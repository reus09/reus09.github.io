<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Jdbc | Reus09&#39;s Blog</title>
<meta name="keywords" content="jdbc">
<meta name="description" content="ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/jdbc/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Jdbc" />
<meta property="og:description" content="ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/jdbc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-24T23:02:23+00:00" />
<meta property="article:modified_time" content="2022-09-11T16:07:31+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jdbc"/>
<meta name="twitter:description" content="ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Jdbc",
      "item": "http://www.reus09.top/posts/tech/jdbc/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Jdbc",
  "name": "Jdbc",
  "description": "ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ",
  "keywords": [
    "jdbc"
  ],
  "articleBody": "ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œæ•°æ®æŒä¹…åŒ–æ„å‘³ç€å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸ŠåŠ ä»¥â€å›ºåŒ–â€ï¼Œè€ŒæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹å¤§å¤šé€šè¿‡å„ç§å…³ç³»æ•°æ®åº“æ¥å®Œæˆã€‚\næŒä¹…åŒ–çš„ä¸»è¦åº”ç”¨æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ã€XMLæ•°æ®æ–‡ä»¶ä¸­ã€‚\n1.2 JDBCç¨‹åºç¼–å†™æ­¥éª¤ æ€»ç»“ä¸€ä¸‹JDBCå»ºç«‹è¿æ¥çš„å…¨è¿‡ç¨‹ã€‚ äºŒï¼šè·å–æ•°æ®åº“è¿æ¥ 2.1 Driveræ¥å£å®ç°ç±» 2.1.1 Driveræ¥å£ä»‹ç» java.sql.Driver æ¥å£æ˜¯æ‰€æœ‰ JDBC é©±åŠ¨ç¨‹åºéœ€è¦å®ç°çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯æä¾›ç»™æ•°æ®åº“å‚å•†ä½¿ç”¨çš„ï¼Œä¸åŒæ•°æ®åº“å‚å•†æä¾›ä¸åŒçš„å®ç°ã€‚\nåœ¨ç¨‹åºä¸­ä¸éœ€è¦ç›´æ¥å»è®¿é—®å®ç°äº† Driver æ¥å£çš„ç±»ï¼Œè€Œæ˜¯ç”±é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»(java.sql.DriverManager)å»è°ƒç”¨è¿™äº›Driverå®ç°ã€‚\nmySqlçš„é©±åŠ¨ï¼šcom.mysql.cj.jdbc.Driver ,æœ€æ–°ç‰ˆçš„é©±åŠ¨å·²æ›´åä¸ºæ­¤ã€‚ è¿™é‡Œè®²ä¸€ä¸‹IDEA å¦‚ä½•å¯¼å…¥mysqlè¿æ¥åº“\næ‰“å¼€Project Structureæ¨¡å—\nç„¶åæŒ‰ç…§å¦‚å›¾æ‰€ç¤ºç‚¹å‡»ï¼Œå³å¯æ·»åŠ jaråŒ…åˆ°é¡¹ç›®è·¯å¾„\n2.1.2 åŠ è½½ä¸æ³¨å†ŒJDBCé©±åŠ¨ åŠ è½½é©±åŠ¨ï¼šåŠ è½½ JDBC é©±åŠ¨éœ€è°ƒç”¨ Class ç±»çš„é™æ€æ–¹æ³• forName()ï¼Œå‘å…¶ä¼ é€’è¦åŠ è½½çš„ JDBC é©±åŠ¨çš„ç±»å\nClass.forName(â€œcom.mysql.cj.jdbc.Driverâ€); æ³¨å†Œé©±åŠ¨ï¼šDriverManager ç±»æ˜¯é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»ï¼Œè´Ÿè´£ç®¡ç†é©±åŠ¨ç¨‹åº\nä½¿ç”¨DriverManager.registerDriver(com.mysql.jc.jdbc.Driver)æ¥æ³¨å†Œé©±åŠ¨\né€šå¸¸ä¸ç”¨æ˜¾å¼è°ƒç”¨ DriverManager ç±»çš„ registerDriver() æ–¹æ³•æ¥æ³¨å†Œé©±åŠ¨ç¨‹åºç±»çš„å®ä¾‹ï¼Œå› ä¸º Driver æ¥å£çš„é©±åŠ¨ç¨‹åºç±»éƒ½åŒ…å«äº†é™æ€ä»£ç å—ï¼Œåœ¨è¿™ä¸ªé™æ€ä»£ç å—ä¸­ï¼Œä¼šè°ƒç”¨ DriverManager.registerDriver() æ–¹æ³•æ¥æ³¨å†Œè‡ªèº«çš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸‹å›¾æ˜¯MySQLçš„Driverå®ç°ç±»çš„æºç ï¼š\n2.2 URL JDBC URL ç”¨äºæ ‡è¯†ä¸€ä¸ªè¢«æ³¨å†Œçš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºç®¡ç†å™¨é€šè¿‡è¿™ä¸ª URL é€‰æ‹©æ­£ç¡®çš„é©±åŠ¨ç¨‹åºï¼Œä»è€Œå»ºç«‹åˆ°æ•°æ®åº“çš„è¿æ¥ã€‚\nä¸¾ä¾‹ï¼š\nè¿™é‡Œæ³¨æ˜ï¼šåœ¨MySQL 8ç‰ˆæœ¬ä»¥ä¸Šçš„urlè¿æ¥éœ€è¦åŠ ä¸Šæ—¶åŒº\njdbc:mysql://localhost:3306/test?serverTimezone=UTC\n2.4 æ•°æ®åº“è¿æ¥æ–¹å¼ è¿æ¥æ–¹å¼äº” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @Test public void testConnection5() throws Exception { //1.åŠ è½½é…ç½®æ–‡ä»¶ InputStream is = ConnectionTest.class.getClassLoader().getResourceAsStream(\"jdbc.properties\"); Properties pros = new Properties(); pros.load(is); //2.è¯»å–é…ç½®ä¿¡æ¯ String user = pros.getProperty(\"user\"); String password = pros.getProperty(\"password\"); String url = pros.getProperty(\"url\"); String driverClass = pros.getProperty(\"driverClass\"); //3.åŠ è½½é©±åŠ¨ Class.forName(driverClass); //4.è·å–è¿æ¥ Connection conn = DriverManager.getConnection(url,user,password); System.out.println(conn); } å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶å£°æ˜åœ¨å·¥ç¨‹çš„srcç›®å½•ä¸‹ï¼šjdbc.properties\n1 2 3 4 user=root password=abc123 url=jdbc:mysql://localhost:3306/test?serverTimezone=UTC driverClass=com.mysql.jc.jdbc.Driver è¯´æ˜ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ä¿å­˜é…ç½®ä¿¡æ¯ï¼Œåœ¨ä»£ç ä¸­åŠ è½½é…ç½®æ–‡ä»¶\nä½¿ç”¨é…ç½®æ–‡ä»¶çš„å¥½å¤„ï¼š\nâ‘ å®ç°äº†ä»£ç å’Œæ•°æ®çš„åˆ†ç¦»ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œä¸éœ€è¦æ·±å…¥ä»£ç  â‘¡å¦‚æœä¿®æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œçœå»é‡æ–°ç¼–è¯‘çš„è¿‡ç¨‹ã€‚\nä¸‰ï¼šä½¿ç”¨PreparedStatementå®ç°CRUDæ“ä½œ 3.1 æ“ä½œå’Œè®¿é—®æ•°æ®åº“ æ•°æ®åº“è¿æ¥è¢«ç”¨äºå‘æ•°æ®åº“æœåŠ¡å™¨å‘é€å‘½ä»¤å’Œ SQL è¯­å¥ï¼Œå¹¶æ¥å—æ•°æ®åº“æœåŠ¡å™¨è¿”å›çš„ç»“æœã€‚å…¶å®ä¸€ä¸ªæ•°æ®åº“è¿æ¥å°±æ˜¯ä¸€ä¸ªSocketè¿æ¥ã€‚\nåœ¨ java.sql åŒ…ä¸­æœ‰ 3 ä¸ªæ¥å£åˆ†åˆ«å®šä¹‰äº†å¯¹æ•°æ®åº“çš„è°ƒç”¨çš„ä¸åŒæ–¹å¼ï¼š\nStatementï¼šç”¨äºæ‰§è¡Œé™æ€ SQL è¯­å¥å¹¶è¿”å›å®ƒæ‰€ç”Ÿæˆç»“æœçš„å¯¹è±¡ã€‚ PrepatedStatementï¼šSQL è¯­å¥è¢«é¢„ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ­¤å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡å¤šæ¬¡é«˜æ•ˆåœ°æ‰§è¡Œè¯¥è¯­å¥ã€‚ CallableStatementï¼šç”¨äºæ‰§è¡Œ SQL å­˜å‚¨è¿‡ç¨‹ å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚\n3.2 PreparedStatementçš„ä½¿ç”¨ 3.2.1 PreparedStatementä»‹ç» PreparedStatement æ¥å£æ˜¯ Statement çš„å­æ¥å£ï¼Œå®ƒè¡¨ç¤ºä¸€æ¡é¢„ç¼–è¯‘è¿‡çš„ SQL è¯­å¥\nPreparedStatement å¯¹è±¡æ‰€ä»£è¡¨çš„ SQL è¯­å¥ä¸­çš„å‚æ•°ç”¨é—®å·(?)æ¥è¡¨ç¤ºï¼Œè°ƒç”¨ PreparedStatement å¯¹è±¡çš„ setXxx() æ–¹æ³•æ¥è®¾ç½®è¿™äº›å‚æ•°. setXxx() æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„ç´¢å¼•(ä» 1 å¼€å§‹)ï¼Œç¬¬äºŒä¸ªæ˜¯è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„å€¼\n3.2.2 PreparedStatement vs Statement ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nPreparedStatement èƒ½æœ€å¤§å¯èƒ½æé«˜æ€§èƒ½ï¼š\nDBServerä¼šå¯¹é¢„ç¼–è¯‘è¯­å¥æä¾›æ€§èƒ½ä¼˜åŒ–ã€‚å› ä¸ºé¢„ç¼–è¯‘è¯­å¥æœ‰å¯èƒ½è¢«é‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥è¯­å¥åœ¨è¢«DBServerçš„ç¼–è¯‘å™¨ç¼–è¯‘åçš„æ‰§è¡Œä»£ç è¢«ç¼“å­˜ä¸‹æ¥ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨æ—¶åªè¦æ˜¯ç›¸åŒçš„é¢„ç¼–è¯‘è¯­å¥å°±ä¸éœ€è¦ç¼–è¯‘ï¼Œåªè¦å°†å‚æ•°ç›´æ¥ä¼ å…¥ç¼–è¯‘è¿‡çš„è¯­å¥æ‰§è¡Œä»£ç ä¸­å°±ä¼šå¾—åˆ°æ‰§è¡Œã€‚ åœ¨statementè¯­å¥ä¸­,å³ä½¿æ˜¯ç›¸åŒæ“ä½œä½†å› ä¸ºæ•°æ®å†…å®¹ä¸ä¸€æ ·,æ‰€ä»¥æ•´ä¸ªè¯­å¥æœ¬èº«ä¸èƒ½åŒ¹é…,æ²¡æœ‰ç¼“å­˜è¯­å¥çš„æ„ä¹‰.äº‹å®æ˜¯æ²¡æœ‰æ•°æ®åº“ä¼šå¯¹æ™®é€šè¯­å¥ç¼–è¯‘åçš„æ‰§è¡Œä»£ç ç¼“å­˜ã€‚è¿™æ ·æ¯æ‰§è¡Œä¸€æ¬¡éƒ½è¦å¯¹ä¼ å…¥çš„è¯­å¥ç¼–è¯‘ä¸€æ¬¡ã€‚ (è¯­æ³•æ£€æŸ¥ï¼Œè¯­ä¹‰æ£€æŸ¥ï¼Œç¿»è¯‘æˆäºŒè¿›åˆ¶å‘½ä»¤ï¼Œç¼“å­˜) å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚\n3.2.3 Javaä¸SQLå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨ Javaç±»å‹ SQLç±»å‹ boolean BIT byte TINYINT short SMALLINT int INTEGER long BIGINT String CHAR,VARCHAR,LONGVARCHAR byte array BINARY , VAR BINARY java.sql.Date DATE java.sql.Time TIME java.sql.Timestamp TIMESTAMP 3.2.4 ä½¿ç”¨PreparedStatementå®ç°å¢ã€åˆ ã€æ”¹æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 //é€šç”¨çš„å¢ã€åˆ ã€æ”¹æ“ä½œï¼ˆä½“ç°ä¸€ï¼šå¢ã€åˆ ã€æ”¹ ï¼› ä½“ç°äºŒï¼šé’ˆå¯¹äºä¸åŒçš„è¡¨ï¼‰ public void update(String sql,Object ... args){ Connection conn = null; PreparedStatement ps = null; try { //1.è·å–æ•°æ®åº“çš„è¿æ¥ conn = JDBCUtils.getConnection(); //2.è·å–PreparedStatementçš„å®ä¾‹ (æˆ–ï¼šé¢„ç¼–è¯‘sqlè¯­å¥) ps = conn.prepareStatement(sql); //3.å¡«å……å ä½ç¬¦ for(int i = 0;i \u003c args.length;i++){ ps.setObject(i + 1, args[i]); } //4.æ‰§è¡Œsqlè¯­å¥ ps.execute(); } catch (Exception e) { e.printStackTrace(); }finally{ //5.å…³é—­èµ„æº JDBCUtils.closeResource(conn, ps); } } 3.2.5 ä½¿ç”¨PreparedStatementå®ç°æŸ¥è¯¢æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // é€šç”¨çš„é’ˆå¯¹äºä¸åŒè¡¨çš„æŸ¥è¯¢:è¿”å›ä¸€ä¸ªå¯¹è±¡ (version 1.0) public T getInstance(Class clazz, String sql, Object... args) { Connection conn = null; PreparedStatement ps = null; ResultSet rs = null; try { // 1.è·å–æ•°æ®åº“è¿æ¥ conn = JDBCUtils.getConnection(); // 2.é¢„ç¼–è¯‘sqlè¯­å¥ï¼Œå¾—åˆ°PreparedStatementå¯¹è±¡ ps = conn.prepareStatement(sql); // 3.å¡«å……å ä½ç¬¦ for (int i = 0; i \u003c args.length; i++) { ps.setObject(i + 1, args[i]); } // 4.æ‰§è¡ŒexecuteQuery(),å¾—åˆ°ç»“æœé›†ï¼šResultSet rs = ps.executeQuery(); // 5.å¾—åˆ°ç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData ResultSetMetaData rsmd = rs.getMetaData(); // 6.1é€šè¿‡ResultSetMetaDataå¾—åˆ°columnCount,columnLabelï¼›é€šè¿‡ResultSetå¾—åˆ°åˆ—å€¼ int columnCount = rsmd.getColumnCount(); if (rs.next()) { T t = clazz.newInstance(); for (int i = 0; i \u003c columnCount; i++) {// éå†æ¯ä¸€ä¸ªåˆ— // è·å–åˆ—å€¼ Object columnVal = rs.getObject(i + 1); // è·å–åˆ—çš„åˆ«å:åˆ—çš„åˆ«åï¼Œä½¿ç”¨ç±»çš„å±æ€§åå……å½“ String columnLabel = rsmd.getColumnLabel(i + 1); // 6.2ä½¿ç”¨åå°„ï¼Œç»™å¯¹è±¡çš„ç›¸åº”å±æ€§èµ‹å€¼ Field field = clazz.getDeclaredField(columnLabel); field.setAccessible(true); field.set(t, columnVal); } return t; } } catch (Exception e) { e.printStackTrace(); } finally { // 7.å…³é—­èµ„æº JDBCUtils.closeResource(conn, ps, rs); } return null; } 3.3 ResultSetä¸ResultSetMetaData 3.3.1 ResultSet æŸ¥è¯¢éœ€è¦è°ƒç”¨PreparedStatement çš„ executeQuery() æ–¹æ³•ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸€ä¸ªResultSet å¯¹è±¡\nResultSet å¯¹è±¡ä»¥é€»è¾‘è¡¨æ ¼çš„å½¢å¼å°è£…äº†æ‰§è¡Œæ•°æ®åº“æ“ä½œçš„ç»“æœé›†ï¼ŒResultSet æ¥å£ç”±æ•°æ®åº“å‚å•†æä¾›å®ç°\nResultSet è¿”å›çš„å®é™…ä¸Šå°±æ˜¯ä¸€å¼ æ•°æ®è¡¨ã€‚æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®è¡¨çš„ç¬¬ä¸€æ¡è®°å½•çš„å‰é¢ã€‚\nResultSet å¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å½“å‰æ•°æ®è¡Œçš„æ¸¸æ ‡ï¼Œåˆå§‹çš„æ—¶å€™ï¼Œæ¸¸æ ‡åœ¨ç¬¬ä¸€è¡Œä¹‹å‰ï¼Œå¯ä»¥é€šè¿‡ ResultSet å¯¹è±¡çš„ next() æ–¹æ³•ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œã€‚è°ƒç”¨ next()æ–¹æ³•æ£€æµ‹ä¸‹ä¸€è¡Œæ˜¯å¦æœ‰æ•ˆã€‚è‹¥æœ‰æ•ˆï¼Œè¯¥æ–¹æ³•è¿”å› trueï¼Œä¸”æŒ‡é’ˆä¸‹ç§»ã€‚ç›¸å½“äºIteratorå¯¹è±¡çš„ hasNext() å’Œ next() æ–¹æ³•çš„ç»“åˆä½“ã€‚\nå½“æŒ‡é’ˆæŒ‡å‘ä¸€è¡Œæ—¶, å¯ä»¥é€šè¿‡è°ƒç”¨ getXxx(int index) æˆ– getXxx(int columnName) è·å–æ¯ä¸€åˆ—çš„å€¼ã€‚\nä¾‹å¦‚: getInt(1), getString(â€œnameâ€) æ³¨æ„ï¼šJavaä¸æ•°æ®åº“äº¤äº’æ¶‰åŠåˆ°çš„ç›¸å…³Java APIä¸­çš„ç´¢å¼•éƒ½ä»1å¼€å§‹ã€‚ ResultSet æ¥å£çš„å¸¸ç”¨æ–¹æ³•ï¼š\nboolean next() getString() 3.3.2 ResultSetMetaData å¯ç”¨äºè·å–å…³äº ResultSet å¯¹è±¡ä¸­åˆ—çš„ç±»å‹å’Œå±æ€§ä¿¡æ¯çš„å¯¹è±¡\nResultSetMetaData meta = rs.getMetaData();\ngetColumnName(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åç§°\ngetColumnLabel(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åˆ«å\ngetColumnCount()ï¼šè¿”å›å½“å‰ ResultSet å¯¹è±¡ä¸­çš„åˆ—æ•°ã€‚\ngetColumnTypeName(int column)ï¼šæ£€ç´¢æŒ‡å®šåˆ—çš„æ•°æ®åº“ç‰¹å®šçš„ç±»å‹åç§°ã€‚\ngetColumnDisplaySize(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—çš„æœ€å¤§æ ‡å‡†å®½åº¦ï¼Œä»¥å­—ç¬¦ä¸ºå•ä½ã€‚\nisNullable(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—ä¸­çš„å€¼æ˜¯å¦å¯ä»¥ä¸º nullã€‚\nisAutoIncrement(int column)ï¼šæŒ‡ç¤ºæ˜¯å¦è‡ªåŠ¨ä¸ºæŒ‡å®šåˆ—è¿›è¡Œç¼–å·ï¼Œè¿™æ ·è¿™äº›åˆ—ä»ç„¶æ˜¯åªè¯»çš„ã€‚\né—®é¢˜1ï¼šå¾—åˆ°ç»“æœé›†å, å¦‚ä½•çŸ¥é“è¯¥ç»“æœé›†ä¸­æœ‰å“ªäº›åˆ— ï¼Ÿ åˆ—åæ˜¯ä»€ä¹ˆï¼Ÿ\nâ€‹ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæè¿° ResultSet çš„å¯¹è±¡ï¼Œ å³ ResultSetMetaData\né—®é¢˜2ï¼šå…³äºResultSetMetaData\nå¦‚ä½•è·å– ResultSetMetaDataï¼š è°ƒç”¨ ResultSet çš„ getMetaData() æ–¹æ³•å³å¯ è·å– ResultSet ä¸­æœ‰å¤šå°‘åˆ—ï¼šè°ƒç”¨ ResultSetMetaData çš„ getColumnCount() æ–¹æ³• è·å– ResultSet æ¯ä¸€åˆ—çš„åˆ—çš„åˆ«åæ˜¯ä»€ä¹ˆï¼šè°ƒç”¨ ResultSetMetaData çš„getColumnLabel() æ–¹æ³• 3.4 èµ„æºçš„é‡Šæ”¾ æ•°æ®åº“ç»“æŸåä¸€å®šè¦å…³é—­æ‰€æœ‰çš„è¿æ¥ 3.6 JDBC APIå°ç»“ ä¸¤ç§æ€æƒ³\né¢å‘æ¥å£ç¼–ç¨‹çš„æ€æƒ³ ORMæ€æƒ³(object relational mapping) ä¸€ä¸ªæ•°æ®è¡¨å¯¹åº”ä¸€ä¸ªjavaç±» è¡¨ä¸­çš„ä¸€æ¡è®°å½•å¯¹åº”javaç±»çš„ä¸€ä¸ªå¯¹è±¡ è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µå¯¹åº”javaç±»çš„ä¸€ä¸ªå±æ€§ sqlæ˜¯éœ€è¦ç»“åˆåˆ—åå’Œè¡¨çš„å±æ€§åæ¥å†™ã€‚æ³¨æ„èµ·åˆ«åã€‚\nä¸¤ç§æŠ€æœ¯\nJDBCç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData è·å–åˆ—æ•°ï¼šgetColumnCount() è·å–åˆ—çš„åˆ«åï¼šgetColumnLabel() é€šè¿‡åå°„ï¼Œåˆ›å»ºæŒ‡å®šç±»çš„å¯¹è±¡ï¼Œè·å–æŒ‡å®šçš„å±æ€§å¹¶èµ‹å€¼ å››ï¼š æ“ä½œBLOBç±»å‹å­—æ®µ 4.1 MySQL BLOBç±»å‹ MySQLä¸­ï¼ŒBLOBæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®çš„å®¹å™¨ï¼Œå®ƒèƒ½å®¹çº³ä¸åŒå¤§å°çš„æ•°æ®ã€‚\næ’å…¥BLOBç±»å‹çš„æ•°æ®å¿…é¡»ä½¿ç”¨PreparedStatementï¼Œå› ä¸ºBLOBç±»å‹çš„æ•°æ®æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å†™çš„ã€‚\nMySQLçš„å››ç§BLOBç±»å‹(é™¤äº†åœ¨å­˜å‚¨çš„æœ€å¤§ä¿¡æ¯é‡ä¸Šä¸åŒå¤–ï¼Œä»–ä»¬æ˜¯ç­‰åŒçš„)\nå¦‚æœåœ¨æŒ‡å®šäº†ç›¸å…³çš„Blobç±»å‹ä»¥åï¼Œè¿˜æŠ¥é”™ï¼šxxx too largeï¼Œé‚£ä¹ˆåœ¨mysqlçš„å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾my.iniæ–‡ä»¶åŠ ä¸Šå¦‚ä¸‹çš„é…ç½®å‚æ•°ï¼š max_allowed_packet=16Mã€‚åŒæ—¶æ³¨æ„ï¼šä¿®æ”¹äº†my.iniæ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡æ–°å¯åŠ¨mysqlæœåŠ¡ã€‚ 4.2 å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 //è·å–è¿æ¥ Connection conn = JDBCUtils.getConnection(); String sql = \"insert into customers(name,email,birth,photo)values(?,?,?,?)\"; PreparedStatement ps = conn.prepareStatement(sql); // å¡«å……å ä½ç¬¦ ps.setString(1, \"å¾æµ·å¼º\"); ps.setString(2, \"xhq@126.com\"); ps.setDate(3, new Date(new java.util.Date().getTime())); // æ“ä½œBlobç±»å‹çš„å˜é‡ FileInputStream fis = new FileInputStream(\"xhq.png\"); ps.setBlob(4, fis); //æ‰§è¡Œ ps.execute(); fis.close(); JDBCUtils.closeResource(conn, ps); 4.3 ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„Blobç±»å‹å­—æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Connection conn = JDBCUtils.getConnection(); String sql = \"update customers set photo = ? where id = ?\"; PreparedStatement ps = conn.prepareStatement(sql); // å¡«å……å ä½ç¬¦ // æ“ä½œBlobç±»å‹çš„å˜é‡ FileInputStream fis = new FileInputStream(\"coffee.png\"); ps.setBlob(1, fis); ps.setInt(2, 25); ps.execute(); fis.close(); JDBCUtils.closeResource(conn, ps); 4.4 ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 String sql = \"SELECT id, name, email, birth, photo FROM customer WHERE id = ?\"; conn = getConnection(); ps = conn.prepareStatement(sql); ps.setInt(1, 8); rs = ps.executeQuery(); if(rs.next()){ Integer id = rs.getInt(1); String name = rs.getString(2); String email = rs.getString(3); Date birth = rs.getDate(4); Customer cust = new Customer(id, name, email, birth); System.out.println(cust); //è¯»å–Blobç±»å‹çš„å­—æ®µ Blob photo = rs.getBlob(5); InputStream is = photo.getBinaryStream(); OutputStream os = new FileOutputStream(\"c.jpg\"); byte [] buffer = new byte[1024]; int len = 0; while((len = is.read(buffer)) != -1){ os.write(buffer, 0, len); } JDBCUtils.closeResource(conn, ps, rs); if(is != null){ is.close(); } if(os != null){ os.close(); } } äº”ï¼š æ‰¹é‡æ’å…¥ 5.1 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥ å½“éœ€è¦æˆæ‰¹æ’å…¥æˆ–è€…æ›´æ–°è®°å½•æ—¶ï¼Œå¯ä»¥é‡‡ç”¨Javaçš„æ‰¹é‡æ›´æ–°æœºåˆ¶ï¼Œè¿™ä¸€æœºåˆ¶å…è®¸å¤šæ¡è¯­å¥ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“æ‰¹é‡å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹æ¯”å•ç‹¬æäº¤å¤„ç†æ›´æœ‰æ•ˆç‡\nJDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼š\naddBatch(String)ï¼šæ·»åŠ éœ€è¦æ‰¹é‡å¤„ç†çš„SQLè¯­å¥æˆ–æ˜¯å‚æ•°ï¼› executeBatch()ï¼šæ‰§è¡Œæ‰¹é‡å¤„ç†è¯­å¥ï¼› clearBatch():æ¸…ç©ºç¼“å­˜çš„æ•°æ® é€šå¸¸æˆ‘ä»¬ä¼šé‡åˆ°ä¸¤ç§æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„æƒ…å†µï¼š\nå¤šæ¡SQLè¯­å¥çš„æ‰¹é‡å¤„ç†ï¼› ä¸€ä¸ªSQLè¯­å¥çš„æ‰¹é‡ä¼ å‚ï¼› 5.2 é«˜æ•ˆçš„æ‰¹é‡æ’å…¥ ä¸¾ä¾‹ï¼šå‘æ•°æ®è¡¨ä¸­æ’å…¥20000æ¡æ•°æ® 5.2.1 å®ç°å±‚æ¬¡ä¸€ï¼šä½¿ç”¨Statement 1 2 3 4 5 6 Connection conn = JDBCUtils.getConnection(); Statement st = conn.createStatement(); for(int i = 1;i \u003c= 20000;i++){ String sql = \"insert into goods(name) values('name_' + \"+ i +\")\"; st.executeUpdate(sql); } 5.2.2 å®ç°å±‚æ¬¡äºŒï¼šä½¿ç”¨PreparedStatement 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); String sql = \"insert into goods(name)values(?)\"; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u003c= 20000;i++){ ps.setString(1, \"name_\" + i); ps.executeUpdate(); } long end = System.currentTimeMillis(); System.out.println(\"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\" + (end - start));//82340 JDBCUtils.closeResource(conn, ps); æ³•äºŒæ¯”æ³•ä¸€å¿«çš„åŸå› æ˜¯ï¼šPrepareStatementå¯ä»¥ç»™sqlæå‰é¢„å¤‡å¥½ï¼Œå®é™…ä¸Šï¼Œsqlåªéœ€è¦æ‹¼æ¥ä¸€æ¬¡ï¼Œè€Œstatementéœ€è¦æ‹¼æ¥å¤šæ¬¡ã€‚ 5.2.3 å®ç°å±‚æ¬¡ä¸‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 /* * ä¿®æ”¹1ï¼š ä½¿ç”¨ addBatch() / executeBatch() / clearBatch() * ä¿®æ”¹2ï¼šmysqlæœåŠ¡å™¨é»˜è®¤æ˜¯å…³é—­æ‰¹å¤„ç†çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªå‚æ•°ï¼Œè®©mysqlå¼€å¯æ‰¹å¤„ç†çš„æ”¯æŒã€‚ * ?rewriteBatchedStatements=true å†™åœ¨é…ç½®æ–‡ä»¶çš„urlåé¢ * ä¿®æ”¹3ï¼šä½¿ç”¨æ›´æ–°çš„mysql é©±åŠ¨ï¼šmysql-connector-java-5.1.37-bin.jar * */ @Test public void testInsert1() throws Exception{ long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); String sql = \"insert into goods(name)values(?)\"; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u003c= 1000000;i++){ ps.setString(1, \"name_\" + i); //1.â€œæ”’â€sql ps.addBatch(); if(i % 500 == 0){ //2.æ‰§è¡Œ ps.executeBatch(); //3.æ¸…ç©º ps.clearBatch(); } } long end = System.currentTimeMillis(); System.out.println(\"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\" + (end - start));//20000æ¡ï¼š625 //1000000æ¡:14733 JDBCUtils.closeResource(conn, ps); } æ³•ä¸‰æ˜¯åˆ©ç”¨Batch,ç›¸å½“äºä¸€ä¸ªæ± å­ï¼Œå½“ç§¯ç´¯çš„è¯·æ±‚è¾¾åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œé›†ä¸­è¿›è¡Œæ‰§è¡Œã€‚ 5.2.4 å®ç°å±‚æ¬¡å›› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /* * å±‚æ¬¡å››ï¼šåœ¨å±‚æ¬¡ä¸‰çš„åŸºç¡€ä¸Šæ“ä½œ * ä½¿ç”¨Connection çš„ setAutoCommit(false) / commit() */ @Test public void testInsert2() throws Exception{ long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); //1.è®¾ç½®ä¸ºä¸è‡ªåŠ¨æäº¤æ•°æ® conn.setAutoCommit(false); String sql = \"insert into goods(name)values(?)\"; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u003c= 1000000;i++){ ps.setString(1, \"name_\" + i); //1.â€œæ”’â€sql ps.addBatch(); if(i % 500 == 0){ //2.æ‰§è¡Œ ps.executeBatch(); //3.æ¸…ç©º ps.clearBatch(); } } //2.æäº¤æ•°æ® conn.commit(); long end = System.currentTimeMillis(); System.out.println(\"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\" + (end - start));//1000000æ¡:4978 JDBCUtils.closeResource(conn, ps); } æ³•å›› ç›¸æ¯”è¾ƒæ³•ä¸‰ï¼Œ åªéœ€è¦æäº¤ä¸€æ¬¡ã€‚io è¯·æ±‚å‡å°‘ã€‚ å…­ï¼š æ•°æ®åº“äº‹åŠ¡ 6.1 æ•°æ®åº“äº‹åŠ¡ä»‹ç» äº‹åŠ¡ï¼šä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒ,ä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚\näº‹åŠ¡å¤„ç†ï¼ˆäº‹åŠ¡æ“ä½œï¼‰ï¼šä¿è¯æ‰€æœ‰äº‹åŠ¡éƒ½ä½œä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒæ¥æ‰§è¡Œï¼Œå³ä½¿å‡ºç°äº†æ•…éšœï¼Œéƒ½ä¸èƒ½æ”¹å˜è¿™ç§æ‰§è¡Œæ–¹å¼ã€‚å½“åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰çš„äº‹åŠ¡éƒ½è¢«æäº¤(commit)ï¼Œé‚£ä¹ˆè¿™äº›ä¿®æ”¹å°±æ°¸ä¹…åœ°ä¿å­˜ä¸‹æ¥ï¼›è¦ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå°†æ”¾å¼ƒæ‰€ä½œçš„æ‰€æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªäº‹åŠ¡**å›æ»š(rollback)**åˆ°æœ€åˆçŠ¶æ€ã€‚\nä¸ºç¡®ä¿æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®çš„æ“çºµåº”å½“æ˜¯ç¦»æ•£çš„æˆç»„çš„é€»è¾‘å•å…ƒï¼šå½“å®ƒå…¨éƒ¨å®Œæˆæ—¶ï¼Œæ•°æ®çš„ä¸€è‡´æ€§å¯ä»¥ä¿æŒï¼Œè€Œå½“è¿™ä¸ªå•å…ƒä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡åº”å…¨éƒ¨è§†ä¸ºé”™è¯¯ï¼Œæ‰€æœ‰ä»èµ·å§‹ç‚¹ä»¥åçš„æ“ä½œåº”å…¨éƒ¨å›é€€åˆ°å¼€å§‹çŠ¶æ€ã€‚\n6.2 äº‹åŠ¡çš„ACIDå±æ€§ åŸå­æ€§ï¼ˆAtomicityï¼‰ åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚\néš”ç¦»æ€§ï¼ˆIsolationï¼‰ äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚\næŒä¹…æ€§ï¼ˆDurabilityï¼‰ æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œå’Œæ•°æ®åº“æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚\n6.3.1 æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ å¯¹äºåŒæ—¶è¿è¡Œçš„å¤šä¸ªäº‹åŠ¡, å½“è¿™äº›äº‹åŠ¡è®¿é—®æ•°æ®åº“ä¸­ç›¸åŒçš„æ•°æ®æ—¶, å¦‚æœæ²¡æœ‰é‡‡å–å¿…è¦çš„éš”ç¦»æœºåˆ¶, å°±ä¼šå¯¼è‡´å„ç§å¹¶å‘é—®é¢˜:\nè„è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡ T1, T2, T1 è¯»å–äº†å·²ç»è¢« T2 æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µã€‚ä¹‹å, è‹¥ T2 å›æ»š, T1è¯»å–çš„å†…å®¹å°±æ˜¯ä¸´æ—¶ä¸”æ— æ•ˆçš„ã€‚ ä¸å¯é‡å¤è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 æ›´æ–°äº†è¯¥å­—æ®µã€‚ä¹‹å, T1å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µ, å€¼å°±ä¸åŒäº†ã€‚ å¹»è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 åœ¨è¯¥è¡¨ä¸­æ’å…¥äº†ä¸€äº›æ–°çš„è¡Œã€‚ä¹‹å, å¦‚æœ T1 å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œã€‚ æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»æ€§: æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›, ä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“, é¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚\nä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚æ•°æ®åº“è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«, ä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦, éš”ç¦»çº§åˆ«è¶Šé«˜, æ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½, ä½†å¹¶å‘æ€§è¶Šå¼±ã€‚\n6.3.2 å››ç§éš”ç¦»çº§åˆ« æ•°æ®åº“æä¾›çš„4ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š\nOracle æ”¯æŒçš„ 2 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREAD COMMITED, SERIALIZABLEã€‚ Oracle é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: READ COMMITED ã€‚\nMysql æ”¯æŒ 4 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚Mysql é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: REPEATABLE READã€‚\n6.3.3 åœ¨MySqlä¸­è®¾ç½®éš”ç¦»çº§åˆ« æ¯å¯åŠ¨ä¸€ä¸ª mysql ç¨‹åº, å°±ä¼šè·å¾—ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“è¿æ¥. æ¯ä¸ªæ•°æ®åº“è¿æ¥éƒ½æœ‰ä¸€ä¸ªå…¨å±€å˜é‡ @@tx_isolation, è¡¨ç¤ºå½“å‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚\næŸ¥çœ‹å½“å‰çš„éš”ç¦»çº§åˆ«:\n1 SELECT @@tx_isolation; è®¾ç½®å½“å‰ mySQL è¿æ¥çš„éš”ç¦»çº§åˆ«:\n1 set transaction isolation level read committed; è®¾ç½®æ•°æ®åº“ç³»ç»Ÿçš„å…¨å±€çš„éš”ç¦»çº§åˆ«:\n1 set global transaction isolation level read committed; è¡¥å……æ“ä½œï¼š\nåˆ›å»ºmysqlæ•°æ®åº“ç”¨æˆ·ï¼š\n1 create user tom identified by 'abc123'; æˆäºˆæƒé™\n1 2 3 4 5 #æˆäºˆé€šè¿‡ç½‘ç»œæ–¹å¼ç™»å½•çš„tomç”¨æˆ·ï¼Œå¯¹æ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„å…¨éƒ¨æƒé™ï¼Œå¯†ç è®¾ä¸ºabc123. grant all privileges on *.* to tom@'%' identified by 'abc123'; #ç»™tomç”¨æˆ·ä½¿ç”¨æœ¬åœ°å‘½ä»¤è¡Œæ–¹å¼ï¼Œæˆäºˆatguigudbè¿™ä¸ªåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„æ’åˆ æ”¹æŸ¥çš„æƒé™ã€‚ grant select,insert,delete,update on atguigudb.* to tom@localhost identified by 'abc123'; ä¸ƒï¼šDAOåŠç›¸å…³å®ç°ç±» DAOï¼šData Access Objectè®¿é—®æ•°æ®ä¿¡æ¯çš„ç±»å’Œæ¥å£ï¼ŒåŒ…æ‹¬äº†å¯¹æ•°æ®çš„CRUDï¼ˆCreateã€Retrivalã€Updateã€Deleteï¼‰ï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚æœ‰æ—¶ä¹Ÿç§°ä½œï¼šBaseDAO ä½œç”¨ï¼šä¸ºäº†å®ç°åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œæ›´æœ‰åˆ©äºä»£ç çš„ç»´æŠ¤å’Œå‡çº§ã€‚ ã€BaseDAO.javaã€‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 package com.atguigu.bookstore.dao; import java.lang.reflect.ParameterizedType; import java.lang.reflect.Type; import java.sql.Connection; import java.sql.SQLException; import java.util.List; import org.apache.commons.dbutils.QueryRunner; import org.apache.commons.dbutils.handlers.BeanHandler; import org.apache.commons.dbutils.handlers.BeanListHandler; import org.apache.commons.dbutils.handlers.ScalarHandler; /** * å®šä¹‰ä¸€ä¸ªç”¨æ¥è¢«ç»§æ‰¿çš„å¯¹æ•°æ®åº“è¿›è¡ŒåŸºæœ¬æ“ä½œçš„Dao * * @author HanYanBing * * @param */ public abstract class BaseDao { private QueryRunner queryRunner = new QueryRunner(); // å®šä¹‰ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶æ³›å‹çš„ç±»å‹ private Class type; // è·å–Tçš„Classå¯¹è±¡ï¼Œè·å–æ³›å‹çš„ç±»å‹ï¼Œæ³›å‹æ˜¯åœ¨è¢«å­ç±»ç»§æ‰¿æ—¶æ‰ç¡®å®š public BaseDao() { // è·å–å­ç±»çš„ç±»å‹ Class clazz = this.getClass(); // è·å–çˆ¶ç±»çš„ç±»å‹ // getGenericSuperclass()ç”¨æ¥è·å–å½“å‰ç±»çš„çˆ¶ç±»çš„ç±»å‹ // ParameterizedTypeè¡¨ç¤ºçš„æ˜¯å¸¦æ³›å‹çš„ç±»å‹ ParameterizedType parameterizedType = (ParameterizedType) clazz.getGenericSuperclass(); // è·å–å…·ä½“çš„æ³›å‹ç±»å‹ getActualTypeArgumentsè·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹ // è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªTypeçš„æ•°ç»„ Type[] types = parameterizedType.getActualTypeArguments(); // è·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹Â· this.type = (Class) types[0]; } /** * é€šç”¨çš„å¢åˆ æ”¹æ“ä½œ * * @param sql * @param params * @return */ public int update(Connection conn,String sql, Object... params) { int count = 0; try { count = queryRunner.update(conn, sql, params); } catch (SQLException e) { e.printStackTrace(); } return count; } /** * è·å–ä¸€ä¸ªå¯¹è±¡ * * @param sql * @param params * @return */ public T getBean(Connection conn,String sql, Object... params) { T t = null; try { t = queryRunner.query(conn, sql, new BeanHandler(type), params); } catch (SQLException e) { e.printStackTrace(); } return t; } /** * è·å–æ‰€æœ‰å¯¹è±¡ * * @param sql * @param params * @return */ public List getBeanList(Connection conn,String sql, Object... params) { List list = null; try { list = queryRunner.query(conn, sql, new BeanListHandler(type), params); } catch (SQLException e) { e.printStackTrace(); } return list; } /** * è·å–ä¸€ä¸ªä½†ä¸€å€¼å¾—æ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œåƒ select count(*)...è¿™æ ·çš„sqlè¯­å¥ * * @param sql * @param params * @return */ public Object getValue(Connection conn,String sql, Object... params) { Object count = null; try { // è°ƒç”¨queryRunnerçš„queryæ–¹æ³•è·å–ä¸€ä¸ªå•ä¸€çš„å€¼ count = queryRunner.query(conn, sql, new ScalarHandler\u003c\u003e(), params); } catch (SQLException e) { e.printStackTrace(); } return count; } } ä¹‹åå¯ä»¥å»ºç«‹ç›¸å…³çš„è¡¨ã€æ¥å£ï¼Œè¿›è€Œå°†å¯¹åº”è¡¨çš„DMLæ–¹æ³•å®ç° è¿™é‡Œä»¥customerè¡¨ä¸ºä¾‹å­ å…«ï¼šæ•°æ®åº“è¿æ¥æ±  8.1 æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ ä¸ºè§£å†³ä¼ ç»Ÿå¼€å‘ä¸­çš„æ•°æ®åº“è¿æ¥é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ã€‚\næ•°æ®åº“è¿æ¥æ± çš„åŸºæœ¬æ€æƒ³ï¼šå°±æ˜¯ä¸ºæ•°æ®åº“è¿æ¥å»ºç«‹ä¸€ä¸ªâ€œç¼“å†²æ± â€ã€‚é¢„å…ˆåœ¨ç¼“å†²æ± ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œå½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€ä»â€œç¼“å†²æ± â€ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•ä¹‹åå†æ”¾å›å»ã€‚\næ•°æ®åº“è¿æ¥æ± è´Ÿè´£åˆ†é…ã€ç®¡ç†å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºé‡å¤ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸æ˜¯é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚\næ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–æ—¶å°†åˆ›å»ºä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥æ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œè¿™äº›æ•°æ®åº“è¿æ¥çš„æ•°é‡æ˜¯ç”±æœ€å°æ•°æ®åº“è¿æ¥æ•°æ¥è®¾å®šçš„ã€‚æ— è®ºè¿™äº›æ•°æ®åº“è¿æ¥æ˜¯å¦è¢«ä½¿ç”¨ï¼Œè¿æ¥æ± éƒ½å°†ä¸€ç›´ä¿è¯è‡³å°‘æ‹¥æœ‰è¿™ä¹ˆå¤šçš„è¿æ¥æ•°é‡ã€‚è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°é‡é™å®šäº†è¿™ä¸ªè¿æ¥æ± èƒ½å æœ‰çš„æœ€å¤§è¿æ¥æ•°ï¼Œå½“åº”ç”¨ç¨‹åºå‘è¿æ¥æ± è¯·æ±‚çš„è¿æ¥æ•°è¶…è¿‡æœ€å¤§è¿æ¥æ•°é‡æ—¶ï¼Œè¿™äº›è¯·æ±‚å°†è¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚\nå·¥ä½œåŸç†ï¼š æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯çš„ä¼˜ç‚¹\n1. èµ„æºé‡ç”¨\nç”±äºæ•°æ®åº“è¿æ¥å¾—ä»¥é‡ç”¨ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºï¼Œé‡Šæ”¾è¿æ¥å¼•èµ·çš„å¤§é‡æ€§èƒ½å¼€é”€ã€‚åœ¨å‡å°‘ç³»ç»Ÿæ¶ˆè€—çš„åŸºç¡€ä¸Šï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¢åŠ äº†ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„å¹³ç¨³æ€§ã€‚\n2. æ›´å¿«çš„ç³»ç»Ÿååº”é€Ÿåº¦\næ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å·²ç»åˆ›å»ºäº†è‹¥å¹²æ•°æ®åº“è¿æ¥ç½®äºè¿æ¥æ± ä¸­å¤‡ç”¨ã€‚æ­¤æ—¶è¿æ¥çš„åˆå§‹åŒ–å·¥ä½œå‡å·²å®Œæˆã€‚å¯¹äºä¸šåŠ¡è¯·æ±‚å¤„ç†è€Œè¨€ï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„æ—¶é—´å¼€é”€ï¼Œä»è€Œå‡å°‘äº†ç³»ç»Ÿçš„å“åº”æ—¶é—´\n3. æ–°çš„èµ„æºåˆ†é…æ‰‹æ®µ\nå¯¹äºå¤šåº”ç”¨å…±äº«åŒä¸€æ•°æ®åº“çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¯åœ¨åº”ç”¨å±‚é€šè¿‡æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œå®ç°æŸä¸€åº”ç”¨æœ€å¤§å¯ç”¨æ•°æ®åº“è¿æ¥æ•°çš„é™åˆ¶ï¼Œé¿å…æŸä¸€åº”ç”¨ç‹¬å æ‰€æœ‰çš„æ•°æ®åº“èµ„æº\n4. ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼\nåœ¨è¾ƒä¸ºå®Œå–„çš„æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶å›æ”¶è¢«å ç”¨è¿æ¥ï¼Œä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„éœ²\n8.2 å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ±  JDBC çš„æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ javax.sql.DataSource æ¥è¡¨ç¤ºï¼ŒDataSource åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£é€šå¸¸ç”±æœåŠ¡å™¨(Weblogic, WebSphere, Tomcat)æä¾›å®ç°ï¼Œä¹Ÿæœ‰ä¸€äº›å¼€æºç»„ç»‡æä¾›å®ç°ï¼š DBCP æ˜¯Apacheæä¾›çš„æ•°æ®åº“è¿æ¥æ± ã€‚tomcat æœåŠ¡å™¨è‡ªå¸¦dbcpæ•°æ®åº“è¿æ¥æ± ã€‚é€Ÿåº¦ç›¸å¯¹c3p0è¾ƒå¿«ï¼Œä½†å› è‡ªèº«å­˜åœ¨BUGï¼ŒHibernate3å·²ä¸å†æä¾›æ”¯æŒã€‚ C3P0 æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œ**é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œç¨³å®šæ€§è¿˜å¯ä»¥ã€‚**hibernateå®˜æ–¹æ¨èä½¿ç”¨ Proxool æ˜¯sourceforgeä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®æ•°æ®åº“è¿æ¥æ± ï¼Œæœ‰ç›‘æ§è¿æ¥æ± çŠ¶æ€çš„åŠŸèƒ½ï¼Œç¨³å®šæ€§è¾ƒc3p0å·®ä¸€ç‚¹ BoneCP æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œé€Ÿåº¦å¿« Druid æ˜¯é˜¿é‡Œæä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ®è¯´æ˜¯é›†DBCP ã€C3P0 ã€Proxool ä¼˜ç‚¹äºä¸€èº«çš„æ•°æ®åº“è¿æ¥æ± ï¼Œä½†æ˜¯é€Ÿåº¦ä¸ç¡®å®šæ˜¯å¦æœ‰BoneCPå¿« DataSource é€šå¸¸è¢«ç§°ä¸ºæ•°æ®æºï¼Œå®ƒåŒ…å«è¿æ¥æ± å’Œè¿æ¥æ± ç®¡ç†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¹ æƒ¯ä¸Šä¹Ÿç»å¸¸æŠŠ DataSource ç§°ä¸ºè¿æ¥æ±  DataSourceç”¨æ¥å–ä»£DriverManageræ¥è·å–Connectionï¼Œè·å–é€Ÿåº¦å¿«ï¼ŒåŒæ—¶å¯ä»¥å¤§å¹…åº¦æé«˜æ•°æ®åº“è®¿é—®é€Ÿåº¦ã€‚ ç‰¹åˆ«æ³¨æ„ï¼š æ•°æ®æºå’Œæ•°æ®åº“è¿æ¥ä¸åŒï¼Œæ•°æ®æºæ— éœ€åˆ›å»ºå¤šä¸ªï¼Œå®ƒæ˜¯äº§ç”Ÿæ•°æ®åº“è¿æ¥çš„å·¥å‚ï¼Œå› æ­¤æ•´ä¸ªåº”ç”¨åªéœ€è¦ä¸€ä¸ªæ•°æ®æºå³å¯ã€‚ å½“æ•°æ®åº“è®¿é—®ç»“æŸåï¼Œç¨‹åºè¿˜æ˜¯åƒä»¥å‰ä¸€æ ·å…³é—­æ•°æ®åº“è¿æ¥ï¼šconn.close(); ä½†conn.close()å¹¶æ²¡æœ‰å…³é—­æ•°æ®åº“çš„ç‰©ç†è¿æ¥ï¼Œå®ƒä»…ä»…æŠŠæ•°æ®åº“è¿æ¥é‡Šæ”¾ï¼Œå½’è¿˜ç»™äº†æ•°æ®åº“è¿æ¥æ± ã€‚ 8.2.1 Druidï¼ˆå¾·é²ä¼Šï¼‰æ•°æ®åº“è¿æ¥æ±  Druidæ˜¯é˜¿é‡Œå·´å·´å¼€æºå¹³å°ä¸Šä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å®ç°ï¼Œå®ƒç»“åˆäº†C3P0ã€DBCPã€Proxoolç­‰DBæ± çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åŠ å…¥äº†æ—¥å¿—ç›‘æ§ï¼Œå¯ä»¥å¾ˆå¥½çš„ç›‘æ§DBæ± è¿æ¥å’ŒSQLçš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥è¯´æ˜¯é’ˆå¯¹ç›‘æ§è€Œç”Ÿçš„DBè¿æ¥æ± ï¼Œå¯ä»¥è¯´æ˜¯ç›®å‰æœ€å¥½çš„è¿æ¥æ± ä¹‹ä¸€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package com.atguigu.druid; import java.sql.Connection; import java.util.Properties; import javax.sql.DataSource; import com.alibaba.druid.pool.DruidDataSourceFactory; public class TestDruid { public static void main(String[] args) throws Exception { Properties pro = new Properties();\tpro.load(TestDruid.class.getClassLoader().getResourceAsStream(\"druid.properties\")); DataSource ds = DruidDataSourceFactory.createDataSource(pro); Connection conn = ds.getConnection(); System.out.println(conn); } } å…¶ä¸­ï¼Œsrcä¸‹çš„é…ç½®æ–‡ä»¶ä¸ºï¼šã€druid.propertiesã€‘\n1 2 3 4 5 6 7 8 9 url=jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=true username=root password=123456 driverClassName=com.mysql.jdbc.Driver initialSize=10 maxActive=20 maxWait=1000 filters=wall è¯¦ç»†é…ç½®å‚æ•°ï¼š é…ç½® ç¼ºçœ è¯´æ˜ name é…ç½®è¿™ä¸ªå±æ€§çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ•°æ®æºï¼Œç›‘æ§çš„æ—¶å€™å¯ä»¥é€šè¿‡åå­—æ¥åŒºåˆ†å¼€æ¥ã€‚ å¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªåå­—ï¼Œæ ¼å¼æ˜¯ï¼šâ€DataSource-â€ + System.identityHashCode(this) url è¿æ¥æ•°æ®åº“çš„urlï¼Œä¸åŒæ•°æ®åº“ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ï¼šmysql : jdbc:mysql://10.20.153.104:3306/druid2 oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto username è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å password è¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚å¦‚æœä½ ä¸å¸Œæœ›å¯†ç ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ConfigFilterã€‚è¯¦ç»†çœ‹è¿™é‡Œï¼šhttps://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter driverClassName æ ¹æ®urlè‡ªåŠ¨è¯†åˆ« è¿™ä¸€é¡¹å¯é…å¯ä¸é…ï¼Œå¦‚æœä¸é…ç½®druidä¼šæ ¹æ®urlè‡ªåŠ¨è¯†åˆ«dbTypeï¼Œç„¶åé€‰æ‹©ç›¸åº”çš„driverClassName(å»ºè®®é…ç½®ä¸‹) initialSize 0 åˆå§‹åŒ–æ—¶å»ºç«‹ç‰©ç†è¿æ¥çš„ä¸ªæ•°ã€‚åˆå§‹åŒ–å‘ç”Ÿåœ¨æ˜¾ç¤ºè°ƒç”¨initæ–¹æ³•ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡getConnectionæ—¶ maxActive 8 æœ€å¤§è¿æ¥æ± æ•°é‡ maxIdle 8 å·²ç»ä¸å†ä½¿ç”¨ï¼Œé…ç½®äº†ä¹Ÿæ²¡æ•ˆæœ minIdle æœ€å°è¿æ¥æ± æ•°é‡ maxWait è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚é…ç½®äº†maxWaitä¹‹åï¼Œç¼ºçœå¯ç”¨å…¬å¹³é”ï¼Œå¹¶å‘æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ï¼Œå¦‚æœéœ€è¦å¯ä»¥é€šè¿‡é…ç½®useUnfairLockå±æ€§ä¸ºtrueä½¿ç”¨éå…¬å¹³é”ã€‚ poolPreparedStatements false æ˜¯å¦ç¼“å­˜preparedStatementï¼Œä¹Ÿå°±æ˜¯PSCacheã€‚PSCacheå¯¹æ”¯æŒæ¸¸æ ‡çš„æ•°æ®åº“æ€§èƒ½æå‡å·¨å¤§ï¼Œæ¯”å¦‚è¯´oracleã€‚åœ¨mysqlä¸‹å»ºè®®å…³é—­ã€‚ maxOpenPreparedStatements -1 è¦å¯ç”¨PSCacheï¼Œå¿…é¡»é…ç½®å¤§äº0ï¼Œå½“å¤§äº0æ—¶ï¼ŒpoolPreparedStatementsè‡ªåŠ¨è§¦å‘ä¿®æ”¹ä¸ºtrueã€‚åœ¨Druidä¸­ï¼Œä¸ä¼šå­˜åœ¨Oracleä¸‹PSCacheå ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ•°å€¼é…ç½®å¤§ä¸€äº›ï¼Œæ¯”å¦‚è¯´100 validationQuery ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å¦‚æœvalidationQueryä¸ºnullï¼ŒtestOnBorrowã€testOnReturnã€testWhileIdleéƒ½ä¸ä¼šå…¶ä½œç”¨ã€‚ testOnBorrow true ç”³è¯·è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚ testOnReturn false å½’è¿˜è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ testWhileIdle false å»ºè®®é…ç½®ä¸ºtrueï¼Œä¸å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯å®‰å…¨æ€§ã€‚ç”³è¯·è¿æ¥çš„æ—¶å€™æ£€æµ‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´å¤§äºtimeBetweenEvictionRunsMillisï¼Œæ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆã€‚ timeBetweenEvictionRunsMillis æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š 1)Destroyçº¿ç¨‹ä¼šæ£€æµ‹è¿æ¥çš„é—´éš”æ—¶é—´2)testWhileIdleçš„åˆ¤æ–­ä¾æ®ï¼Œè¯¦ç»†çœ‹testWhileIdleå±æ€§çš„è¯´æ˜ numTestsPerEvictionRun ä¸å†ä½¿ç”¨ï¼Œä¸€ä¸ªDruidDataSourceåªæ”¯æŒä¸€ä¸ªEvictionRun minEvictableIdleTimeMillis connectionInitSqls ç‰©ç†è¿æ¥åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„sql exceptionSorter æ ¹æ®dbTypeè‡ªåŠ¨è¯†åˆ« å½“æ•°æ®åº“æŠ›å‡ºä¸€äº›ä¸å¯æ¢å¤çš„å¼‚å¸¸æ—¶ï¼ŒæŠ›å¼ƒè¿æ¥ filters å±æ€§ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé€šè¿‡åˆ«åçš„æ–¹å¼é…ç½®æ‰©å±•æ’ä»¶ï¼Œå¸¸ç”¨çš„æ’ä»¶æœ‰ï¼š ç›‘æ§ç»Ÿè®¡ç”¨çš„filter:statæ—¥å¿—ç”¨çš„filter:log4jé˜²å¾¡sqlæ³¨å…¥çš„filter:wall proxyFilters ç±»å‹æ˜¯Listï¼Œå¦‚æœåŒæ—¶é…ç½®äº†filterså’ŒproxyFiltersï¼Œæ˜¯ç»„åˆå…³ç³»ï¼Œå¹¶éæ›¿æ¢å…³ç³» ä¹ï¼šApache-DBUtilså®ç°CRUDæ“ä½œ 9.1 Apache-DBUtilsç®€ä»‹ commons-dbutils æ˜¯ Apache ç»„ç»‡æä¾›çš„ä¸€ä¸ªå¼€æº JDBCå·¥å…·ç±»åº“ï¼Œå®ƒæ˜¯å¯¹JDBCçš„ç®€å•å°è£…ï¼Œå­¦ä¹ æˆæœ¬æä½ï¼Œå¹¶ä¸”ä½¿ç”¨dbutilsèƒ½æå¤§ç®€åŒ–jdbcç¼–ç çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ APIä»‹ç»ï¼š org.apache.commons.dbutils.QueryRunner org.apache.commons.dbutils.ResultSetHandler å·¥å…·ç±»ï¼šorg.apache.commons.dbutils.DbUtils æœ‰äº†DBUtilså¯ä»¥ç›´æ¥è°ƒç”¨APIä½¿ç”¨å¢åˆ æ”¹æŸ¥æ“ä½œäº†ã€‚ 9.2 ä¸»è¦APIçš„ä½¿ç”¨ 9.2.1 DbUtils DbUtils ï¼šæä¾›å¦‚å…³é—­è¿æ¥ã€è£…è½½JDBCé©±åŠ¨ç¨‹åºç­‰å¸¸è§„å·¥ä½œçš„å·¥å…·ç±»ï¼Œé‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ã€‚ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š public static void close(â€¦) throws java.sql.SQLExceptionï¼šã€€DbUtilsç±»æä¾›äº†ä¸‰ä¸ªé‡è½½çš„å…³é—­æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ£€æŸ¥æ‰€æä¾›çš„å‚æ•°æ˜¯ä¸æ˜¯NULLï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œå®ƒä»¬å°±å…³é—­Connectionã€Statementå’ŒResultSetã€‚ public static void closeQuietly(â€¦): è¿™ä¸€ç±»æ–¹æ³•ä¸ä»…èƒ½åœ¨Connectionã€Statementå’ŒResultSetä¸ºNULLæƒ…å†µä¸‹é¿å…å…³é—­ï¼Œè¿˜èƒ½éšè—ä¸€äº›åœ¨ç¨‹åºä¸­æŠ›å‡ºçš„SQLEeceptionã€‚ public static void commitAndClose(Connection conn)throws SQLExceptionï¼š ç”¨æ¥æäº¤è¿æ¥çš„äº‹åŠ¡ï¼Œç„¶åå…³é—­è¿æ¥ public static void commitAndCloseQuietly(Connection conn)ï¼š ç”¨æ¥æäº¤è¿æ¥ï¼Œç„¶åå…³é—­è¿æ¥ï¼Œå¹¶ä¸”åœ¨å…³é—­è¿æ¥æ—¶ä¸æŠ›å‡ºSQLå¼‚å¸¸ã€‚ public static void rollback(Connection conn)throws SQLExceptionï¼šå…è®¸connä¸ºnullï¼Œå› ä¸ºæ–¹æ³•å†…éƒ¨åšäº†åˆ¤æ–­ public static void rollbackAndClose(Connection conn)throws SQLException rollbackAndCloseQuietly(Connection) public static boolean loadDriver(java.lang.String driverClassName)ï¼šè¿™ä¸€æ–¹è£…è½½å¹¶æ³¨å†ŒJDBCé©±åŠ¨ç¨‹åºï¼Œå¦‚æœæˆåŠŸå°±è¿”å›trueã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä½ ä¸éœ€è¦æ•æ‰è¿™ä¸ªå¼‚å¸¸ClassNotFoundExceptionã€‚ 9.2.2 QueryRunnerç±» è¯¥ç±»ç®€å•åŒ–äº†SQLæŸ¥è¯¢ï¼Œå®ƒä¸ResultSetHandlerç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„æ•°æ®åº“æ“ä½œï¼Œèƒ½å¤Ÿå¤§å¤§å‡å°‘ç¼–ç é‡ã€‚ QueryRunnerç±»æä¾›äº†ä¸¤ä¸ªæ„é€ å™¨ï¼š é»˜è®¤çš„æ„é€ å™¨ éœ€è¦ä¸€ä¸ª javax.sql.DataSource æ¥ä½œå‚æ•°çš„æ„é€ å™¨ QueryRunnerç±»çš„ä¸»è¦æ–¹æ³•ï¼š æ›´æ–° public int update(Connection conn, String sql, Object... params) throws SQLException:ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ›´æ–°ï¼ˆæ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤ï¼‰æ“ä½œã€‚ â€¦â€¦ æ’å…¥ public T insert(Connection conn,String sql,ResultSetHandler rsh, Object... params) throws SQLExceptionï¼šåªæ”¯æŒINSERTè¯­å¥ï¼Œå…¶ä¸­ rsh - The handler used to create the result object from the ResultSet of auto-generated keys. è¿”å›å€¼: An object generated by the handler.å³è‡ªåŠ¨ç”Ÿæˆçš„é”®å€¼ â€¦. æ‰¹å¤„ç† public int[] batch(Connection conn,String sql,Object[][] params)throws SQLExceptionï¼š INSERT, UPDATE, or DELETEè¯­å¥ public T insertBatch(Connection conn,String sql,ResultSetHandler rsh,Object[][] params)throws SQLExceptionï¼šåªæ”¯æŒINSERTè¯­å¥ æŸ¥è¯¢ public Object query(Connection conn, String sql, ResultSetHandler rsh,Object... params) throws SQLExceptionï¼šæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå¯¹è±¡æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å€¼è¢«ç”¨æ¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ç½®æ¢å‚æ•°ã€‚è¯¥æ–¹æ³•ä¼šè‡ªè¡Œå¤„ç† PreparedStatement å’Œ ResultSet çš„åˆ›å»ºå’Œå…³é—­ã€‚ æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 // æµ‹è¯•æ·»åŠ  @Test public void testInsert() throws Exception { QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \"insert into customers(name,email,birth)values(?,?,?)\"; int count = runner.update(conn, sql, \"ä½•æˆé£\", \"he@qq.com\", \"1992-09-08\"); System.out.println(\"æ·»åŠ äº†\" + count + \"æ¡è®°å½•\"); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 // æµ‹è¯•åˆ é™¤ @Test public void testDelete() throws Exception { QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \"delete from customers where id \u003c ?\"; int count = runner.update(conn, sql,3); System.out.println(\"åˆ é™¤äº†\" + count + \"æ¡è®°å½•\"); JDBCUtils.closeResource(conn, null); } 9.2.3 ResultSetHandleræ¥å£åŠå®ç°ç±» è¯¥æ¥å£ç”¨äºå¤„ç† java.sql.ResultSetï¼Œå°†æ•°æ®æŒ‰è¦æ±‚è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼ã€‚\nResultSetHandler æ¥å£æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼šObject handle (java.sql.ResultSet .rs)ã€‚\næ¥å£çš„ä¸»è¦å®ç°ç±»ï¼š\nArrayHandlerï¼šæŠŠç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®è½¬æˆå¯¹è±¡æ•°ç»„ã€‚ ArrayListHandlerï¼šæŠŠç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½è½¬æˆä¸€ä¸ªæ•°ç»„ï¼Œå†å­˜æ”¾åˆ°Listä¸­ã€‚ **BeanHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ã€‚ **BeanListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ï¼Œå­˜æ”¾åˆ°Listé‡Œã€‚ ColumnListHandlerï¼šå°†ç»“æœé›†ä¸­æŸä¸€åˆ—çš„æ•°æ®å­˜æ”¾åˆ°Listä¸­ã€‚ KeyedHandler(name)ï¼šå°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œå†æŠŠè¿™äº›mapå†å­˜åˆ°ä¸€ä¸ªmapé‡Œï¼Œå…¶keyä¸ºæŒ‡å®šçš„keyã€‚ **MapHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œkeyæ˜¯åˆ—åï¼Œvalueå°±æ˜¯å¯¹åº”çš„å€¼ã€‚ **MapListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œç„¶åå†å­˜æ”¾åˆ°List **ScalarHandlerï¼š**æŸ¥è¯¢å•ä¸ªå€¼å¯¹è±¡ æµ‹è¯•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /* * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢ä¸€æ¡è®°å½• * * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanHandler */ @Test public void testQueryInstance() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \"select id,name,email,birth from customers where id = ?\"; // BeanHandler handler = new BeanHandler\u003c\u003e(Customer.class); Customer customer = runner.query(conn, sql, handler, 23); System.out.println(customer);\tJDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢å¤šæ¡è®°å½•æ„æˆçš„é›†åˆ * * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanListHandler */ @Test public void testQueryList() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \"select id,name,email,birth from customers where id \u003c ?\"; // BeanListHandler handler = new BeanListHandler\u003c\u003e(Customer.class); List list = runner.query(conn, sql, handler, 23); list.forEach(System.out::println); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 /* * è‡ªå®šä¹‰ResultSetHandlerçš„å®ç°ç±» */ @Test public void testQueryInstance1() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \"select id,name,email,birth from customers where id = ?\"; ResultSetHandler handler = new ResultSetHandler() { @Override public Customer handle(ResultSet rs) throws SQLException { System.out.println(\"handle\"); //\treturn new Customer(1,\"Tom\",\"tom@126.com\",new Date(123323432L)); if(rs.next()){ int id = rs.getInt(\"id\"); String name = rs.getString(\"name\"); String email = rs.getString(\"email\"); Date birth = rs.getDate(\"birth\"); return new Customer(id, name, email, birth); } return null; } }; Customer customer = runner.query(conn, sql, handler, 23); System.out.println(customer); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* * å¦‚ä½•æŸ¥è¯¢ç±»ä¼¼äºæœ€å¤§çš„ï¼Œæœ€å°çš„ï¼Œå¹³å‡çš„ï¼Œæ€»å’Œï¼Œä¸ªæ•°ç›¸å…³çš„æ•°æ®ï¼Œ * ä½¿ç”¨ScalarHandler * */ @Test public void testQueryValue() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); //æµ‹è¯•ä¸€ï¼š //\tString sql = \"select count(*) from customers where id \u003c ?\"; //\tScalarHandler handler = new ScalarHandler(); //\tlong count = (long) runner.query(conn, sql, handler, 20); //\tSystem.out.println(count); //æµ‹è¯•äºŒï¼š String sql = \"select max(birth) from customers\"; ScalarHandler handler = new ScalarHandler(); Date birth = (Date) runner.query(conn, sql, handler); System.out.println(birth); JDBCUtils.closeResource(conn, null); } ",
  "wordCount" : "12648",
  "inLanguage": "en",
  "datePublished": "2022-03-24T23:02:23Z",
  "dateModified": "2022-09-11T16:07:31+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/jdbc/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/categories" title="ğŸ§©åˆ†ç±»">
                    <span>ğŸ§©åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;Â»&nbsp;<a href="http://www.reus09.top/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="http://www.reus09.top/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯</a></div>
    <h1 class="post-title">
      Jdbc
    </h1>
    <div class="post-meta"><span title='2022-03-24 23:02:23 +0000 UTC'>2022-03-24</span>&nbsp;Â·&nbsp;26 min&nbsp;Â·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e4%b8%80jdbc%e6%a6%82%e8%bf%b0" aria-label="ä¸€ï¼šJDBCæ¦‚è¿°">ä¸€ï¼šJDBCæ¦‚è¿°</a><ul>
                            
                    <li>
                        <a href="#11-%e6%95%b0%e6%8d%ae%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="1.1 æ•°æ®çš„æŒä¹…åŒ–">1.1 æ•°æ®çš„æŒä¹…åŒ–</a></li>
                    <li>
                        <a href="#12-jdbc%e7%a8%8b%e5%ba%8f%e7%bc%96%e5%86%99%e6%ad%a5%e9%aa%a4" aria-label="1.2 JDBCç¨‹åºç¼–å†™æ­¥éª¤">1.2 JDBCç¨‹åºç¼–å†™æ­¥éª¤</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%ba%8c%e8%8e%b7%e5%8f%96%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5" aria-label="äºŒï¼šè·å–æ•°æ®åº“è¿æ¥">äºŒï¼šè·å–æ•°æ®åº“è¿æ¥</a><ul>
                            
                    <li>
                        <a href="#21-driver%e6%8e%a5%e5%8f%a3%e5%ae%9e%e7%8e%b0%e7%b1%bb" aria-label="2.1 Driveræ¥å£å®ç°ç±»">2.1 Driveræ¥å£å®ç°ç±»</a><ul>
                            
                    <li>
                        <a href="#211-driver%e6%8e%a5%e5%8f%a3%e4%bb%8b%e7%bb%8d" aria-label="2.1.1 Driveræ¥å£ä»‹ç»">2.1.1 Driveræ¥å£ä»‹ç»</a></li>
                    <li>
                        <a href="#212-%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b3%a8%e5%86%8cjdbc%e9%a9%b1%e5%8a%a8" aria-label="2.1.2 åŠ è½½ä¸æ³¨å†ŒJDBCé©±åŠ¨">2.1.2 åŠ è½½ä¸æ³¨å†ŒJDBCé©±åŠ¨</a></li></ul>
                    </li>
                    <li>
                        <a href="#22-url" aria-label="2.2 URL">2.2 URL</a></li>
                    <li>
                        <a href="#24-%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e6%96%b9%e5%bc%8f" aria-label="2.4 æ•°æ®åº“è¿æ¥æ–¹å¼">2.4 æ•°æ®åº“è¿æ¥æ–¹å¼</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%9e%e6%8e%a5%e6%96%b9%e5%bc%8f%e4%ba%94" aria-label="è¿æ¥æ–¹å¼äº”">è¿æ¥æ–¹å¼äº”</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%89%e4%bd%bf%e7%94%a8preparedstatement%e5%ae%9e%e7%8e%b0crud%e6%93%8d%e4%bd%9c" aria-label="ä¸‰ï¼šä½¿ç”¨PreparedStatementå®ç°CRUDæ“ä½œ">ä¸‰ï¼šä½¿ç”¨PreparedStatementå®ç°CRUDæ“ä½œ</a><ul>
                            
                    <li>
                        <a href="#31-%e6%93%8d%e4%bd%9c%e5%92%8c%e8%ae%bf%e9%97%ae%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="3.1 æ“ä½œå’Œè®¿é—®æ•°æ®åº“">3.1 æ“ä½œå’Œè®¿é—®æ•°æ®åº“</a></li>
                    <li>
                        <a href="#32-preparedstatement%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="3.2 PreparedStatementçš„ä½¿ç”¨">3.2 PreparedStatementçš„ä½¿ç”¨</a><ul>
                            
                    <li>
                        <a href="#321-preparedstatement%e4%bb%8b%e7%bb%8d" aria-label="3.2.1 PreparedStatementä»‹ç»">3.2.1 PreparedStatementä»‹ç»</a></li>
                    <li>
                        <a href="#322-preparedstatement-vs-statement" aria-label="3.2.2 PreparedStatement vs Statement">3.2.2 PreparedStatement vs Statement</a></li>
                    <li>
                        <a href="#323-java%e4%b8%8esql%e5%af%b9%e5%ba%94%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2%e8%a1%a8" aria-label="3.2.3 Javaä¸SQLå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨">3.2.3 Javaä¸SQLå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨</a></li>
                    <li>
                        <a href="#324-%e4%bd%bf%e7%94%a8preparedstatement%e5%ae%9e%e7%8e%b0%e5%a2%9e%e5%88%a0%e6%94%b9%e6%93%8d%e4%bd%9c" aria-label="3.2.4 ä½¿ç”¨PreparedStatementå®ç°å¢ã€åˆ ã€æ”¹æ“ä½œ">3.2.4 ä½¿ç”¨PreparedStatementå®ç°å¢ã€åˆ ã€æ”¹æ“ä½œ</a></li>
                    <li>
                        <a href="#325-%e4%bd%bf%e7%94%a8preparedstatement%e5%ae%9e%e7%8e%b0%e6%9f%a5%e8%af%a2%e6%93%8d%e4%bd%9c" aria-label="3.2.5 ä½¿ç”¨PreparedStatementå®ç°æŸ¥è¯¢æ“ä½œ">3.2.5 ä½¿ç”¨PreparedStatementå®ç°æŸ¥è¯¢æ“ä½œ</a></li></ul>
                    </li>
                    <li>
                        <a href="#33-resultset%e4%b8%8eresultsetmetadata" aria-label="3.3 ResultSetä¸ResultSetMetaData">3.3 ResultSetä¸ResultSetMetaData</a><ul>
                            
                    <li>
                        <a href="#331-resultset" aria-label="3.3.1 ResultSet">3.3.1 ResultSet</a></li>
                    <li>
                        <a href="#332-resultsetmetadata" aria-label="3.3.2 ResultSetMetaData">3.3.2 ResultSetMetaData</a></li></ul>
                    </li>
                    <li>
                        <a href="#34-%e8%b5%84%e6%ba%90%e7%9a%84%e9%87%8a%e6%94%be" aria-label="3.4 èµ„æºçš„é‡Šæ”¾">3.4 èµ„æºçš„é‡Šæ”¾</a></li>
                    <li>
                        <a href="#36-jdbc-api%e5%b0%8f%e7%bb%93" aria-label="3.6 JDBC APIå°ç»“">3.6 JDBC APIå°ç»“</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%9b%9b-%e6%93%8d%e4%bd%9cblob%e7%b1%bb%e5%9e%8b%e5%ad%97%e6%ae%b5" aria-label="å››ï¼š æ“ä½œBLOBç±»å‹å­—æ®µ">å››ï¼š æ“ä½œBLOBç±»å‹å­—æ®µ</a><ul>
                            
                    <li>
                        <a href="#41-mysql-blob%e7%b1%bb%e5%9e%8b" aria-label="4.1 MySQL BLOBç±»å‹">4.1 MySQL BLOBç±»å‹</a></li>
                    <li>
                        <a href="#42-%e5%90%91%e6%95%b0%e6%8d%ae%e8%a1%a8%e4%b8%ad%e6%8f%92%e5%85%a5%e5%a4%a7%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="4.2 å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹">4.2 å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹</a></li>
                    <li>
                        <a href="#43-%e4%bf%ae%e6%94%b9%e6%95%b0%e6%8d%ae%e8%a1%a8%e4%b8%ad%e7%9a%84blob%e7%b1%bb%e5%9e%8b%e5%ad%97%e6%ae%b5" aria-label="4.3 ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„Blobç±»å‹å­—æ®µ">4.3 ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„Blobç±»å‹å­—æ®µ</a></li>
                    <li>
                        <a href="#44-%e4%bb%8e%e6%95%b0%e6%8d%ae%e8%a1%a8%e4%b8%ad%e8%af%bb%e5%8f%96%e5%a4%a7%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="4.4 ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹">4.4 ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%ba%94-%e6%89%b9%e9%87%8f%e6%8f%92%e5%85%a5" aria-label="äº”ï¼š æ‰¹é‡æ’å…¥">äº”ï¼š æ‰¹é‡æ’å…¥</a><ul>
                            
                    <li>
                        <a href="#51-%e6%89%b9%e9%87%8f%e6%89%a7%e8%a1%8csql%e8%af%ad%e5%8f%a5" aria-label="5.1 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥">5.1 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥</a></li>
                    <li>
                        <a href="#52-%e9%ab%98%e6%95%88%e7%9a%84%e6%89%b9%e9%87%8f%e6%8f%92%e5%85%a5" aria-label="5.2 é«˜æ•ˆçš„æ‰¹é‡æ’å…¥">5.2 é«˜æ•ˆçš„æ‰¹é‡æ’å…¥</a><ul>
                            
                    <li>
                        <a href="#521-%e5%ae%9e%e7%8e%b0%e5%b1%82%e6%ac%a1%e4%b8%80%e4%bd%bf%e7%94%a8statement" aria-label="5.2.1 å®ç°å±‚æ¬¡ä¸€ï¼šä½¿ç”¨Statement">5.2.1 å®ç°å±‚æ¬¡ä¸€ï¼šä½¿ç”¨Statement</a></li>
                    <li>
                        <a href="#522-%e5%ae%9e%e7%8e%b0%e5%b1%82%e6%ac%a1%e4%ba%8c%e4%bd%bf%e7%94%a8preparedstatement" aria-label="5.2.2 å®ç°å±‚æ¬¡äºŒï¼šä½¿ç”¨PreparedStatement">5.2.2 å®ç°å±‚æ¬¡äºŒï¼šä½¿ç”¨PreparedStatement</a></li>
                    <li>
                        <a href="#523-%e5%ae%9e%e7%8e%b0%e5%b1%82%e6%ac%a1%e4%b8%89" aria-label="5.2.3 å®ç°å±‚æ¬¡ä¸‰">5.2.3 å®ç°å±‚æ¬¡ä¸‰</a></li>
                    <li>
                        <a href="#524-%e5%ae%9e%e7%8e%b0%e5%b1%82%e6%ac%a1%e5%9b%9b" aria-label="5.2.4 å®ç°å±‚æ¬¡å››">5.2.4 å®ç°å±‚æ¬¡å››</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e5%85%ad-%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1" aria-label="å…­ï¼š æ•°æ®åº“äº‹åŠ¡">å…­ï¼š æ•°æ®åº“äº‹åŠ¡</a><ul>
                            
                    <li>
                        <a href="#61-%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1%e4%bb%8b%e7%bb%8d" aria-label="6.1 æ•°æ®åº“äº‹åŠ¡ä»‹ç»">6.1 æ•°æ®åº“äº‹åŠ¡ä»‹ç»</a></li>
                    <li>
                        <a href="#62-%e4%ba%8b%e5%8a%a1%e7%9a%84acid%e5%b1%9e%e6%80%a7" aria-label="6.2 äº‹åŠ¡çš„ACIDå±æ€§">6.2 äº‹åŠ¡çš„ACIDå±æ€§</a><ul>
                            
                    <li>
                        <a href="#631-%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%b9%b6%e5%8f%91%e9%97%ae%e9%a2%98" aria-label="6.3.1 æ•°æ®åº“çš„å¹¶å‘é—®é¢˜">6.3.1 æ•°æ®åº“çš„å¹¶å‘é—®é¢˜</a></li>
                    <li>
                        <a href="#632-%e5%9b%9b%e7%a7%8d%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab" aria-label="6.3.2 å››ç§éš”ç¦»çº§åˆ«">6.3.2 å››ç§éš”ç¦»çº§åˆ«</a></li>
                    <li>
                        <a href="#633-%e5%9c%a8mysql%e4%b8%ad%e8%ae%be%e7%bd%ae%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab" aria-label="6.3.3 åœ¨MySqlä¸­è®¾ç½®éš”ç¦»çº§åˆ«">6.3.3 åœ¨MySqlä¸­è®¾ç½®éš”ç¦»çº§åˆ«</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%83dao%e5%8f%8a%e7%9b%b8%e5%85%b3%e5%ae%9e%e7%8e%b0%e7%b1%bb" aria-label="ä¸ƒï¼šDAOåŠç›¸å…³å®ç°ç±»">ä¸ƒï¼šDAOåŠç›¸å…³å®ç°ç±»</a><ul>
                            
                    <li>
                        <a href="#basedaojava" aria-label="ã€BaseDAO.javaã€‘">ã€BaseDAO.javaã€‘</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%85%ab%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e6%b1%a0" aria-label="å…«ï¼šæ•°æ®åº“è¿æ¥æ± ">å…«ï¼šæ•°æ®åº“è¿æ¥æ± </a><ul>
                            
                    <li>
                        <a href="#81-%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e6%b1%a0%e6%8a%80%e6%9c%af" aria-label="8.1 æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯">8.1 æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯</a></li>
                    <li>
                        <a href="#82-%e5%a4%9a%e7%a7%8d%e5%bc%80%e6%ba%90%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e6%b1%a0" aria-label="8.2 å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ± ">8.2 å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ± </a><ul>
                            
                    <li>
                        <a href="#821-druid%e5%be%b7%e9%b2%81%e4%bc%8a%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5%e6%b1%a0" aria-label="8.2.1 Druidï¼ˆå¾·é²ä¼Šï¼‰æ•°æ®åº“è¿æ¥æ± ">8.2.1 Druidï¼ˆå¾·é²ä¼Šï¼‰æ•°æ®åº“è¿æ¥æ± </a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b9%9dapache-dbutils%e5%ae%9e%e7%8e%b0crud%e6%93%8d%e4%bd%9c" aria-label="ä¹ï¼šApache-DBUtilså®ç°CRUDæ“ä½œ">ä¹ï¼šApache-DBUtilså®ç°CRUDæ“ä½œ</a><ul>
                            
                    <li>
                        <a href="#91-apache-dbutils%e7%ae%80%e4%bb%8b" aria-label="9.1 Apache-DBUtilsç®€ä»‹">9.1 Apache-DBUtilsç®€ä»‹</a></li>
                    <li>
                        <a href="#92-%e4%b8%bb%e8%a6%81api%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="9.2 ä¸»è¦APIçš„ä½¿ç”¨">9.2 ä¸»è¦APIçš„ä½¿ç”¨</a><ul>
                            
                    <li>
                        <a href="#921-dbutils" aria-label="9.2.1 DbUtils">9.2.1 DbUtils</a></li>
                    <li>
                        <a href="#922-queryrunner%e7%b1%bb" aria-label="9.2.2 QueryRunnerç±»">9.2.2 QueryRunnerç±»</a></li>
                    <li>
                        <a href="#923-resultsethandler%e6%8e%a5%e5%8f%a3%e5%8f%8a%e5%ae%9e%e7%8e%b0%e7%b1%bb" aria-label="9.2.3 ResultSetHandleræ¥å£åŠå®ç°ç±»">9.2.3 ResultSetHandleræ¥å£åŠå®ç°ç±»</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h2 id="ä¸€jdbcæ¦‚è¿°">ä¸€ï¼šJDBCæ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#ä¸€jdbcæ¦‚è¿°">#</a></h2>
<h3 id="11-æ•°æ®çš„æŒä¹…åŒ–">1.1 æ•°æ®çš„æŒä¹…åŒ–<a hidden class="anchor" aria-hidden="true" href="#11-æ•°æ®çš„æŒä¹…åŒ–">#</a></h3>
<ul>
<li>
<p>æŒä¹…åŒ–(persistence)ï¼š<strong>æŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨</strong>ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ<strong>æ•°æ®æŒä¹…åŒ–æ„å‘³ç€å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜</strong>ä¸ŠåŠ ä»¥â€å›ºåŒ–â€<strong>ï¼Œè€ŒæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹å¤§å¤šé€šè¿‡å„ç§å…³ç³»æ•°æ®åº“æ¥å®Œæˆ</strong>ã€‚</p>
</li>
<li>
<p>æŒä¹…åŒ–çš„ä¸»è¦åº”ç”¨æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ã€XMLæ•°æ®æ–‡ä»¶ä¸­ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1566741430592.png" alt="1566741430592"  />
</p>
</li>
</ul>
<h3 id="12-jdbcç¨‹åºç¼–å†™æ­¥éª¤">1.2 JDBCç¨‹åºç¼–å†™æ­¥éª¤<a hidden class="anchor" aria-hidden="true" href="#12-jdbcç¨‹åºç¼–å†™æ­¥éª¤">#</a></h3>
<ul>
<li>æ€»ç»“ä¸€ä¸‹<code>JDBC</code>å»ºç«‹è¿æ¥çš„å…¨è¿‡ç¨‹ã€‚</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1565969323908.png" alt="1565969323908"  />
</p>
<h2 id="äºŒè·å–æ•°æ®åº“è¿æ¥">äºŒï¼šè·å–æ•°æ®åº“è¿æ¥<a hidden class="anchor" aria-hidden="true" href="#äºŒè·å–æ•°æ®åº“è¿æ¥">#</a></h2>
<h3 id="21-driveræ¥å£å®ç°ç±»">2.1 Driveræ¥å£å®ç°ç±»<a hidden class="anchor" aria-hidden="true" href="#21-driveræ¥å£å®ç°ç±»">#</a></h3>
<h4 id="211-driveræ¥å£ä»‹ç»">2.1.1 Driveræ¥å£ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#211-driveræ¥å£ä»‹ç»">#</a></h4>
<ul>
<li>
<p>java.sql.Driver æ¥å£æ˜¯æ‰€æœ‰ JDBC é©±åŠ¨ç¨‹åºéœ€è¦å®ç°çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯æä¾›ç»™æ•°æ®åº“å‚å•†ä½¿ç”¨çš„ï¼Œä¸åŒæ•°æ®åº“å‚å•†æä¾›ä¸åŒçš„å®ç°ã€‚</p>
</li>
<li>
<p>åœ¨ç¨‹åºä¸­ä¸éœ€è¦ç›´æ¥å»è®¿é—®å®ç°äº† Driver æ¥å£çš„ç±»ï¼Œè€Œæ˜¯ç”±é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»(java.sql.DriverManager)å»è°ƒç”¨è¿™äº›Driverå®ç°ã€‚</p>
<ul>
<li><code>mySql</code>çš„é©±åŠ¨ï¼š<code>com.mysql.cj.jdbc.Driver</code> ,æœ€æ–°ç‰ˆçš„é©±åŠ¨å·²æ›´åä¸ºæ­¤ã€‚</li>
</ul>
</li>
<li>
<p>è¿™é‡Œè®²ä¸€ä¸‹<code>IDEA</code> å¦‚ä½•å¯¼å…¥<code>mysql</code>è¿æ¥åº“</p>
<ul>
<li>
<p>æ‰“å¼€<code>Project Structure</code>æ¨¡å—</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20220324221953021.png" alt="image-20220324221953021"  />
</p>
</li>
<li>
<p>ç„¶åæŒ‰ç…§å¦‚å›¾æ‰€ç¤ºç‚¹å‡»ï¼Œå³å¯æ·»åŠ <code>jar</code>åŒ…åˆ°é¡¹ç›®è·¯å¾„</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20220324222114455.png" alt="image-20220324222114455"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="212-åŠ è½½ä¸æ³¨å†Œjdbcé©±åŠ¨">2.1.2 åŠ è½½ä¸æ³¨å†ŒJDBCé©±åŠ¨<a hidden class="anchor" aria-hidden="true" href="#212-åŠ è½½ä¸æ³¨å†Œjdbcé©±åŠ¨">#</a></h4>
<ul>
<li>
<p>åŠ è½½é©±åŠ¨ï¼šåŠ è½½ JDBC é©±åŠ¨éœ€è°ƒç”¨ Class ç±»çš„é™æ€æ–¹æ³• forName()ï¼Œå‘å…¶ä¼ é€’è¦åŠ è½½çš„ JDBC é©±åŠ¨çš„ç±»å</p>
<ul>
<li><strong>Class.forName(â€œcom.mysql.cj.jdbc.Driverâ€);</strong></li>
</ul>
</li>
<li>
<p>æ³¨å†Œé©±åŠ¨ï¼šDriverManager ç±»æ˜¯é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»ï¼Œè´Ÿè´£ç®¡ç†é©±åŠ¨ç¨‹åº</p>
<ul>
<li>
<p><strong>ä½¿ç”¨DriverManager.registerDriver(com.mysql.jc.jdbc.Driver)æ¥æ³¨å†Œé©±åŠ¨</strong></p>
</li>
<li>
<p>é€šå¸¸ä¸ç”¨æ˜¾å¼è°ƒç”¨ DriverManager ç±»çš„ registerDriver() æ–¹æ³•æ¥æ³¨å†Œé©±åŠ¨ç¨‹åºç±»çš„å®ä¾‹ï¼Œå› ä¸º Driver æ¥å£çš„é©±åŠ¨ç¨‹åºç±»<strong>éƒ½</strong>åŒ…å«äº†é™æ€ä»£ç å—ï¼Œåœ¨è¿™ä¸ªé™æ€ä»£ç å—ä¸­ï¼Œä¼šè°ƒç”¨ DriverManager.registerDriver() æ–¹æ³•æ¥æ³¨å†Œè‡ªèº«çš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸‹å›¾æ˜¯MySQLçš„Driverå®ç°ç±»çš„æºç ï¼š</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1566136831283.png" alt="1566136831283"  />
</p>
</li>
</ul>
</li>
</ul>
<h3 id="22-url">2.2 URL<a hidden class="anchor" aria-hidden="true" href="#22-url">#</a></h3>
<ul>
<li>
<p>JDBC URL ç”¨äºæ ‡è¯†ä¸€ä¸ªè¢«æ³¨å†Œçš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºç®¡ç†å™¨é€šè¿‡è¿™ä¸ª URL é€‰æ‹©æ­£ç¡®çš„é©±åŠ¨ç¨‹åºï¼Œä»è€Œå»ºç«‹åˆ°æ•°æ®åº“çš„è¿æ¥ã€‚</p>
</li>
<li>
<p>ä¸¾ä¾‹ï¼š</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555576477107.png" alt="1555576477107"  />
</p>
</li>
<li>
<p>è¿™é‡Œæ³¨æ˜ï¼šåœ¨<code>MySQL 8</code>ç‰ˆæœ¬ä»¥ä¸Šçš„<code>url</code>è¿æ¥éœ€è¦åŠ ä¸Šæ—¶åŒº</p>
<p><code>jdbc:mysql://localhost:3306/test?serverTimezone=UTC</code></p>
</li>
</ul>
<h3 id="24-æ•°æ®åº“è¿æ¥æ–¹å¼">2.4 æ•°æ®åº“è¿æ¥æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#24-æ•°æ®åº“è¿æ¥æ–¹å¼">#</a></h3>
<h4 id="è¿æ¥æ–¹å¼äº”">è¿æ¥æ–¹å¼äº”<a hidden class="anchor" aria-hidden="true" href="#è¿æ¥æ–¹å¼äº”">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	@Test
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span>  <span style="color:#fff;font-weight:bold">void</span> testConnection5() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    	<span style="color:#007f7f">//1.åŠ è½½é…ç½®æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        InputStream is = ConnectionTest.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getClassLoader</span>().<span style="color:#007f7f">getResourceAsStream</span>(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>);
</span></span><span style="display:flex;"><span>        Properties pros = <span style="color:#fff;font-weight:bold">new</span> Properties();
</span></span><span style="display:flex;"><span>        pros.<span style="color:#007f7f">load</span>(is);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//2.è¯»å–é…ç½®ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String user = pros.<span style="color:#007f7f">getProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>);
</span></span><span style="display:flex;"><span>        String password = pros.<span style="color:#007f7f">getProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>        String url = pros.<span style="color:#007f7f">getProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;url&#34;</span>);
</span></span><span style="display:flex;"><span>        String driverClass = pros.<span style="color:#007f7f">getProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;driverClass&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//3.åŠ è½½é©±åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Class.<span style="color:#007f7f">forName</span>(driverClass);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//4.è·å–è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection conn = DriverManager.<span style="color:#007f7f">getConnection</span>(url,user,password);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(conn);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶å£°æ˜åœ¨å·¥ç¨‹çš„srcç›®å½•ä¸‹ï¼š<code>jdbc.properties</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>user=root
</span></span><span style="display:flex;"><span>password=abc123
</span></span><span style="display:flex;"><span>url=jdbc:mysql://localhost:3306/test?serverTimezone=UTC
</span></span><span style="display:flex;"><span>driverClass=com.mysql.jc.jdbc.Driver
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¯´æ˜ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ä¿å­˜é…ç½®ä¿¡æ¯ï¼Œåœ¨ä»£ç ä¸­åŠ è½½é…ç½®æ–‡ä»¶</p>
<p><strong>ä½¿ç”¨é…ç½®æ–‡ä»¶çš„å¥½å¤„ï¼š</strong></p>
<p>â‘ å®ç°äº†ä»£ç å’Œæ•°æ®çš„åˆ†ç¦»ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œä¸éœ€è¦æ·±å…¥ä»£ç 
â‘¡å¦‚æœä¿®æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œçœå»é‡æ–°ç¼–è¯‘çš„è¿‡ç¨‹ã€‚</p>
</blockquote>
<h2 id="ä¸‰ä½¿ç”¨preparedstatementå®ç°crudæ“ä½œ">ä¸‰ï¼šä½¿ç”¨PreparedStatementå®ç°CRUDæ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#ä¸‰ä½¿ç”¨preparedstatementå®ç°crudæ“ä½œ">#</a></h2>
<h3 id="31-æ“ä½œå’Œè®¿é—®æ•°æ®åº“">3.1 æ“ä½œå’Œè®¿é—®æ•°æ®åº“<a hidden class="anchor" aria-hidden="true" href="#31-æ“ä½œå’Œè®¿é—®æ•°æ®åº“">#</a></h3>
<ul>
<li>
<p>æ•°æ®åº“è¿æ¥è¢«ç”¨äºå‘æ•°æ®åº“æœåŠ¡å™¨å‘é€å‘½ä»¤å’Œ SQL è¯­å¥ï¼Œå¹¶æ¥å—æ•°æ®åº“æœåŠ¡å™¨è¿”å›çš„ç»“æœã€‚å…¶å®ä¸€ä¸ªæ•°æ®åº“è¿æ¥å°±æ˜¯ä¸€ä¸ªSocketè¿æ¥ã€‚</p>
</li>
<li>
<p>åœ¨ java.sql åŒ…ä¸­æœ‰ 3 ä¸ªæ¥å£åˆ†åˆ«å®šä¹‰äº†å¯¹æ•°æ®åº“çš„è°ƒç”¨çš„ä¸åŒæ–¹å¼ï¼š</p>
<ul>
<li>Statementï¼šç”¨äºæ‰§è¡Œé™æ€ SQL è¯­å¥å¹¶è¿”å›å®ƒæ‰€ç”Ÿæˆç»“æœçš„å¯¹è±¡ã€‚</li>
<li>PrepatedStatementï¼šSQL è¯­å¥è¢«é¢„ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ­¤å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡å¤šæ¬¡é«˜æ•ˆåœ°æ‰§è¡Œè¯¥è¯­å¥ã€‚</li>
<li>CallableStatementï¼šç”¨äºæ‰§è¡Œ SQL å­˜å‚¨è¿‡ç¨‹</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1566573842140.png" alt="1566573842140"  />
</p>
</li>
<li>
<p>å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚</p>
</li>
</ul>
<h3 id="32-preparedstatementçš„ä½¿ç”¨">3.2 PreparedStatementçš„ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#32-preparedstatementçš„ä½¿ç”¨">#</a></h3>
<h4 id="321-preparedstatementä»‹ç»">3.2.1 PreparedStatementä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#321-preparedstatementä»‹ç»">#</a></h4>
<ul>
<li>
<p><strong>PreparedStatement æ¥å£æ˜¯ Statement çš„å­æ¥å£ï¼Œå®ƒè¡¨ç¤ºä¸€æ¡é¢„ç¼–è¯‘è¿‡çš„ SQL è¯­å¥</strong></p>
</li>
<li>
<p>PreparedStatement å¯¹è±¡æ‰€ä»£è¡¨çš„ SQL è¯­å¥ä¸­çš„å‚æ•°ç”¨é—®å·(?)æ¥è¡¨ç¤ºï¼Œè°ƒç”¨ PreparedStatement å¯¹è±¡çš„ setXxx() æ–¹æ³•æ¥è®¾ç½®è¿™äº›å‚æ•°. setXxx() æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„ç´¢å¼•(ä» 1 å¼€å§‹)ï¼Œç¬¬äºŒä¸ªæ˜¯è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„å€¼</p>
</li>
</ul>
<h4 id="322-preparedstatement-vs-statement">3.2.2 PreparedStatement vs Statement<a hidden class="anchor" aria-hidden="true" href="#322-preparedstatement-vs-statement">#</a></h4>
<ul>
<li>
<p>ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
</li>
<li>
<p><strong>PreparedStatement èƒ½æœ€å¤§å¯èƒ½æé«˜æ€§èƒ½ï¼š</strong></p>
<ul>
<li>DBServerä¼šå¯¹<strong>é¢„ç¼–è¯‘</strong>è¯­å¥æä¾›æ€§èƒ½ä¼˜åŒ–ã€‚å› ä¸ºé¢„ç¼–è¯‘è¯­å¥æœ‰å¯èƒ½è¢«é‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥<u>è¯­å¥åœ¨è¢«DBServerçš„ç¼–è¯‘å™¨ç¼–è¯‘åçš„æ‰§è¡Œä»£ç è¢«ç¼“å­˜ä¸‹æ¥ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨æ—¶åªè¦æ˜¯ç›¸åŒçš„é¢„ç¼–è¯‘è¯­å¥å°±ä¸éœ€è¦ç¼–è¯‘ï¼Œåªè¦å°†å‚æ•°ç›´æ¥ä¼ å…¥ç¼–è¯‘è¿‡çš„è¯­å¥æ‰§è¡Œä»£ç ä¸­å°±ä¼šå¾—åˆ°æ‰§è¡Œã€‚</u></li>
<li>åœ¨statementè¯­å¥ä¸­,å³ä½¿æ˜¯ç›¸åŒæ“ä½œä½†å› ä¸ºæ•°æ®å†…å®¹ä¸ä¸€æ ·,æ‰€ä»¥æ•´ä¸ªè¯­å¥æœ¬èº«ä¸èƒ½åŒ¹é…,æ²¡æœ‰ç¼“å­˜è¯­å¥çš„æ„ä¹‰.äº‹å®æ˜¯æ²¡æœ‰æ•°æ®åº“ä¼šå¯¹æ™®é€šè¯­å¥ç¼–è¯‘åçš„æ‰§è¡Œä»£ç ç¼“å­˜ã€‚è¿™æ ·<u>æ¯æ‰§è¡Œä¸€æ¬¡éƒ½è¦å¯¹ä¼ å…¥çš„è¯­å¥ç¼–è¯‘ä¸€æ¬¡ã€‚</u></li>
<li>(è¯­æ³•æ£€æŸ¥ï¼Œè¯­ä¹‰æ£€æŸ¥ï¼Œç¿»è¯‘æˆäºŒè¿›åˆ¶å‘½ä»¤ï¼Œç¼“å­˜)</li>
</ul>
</li>
<li>
<p>å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1566569819744.png" alt="1566569819744"  />
</p>
</li>
</ul>
<h4 id="323-javaä¸sqlå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨">3.2.3 Javaä¸SQLå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨<a hidden class="anchor" aria-hidden="true" href="#323-javaä¸sqlå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨">#</a></h4>
<table>
<thead>
<tr>
<th>Javaç±»å‹</th>
<th>SQLç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>BIT</td>
</tr>
<tr>
<td>byte</td>
<td>TINYINT</td>
</tr>
<tr>
<td>short</td>
<td>SMALLINT</td>
</tr>
<tr>
<td>int</td>
<td>INTEGER</td>
</tr>
<tr>
<td>long</td>
<td>BIGINT</td>
</tr>
<tr>
<td>String</td>
<td>CHAR,VARCHAR,LONGVARCHAR</td>
</tr>
<tr>
<td>byte   array</td>
<td>BINARY  ,    VAR BINARY</td>
</tr>
<tr>
<td>java.sql.Date</td>
<td>DATE</td>
</tr>
<tr>
<td>java.sql.Time</td>
<td>TIME</td>
</tr>
<tr>
<td>java.sql.Timestamp</td>
<td>TIMESTAMP</td>
</tr>
</tbody>
</table>
<h4 id="324-ä½¿ç”¨preparedstatementå®ç°å¢åˆ æ”¹æ“ä½œ">3.2.4 ä½¿ç”¨PreparedStatementå®ç°å¢ã€åˆ ã€æ”¹æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#324-ä½¿ç”¨preparedstatementå®ç°å¢åˆ æ”¹æ“ä½œ">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#007f7f">//é€šç”¨çš„å¢ã€åˆ ã€æ”¹æ“ä½œï¼ˆä½“ç°ä¸€ï¼šå¢ã€åˆ ã€æ”¹ ï¼› ä½“ç°äºŒï¼šé’ˆå¯¹äºä¸åŒçš„è¡¨ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> update(String sql,Object ... args){
</span></span><span style="display:flex;"><span>		Connection conn = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		PreparedStatement ps = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//1.è·å–æ•°æ®åº“çš„è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//2.è·å–PreparedStatementçš„å®ä¾‹ (æˆ–ï¼šé¢„ç¼–è¯‘sqlè¯­å¥)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//3.å¡«å……å ä½ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			<span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = 0;i &lt; args.<span style="color:#007f7f">length</span>;i++){
</span></span><span style="display:flex;"><span>				ps.<span style="color:#007f7f">setObject</span>(i + 1, args[i]);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//4.æ‰§è¡Œsqlè¯­å¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps.<span style="color:#007f7f">execute</span>();
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		}<span style="color:#fff;font-weight:bold">finally</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//5.å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="325-ä½¿ç”¨preparedstatementå®ç°æŸ¥è¯¢æ“ä½œ">3.2.5 ä½¿ç”¨PreparedStatementå®ç°æŸ¥è¯¢æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#325-ä½¿ç”¨preparedstatementå®ç°æŸ¥è¯¢æ“ä½œ">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#007f7f">// é€šç”¨çš„é’ˆå¯¹äºä¸åŒè¡¨çš„æŸ¥è¯¢:è¿”å›ä¸€ä¸ªå¯¹è±¡ (version 1.0)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getInstance(Class&lt;T&gt; clazz, String sql, Object... args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Connection conn = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		PreparedStatement ps = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		ResultSet rs = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 1.è·å–æ•°æ®åº“è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 2.é¢„ç¼–è¯‘sqlè¯­å¥ï¼Œå¾—åˆ°PreparedStatementå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 3.å¡«å……å ä½ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; args.<span style="color:#007f7f">length</span>; i++) {
</span></span><span style="display:flex;"><span>				ps.<span style="color:#007f7f">setObject</span>(i + 1, args[i]);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 4.æ‰§è¡ŒexecuteQuery(),å¾—åˆ°ç»“æœé›†ï¼šResultSet
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			rs = ps.<span style="color:#007f7f">executeQuery</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 5.å¾—åˆ°ç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ResultSetMetaData rsmd = rs.<span style="color:#007f7f">getMetaData</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 6.1é€šè¿‡ResultSetMetaDataå¾—åˆ°columnCount,columnLabelï¼›é€šè¿‡ResultSetå¾—åˆ°åˆ—å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			<span style="color:#fff;font-weight:bold">int</span> columnCount = rsmd.<span style="color:#007f7f">getColumnCount</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">if</span> (rs.<span style="color:#007f7f">next</span>()) {
</span></span><span style="display:flex;"><span>				T t = clazz.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; columnCount; i++) {<span style="color:#007f7f">// éå†æ¯ä¸€ä¸ªåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>					<span style="color:#007f7f">// è·å–åˆ—å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>					Object columnVal = rs.<span style="color:#007f7f">getObject</span>(i + 1);
</span></span><span style="display:flex;"><span>					<span style="color:#007f7f">// è·å–åˆ—çš„åˆ«å:åˆ—çš„åˆ«åï¼Œä½¿ç”¨ç±»çš„å±æ€§åå……å½“
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>					String columnLabel = rsmd.<span style="color:#007f7f">getColumnLabel</span>(i + 1);
</span></span><span style="display:flex;"><span>					<span style="color:#007f7f">// 6.2ä½¿ç”¨åå°„ï¼Œç»™å¯¹è±¡çš„ç›¸åº”å±æ€§èµ‹å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>					Field field = clazz.<span style="color:#007f7f">getDeclaredField</span>(columnLabel);
</span></span><span style="display:flex;"><span>					field.<span style="color:#007f7f">setAccessible</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>					field.<span style="color:#007f7f">set</span>(t, columnVal);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// 7.å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps, rs);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-resultsetä¸resultsetmetadata">3.3 ResultSetä¸ResultSetMetaData<a hidden class="anchor" aria-hidden="true" href="#33-resultsetä¸resultsetmetadata">#</a></h3>
<h4 id="331-resultset">3.3.1 ResultSet<a hidden class="anchor" aria-hidden="true" href="#331-resultset">#</a></h4>
<ul>
<li>
<p>æŸ¥è¯¢éœ€è¦è°ƒç”¨PreparedStatement çš„ executeQuery() æ–¹æ³•ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸€ä¸ªResultSet å¯¹è±¡</p>
</li>
<li>
<p>ResultSet å¯¹è±¡ä»¥é€»è¾‘è¡¨æ ¼çš„å½¢å¼å°è£…äº†æ‰§è¡Œæ•°æ®åº“æ“ä½œçš„ç»“æœé›†ï¼ŒResultSet æ¥å£ç”±æ•°æ®åº“å‚å•†æä¾›å®ç°</p>
</li>
<li>
<p>ResultSet è¿”å›çš„å®é™…ä¸Šå°±æ˜¯ä¸€å¼ æ•°æ®è¡¨ã€‚æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®è¡¨çš„ç¬¬ä¸€æ¡è®°å½•çš„å‰é¢ã€‚</p>
</li>
<li>
<p>ResultSet å¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å½“å‰æ•°æ®è¡Œçš„<strong>æ¸¸æ ‡</strong>ï¼Œåˆå§‹çš„æ—¶å€™ï¼Œæ¸¸æ ‡åœ¨ç¬¬ä¸€è¡Œä¹‹å‰ï¼Œå¯ä»¥é€šè¿‡ ResultSet å¯¹è±¡çš„ next() æ–¹æ³•ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œã€‚è°ƒç”¨ next()æ–¹æ³•æ£€æµ‹ä¸‹ä¸€è¡Œæ˜¯å¦æœ‰æ•ˆã€‚è‹¥æœ‰æ•ˆï¼Œè¯¥æ–¹æ³•è¿”å› trueï¼Œä¸”æŒ‡é’ˆä¸‹ç§»ã€‚ç›¸å½“äºIteratorå¯¹è±¡çš„ hasNext() å’Œ next() æ–¹æ³•çš„ç»“åˆä½“ã€‚</p>
</li>
<li>
<p>å½“æŒ‡é’ˆæŒ‡å‘ä¸€è¡Œæ—¶, å¯ä»¥é€šè¿‡è°ƒç”¨ getXxx(int index) æˆ– getXxx(int columnName) è·å–æ¯ä¸€åˆ—çš„å€¼ã€‚</p>
<ul>
<li>ä¾‹å¦‚: getInt(1), getString(&ldquo;name&rdquo;)</li>
<li><strong>æ³¨æ„ï¼šJavaä¸æ•°æ®åº“äº¤äº’æ¶‰åŠåˆ°çš„ç›¸å…³Java APIä¸­çš„ç´¢å¼•éƒ½ä»1å¼€å§‹ã€‚</strong></li>
</ul>
</li>
<li>
<p>ResultSet æ¥å£çš„å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>boolean next()</li>
<li>getString()</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555580152530.png" alt="1555580152530"  />
</p>
</li>
</ul>
<h4 id="332-resultsetmetadata">3.3.2 ResultSetMetaData<a hidden class="anchor" aria-hidden="true" href="#332-resultsetmetadata">#</a></h4>
<ul>
<li>
<p>å¯ç”¨äºè·å–å…³äº ResultSet å¯¹è±¡ä¸­åˆ—çš„ç±»å‹å’Œå±æ€§ä¿¡æ¯çš„å¯¹è±¡</p>
</li>
<li>
<p>ResultSetMetaData meta = rs.getMetaData();</p>
<ul>
<li>
<p><strong>getColumnName</strong>(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åç§°</p>
</li>
<li>
<p><strong>getColumnLabel</strong>(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åˆ«å</p>
</li>
<li>
<p><strong>getColumnCount</strong>()ï¼šè¿”å›å½“å‰ ResultSet å¯¹è±¡ä¸­çš„åˆ—æ•°ã€‚</p>
</li>
<li>
<p>getColumnTypeName(int column)ï¼šæ£€ç´¢æŒ‡å®šåˆ—çš„æ•°æ®åº“ç‰¹å®šçš„ç±»å‹åç§°ã€‚</p>
</li>
<li>
<p>getColumnDisplaySize(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—çš„æœ€å¤§æ ‡å‡†å®½åº¦ï¼Œä»¥å­—ç¬¦ä¸ºå•ä½ã€‚</p>
</li>
<li>
<p><strong>isNullable</strong>(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—ä¸­çš„å€¼æ˜¯å¦å¯ä»¥ä¸º nullã€‚</p>
</li>
<li>
<p>isAutoIncrement(int column)ï¼šæŒ‡ç¤ºæ˜¯å¦è‡ªåŠ¨ä¸ºæŒ‡å®šåˆ—è¿›è¡Œç¼–å·ï¼Œè¿™æ ·è¿™äº›åˆ—ä»ç„¶æ˜¯åªè¯»çš„ã€‚</p>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555579494691.png" alt="1555579494691"  />
</p>
<p><strong>é—®é¢˜1ï¼šå¾—åˆ°ç»“æœé›†å, å¦‚ä½•çŸ¥é“è¯¥ç»“æœé›†ä¸­æœ‰å“ªäº›åˆ— ï¼Ÿ åˆ—åæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>â€‹     éœ€è¦ä½¿ç”¨ä¸€ä¸ªæè¿° ResultSet çš„å¯¹è±¡ï¼Œ å³ ResultSetMetaData</p>
<p><strong>é—®é¢˜2ï¼šå…³äºResultSetMetaData</strong></p>
<ol>
<li><strong>å¦‚ä½•è·å– ResultSetMetaData</strong>ï¼š è°ƒç”¨ ResultSet çš„ getMetaData() æ–¹æ³•å³å¯</li>
<li><strong>è·å– ResultSet ä¸­æœ‰å¤šå°‘åˆ—</strong>ï¼šè°ƒç”¨ ResultSetMetaData çš„ getColumnCount() æ–¹æ³•</li>
<li><strong>è·å– ResultSet æ¯ä¸€åˆ—çš„åˆ—çš„åˆ«åæ˜¯ä»€ä¹ˆ</strong>ï¼šè°ƒç”¨ ResultSetMetaData çš„getColumnLabel() æ–¹æ³•</li>
</ol>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555579816884.png" alt="1555579816884"  />
</p>
<h3 id="34-èµ„æºçš„é‡Šæ”¾">3.4 èµ„æºçš„é‡Šæ”¾<a hidden class="anchor" aria-hidden="true" href="#34-èµ„æºçš„é‡Šæ”¾">#</a></h3>
<ul>
<li>æ•°æ®åº“ç»“æŸåä¸€å®šè¦å…³é—­æ‰€æœ‰çš„è¿æ¥</li>
</ul>
<h3 id="36-jdbc-apiå°ç»“">3.6 JDBC APIå°ç»“<a hidden class="anchor" aria-hidden="true" href="#36-jdbc-apiå°ç»“">#</a></h3>
<ul>
<li>
<p>ä¸¤ç§æ€æƒ³</p>
<ul>
<li>é¢å‘æ¥å£ç¼–ç¨‹çš„æ€æƒ³</li>
<li>ORMæ€æƒ³(object relational mapping)
<ul>
<li>ä¸€ä¸ªæ•°æ®è¡¨å¯¹åº”ä¸€ä¸ªjavaç±»</li>
<li>è¡¨ä¸­çš„ä¸€æ¡è®°å½•å¯¹åº”javaç±»çš„ä¸€ä¸ªå¯¹è±¡</li>
<li>è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µå¯¹åº”javaç±»çš„ä¸€ä¸ªå±æ€§</li>
</ul>
</li>
</ul>
</li>
<li>
<p>sqlæ˜¯éœ€è¦ç»“åˆåˆ—åå’Œè¡¨çš„å±æ€§åæ¥å†™ã€‚æ³¨æ„èµ·åˆ«åã€‚</p>
</li>
<li>
<p>ä¸¤ç§æŠ€æœ¯</p>
<ul>
<li>JDBCç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData
<ul>
<li>è·å–åˆ—æ•°ï¼šgetColumnCount()</li>
<li>è·å–åˆ—çš„åˆ«åï¼šgetColumnLabel()</li>
</ul>
</li>
<li>é€šè¿‡åå°„ï¼Œåˆ›å»ºæŒ‡å®šç±»çš„å¯¹è±¡ï¼Œè·å–æŒ‡å®šçš„å±æ€§å¹¶èµ‹å€¼</li>
</ul>
</li>
</ul>
<h2 id="å››-æ“ä½œblobç±»å‹å­—æ®µ">å››ï¼š æ“ä½œBLOBç±»å‹å­—æ®µ<a hidden class="anchor" aria-hidden="true" href="#å››-æ“ä½œblobç±»å‹å­—æ®µ">#</a></h2>
<h3 id="41-mysql-blobç±»å‹">4.1 MySQL BLOBç±»å‹<a hidden class="anchor" aria-hidden="true" href="#41-mysql-blobç±»å‹">#</a></h3>
<ul>
<li>
<p>MySQLä¸­ï¼ŒBLOBæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®çš„å®¹å™¨ï¼Œå®ƒèƒ½å®¹çº³ä¸åŒå¤§å°çš„æ•°æ®ã€‚</p>
</li>
<li>
<p>æ’å…¥BLOBç±»å‹çš„æ•°æ®å¿…é¡»ä½¿ç”¨PreparedStatementï¼Œå› ä¸ºBLOBç±»å‹çš„æ•°æ®æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å†™çš„ã€‚</p>
</li>
<li>
<p>MySQLçš„å››ç§BLOBç±»å‹(é™¤äº†åœ¨å­˜å‚¨çš„æœ€å¤§ä¿¡æ¯é‡ä¸Šä¸åŒå¤–ï¼Œä»–ä»¬æ˜¯ç­‰åŒçš„)</p>
</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555581069798.png" alt="1555581069798"  />
</p>
<ul>
<li>å¦‚æœåœ¨æŒ‡å®šäº†ç›¸å…³çš„Blobç±»å‹ä»¥åï¼Œè¿˜æŠ¥é”™ï¼šxxx too largeï¼Œé‚£ä¹ˆåœ¨mysqlçš„å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾my.iniæ–‡ä»¶åŠ ä¸Šå¦‚ä¸‹çš„é…ç½®å‚æ•°ï¼š <strong>max_allowed_packet=16M</strong>ã€‚åŒæ—¶æ³¨æ„ï¼šä¿®æ”¹äº†my.iniæ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡æ–°å¯åŠ¨mysqlæœåŠ¡ã€‚</li>
</ul>
<h3 id="42-å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹">4.2 å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#42-å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//è·å–è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into customers(name,email,birth,photo)values(?,?,?,?)&#34;</span>;
</span></span><span style="display:flex;"><span>PreparedStatement ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¡«å……å ä½ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ps.<span style="color:#007f7f">setString</span>(1, <span style="color:#0ff;font-weight:bold">&#34;å¾æµ·å¼º&#34;</span>);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setString</span>(2, <span style="color:#0ff;font-weight:bold">&#34;xhq@126.com&#34;</span>);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setDate</span>(3, <span style="color:#fff;font-weight:bold">new</span> Date(<span style="color:#fff;font-weight:bold">new</span> java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">Date</span>().<span style="color:#007f7f">getTime</span>()));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ“ä½œBlobç±»å‹çš„å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;xhq.png&#34;</span>);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setBlob</span>(4, fis);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ps.<span style="color:#007f7f">execute</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>fis.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="43-ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„blobç±»å‹å­—æ®µ">4.3 ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„Blobç±»å‹å­—æ®µ<a hidden class="anchor" aria-hidden="true" href="#43-ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„blobç±»å‹å­—æ®µ">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>String sql = <span style="color:#0ff;font-weight:bold">&#34;update customers set photo = ? where id = ?&#34;</span>;
</span></span><span style="display:flex;"><span>PreparedStatement ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¡«å……å ä½ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ“ä½œBlobç±»å‹çš„å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;coffee.png&#34;</span>);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setBlob</span>(1, fis);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setInt</span>(2, 25);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">execute</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fis.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44-ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹">4.4 ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#44-ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String sql = <span style="color:#0ff;font-weight:bold">&#34;SELECT id, name, email, birth, photo FROM customer WHERE id = ?&#34;</span>;
</span></span><span style="display:flex;"><span>conn = getConnection();
</span></span><span style="display:flex;"><span>ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>ps.<span style="color:#007f7f">setInt</span>(1, 8);
</span></span><span style="display:flex;"><span>rs = ps.<span style="color:#007f7f">executeQuery</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span>(rs.<span style="color:#007f7f">next</span>()){
</span></span><span style="display:flex;"><span>	Integer id = rs.<span style="color:#007f7f">getInt</span>(1);
</span></span><span style="display:flex;"><span>    String name = rs.<span style="color:#007f7f">getString</span>(2);
</span></span><span style="display:flex;"><span>	String email = rs.<span style="color:#007f7f">getString</span>(3);
</span></span><span style="display:flex;"><span>    Date birth = rs.<span style="color:#007f7f">getDate</span>(4);
</span></span><span style="display:flex;"><span>	Customer cust = <span style="color:#fff;font-weight:bold">new</span> Customer(id, name, email, birth);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(cust); 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//è¯»å–Blobç±»å‹çš„å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	Blob photo = rs.<span style="color:#007f7f">getBlob</span>(5);
</span></span><span style="display:flex;"><span>	InputStream is = photo.<span style="color:#007f7f">getBinaryStream</span>();
</span></span><span style="display:flex;"><span>	OutputStream os = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;c.jpg&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">byte</span> [] buffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> len = 0;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">while</span>((len = is.<span style="color:#007f7f">read</span>(buffer)) != -1){
</span></span><span style="display:flex;"><span>		os.<span style="color:#007f7f">write</span>(buffer, 0, len);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps, rs);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span>(is != <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>		is.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span>(os !=  <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>		os.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”-æ‰¹é‡æ’å…¥">äº”ï¼š æ‰¹é‡æ’å…¥<a hidden class="anchor" aria-hidden="true" href="#äº”-æ‰¹é‡æ’å…¥">#</a></h2>
<h3 id="51-æ‰¹é‡æ‰§è¡Œsqlè¯­å¥">5.1 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥<a hidden class="anchor" aria-hidden="true" href="#51-æ‰¹é‡æ‰§è¡Œsqlè¯­å¥">#</a></h3>
<ul>
<li>
<p>å½“éœ€è¦æˆæ‰¹æ’å…¥æˆ–è€…æ›´æ–°è®°å½•æ—¶ï¼Œå¯ä»¥é‡‡ç”¨Javaçš„æ‰¹é‡<strong>æ›´æ–°</strong>æœºåˆ¶ï¼Œè¿™ä¸€æœºåˆ¶å…è®¸å¤šæ¡è¯­å¥ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“æ‰¹é‡å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹æ¯”å•ç‹¬æäº¤å¤„ç†æ›´æœ‰æ•ˆç‡</p>
</li>
<li>
<p>JDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><strong>addBatch(String)ï¼šæ·»åŠ éœ€è¦æ‰¹é‡å¤„ç†çš„SQLè¯­å¥æˆ–æ˜¯å‚æ•°ï¼›</strong></li>
<li><strong>executeBatch()ï¼šæ‰§è¡Œæ‰¹é‡å¤„ç†è¯­å¥ï¼›</strong></li>
<li><strong>clearBatch():æ¸…ç©ºç¼“å­˜çš„æ•°æ®</strong></li>
</ul>
</li>
<li>
<p>é€šå¸¸æˆ‘ä»¬ä¼šé‡åˆ°ä¸¤ç§æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„æƒ…å†µï¼š</p>
<ul>
<li>å¤šæ¡SQLè¯­å¥çš„æ‰¹é‡å¤„ç†ï¼›</li>
<li>ä¸€ä¸ªSQLè¯­å¥çš„æ‰¹é‡ä¼ å‚ï¼›</li>
</ul>
</li>
</ul>
<h3 id="52-é«˜æ•ˆçš„æ‰¹é‡æ’å…¥">5.2 é«˜æ•ˆçš„æ‰¹é‡æ’å…¥<a hidden class="anchor" aria-hidden="true" href="#52-é«˜æ•ˆçš„æ‰¹é‡æ’å…¥">#</a></h3>
<ul>
<li>ä¸¾ä¾‹ï¼šå‘æ•°æ®è¡¨ä¸­æ’å…¥20000æ¡æ•°æ®</li>
</ul>
<h4 id="521-å®ç°å±‚æ¬¡ä¸€ä½¿ç”¨statement">5.2.1 å®ç°å±‚æ¬¡ä¸€ï¼šä½¿ç”¨Statement<a hidden class="anchor" aria-hidden="true" href="#521-å®ç°å±‚æ¬¡ä¸€ä½¿ç”¨statement">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>Statement st = conn.<span style="color:#007f7f">createStatement</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = 1;i &lt;= 20000;i++){
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into goods(name) values(&#39;name_&#39; + &#34;</span>+ i +<span style="color:#0ff;font-weight:bold">&#34;)&#34;</span>;
</span></span><span style="display:flex;"><span>	st.<span style="color:#007f7f">executeUpdate</span>(sql);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="522-å®ç°å±‚æ¬¡äºŒä½¿ç”¨preparedstatement">5.2.2 å®ç°å±‚æ¬¡äºŒï¼šä½¿ç”¨PreparedStatement<a hidden class="anchor" aria-hidden="true" href="#522-å®ç°å±‚æ¬¡äºŒä½¿ç”¨preparedstatement">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into goods(name)values(?)&#34;</span>;
</span></span><span style="display:flex;"><span>PreparedStatement ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = 1;i &lt;= 20000;i++){
</span></span><span style="display:flex;"><span>	ps.<span style="color:#007f7f">setString</span>(1, <span style="color:#0ff;font-weight:bold">&#34;name_&#34;</span> + i);
</span></span><span style="display:flex;"><span>	ps.<span style="color:#007f7f">executeUpdate</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&#34;</span> + (end - start));<span style="color:#007f7f">//82340
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ³•äºŒæ¯”æ³•ä¸€å¿«çš„åŸå› æ˜¯ï¼š<code>PrepareStatement</code>å¯ä»¥ç»™<code>sql</code>æå‰é¢„å¤‡å¥½ï¼Œå®é™…ä¸Šï¼Œ<code>sql</code>åªéœ€è¦æ‹¼æ¥ä¸€æ¬¡ï¼Œè€Œ<code>statement</code>éœ€è¦æ‹¼æ¥å¤šæ¬¡ã€‚</li>
</ul>
<h4 id="523-å®ç°å±‚æ¬¡ä¸‰">5.2.3 å®ç°å±‚æ¬¡ä¸‰<a hidden class="anchor" aria-hidden="true" href="#523-å®ç°å±‚æ¬¡ä¸‰">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä¿®æ”¹1ï¼š ä½¿ç”¨ addBatch() / executeBatch() / clearBatch()
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä¿®æ”¹2ï¼šmysqlæœåŠ¡å™¨é»˜è®¤æ˜¯å…³é—­æ‰¹å¤„ç†çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªå‚æ•°ï¼Œè®©mysqlå¼€å¯æ‰¹å¤„ç†çš„æ”¯æŒã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 		 ?rewriteBatchedStatements=true å†™åœ¨é…ç½®æ–‡ä»¶çš„urlåé¢
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä¿®æ”¹3ï¼šä½¿ç”¨æ›´æ–°çš„mysql é©±åŠ¨ï¼šmysql-connector-java-5.1.37-bin.jar
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testInsert1() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into goods(name)values(?)&#34;</span>;
</span></span><span style="display:flex;"><span>	PreparedStatement ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = 1;i &lt;= 1000000;i++){
</span></span><span style="display:flex;"><span>		ps.<span style="color:#007f7f">setString</span>(1, <span style="color:#0ff;font-weight:bold">&#34;name_&#34;</span> + i);
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//1.â€œæ”’â€sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		ps.<span style="color:#007f7f">addBatch</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span>(i % 500 == 0){
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//2.æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps.<span style="color:#007f7f">executeBatch</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//3.æ¸…ç©º
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps.<span style="color:#007f7f">clearBatch</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&#34;</span> + (end - start));<span style="color:#007f7f">//20000æ¡ï¼š625                                                                         //1000000æ¡:14733  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ³•ä¸‰æ˜¯åˆ©ç”¨<code>Batch</code>,ç›¸å½“äºä¸€ä¸ªæ± å­ï¼Œå½“ç§¯ç´¯çš„è¯·æ±‚è¾¾åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œé›†ä¸­è¿›è¡Œæ‰§è¡Œã€‚</li>
</ul>
<h4 id="524-å®ç°å±‚æ¬¡å››">5.2.4 å®ç°å±‚æ¬¡å››<a hidden class="anchor" aria-hidden="true" href="#524-å®ç°å±‚æ¬¡å››">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">* å±‚æ¬¡å››ï¼šåœ¨å±‚æ¬¡ä¸‰çš„åŸºç¡€ä¸Šæ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">* ä½¿ç”¨Connection çš„ setAutoCommit(false)  /  commit()
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">*/</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testInsert2() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//1.è®¾ç½®ä¸ºä¸è‡ªåŠ¨æäº¤æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	conn.<span style="color:#007f7f">setAutoCommit</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into goods(name)values(?)&#34;</span>;
</span></span><span style="display:flex;"><span>	PreparedStatement ps = conn.<span style="color:#007f7f">prepareStatement</span>(sql);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = 1;i &lt;= 1000000;i++){
</span></span><span style="display:flex;"><span>		ps.<span style="color:#007f7f">setString</span>(1, <span style="color:#0ff;font-weight:bold">&#34;name_&#34;</span> + i);
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//1.â€œæ”’â€sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		ps.<span style="color:#007f7f">addBatch</span>();
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span>(i % 500 == 0){
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//2.æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps.<span style="color:#007f7f">executeBatch</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//3.æ¸…ç©º
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			ps.<span style="color:#007f7f">clearBatch</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//2.æäº¤æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	conn.<span style="color:#007f7f">commit</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&#34;</span> + (end - start));<span style="color:#007f7f">//1000000æ¡:4978 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, ps);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ³•å›› ç›¸æ¯”è¾ƒæ³•ä¸‰ï¼Œ åªéœ€è¦æäº¤ä¸€æ¬¡ã€‚<code>io </code>è¯·æ±‚å‡å°‘ã€‚</li>
</ul>
<h2 id="å…­-æ•°æ®åº“äº‹åŠ¡">å…­ï¼š æ•°æ®åº“äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#å…­-æ•°æ®åº“äº‹åŠ¡">#</a></h2>
<h3 id="61-æ•°æ®åº“äº‹åŠ¡ä»‹ç»">6.1 æ•°æ®åº“äº‹åŠ¡ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#61-æ•°æ®åº“äº‹åŠ¡ä»‹ç»">#</a></h3>
<ul>
<li>
<p><strong>äº‹åŠ¡ï¼šä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒ,ä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚</strong></p>
</li>
<li>
<p><strong>äº‹åŠ¡å¤„ç†ï¼ˆäº‹åŠ¡æ“ä½œï¼‰ï¼š<strong>ä¿è¯æ‰€æœ‰äº‹åŠ¡éƒ½ä½œä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒæ¥æ‰§è¡Œï¼Œå³ä½¿å‡ºç°äº†æ•…éšœï¼Œéƒ½ä¸èƒ½æ”¹å˜è¿™ç§æ‰§è¡Œæ–¹å¼ã€‚å½“åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰çš„äº‹åŠ¡éƒ½</strong>è¢«æäº¤(commit)</strong>ï¼Œé‚£ä¹ˆè¿™äº›ä¿®æ”¹å°±æ°¸ä¹…åœ°ä¿å­˜ä¸‹æ¥ï¼›è¦ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå°†æ”¾å¼ƒæ‰€ä½œçš„æ‰€æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªäº‹åŠ¡**å›æ»š(rollback)**åˆ°æœ€åˆçŠ¶æ€ã€‚</p>
</li>
<li>
<p>ä¸ºç¡®ä¿æ•°æ®åº“ä¸­æ•°æ®çš„<strong>ä¸€è‡´æ€§</strong>ï¼Œæ•°æ®çš„æ“çºµåº”å½“æ˜¯ç¦»æ•£çš„æˆç»„çš„é€»è¾‘å•å…ƒï¼šå½“å®ƒå…¨éƒ¨å®Œæˆæ—¶ï¼Œæ•°æ®çš„ä¸€è‡´æ€§å¯ä»¥ä¿æŒï¼Œè€Œå½“è¿™ä¸ªå•å…ƒä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡åº”å…¨éƒ¨è§†ä¸ºé”™è¯¯ï¼Œæ‰€æœ‰ä»èµ·å§‹ç‚¹ä»¥åçš„æ“ä½œåº”å…¨éƒ¨å›é€€åˆ°å¼€å§‹çŠ¶æ€ã€‚</p>
</li>
</ul>
<h3 id="62-äº‹åŠ¡çš„acidå±æ€§">6.2 äº‹åŠ¡çš„ACIDå±æ€§<a hidden class="anchor" aria-hidden="true" href="#62-äº‹åŠ¡çš„acidå±æ€§">#</a></h3>
<ol>
<li>
<p><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>
åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</p>
</li>
<li>
<p><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>
äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>
äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p>
</li>
<li>
<p><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>
æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œå’Œæ•°æ®åº“æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p>
</li>
</ol>
<h4 id="631-æ•°æ®åº“çš„å¹¶å‘é—®é¢˜">6.3.1 æ•°æ®åº“çš„å¹¶å‘é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#631-æ•°æ®åº“çš„å¹¶å‘é—®é¢˜">#</a></h4>
<ul>
<li>
<p>å¯¹äºåŒæ—¶è¿è¡Œçš„å¤šä¸ªäº‹åŠ¡, å½“è¿™äº›äº‹åŠ¡è®¿é—®æ•°æ®åº“ä¸­ç›¸åŒçš„æ•°æ®æ—¶, å¦‚æœæ²¡æœ‰é‡‡å–å¿…è¦çš„éš”ç¦»æœºåˆ¶, å°±ä¼šå¯¼è‡´å„ç§å¹¶å‘é—®é¢˜:</p>
<ul>
<li><strong>è„è¯»</strong>: å¯¹äºä¸¤ä¸ªäº‹åŠ¡ T1, T2, T1 è¯»å–äº†å·²ç»è¢« T2 æ›´æ–°ä½†è¿˜<strong>æ²¡æœ‰è¢«æäº¤</strong>çš„å­—æ®µã€‚ä¹‹å, è‹¥ T2 å›æ»š, T1è¯»å–çš„å†…å®¹å°±æ˜¯ä¸´æ—¶ä¸”æ— æ•ˆçš„ã€‚</li>
<li><strong>ä¸å¯é‡å¤è¯»</strong>: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 <strong>æ›´æ–°</strong>äº†è¯¥å­—æ®µã€‚ä¹‹å, T1å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µ, å€¼å°±ä¸åŒäº†ã€‚</li>
<li><strong>å¹»è¯»</strong>: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 åœ¨è¯¥è¡¨ä¸­<strong>æ’å…¥</strong>äº†ä¸€äº›æ–°çš„è¡Œã€‚ä¹‹å, å¦‚æœ T1 å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»æ€§</strong>: æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›, ä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“, é¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚æ•°æ®åº“è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«, ä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦, <strong>éš”ç¦»çº§åˆ«è¶Šé«˜, æ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½, ä½†å¹¶å‘æ€§è¶Šå¼±ã€‚</strong></p>
</li>
</ul>
<h4 id="632-å››ç§éš”ç¦»çº§åˆ«">6.3.2 å››ç§éš”ç¦»çº§åˆ«<a hidden class="anchor" aria-hidden="true" href="#632-å››ç§éš”ç¦»çº§åˆ«">#</a></h4>
<ul>
<li>
<p>æ•°æ®åº“æä¾›çš„4ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555586275271.png" alt="1555586275271"  />
</p>
</li>
<li>
<p>Oracle æ”¯æŒçš„ 2 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š<strong>READ COMMITED</strong>, SERIALIZABLEã€‚ Oracle é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: <strong>READ COMMITED</strong> ã€‚</p>
</li>
<li>
<p>Mysql æ”¯æŒ 4 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚Mysql é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: <strong>REPEATABLE READã€‚</strong></p>
</li>
</ul>
<h4 id="633-åœ¨mysqlä¸­è®¾ç½®éš”ç¦»çº§åˆ«">6.3.3 åœ¨MySqlä¸­è®¾ç½®éš”ç¦»çº§åˆ«<a hidden class="anchor" aria-hidden="true" href="#633-åœ¨mysqlä¸­è®¾ç½®éš”ç¦»çº§åˆ«">#</a></h4>
<ul>
<li>
<p>æ¯å¯åŠ¨ä¸€ä¸ª mysql ç¨‹åº, å°±ä¼šè·å¾—ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“è¿æ¥. æ¯ä¸ªæ•°æ®åº“è¿æ¥éƒ½æœ‰ä¸€ä¸ªå…¨å±€å˜é‡ @@tx_isolation, è¡¨ç¤ºå½“å‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p>
</li>
<li>
<p>æŸ¥çœ‹å½“å‰çš„éš”ç¦»çº§åˆ«:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> @@tx_isolation;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è®¾ç½®å½“å‰ mySQL è¿æ¥çš„éš”ç¦»çº§åˆ«:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span>  transaction isolation level <span style="color:#fff;font-weight:bold">read</span> committed;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è®¾ç½®æ•°æ®åº“ç³»ç»Ÿçš„å…¨å±€çš„éš”ç¦»çº§åˆ«:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> global transaction isolation level <span style="color:#fff;font-weight:bold">read</span> committed;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è¡¥å……æ“ä½œï¼š</p>
<ul>
<li>
<p>åˆ›å»ºmysqlæ•°æ®åº“ç”¨æˆ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">user</span> tom <span style="color:#fff;font-weight:bold">identified</span> <span style="color:#fff;font-weight:bold">by</span> <span style="color:#0ff;font-weight:bold">&#39;abc123&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æˆäºˆæƒé™</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#007f7f">#æˆäºˆé€šè¿‡ç½‘ç»œæ–¹å¼ç™»å½•çš„tomç”¨æˆ·ï¼Œå¯¹æ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„å…¨éƒ¨æƒé™ï¼Œå¯†ç è®¾ä¸ºabc123.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">grant</span> <span style="color:#fff;font-weight:bold">all</span> <span style="color:#fff;font-weight:bold">privileges</span> <span style="color:#fff;font-weight:bold">on</span> *.* <span style="color:#fff;font-weight:bold">to</span> tom@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span>  <span style="color:#fff;font-weight:bold">identified</span> <span style="color:#fff;font-weight:bold">by</span> <span style="color:#0ff;font-weight:bold">&#39;abc123&#39;</span>; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#007f7f">#ç»™tomç”¨æˆ·ä½¿ç”¨æœ¬åœ°å‘½ä»¤è¡Œæ–¹å¼ï¼Œæˆäºˆatguigudbè¿™ä¸ªåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„æ’åˆ æ”¹æŸ¥çš„æƒé™ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">grant</span> <span style="color:#fff;font-weight:bold">select</span>,<span style="color:#fff;font-weight:bold">insert</span>,<span style="color:#fff;font-weight:bold">delete</span>,<span style="color:#fff;font-weight:bold">update</span> <span style="color:#fff;font-weight:bold">on</span> atguigudb.* <span style="color:#fff;font-weight:bold">to</span> tom@localhost <span style="color:#fff;font-weight:bold">identified</span> <span style="color:#fff;font-weight:bold">by</span> <span style="color:#0ff;font-weight:bold">&#39;abc123&#39;</span>; 
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h2 id="ä¸ƒdaoåŠç›¸å…³å®ç°ç±»">ä¸ƒï¼šDAOåŠç›¸å…³å®ç°ç±»<a hidden class="anchor" aria-hidden="true" href="#ä¸ƒdaoåŠç›¸å…³å®ç°ç±»">#</a></h2>
<ul>
<li>DAOï¼šData Access Objectè®¿é—®æ•°æ®ä¿¡æ¯çš„ç±»å’Œæ¥å£ï¼ŒåŒ…æ‹¬äº†å¯¹æ•°æ®çš„CRUDï¼ˆCreateã€Retrivalã€Updateã€Deleteï¼‰ï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚æœ‰æ—¶ä¹Ÿç§°ä½œï¼šBaseDAO</li>
<li>ä½œç”¨ï¼šä¸ºäº†å®ç°åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œæ›´æœ‰åˆ©äºä»£ç çš„ç»´æŠ¤å’Œå‡çº§ã€‚</li>
</ul>
<h3 id="basedaojava">ã€BaseDAO.javaã€‘<a hidden class="anchor" aria-hidden="true" href="#basedaojava">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.atguigu.bookstore.dao;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.ParameterizedType;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Type;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.sql.Connection;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.sql.SQLException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.dbutils.QueryRunner;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.dbutils.handlers.BeanHandler;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å®šä¹‰ä¸€ä¸ªç”¨æ¥è¢«ç»§æ‰¿çš„å¯¹æ•°æ®åº“è¿›è¡ŒåŸºæœ¬æ“ä½œçš„Dao
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author HanYanBing
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param &lt;T&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> BaseDao&lt;T&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">private</span> QueryRunner queryRunner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// å®šä¹‰ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶æ³›å‹çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">private</span> Class&lt;T&gt; type;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// è·å–Tçš„Classå¯¹è±¡ï¼Œè·å–æ³›å‹çš„ç±»å‹ï¼Œæ³›å‹æ˜¯åœ¨è¢«å­ç±»ç»§æ‰¿æ—¶æ‰ç¡®å®š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">public</span> BaseDao() {
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// è·å–å­ç±»çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		Class clazz = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getClass</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// è·å–çˆ¶ç±»çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		<span style="color:#007f7f">// getGenericSuperclass()ç”¨æ¥è·å–å½“å‰ç±»çš„çˆ¶ç±»çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		<span style="color:#007f7f">// ParameterizedTypeè¡¨ç¤ºçš„æ˜¯å¸¦æ³›å‹çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		ParameterizedType parameterizedType = (ParameterizedType) clazz.<span style="color:#007f7f">getGenericSuperclass</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// è·å–å…·ä½“çš„æ³›å‹ç±»å‹ getActualTypeArgumentsè·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		<span style="color:#007f7f">// è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªTypeçš„æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		Type[] types = parameterizedType.<span style="color:#007f7f">getActualTypeArguments</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// è·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹Â·
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">type</span> = (Class&lt;T&gt;) types[0];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * é€šç”¨çš„å¢åˆ æ”¹æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param params
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> update(Connection conn,String sql, Object... params) {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> count = 0;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			count = queryRunner.<span style="color:#007f7f">update</span>(conn, sql, params);
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (SQLException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		} 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * è·å–ä¸€ä¸ªå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param params
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> T getBean(Connection conn,String sql, Object... params) {
</span></span><span style="display:flex;"><span>		T t = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			t = queryRunner.<span style="color:#007f7f">query</span>(conn, sql, <span style="color:#fff;font-weight:bold">new</span> BeanHandler&lt;T&gt;(type), params);
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (SQLException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		} 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * è·å–æ‰€æœ‰å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param params
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> List&lt;T&gt; getBeanList(Connection conn,String sql, Object... params) {
</span></span><span style="display:flex;"><span>		List&lt;T&gt; list = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			list = queryRunner.<span style="color:#007f7f">query</span>(conn, sql, <span style="color:#fff;font-weight:bold">new</span> BeanListHandler&lt;T&gt;(type), params);
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (SQLException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		} 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> list;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * è·å–ä¸€ä¸ªä½†ä¸€å€¼å¾—æ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œåƒ select count(*)...è¿™æ ·çš„sqlè¯­å¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param sql
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @param params
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> Object getValue(Connection conn,String sql, Object... params) {
</span></span><span style="display:flex;"><span>		Object count = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">// è°ƒç”¨queryRunnerçš„queryæ–¹æ³•è·å–ä¸€ä¸ªå•ä¸€çš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			count = queryRunner.<span style="color:#007f7f">query</span>(conn, sql, <span style="color:#fff;font-weight:bold">new</span> ScalarHandler&lt;&gt;(), params);
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (SQLException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		} 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¹‹åå¯ä»¥å»ºç«‹ç›¸å…³çš„è¡¨ã€æ¥å£ï¼Œè¿›è€Œå°†å¯¹åº”è¡¨çš„DMLæ–¹æ³•å®ç°
<ul>
<li>è¿™é‡Œä»¥<code>customer</code>è¡¨ä¸ºä¾‹å­
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20220324225041717.png" alt="image-20220324225041717"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20220324225054322.png" alt="image-20220324225054322"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å…«æ•°æ®åº“è¿æ¥æ± ">å…«ï¼šæ•°æ®åº“è¿æ¥æ± <a hidden class="anchor" aria-hidden="true" href="#å…«æ•°æ®åº“è¿æ¥æ± ">#</a></h2>
<h3 id="81-æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯">8.1 æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯<a hidden class="anchor" aria-hidden="true" href="#81-æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯">#</a></h3>
<ul>
<li>
<p>ä¸ºè§£å†³ä¼ ç»Ÿå¼€å‘ä¸­çš„æ•°æ®åº“è¿æ¥é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®åº“è¿æ¥æ± çš„åŸºæœ¬æ€æƒ³</strong>ï¼šå°±æ˜¯ä¸ºæ•°æ®åº“è¿æ¥å»ºç«‹ä¸€ä¸ªâ€œç¼“å†²æ± â€ã€‚é¢„å…ˆåœ¨ç¼“å†²æ± ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œå½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€ä»â€œç¼“å†²æ± â€ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•ä¹‹åå†æ”¾å›å»ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®åº“è¿æ¥æ± </strong>è´Ÿè´£åˆ†é…ã€ç®¡ç†å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œå®ƒ<strong>å…è®¸åº”ç”¨ç¨‹åºé‡å¤ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸æ˜¯é‡æ–°å»ºç«‹ä¸€ä¸ª</strong>ã€‚</p>
</li>
<li>
<p>æ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–æ—¶å°†åˆ›å»ºä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥æ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œè¿™äº›æ•°æ®åº“è¿æ¥çš„æ•°é‡æ˜¯ç”±<strong>æœ€å°æ•°æ®åº“è¿æ¥æ•°æ¥è®¾å®š</strong>çš„ã€‚æ— è®ºè¿™äº›æ•°æ®åº“è¿æ¥æ˜¯å¦è¢«ä½¿ç”¨ï¼Œè¿æ¥æ± éƒ½å°†ä¸€ç›´ä¿è¯è‡³å°‘æ‹¥æœ‰è¿™ä¹ˆå¤šçš„è¿æ¥æ•°é‡ã€‚è¿æ¥æ± çš„<strong>æœ€å¤§æ•°æ®åº“è¿æ¥æ•°é‡</strong>é™å®šäº†è¿™ä¸ªè¿æ¥æ± èƒ½å æœ‰çš„æœ€å¤§è¿æ¥æ•°ï¼Œå½“åº”ç”¨ç¨‹åºå‘è¿æ¥æ± è¯·æ±‚çš„è¿æ¥æ•°è¶…è¿‡æœ€å¤§è¿æ¥æ•°é‡æ—¶ï¼Œè¿™äº›è¯·æ±‚å°†è¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555593464033.png" alt="1555593464033"  />
</p>
<ul>
<li><strong>å·¥ä½œåŸç†ï¼š</strong></li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/1555593598606.png" alt="1555593598606"  />
</p>
<ul>
<li>
<p><strong>æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯çš„ä¼˜ç‚¹</strong></p>
<p><strong>1. èµ„æºé‡ç”¨</strong></p>
<p>ç”±äºæ•°æ®åº“è¿æ¥å¾—ä»¥é‡ç”¨ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºï¼Œé‡Šæ”¾è¿æ¥å¼•èµ·çš„å¤§é‡æ€§èƒ½å¼€é”€ã€‚åœ¨å‡å°‘ç³»ç»Ÿæ¶ˆè€—çš„åŸºç¡€ä¸Šï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¢åŠ äº†ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„å¹³ç¨³æ€§ã€‚</p>
<p><strong>2. æ›´å¿«çš„ç³»ç»Ÿååº”é€Ÿåº¦</strong></p>
<p>æ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å·²ç»åˆ›å»ºäº†è‹¥å¹²æ•°æ®åº“è¿æ¥ç½®äºè¿æ¥æ± ä¸­å¤‡ç”¨ã€‚æ­¤æ—¶è¿æ¥çš„åˆå§‹åŒ–å·¥ä½œå‡å·²å®Œæˆã€‚å¯¹äºä¸šåŠ¡è¯·æ±‚å¤„ç†è€Œè¨€ï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„æ—¶é—´å¼€é”€ï¼Œä»è€Œå‡å°‘äº†ç³»ç»Ÿçš„å“åº”æ—¶é—´</p>
<p><strong>3. æ–°çš„èµ„æºåˆ†é…æ‰‹æ®µ</strong></p>
<p>å¯¹äºå¤šåº”ç”¨å…±äº«åŒä¸€æ•°æ®åº“çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¯åœ¨åº”ç”¨å±‚é€šè¿‡æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œå®ç°æŸä¸€åº”ç”¨æœ€å¤§å¯ç”¨æ•°æ®åº“è¿æ¥æ•°çš„é™åˆ¶ï¼Œé¿å…æŸä¸€åº”ç”¨ç‹¬å æ‰€æœ‰çš„æ•°æ®åº“èµ„æº</p>
<p><strong>4. ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼</strong></p>
<p>åœ¨è¾ƒä¸ºå®Œå–„çš„æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶å›æ”¶è¢«å ç”¨è¿æ¥ï¼Œä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„éœ²</p>
</li>
</ul>
<h3 id="82-å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ± ">8.2 å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ± <a hidden class="anchor" aria-hidden="true" href="#82-å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ± ">#</a></h3>
<ul>
<li>JDBC çš„æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ javax.sql.DataSource æ¥è¡¨ç¤ºï¼ŒDataSource åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£é€šå¸¸ç”±æœåŠ¡å™¨(Weblogic, WebSphere, Tomcat)æä¾›å®ç°ï¼Œä¹Ÿæœ‰ä¸€äº›å¼€æºç»„ç»‡æä¾›å®ç°ï¼š
<ul>
<li><strong>DBCP</strong> æ˜¯Apacheæä¾›çš„æ•°æ®åº“è¿æ¥æ± ã€‚tomcat æœåŠ¡å™¨è‡ªå¸¦dbcpæ•°æ®åº“è¿æ¥æ± ã€‚<strong>é€Ÿåº¦ç›¸å¯¹c3p0è¾ƒå¿«</strong>ï¼Œä½†å› è‡ªèº«å­˜åœ¨BUGï¼ŒHibernate3å·²ä¸å†æä¾›æ”¯æŒã€‚</li>
<li><strong>C3P0</strong> æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œ**é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œç¨³å®šæ€§è¿˜å¯ä»¥ã€‚**hibernateå®˜æ–¹æ¨èä½¿ç”¨</li>
<li><strong>Proxool</strong> æ˜¯sourceforgeä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®æ•°æ®åº“è¿æ¥æ± ï¼Œæœ‰ç›‘æ§è¿æ¥æ± çŠ¶æ€çš„åŠŸèƒ½ï¼Œ<strong>ç¨³å®šæ€§è¾ƒc3p0å·®ä¸€ç‚¹</strong></li>
<li><strong>BoneCP</strong> æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œé€Ÿåº¦å¿«</li>
<li><strong>Druid</strong> æ˜¯é˜¿é‡Œæä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ®è¯´æ˜¯é›†DBCP ã€C3P0 ã€Proxool ä¼˜ç‚¹äºä¸€èº«çš„æ•°æ®åº“è¿æ¥æ± ï¼Œä½†æ˜¯é€Ÿåº¦ä¸ç¡®å®šæ˜¯å¦æœ‰BoneCPå¿«</li>
</ul>
</li>
<li>DataSource é€šå¸¸è¢«ç§°ä¸ºæ•°æ®æºï¼Œå®ƒåŒ…å«è¿æ¥æ± å’Œè¿æ¥æ± ç®¡ç†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¹ æƒ¯ä¸Šä¹Ÿç»å¸¸æŠŠ DataSource ç§°ä¸ºè¿æ¥æ± </li>
<li><strong>DataSourceç”¨æ¥å–ä»£DriverManageræ¥è·å–Connectionï¼Œè·å–é€Ÿåº¦å¿«ï¼ŒåŒæ—¶å¯ä»¥å¤§å¹…åº¦æé«˜æ•°æ®åº“è®¿é—®é€Ÿåº¦ã€‚</strong></li>
<li>ç‰¹åˆ«æ³¨æ„ï¼š
<ul>
<li>æ•°æ®æºå’Œæ•°æ®åº“è¿æ¥ä¸åŒï¼Œæ•°æ®æºæ— éœ€åˆ›å»ºå¤šä¸ªï¼Œå®ƒæ˜¯äº§ç”Ÿæ•°æ®åº“è¿æ¥çš„å·¥å‚ï¼Œå› æ­¤<strong>æ•´ä¸ªåº”ç”¨åªéœ€è¦ä¸€ä¸ªæ•°æ®æºå³å¯ã€‚</strong></li>
<li>å½“æ•°æ®åº“è®¿é—®ç»“æŸåï¼Œç¨‹åºè¿˜æ˜¯åƒä»¥å‰ä¸€æ ·å…³é—­æ•°æ®åº“è¿æ¥ï¼šconn.close(); ä½†conn.close()å¹¶æ²¡æœ‰å…³é—­æ•°æ®åº“çš„ç‰©ç†è¿æ¥ï¼Œå®ƒä»…ä»…æŠŠæ•°æ®åº“è¿æ¥é‡Šæ”¾ï¼Œå½’è¿˜ç»™äº†æ•°æ®åº“è¿æ¥æ± ã€‚</li>
</ul>
</li>
</ul>
<h4 id="821-druidå¾·é²ä¼Šæ•°æ®åº“è¿æ¥æ± ">8.2.1 Druidï¼ˆå¾·é²ä¼Šï¼‰æ•°æ®åº“è¿æ¥æ± <a hidden class="anchor" aria-hidden="true" href="#821-druidå¾·é²ä¼Šæ•°æ®åº“è¿æ¥æ± ">#</a></h4>
<p>Druidæ˜¯é˜¿é‡Œå·´å·´å¼€æºå¹³å°ä¸Šä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å®ç°ï¼Œå®ƒç»“åˆäº†C3P0ã€DBCPã€Proxoolç­‰DBæ± çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åŠ å…¥äº†æ—¥å¿—ç›‘æ§ï¼Œå¯ä»¥å¾ˆå¥½çš„ç›‘æ§DBæ± è¿æ¥å’ŒSQLçš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥è¯´æ˜¯é’ˆå¯¹ç›‘æ§è€Œç”Ÿçš„DBè¿æ¥æ± ï¼Œ<strong>å¯ä»¥è¯´æ˜¯ç›®å‰æœ€å¥½çš„è¿æ¥æ± ä¹‹ä¸€ã€‚</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.atguigu.druid;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.sql.Connection;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.sql.DataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestDruid {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>		Properties pro = <span style="color:#fff;font-weight:bold">new</span> Properties();		 pro.<span style="color:#007f7f">load</span>(TestDruid.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getClassLoader</span>().<span style="color:#007f7f">getResourceAsStream</span>(<span style="color:#0ff;font-weight:bold">&#34;druid.properties&#34;</span>));
</span></span><span style="display:flex;"><span>		DataSource ds = DruidDataSourceFactory.<span style="color:#007f7f">createDataSource</span>(pro);
</span></span><span style="display:flex;"><span>		Connection conn = ds.<span style="color:#007f7f">getConnection</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(conn);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œsrcä¸‹çš„é…ç½®æ–‡ä»¶ä¸ºï¼šã€druid.propertiesã€‘</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>url=jdbc:mysql:<span style="color:#007f7f">//localhost:3306/test?rewriteBatchedStatements=true
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>username=root
</span></span><span style="display:flex;"><span>password=123456
</span></span><span style="display:flex;"><span>driverClassName=com.<span style="color:#007f7f">mysql</span>.<span style="color:#007f7f">jdbc</span>.<span style="color:#007f7f">Driver</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>initialSize=10
</span></span><span style="display:flex;"><span>maxActive=20
</span></span><span style="display:flex;"><span>maxWait=1000
</span></span><span style="display:flex;"><span>filters=wall
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¯¦ç»†é…ç½®å‚æ•°ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th><strong>é…ç½®</strong></th>
<th><strong>ç¼ºçœ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td></td>
<td>é…ç½®è¿™ä¸ªå±æ€§çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ•°æ®æºï¼Œç›‘æ§çš„æ—¶å€™å¯ä»¥é€šè¿‡åå­—æ¥åŒºåˆ†å¼€æ¥ã€‚   å¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªåå­—ï¼Œæ ¼å¼æ˜¯ï¼šâ€DataSource-â€ +   System.identityHashCode(this)</td>
</tr>
<tr>
<td>url</td>
<td></td>
<td>è¿æ¥æ•°æ®åº“çš„urlï¼Œä¸åŒæ•°æ®åº“ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ï¼šmysql :   jdbc:mysql://10.20.153.104:3306/druid2      oracle :   jdbc:oracle:thin:@10.20.149.85:1521:ocnauto</td>
</tr>
<tr>
<td>username</td>
<td></td>
<td>è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å</td>
</tr>
<tr>
<td>password</td>
<td></td>
<td>è¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚å¦‚æœä½ ä¸å¸Œæœ›å¯†ç ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ConfigFilterã€‚è¯¦ç»†çœ‹è¿™é‡Œï¼š<a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></td>
</tr>
<tr>
<td>driverClassName</td>
<td></td>
<td>æ ¹æ®urlè‡ªåŠ¨è¯†åˆ«   è¿™ä¸€é¡¹å¯é…å¯ä¸é…ï¼Œå¦‚æœä¸é…ç½®druidä¼šæ ¹æ®urlè‡ªåŠ¨è¯†åˆ«dbTypeï¼Œç„¶åé€‰æ‹©ç›¸åº”çš„driverClassName(å»ºè®®é…ç½®ä¸‹)</td>
</tr>
<tr>
<td>initialSize</td>
<td>0</td>
<td>åˆå§‹åŒ–æ—¶å»ºç«‹ç‰©ç†è¿æ¥çš„ä¸ªæ•°ã€‚åˆå§‹åŒ–å‘ç”Ÿåœ¨æ˜¾ç¤ºè°ƒç”¨initæ–¹æ³•ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡getConnectionæ—¶</td>
</tr>
<tr>
<td>maxActive</td>
<td>8</td>
<td>æœ€å¤§è¿æ¥æ± æ•°é‡</td>
</tr>
<tr>
<td>maxIdle</td>
<td>8</td>
<td>å·²ç»ä¸å†ä½¿ç”¨ï¼Œé…ç½®äº†ä¹Ÿæ²¡æ•ˆæœ</td>
</tr>
<tr>
<td>minIdle</td>
<td></td>
<td>æœ€å°è¿æ¥æ± æ•°é‡</td>
</tr>
<tr>
<td>maxWait</td>
<td></td>
<td>è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚é…ç½®äº†maxWaitä¹‹åï¼Œç¼ºçœå¯ç”¨å…¬å¹³é”ï¼Œå¹¶å‘æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ï¼Œå¦‚æœéœ€è¦å¯ä»¥é€šè¿‡é…ç½®useUnfairLockå±æ€§ä¸ºtrueä½¿ç”¨éå…¬å¹³é”ã€‚</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>false</td>
<td>æ˜¯å¦ç¼“å­˜preparedStatementï¼Œä¹Ÿå°±æ˜¯PSCacheã€‚PSCacheå¯¹æ”¯æŒæ¸¸æ ‡çš„æ•°æ®åº“æ€§èƒ½æå‡å·¨å¤§ï¼Œæ¯”å¦‚è¯´oracleã€‚åœ¨mysqlä¸‹å»ºè®®å…³é—­ã€‚</td>
</tr>
<tr>
<td>maxOpenPreparedStatements</td>
<td>-1</td>
<td>è¦å¯ç”¨PSCacheï¼Œå¿…é¡»é…ç½®å¤§äº0ï¼Œå½“å¤§äº0æ—¶ï¼ŒpoolPreparedStatementsè‡ªåŠ¨è§¦å‘ä¿®æ”¹ä¸ºtrueã€‚åœ¨Druidä¸­ï¼Œä¸ä¼šå­˜åœ¨Oracleä¸‹PSCacheå ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ•°å€¼é…ç½®å¤§ä¸€äº›ï¼Œæ¯”å¦‚è¯´100</td>
</tr>
<tr>
<td>validationQuery</td>
<td></td>
<td>ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å¦‚æœvalidationQueryä¸ºnullï¼ŒtestOnBorrowã€testOnReturnã€testWhileIdleéƒ½ä¸ä¼šå…¶ä½œç”¨ã€‚</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>true</td>
<td>ç”³è¯·è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>false</td>
<td>å½’è¿˜è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>false</td>
<td>å»ºè®®é…ç½®ä¸ºtrueï¼Œä¸å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯å®‰å…¨æ€§ã€‚ç”³è¯·è¿æ¥çš„æ—¶å€™æ£€æµ‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´å¤§äºtimeBetweenEvictionRunsMillisï¼Œæ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆã€‚</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td></td>
<td>æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š 1)Destroyçº¿ç¨‹ä¼šæ£€æµ‹è¿æ¥çš„é—´éš”æ—¶é—´2)testWhileIdleçš„åˆ¤æ–­ä¾æ®ï¼Œè¯¦ç»†çœ‹testWhileIdleå±æ€§çš„è¯´æ˜</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td></td>
<td>ä¸å†ä½¿ç”¨ï¼Œä¸€ä¸ªDruidDataSourceåªæ”¯æŒä¸€ä¸ªEvictionRun</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td></td>
<td></td>
</tr>
<tr>
<td>connectionInitSqls</td>
<td></td>
<td>ç‰©ç†è¿æ¥åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„sql</td>
</tr>
<tr>
<td>exceptionSorter</td>
<td></td>
<td>æ ¹æ®dbTypeè‡ªåŠ¨è¯†åˆ«   å½“æ•°æ®åº“æŠ›å‡ºä¸€äº›ä¸å¯æ¢å¤çš„å¼‚å¸¸æ—¶ï¼ŒæŠ›å¼ƒè¿æ¥</td>
</tr>
<tr>
<td>filters</td>
<td></td>
<td>å±æ€§ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé€šè¿‡åˆ«åçš„æ–¹å¼é…ç½®æ‰©å±•æ’ä»¶ï¼Œå¸¸ç”¨çš„æ’ä»¶æœ‰ï¼š   ç›‘æ§ç»Ÿè®¡ç”¨çš„filter:statæ—¥å¿—ç”¨çš„filter:log4jé˜²å¾¡sqlæ³¨å…¥çš„filter:wall</td>
</tr>
<tr>
<td>proxyFilters</td>
<td></td>
<td>ç±»å‹æ˜¯Listï¼Œå¦‚æœåŒæ—¶é…ç½®äº†filterså’ŒproxyFiltersï¼Œæ˜¯ç»„åˆå…³ç³»ï¼Œå¹¶éæ›¿æ¢å…³ç³»</td>
</tr>
</tbody>
</table>
<h2 id="ä¹apache-dbutilså®ç°crudæ“ä½œ">ä¹ï¼šApache-DBUtilså®ç°CRUDæ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#ä¹apache-dbutilså®ç°crudæ“ä½œ">#</a></h2>
<h3 id="91-apache-dbutilsç®€ä»‹">9.1 Apache-DBUtilsç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#91-apache-dbutilsç®€ä»‹">#</a></h3>
<ul>
<li>commons-dbutils æ˜¯ Apache ç»„ç»‡æä¾›çš„ä¸€ä¸ªå¼€æº JDBCå·¥å…·ç±»åº“ï¼Œå®ƒæ˜¯å¯¹JDBCçš„ç®€å•å°è£…ï¼Œå­¦ä¹ æˆæœ¬æä½ï¼Œå¹¶ä¸”ä½¿ç”¨dbutilsèƒ½æå¤§ç®€åŒ–jdbcç¼–ç çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚</li>
<li>APIä»‹ç»ï¼š
<ul>
<li>org.apache.commons.dbutils.QueryRunner</li>
<li>org.apache.commons.dbutils.ResultSetHandler</li>
<li>å·¥å…·ç±»ï¼šorg.apache.commons.dbutils.DbUtils</li>
</ul>
</li>
<li>æœ‰äº†<code>DBUtils</code>å¯ä»¥ç›´æ¥è°ƒç”¨<code>API</code>ä½¿ç”¨å¢åˆ æ”¹æŸ¥æ“ä½œäº†ã€‚</li>
</ul>
<h3 id="92-ä¸»è¦apiçš„ä½¿ç”¨">9.2 ä¸»è¦APIçš„ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#92-ä¸»è¦apiçš„ä½¿ç”¨">#</a></h3>
<h4 id="921-dbutils">9.2.1 DbUtils<a hidden class="anchor" aria-hidden="true" href="#921-dbutils">#</a></h4>
<ul>
<li>DbUtils ï¼šæä¾›å¦‚å…³é—­è¿æ¥ã€è£…è½½JDBCé©±åŠ¨ç¨‹åºç­‰å¸¸è§„å·¥ä½œçš„å·¥å…·ç±»ï¼Œé‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ã€‚ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š
<ul>
<li><code>public static void close(â€¦) throws java.sql.SQLException</code>ï¼šã€€DbUtilsç±»æä¾›äº†ä¸‰ä¸ªé‡è½½çš„å…³é—­æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ£€æŸ¥æ‰€æä¾›çš„å‚æ•°æ˜¯ä¸æ˜¯NULLï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œå®ƒä»¬å°±å…³é—­Connectionã€Statementå’ŒResultSetã€‚</li>
<li><code>public static void closeQuietly(â€¦)</code>: è¿™ä¸€ç±»æ–¹æ³•ä¸ä»…èƒ½åœ¨Connectionã€Statementå’ŒResultSetä¸ºNULLæƒ…å†µä¸‹é¿å…å…³é—­ï¼Œè¿˜èƒ½éšè—ä¸€äº›åœ¨ç¨‹åºä¸­æŠ›å‡ºçš„SQLEeceptionã€‚</li>
<li><code>public static void commitAndClose(Connection conn)throws SQLException</code>ï¼š ç”¨æ¥æäº¤è¿æ¥çš„äº‹åŠ¡ï¼Œç„¶åå…³é—­è¿æ¥</li>
<li><code>public static void commitAndCloseQuietly(Connection conn)</code>ï¼š ç”¨æ¥æäº¤è¿æ¥ï¼Œç„¶åå…³é—­è¿æ¥ï¼Œå¹¶ä¸”åœ¨å…³é—­è¿æ¥æ—¶ä¸æŠ›å‡ºSQLå¼‚å¸¸ã€‚</li>
<li><code>public static void rollback(Connection conn)throws SQLException</code>ï¼šå…è®¸connä¸ºnullï¼Œå› ä¸ºæ–¹æ³•å†…éƒ¨åšäº†åˆ¤æ–­</li>
<li><code>public static void rollbackAndClose(Connection conn)throws SQLException</code></li>
<li><code>rollbackAndCloseQuietly(Connection)</code></li>
<li><code>public static boolean loadDriver(java.lang.String driverClassName)</code>ï¼šè¿™ä¸€æ–¹è£…è½½å¹¶æ³¨å†ŒJDBCé©±åŠ¨ç¨‹åºï¼Œå¦‚æœæˆåŠŸå°±è¿”å›trueã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä½ ä¸éœ€è¦æ•æ‰è¿™ä¸ªå¼‚å¸¸ClassNotFoundExceptionã€‚</li>
</ul>
</li>
</ul>
<h4 id="922-queryrunnerç±»">9.2.2 QueryRunnerç±»<a hidden class="anchor" aria-hidden="true" href="#922-queryrunnerç±»">#</a></h4>
<ul>
<li><strong>è¯¥ç±»ç®€å•åŒ–äº†SQLæŸ¥è¯¢ï¼Œå®ƒä¸ResultSetHandlerç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„æ•°æ®åº“æ“ä½œï¼Œèƒ½å¤Ÿå¤§å¤§å‡å°‘ç¼–ç é‡ã€‚</strong></li>
<li>QueryRunnerç±»æä¾›äº†ä¸¤ä¸ªæ„é€ å™¨ï¼š
<ul>
<li>é»˜è®¤çš„æ„é€ å™¨</li>
<li>éœ€è¦ä¸€ä¸ª javax.sql.DataSource æ¥ä½œå‚æ•°çš„æ„é€ å™¨</li>
</ul>
</li>
<li>QueryRunnerç±»çš„ä¸»è¦æ–¹æ³•ï¼š
<ul>
<li><strong>æ›´æ–°</strong>
<ul>
<li><code>public int update(Connection conn, String sql, Object... params) throws SQLException</code>:ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ›´æ–°ï¼ˆæ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤ï¼‰æ“ä½œã€‚</li>
<li>&hellip;&hellip;</li>
</ul>
</li>
<li><strong>æ’å…¥</strong>
<ul>
<li><code>public &lt;T&gt; T insert(Connection conn,String sql,ResultSetHandler&lt;T&gt; rsh, Object... params) throws SQLException</code>ï¼šåªæ”¯æŒINSERTè¯­å¥ï¼Œå…¶ä¸­<code> rsh - The handler used to create the result object from the ResultSet of auto-generated keys</code>.  è¿”å›å€¼: <code>An object generated by the handler</code>.å³è‡ªåŠ¨ç”Ÿæˆçš„é”®å€¼</li>
<li>&hellip;.</li>
</ul>
</li>
<li><strong>æ‰¹å¤„ç†</strong>
<ul>
<li><code>public int[] batch(Connection conn,String sql,Object[][] params)throws SQLExceptionï¼š INSERT, UPDATE, or DELETE</code>è¯­å¥</li>
<li><code>public &lt;T&gt; T insertBatch(Connection conn,String sql,ResultSetHandler&lt;T&gt; rsh,Object[][] params)throws SQLException</code>ï¼šåªæ”¯æŒINSERTè¯­å¥</li>
</ul>
</li>
<li><strong>æŸ¥è¯¢</strong>
<ul>
<li><code>public Object query(Connection conn, String sql, ResultSetHandler rsh,Object... params) throws SQLException</code>ï¼šæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå¯¹è±¡æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å€¼è¢«ç”¨æ¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ç½®æ¢å‚æ•°ã€‚è¯¥æ–¹æ³•ä¼šè‡ªè¡Œå¤„ç† PreparedStatement å’Œ ResultSet çš„åˆ›å»ºå’Œå…³é—­ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>æµ‹è¯•</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æµ‹è¯•æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testInsert() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;insert into customers(name,email,birth)values(?,?,?)&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> count = runner.<span style="color:#007f7f">update</span>(conn, sql, <span style="color:#0ff;font-weight:bold">&#34;ä½•æˆé£&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;he@qq.com&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1992-09-08&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ·»åŠ äº†&#34;</span> + count + <span style="color:#0ff;font-weight:bold">&#34;æ¡è®°å½•&#34;</span>);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æµ‹è¯•åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testDelete() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;delete from customers where id &lt; ?&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> count = runner.<span style="color:#007f7f">update</span>(conn, sql,3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;åˆ é™¤äº†&#34;</span> + count + <span style="color:#0ff;font-weight:bold">&#34;æ¡è®°å½•&#34;</span>);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="923-resultsethandleræ¥å£åŠå®ç°ç±»">9.2.3 ResultSetHandleræ¥å£åŠå®ç°ç±»<a hidden class="anchor" aria-hidden="true" href="#923-resultsethandleræ¥å£åŠå®ç°ç±»">#</a></h4>
<ul>
<li>
<p>è¯¥æ¥å£ç”¨äºå¤„ç† java.sql.ResultSetï¼Œå°†æ•°æ®æŒ‰è¦æ±‚è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼ã€‚</p>
</li>
<li>
<p>ResultSetHandler æ¥å£æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼šObject handle (java.sql.ResultSet .rs)ã€‚</p>
</li>
<li>
<p>æ¥å£çš„ä¸»è¦å®ç°ç±»ï¼š</p>
<ul>
<li>ArrayHandlerï¼šæŠŠç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®è½¬æˆå¯¹è±¡æ•°ç»„ã€‚</li>
<li>ArrayListHandlerï¼šæŠŠç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½è½¬æˆä¸€ä¸ªæ•°ç»„ï¼Œå†å­˜æ”¾åˆ°Listä¸­ã€‚</li>
<li>**BeanHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ã€‚</li>
<li>**BeanListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ï¼Œå­˜æ”¾åˆ°Listé‡Œã€‚</li>
<li>ColumnListHandlerï¼šå°†ç»“æœé›†ä¸­æŸä¸€åˆ—çš„æ•°æ®å­˜æ”¾åˆ°Listä¸­ã€‚</li>
<li>KeyedHandler(name)ï¼šå°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œå†æŠŠè¿™äº›mapå†å­˜åˆ°ä¸€ä¸ªmapé‡Œï¼Œå…¶keyä¸ºæŒ‡å®šçš„keyã€‚</li>
<li>**MapHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œkeyæ˜¯åˆ—åï¼Œvalueå°±æ˜¯å¯¹åº”çš„å€¼ã€‚</li>
<li>**MapListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œç„¶åå†å­˜æ”¾åˆ°List</li>
<li>**ScalarHandlerï¼š**æŸ¥è¯¢å•ä¸ªå€¼å¯¹è±¡</li>
</ul>
</li>
<li>
<p>æµ‹è¯•</p>
</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢ä¸€æ¡è®°å½•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanHandler
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testQueryInstance() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;select id,name,email,birth from customers where id = ?&#34;</span>;
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	BeanHandler&lt;Customer&gt; handler = <span style="color:#fff;font-weight:bold">new</span> BeanHandler&lt;&gt;(Customer.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>	Customer customer = runner.<span style="color:#007f7f">query</span>(conn, sql, handler, 23);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(customer);	
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢å¤šæ¡è®°å½•æ„æˆçš„é›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanListHandler
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testQueryList() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;select id,name,email,birth from customers where id &lt; ?&#34;</span>;
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	BeanListHandler&lt;Customer&gt; handler = <span style="color:#fff;font-weight:bold">new</span> BeanListHandler&lt;&gt;(Customer.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>	List&lt;Customer&gt; list = runner.<span style="color:#007f7f">query</span>(conn, sql, handler, 23);
</span></span><span style="display:flex;"><span>	list.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * è‡ªå®šä¹‰ResultSetHandlerçš„å®ç°ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testQueryInstance1() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;select id,name,email,birth from customers where id = ?&#34;</span>;
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	ResultSetHandler&lt;Customer&gt; handler = <span style="color:#fff;font-weight:bold">new</span> ResultSetHandler&lt;Customer&gt;() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		@Override
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">public</span> Customer handle(ResultSet rs) <span style="color:#fff;font-weight:bold">throws</span> SQLException {
</span></span><span style="display:flex;"><span>			System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;handle&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//			return new Customer(1,&#34;Tom&#34;,&#34;tom@126.com&#34;,new Date(123323432L));
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>				
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">if</span>(rs.<span style="color:#007f7f">next</span>()){
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">int</span> id = rs.<span style="color:#007f7f">getInt</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>);
</span></span><span style="display:flex;"><span>				String name = rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>				String email = rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>);
</span></span><span style="display:flex;"><span>				Date birth = rs.<span style="color:#007f7f">getDate</span>(<span style="color:#0ff;font-weight:bold">&#34;birth&#34;</span>);
</span></span><span style="display:flex;"><span>					
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Customer(id, name, email, birth);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	Customer customer = runner.<span style="color:#007f7f">query</span>(conn, sql, handler, 23);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(customer);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å¦‚ä½•æŸ¥è¯¢ç±»ä¼¼äºæœ€å¤§çš„ï¼Œæœ€å°çš„ï¼Œå¹³å‡çš„ï¼Œæ€»å’Œï¼Œä¸ªæ•°ç›¸å…³çš„æ•°æ®ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä½¿ç”¨ScalarHandler
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testQueryValue() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>	QueryRunner runner = <span style="color:#fff;font-weight:bold">new</span> QueryRunner();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Connection conn = JDBCUtils.<span style="color:#007f7f">getConnection3</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//æµ‹è¯•ä¸€ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//	String sql = &#34;select count(*) from customers where id &lt; ?&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//	ScalarHandler handler = new ScalarHandler();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//	long count = (long) runner.query(conn, sql, handler, 20);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">//	System.out.println(count);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//æµ‹è¯•äºŒï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	String sql = <span style="color:#0ff;font-weight:bold">&#34;select max(birth) from customers&#34;</span>;
</span></span><span style="display:flex;"><span>	ScalarHandler handler = <span style="color:#fff;font-weight:bold">new</span> ScalarHandler();
</span></span><span style="display:flex;"><span>	Date birth = (Date) runner.<span style="color:#007f7f">query</span>(conn, sql, handler);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(birth);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	JDBCUtils.<span style="color:#007f7f">closeResource</span>(conn, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/jdbc/">jdbc</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/tech/javaweb/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Javaweb</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/tech/ssl%E5%88%86%E6%9E%90/">
    <span class="title">Next Â»</span>
    <br>
    <span>Sslåˆ†æ</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
