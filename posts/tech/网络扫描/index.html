<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>网络扫描 | Reus09&#39;s Blog</title>
<meta name="keywords" content="网络扫描">
<meta name="description" content="网络扫描 0x01 实验目的 用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="网络扫描" />
<meta property="og:description" content="网络扫描 0x01 实验目的 用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-01T21:22:48+00:00" />
<meta property="article:modified_time" content="2022-09-11T15:59:36+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="网络扫描"/>
<meta name="twitter:description" content="网络扫描 0x01 实验目的 用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻技术",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "网络扫描",
      "item": "http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "网络扫描",
  "name": "网络扫描",
  "description": "网络扫描 0x01 实验目的 用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描",
  "keywords": [
    "网络扫描"
  ],
  "articleBody": "网络扫描 0x01 实验目的  用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描原理。 找到一种常见的主机系统或应用程序漏洞，研究该漏洞的扫描原理，对该漏洞进行扫描器扫描实验，通过分析捕获的扫描数据包验证漏洞扫描原理。(选做) 编程实现TCP全连接或半连接的端口扫描。（选做）  0x02 实验前提知识   网络扫描器的主要功能\n 扫描目标主机识别其工作状态（开/关机） 识别目标主机端口的状态（监听/关闭） 识别目标主机系统及服务程序的类型和版本 根据已知漏洞信息，分析系统脆弱点 生成扫描结果报告    扫描器的基本工作原理\n     网络扫描技术\n  主机扫描技术\n 主机扫描的目的是确定在目标网络上的主机是否可达。这是信息收集的初级阶段，其效果直接影响到后续的扫描。 传统扫描手段  ICMP Echo扫描 ICMP Sweep扫描 Broadcast ICMP扫描 Non-Echo ICMP扫描   防火墙和网络过滤设备常常导致传统的探测手段变得无效。为了突破这种限制，必须采用一些非常规的手段，利用ICMP协议提供网络间传送错误信息的手段，往往可以更有效的达到目的：  异常的IP包头 在IP头中设置无效的字段值 错误的数据分片 通过超长包探测内部路由器 反向映射探测      端口扫描技术\n  确定目标主机可达后，使用端口扫描技术，发现目标主机的开放端口，包括网络协议和各种应用监听的端口。\n  开放扫描 会产生大量的审计数据，容易被对方发现，但其可靠性高\n TCP Connect 扫描 TCP反向ident扫描    隐蔽扫描\n能有效的避免对方入侵检测系统和防火墙的检测，但这种扫描使用的数据包在通过网络时容易被丢弃从而产生错误的探测信息\n TCP FIN 扫描 TCP Xmas扫描 TCP Null 扫描 TCP ftp proxy扫描 分段扫描    半开放扫描\n隐蔽性和可靠性介于前两者之间。\n TCP SYN 扫描 TCP间接扫描        UDP端口扫描\n  栈指纹OS识别技术\n 根据各个OS在TCP/IP协议栈实现上的不同特点，采用黑盒测试方法，通过研究其对各种探测的响应形成识别指纹，进而识别目标主机运行的操作系统 被动扫描  通过Sniffer收集数据包，再对数据包的不同特征（TCP Window\u0002size、 IP TTL、IP TOS、DF位等参数）进行分析，来识别操作系统。   主动扫描  采用向目标系统发送构造的特殊包并监控其应答的方式来识别操作系统类型。      漏洞扫描技术\n 在端口扫描后得知目标主机开启的端口以及端口上的网络服务，将这些相关信息与网络漏洞扫描系统提供的漏洞库进行匹配，查看是否有满足匹配条件的漏洞存在。 通过模拟黑客的攻击手法，对目标主机系统进行攻击性的安全漏洞扫描，如测试弱势口令等。若模拟攻击成功，则表明目标主机系统存在安全漏洞。 CGI漏洞扫描、POP3漏洞扫描、FTP漏洞扫描、SSH漏洞扫描、HTTP漏洞扫描等。这些漏洞扫描是基于漏洞库，将扫描结果与漏洞库相关数据匹配比较得到漏洞信息。 Unicode遍历目录漏洞探测、FTP 弱密码探测、OPENRelay邮件转发漏洞探测等，这些扫描通过使用插件（功能模块技术）进行模拟攻击，测试出目标主机的漏洞信息。      0x03 实验环境   Winodows xp 汇编  IP:192.168.195.135 MAC: 00-0c-29-19-ba-6e    Winodows xp 网络安全实验  IP:192.168.195.131 MAC:00-0c-29-06-65-c9    Windows 7  IP:192.168.195.145 MAC:00-0c-29-f1-b5-17    程序运行机器 Ubuntu 16      网关  IP : 192.168.195.2 MAC :  00-50-56-e7-d4-22    工具   xscan   nmap   nessus   wireshark     0x04 软件扫描 xscan   xscan 配置 参数\n       开始扫描\n 扫描结果     Wireshark抓包分析\n  首先应该是 SYN半扫描端口是否开放\n  源IP(192.168.195.131)随机端口发送tcp-syn连接给目的IP(1921.68.195.135)\n因为扫描了1024个端口，这里只放第一个和最后一个端口的截图\n      SYN扫描实现原理：扫描器向目标主机端口发送SYN包。如果应答是RST包，那么说明端口是关闭的；如果应答中包含SYN和ACK包，说明目标端口处于监听状态，再传送一个RST包给目标机从而停止建立连接。\n  可以看到大量的tcp-syn请求，返回的均为RST,标明该端口没有开放\n     如果返回为SYN+ACK,则表明端口开放\n       TCP Connect 扫描\n 实现原理：通过调用socket函数connect()连接到目标计算机上，完成一次完整的三次握手过程。如果端口处于侦听状态，那么connect()就能成功返回。否则，这个端口不可用，即没有提供服务。 通过三次握手，查看端口是否开放，并进行一定的使用  ftps     ssh     http     https          sslv2协议试探\n     UDP端口扫描\n 向目标端口发送UDP 包。如果得到的应答为“ICMP port Unreachable”（ICMP 端口不可到达），那么目标端口是关闭的。 反之，如果没有收到这个应答消息，则目标端口极有可能是开放的。     结合报告，xscan主要对netbios-ssn(139/tcp)、https (443/tcp)、FTP-ssl (990/tcp)、ssh (22/tcp)、www (443/tcp)、ftp (990/tcp)、microsoft-ds (445/tcp)、ftp (21/tcp)、epmap (135/tcp)、www (80/tcp)、netbios-ns (137/udp)、ntp (123/udp)\n  nmap   参数设置\n  首先开启的为 TCP SYN扫描\n  TCP - SYN扫描\n 扫描器向目标主机端口发送FIN包。当一个FIN数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。      Wireshark抓包\n 、 发现无效，因为TCP SYN扫描通常适用于UNIX目标主机，但在Windows95/NT环境下，该方法无效。因为不论目标端口是否打开，操作系统都返回RST包。我们这里的目标主机是xp系统，所以无论什么端口都会回显RST包      开启 TCP ACK 扫描\n TCP-ACK扫描  TCP ACK扫描是利用标志位ACK，而ACK标志在TCP协议中表示确认序号有效，它表示确认一个正常的TCP连接。但是在TCP ACK扫描中没有进行正常的TCP连接过程，实际上是没有真正的TCP连接。那么当发送一个带有ACK标志的TCP报文到目标主机的端口时，目标主机会怎样反应呢？ 使用TCP ACK扫描不能够确定端口的关闭或者开放，因为当发送给对方一个含有ACK表示的TCP报文的时候，都返回含有RST标志的报文，无论端口是开放或者关闭。所以，不能使用TCP ACK扫描来确定端口是否开放或者关闭。但是可以利用它来扫描防火墙的配置，用它来发现防火墙规则，确定它们是有状态的还是无状态的，哪些端口是被过滤的   Wireshark抓包   可以看到源主机发送的TCP请求包中，ACK直接被初始化了，没有了SYN过程      开启TCP - Xmas 扫描\n TCP - Xmas 扫描  TCP Xmas和Null扫描是FIN扫描的两个变种。Xmas扫描打开FIN，URG和PUSH标记，而Null扫描关闭所有标记。 这些组合的目的是为了通过对FIN标记数据包的过滤。 当此类数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。   Wireshak 抓包   可以看到发的源IP包里面带有Urgent、Fin、Push字段      TCP - Connect 扫描\n  通过调用socket函数connect()连接到目标计算机上，完成一次完整的三次握手过程。如果端口处于侦听状态，那么connect()就能成功返回。否则，这个端口不可用，即没有提供服务\n  Wireshark 抓包\n    可以看到我们开放的http端口经过TCP三次连接可以连接，而另一个端口无法连接，返回一个RST包\n      开启 TCP NULL 扫描\n TCP NULL 扫描  TCP Xmas和Null扫描是FIN扫描的两个变种。而Null扫描关闭所有标记。这些组合的目的是为了通过对FIN标记数据包的过滤。当此类数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。    可以看到我们开放的端口都没有回显，关闭的端口都返回一个RST、ACK包    开启 TCP 滑动窗口扫描\n  其实就是大量的TCP ACK扫描\n    根据抓包，发现其即为通过同时发送大量的ACK包，这里是TCP ACK扫描\n  同时大量返回对上述包的RST包来查看端口是否开放。\n    TCP FIN 扫描\n TCP FIN 扫描  扫描器向目标主机端口发送FIN包。当一个FIN数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。   Wireshark分析   通过将请求包置为FIN查看端口是否开放。      nmap报告\n     nessus   因为Window xp里面的 nessus版本用不了\n  所以在虚拟机Windows 7 里面搭建新版的 Nessus 8\n     并且对靶机192.168.195.135进行攻击\n  利用Wireshark进行抓包分析数据流。\n  TCP-SYN扫描\n  这里仅以HTTP为例子。(其他的协议就不赘述了)\n      80端口开放，所以SYN请求之后，可以正常回显，反之，如果请求的端口81.82没有开放，则回显一个RST包\n    TCP - Connect 扫描\n  可以看到 交互过程先 实现三次握手。查看了HTTPS、HTTP、TLSV1、ssh、FTP协议    SSLV2 协议是否支持\n     SSLv3 协议是否支持\n       nessus 扫描192.168.195.135 得到的漏洞报告\n     0x05 找到漏洞  FTP弱口令漏洞扫描： 扫描原理：  在上述实验过程中，发现靶机开启了21(默认端口)，那么我们可以用字典里的账户和密码去试着登录，如果能够登陆上去，则存在漏洞   利用S-scan进行扫描模块  选择扫描模块，扫描端口      扫描结束     生成的报告       用Wireshark 对过程进行分析  首先，攻击机利用随机端口向靶机的FTP端口发出TCP SYN连接请求     然后，靶机端给其回复一个ACK,此时可以监听到21端口     最后，攻击机收到靶机的ack，再回复一个ack,至此三次握手完成       之后，攻击机就开始用字典里面的数据来 不断发送数据包来暴力破解 靶机的FTP服务器密码账户     之后的过程，攻击机一直再重复以上过程，但可能因为FTP账户和密码设置的较为复杂，以及攻击机的字典过于弱小，所以不能够暴力登入ftp服务器中  0x06 编程实现   这里实现的是TCP SYN 扫描(即半连接扫描)\n  这里用套接字socket的方法来实现tcp SYN 扫描\n 来实现查看靶机端口的开放情况，便于方便，这里端口即从1~1024为止。    只需要构造好一个TCP包，指定好包中IP.flags=0x02(为SYN包)。\n  我们这里在ubuntu 16 的环境中编译我们写好的程序\n     执行程序\n        与此同时，利用Wireshark在靶机进行抓包\n   可以很明显的看到攻击机的随机端口向靶机的端口从1-1024发送SYN请求，端口存在返回ACK包，端口不存在返回RST包。        源码\n  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220  #include #include #include #include #include #include #include #include #include #include #include #include #include #include  struct iphdr {  unsigned char ver_and_hdrlen;// 版本号与IP头部长度  unsigned char tos; // 服务类型  unsigned short total_len; // 总长度  unsigned short id; // IP包ID  unsigned short flags; // 标志位(包括分片偏移量)  unsigned char ttl; // 生命周期  unsigned char protocol; // 上层协议  unsigned short checksum; // 校验和  unsigned int srcaddr; // 源IP地址  unsigned int dstaddr; // 目标IP地址 };  struct tcphdr {  unsigned short sport; // 源端口  unsigned short dport; // 目标端口  unsigned int seq; // 序列号  unsigned int ack_seq; // 确认号  unsigned char len; // 首部长度  unsigned char flag; // 标志位  unsigned short win; // 窗口大小  unsigned short checksum; // 校验和  unsigned short urg; // 紧急指针 };  struct pseudohdr {  unsigned int saddr;  unsigned int daddr;  char zeros;  char protocol;  unsigned short length; };  unsigned short inline checksum(unsigned short *buffer, unsigned short size) {  unsigned long cksum = 0;   while (size  1) {  cksum += *buffer++;  size -= sizeof(unsigned short);  }   if (size) {  cksum += *(unsigned char *)buffer;  }   cksum = (cksum  16) + (cksum \u0026 0xffff);  cksum += (cksum  16);   return (unsigned short )(~cksum); }  void init_ip_header(struct iphdr *ip, unsigned int srcaddr,  unsigned int dstaddr) {  int len = sizeof(struct iphdr) + sizeof(struct tcphdr);   ip-ver_and_hdrlen = (44 | sizeof(struct iphdr)/sizeof(unsigned int));  ip-tos = 0;  ip-total_len = htons(len);  ip-id = 1;  ip-flags = 0x40;  ip-ttl = 255;  ip-protocol = IPPROTO_TCP;  ip-checksum = 0;  ip-srcaddr = srcaddr; // 源IP地址  ip-dstaddr = dstaddr; // 目标IP地址 }  void init_tcp_header(struct tcphdr *tcp, unsigned short dport) {  tcp-sport = htons(rand() % 16383 + 49152); // 随机生成一个端口  tcp-dport = htons(dport); // 目标端口  tcp-seq = htonl(rand() % 90000000 + 2345 ); // 随机生成一个初始化序列号  tcp-ack_seq = 0;  tcp-len = (sizeof(struct tcphdr) / 4 4 | 0);  tcp-flag = 0x02;  tcp-win = htons(1024);  tcp-checksum = 0;  tcp-urg = 0; }  void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr,  unsigned int dstaddr) {  pseudo-zeros = 0;  pseudo-protocol = IPPROTO_TCP;  pseudo-length = htons(sizeof(struct tcphdr));  pseudo-saddr = srcaddr;  pseudo-daddr = dstaddr; }  int make_syn_packet(char *packet, int pkt_len, unsigned int daddr,unsigned int saddr,  unsigned short dport) {  char buf[100];  int len;  struct iphdr ip; //IP 头部  struct tcphdr tcp; //TCP 头部  struct pseudohdr pseudo; //TCP 伪头部   //saddr = inet_addr(\"192.168.195.145\");   len = sizeof(ip) + sizeof(tcp);   // 初始化头部信息  init_ip_header(\u0026ip, saddr, daddr);  init_tcp_header(\u0026tcp, dport);  init_pseudo_header(\u0026pseudo, saddr, daddr);   //计算IP校验和  ip.checksum = checksum((u_short *)\u0026ip, sizeof(ip));   // 计算TCP校验和  bzero(buf, sizeof(buf));  memcpy(buf , \u0026pseudo, sizeof(pseudo)); // 复制TCP伪头部  memcpy(buf + sizeof(pseudo), \u0026tcp, sizeof(tcp)); // 复制TCP头部  tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp));   bzero(packet, pkt_len);  memcpy(packet, \u0026ip, sizeof(ip));  memcpy(packet + sizeof(ip), \u0026tcp, sizeof(tcp));   return len; }  int make_raw_socket() {  int fd;  int on = 1;   // 创建一个原始套接字, 指定其关注TCP协议  fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);  if (fd == -1) {  return -1;  }   // 设置需要手动构建IP头部  if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026on, sizeof(on)) 0) {  close(fd);  return -1;  }   return fd; }  int send_syn_packet(int i ,int sockfd, unsigned int addr, unsigned int sddr,unsigned short port) {  struct sockaddr_in skaddr;  char packet[256];  int pkt_len;   bzero(\u0026skaddr, sizeof(skaddr));   skaddr.sin_family = AF_INET;  skaddr.sin_port = htons(port);  skaddr.sin_addr.s_addr = addr;  printf(\"%d 端口已经探测\\n\",i);  pkt_len = make_syn_packet(packet, 256, addr,sddr, port);   return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026skaddr,  sizeof(struct sockaddr)); }  int main(int argc, char *argv[]) {  unsigned int addr;  unsigned int sddr;  unsigned short port;  int sockfd;    if (argc 3) {  fprintf(stderr, \"Usage: synflood  \\n\");  exit(1);  }   addr = inet_addr(argv[1]);  sddr = inet_addr(argv[2]);     sockfd = make_raw_socket();  if (sockfd == -1) {  fprintf(stderr, \"Failed to make raw socket\\n\");  exit(1);  }   for (int i = 0 ; i 1024; i++) {  port = i;  if (send_syn_packet(i,sockfd, addr,sddr, port) 0) {  fprintf(stderr, \"Failed to send syn packet\\n\");  }  i +=1;  }    close(sockfd);   return 0; }       0x07 总结  明晓网络扫描器xscan、nmap、nessus网络扫描过程中用到的扫描方法。 网络扫描三个过程  主机扫描 端口扫描 漏洞分析   明白了TCP SYN、ACK、FIN、NULL、Xmac、Connect 等扫描方法的原理。 通过Xscan扫描靶机的FTP,通过Wireshark抓包分析扫描器利用FTP弱口令漏洞的过程。 通过编程socket 实现 TCP SYN 扫描，进一步加深了对socket编程的理解。  ",
  "wordCount" : "5359",
  "inLanguage": "en",
  "datePublished": "2022-01-01T21:22:48Z",
  "dateModified": "2022-09-11T15:59:36+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/tech/">👨🏻‍💻技术</a></div>
    <h1 class="post-title">
      网络扫描
    </h1>
    <div class="post-meta"><span title='2022-01-01 21:22:48 +0000 UTC'>2022-01-01</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e7%bd%91%e7%bb%9c%e6%89%ab%e6%8f%8f" aria-label="网络扫描">网络扫描</a><ul>
                            
                    <li>
                        <a href="#0x01-%e5%ae%9e%e9%aa%8c%e7%9b%ae%e7%9a%84" aria-label="0x01 实验目的">0x01 实验目的</a></li>
                    <li>
                        <a href="#0x02-%e5%ae%9e%e9%aa%8c%e5%89%8d%e6%8f%90%e7%9f%a5%e8%af%86" aria-label="0x02 实验前提知识">0x02 实验前提知识</a></li>
                    <li>
                        <a href="#0x03-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83" aria-label="0x03 实验环境">0x03 实验环境</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#winodows-xp-%e6%b1%87%e7%bc%96" aria-label="Winodows xp 汇编">Winodows xp 汇编</a></li>
                    <li>
                        <a href="#winodows-xp-%e7%bd%91%e7%bb%9c%e5%ae%89%e5%85%a8%e5%ae%9e%e9%aa%8c" aria-label="Winodows xp 网络安全实验">Winodows xp 网络安全实验</a></li>
                    <li>
                        <a href="#windows-7" aria-label="Windows 7">Windows 7</a></li>
                    <li>
                        <a href="#%e7%a8%8b%e5%ba%8f%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%99%a8-ubuntu-16" aria-label="程序运行机器 Ubuntu 16">程序运行机器 Ubuntu 16</a></li>
                    <li>
                        <a href="#%e7%bd%91%e5%85%b3" aria-label="网关">网关</a></li>
                    <li>
                        <a href="#%e5%b7%a5%e5%85%b7" aria-label="工具">工具</a><ul>
                            
                    <li>
                        <a href="#xscan" aria-label="xscan">xscan</a></li>
                    <li>
                        <a href="#nmap" aria-label="nmap">nmap</a></li>
                    <li>
                        <a href="#nessus" aria-label="nessus">nessus</a></li>
                    <li>
                        <a href="#wireshark" aria-label="wireshark">wireshark</a></li></ul>
                    </li></ul>
                        </ul>
                    </li>
                    <li>
                        <a href="#0x04-%e8%bd%af%e4%bb%b6%e6%89%ab%e6%8f%8f" aria-label="0x04 软件扫描">0x04 软件扫描</a><ul>
                            
                    <li>
                        <a href="#xscan-1" aria-label="xscan">xscan</a></li>
                    <li>
                        <a href="#nmap-1" aria-label="nmap">nmap</a></li>
                    <li>
                        <a href="#nessus-1" aria-label="nessus">nessus</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x05-%e6%89%be%e5%88%b0%e6%bc%8f%e6%b4%9e" aria-label="0x05 找到漏洞">0x05 找到漏洞</a></li>
                    <li>
                        <a href="#0x06-%e7%bc%96%e7%a8%8b%e5%ae%9e%e7%8e%b0" aria-label="0x06 编程实现">0x06 编程实现</a></li>
                    <li>
                        <a href="#0x07-%e6%80%bb%e7%bb%93" aria-label="0x07 总结">0x07 总结</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="网络扫描">网络扫描<a hidden class="anchor" aria-hidden="true" href="#网络扫描">#</a></h1>
<h2 id="0x01-实验目的">0x01 实验目的<a hidden class="anchor" aria-hidden="true" href="#0x01-实验目的">#</a></h2>
<ul>
<li>用xscan、nmap和nessus软件进行主机、端口、漏洞扫描实验，捕获扫描时交互的数据包，通过分析扫描数据包，验证扫描原理。</li>
<li>找到一种常见的主机系统或应用程序漏洞，研究该漏洞的扫描原理，对该漏洞进行扫描器扫描实验，通过分析捕获的扫描数据包验证漏洞扫描原理。(选做)</li>
<li>编程实现TCP全连接或半连接的端口扫描。（选做）</li>
</ul>
<h2 id="0x02-实验前提知识">0x02 实验前提知识<a hidden class="anchor" aria-hidden="true" href="#0x02-实验前提知识">#</a></h2>
<ul>
<li>
<p>网络扫描器的主要功能</p>
<ul>
<li>扫描目标主机识别其工作状态（开/关机）</li>
<li>识别目标主机端口的状态（监听/关闭）</li>
<li>识别目标主机系统及服务程序的类型和版本</li>
<li>根据已知漏洞信息，分析系统脆弱点</li>
<li>生成扫描结果报告</li>
</ul>
</li>
<li>
<p>扫描器的基本工作原理</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025124451.png" alt="image-20211025124444799"  />
</li>
</ul>
</li>
<li>
<p>网络扫描技术</p>
<ul>
<li>
<p>主机扫描技术</p>
<ul>
<li>主机扫描的目的是确定在目标网络上的主机是否可达。这是信息收集的初级阶段，其效果直接影响到后续的扫描。</li>
<li>传统扫描手段
<ul>
<li>ICMP Echo扫描</li>
<li>ICMP Sweep扫描</li>
<li>Broadcast ICMP扫描</li>
<li>Non-Echo ICMP扫描</li>
</ul>
</li>
<li>防火墙和网络过滤设备常常导致传统的探测手段变得无效。为了突破这种限制，必须采用一些非常规的手段，利用ICMP协议提供网络间传送错误信息的手段，往往可以更有效的达到目的：
<ul>
<li>异常的IP包头</li>
<li>在IP头中设置无效的字段值</li>
<li>错误的数据分片</li>
<li>通过超长包探测内部路由器</li>
<li>反向映射探测</li>
</ul>
</li>
</ul>
</li>
<li>
<p>端口扫描技术</p>
<ul>
<li>
<p>确定目标主机可达后，使用端口扫描技术，发现目标主机的开放端口，包括网络协议和各种应用监听的端口。</p>
<ul>
<li>
<p>开放扫描
会产生大量的审计数据，容易被对方发现，但其可靠性高</p>
<ul>
<li>TCP Connect 扫描</li>
<li>TCP反向ident扫描</li>
</ul>
</li>
<li>
<p>隐蔽扫描</p>
<p>能有效的避免对方入侵检测系统和防火墙的检测，但这种扫描使用的数据包在通过网络时容易被丢弃从而产生错误的探测信息</p>
<ul>
<li>TCP FIN 扫描</li>
<li>TCP Xmas扫描</li>
<li>TCP Null 扫描</li>
<li>TCP ftp proxy扫描</li>
<li>分段扫描</li>
</ul>
</li>
<li>
<p>半开放扫描</p>
<p>隐蔽性和可靠性介于前两者之间。</p>
<ul>
<li>TCP SYN 扫描</li>
<li>TCP间接扫描</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>UDP端口扫描</p>
</li>
<li>
<p>栈指纹OS识别技术</p>
<ul>
<li>根据各个OS在TCP/IP协议栈实现上的不同特点，采用黑盒测试方法，通过研究其对各种探测的响应形成识别指纹，进而识别目标主机运行的操作系统</li>
<li>被动扫描
<ul>
<li>通过Sniffer收集数据包，再对数据包的不同特征（TCP Windowsize、 IP TTL、IP TOS、DF位等参数）进行分析，来识别操作系统。</li>
</ul>
</li>
<li>主动扫描
<ul>
<li>采用向目标系统发送构造的特殊包并监控其应答的方式来识别操作系统类型。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>漏洞扫描技术</p>
<ul>
<li>在端口扫描后得知目标主机开启的端口以及端口上的网络服务，将这些相关信息与网络漏洞扫描系统提供的漏洞库进行匹配，查看是否有满足匹配条件的漏洞存在。</li>
<li>通过模拟黑客的攻击手法，对目标主机系统进行攻击性的安全漏洞扫描，如测试弱势口令等。若模拟攻击成功，则表明目标主机系统存在安全漏洞。</li>
<li>CGI漏洞扫描、POP3漏洞扫描、FTP漏洞扫描、SSH漏洞扫描、HTTP漏洞扫描等。这些漏洞扫描是基于漏洞库，将扫描结果与漏洞库相关数据匹配比较得到漏洞信息。</li>
<li>Unicode遍历目录漏洞探测、FTP 弱密码探测、OPENRelay邮件转发漏洞探测等，这些扫描通过使用插件（功能模块技术）进行模拟攻击，测试出目标主机的漏洞信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x03-实验环境">0x03 实验环境<a hidden class="anchor" aria-hidden="true" href="#0x03-实验环境">#</a></h2>
<ul>
<li>
<h4 id="winodows-xp-汇编">Winodows xp 汇编<a hidden class="anchor" aria-hidden="true" href="#winodows-xp-汇编">#</a></h4>
<ul>
<li><code>IP:192.168.195.135</code></li>
<li><code>MAC: 00-0c-29-19-ba-6e</code></li>
</ul>
</li>
<li>
<h4 id="winodows-xp-网络安全实验">Winodows xp 网络安全实验<a hidden class="anchor" aria-hidden="true" href="#winodows-xp-网络安全实验">#</a></h4>
<ul>
<li><code>IP:192.168.195.131</code></li>
<li><code>MAC:00-0c-29-06-65-c9</code></li>
</ul>
</li>
<li>
<h4 id="windows-7">Windows 7<a hidden class="anchor" aria-hidden="true" href="#windows-7">#</a></h4>
<ul>
<li><code>IP:192.168.195.145</code></li>
<li><code>MAC:00-0c-29-f1-b5-17</code></li>
</ul>
</li>
<li>
<h4 id="程序运行机器-ubuntu-16">程序运行机器 Ubuntu 16<a hidden class="anchor" aria-hidden="true" href="#程序运行机器-ubuntu-16">#</a></h4>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011210108625.png" alt="image-20211011210108625"  />
</li>
</ul>
</li>
<li>
<h4 id="网关">网关<a hidden class="anchor" aria-hidden="true" href="#网关">#</a></h4>
<ul>
<li>IP  : <code>192.168.195.2</code></li>
<li>MAC : <code> 00-50-56-e7-d4-22</code></li>
</ul>
</li>
<li>
<h4 id="工具">工具<a hidden class="anchor" aria-hidden="true" href="#工具">#</a></h4>
<ul>
<li>
<h5 id="xscan">xscan<a hidden class="anchor" aria-hidden="true" href="#xscan">#</a></h5>
</li>
<li>
<h5 id="nmap">nmap<a hidden class="anchor" aria-hidden="true" href="#nmap">#</a></h5>
</li>
<li>
<h5 id="nessus">nessus<a hidden class="anchor" aria-hidden="true" href="#nessus">#</a></h5>
</li>
<li>
<h5 id="wireshark">wireshark<a hidden class="anchor" aria-hidden="true" href="#wireshark">#</a></h5>
</li>
</ul>
</li>
</ul>
<h2 id="0x04-软件扫描">0x04 软件扫描<a hidden class="anchor" aria-hidden="true" href="#0x04-软件扫描">#</a></h2>
<h3 id="xscan-1">xscan<a hidden class="anchor" aria-hidden="true" href="#xscan-1">#</a></h3>
<ul>
<li>
<p>xscan 配置 参数</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025140555.png" alt="image-20211025140555444"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025140615.png" alt="image-20211025140615850"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025140641.png" alt="image-20211025140641945"  />
</li>
</ul>
</li>
<li>
<p>开始扫描</p>
<ul>
<li>扫描结果</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025142926.png" alt="image-20211025142926056"  />
</li>
</ul>
</li>
<li>
<p>Wireshark抓包分析</p>
</li>
<li>
<p>首先应该是 SYN半扫描端口是否开放</p>
<ul>
<li>
<p>源IP(<code>192.168.195.131</code>)随机端口发送tcp-syn连接给目的IP(<code>1921.68.195.135</code>)</p>
<p>因为扫描了1024个端口，这里只放第一个和最后一个端口的截图</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025145912.png" alt="image-20211025145912646"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025150440.png" alt="image-20211025150440200"  />
</p>
</li>
<li>
<p>SYN扫描实现原理：扫描器向目标主机端口发送SYN包。如果应答是RST包，那么说明端口是关闭的；如果应答中包含SYN和ACK包，说明目标端口处于监听状态，再传送一个RST包给目标机从而停止建立连接。</p>
</li>
<li>
<p>可以看到大量的tcp-syn请求，返回的均为RST,标明该端口没有开放</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025150450.png" alt="image-20211025150237910"  />
</li>
</ul>
</li>
<li>
<p>如果返回为SYN+ACK,则表明端口开放</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025150322.png" alt="image-20211025150321994"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP Connect 扫描</p>
<ul>
<li>实现原理：通过调用socket函数connect()连接到目标计算机上，完成一次完整的三次握手过程。如果端口处于侦听状态，那么connect()就能成功返回。否则，这个端口不可用，即没有提供服务。</li>
<li>通过三次握手，查看端口是否开放，并进行一定的使用
<ul>
<li>ftps
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025151525.png" alt="image-20211025151525629"  />
</li>
</ul>
</li>
<li>ssh
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025151631.png" alt="image-20211025151631818"  />
</li>
</ul>
</li>
<li>http
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025151702.png" alt="image-20211025151702151"  />
</li>
</ul>
</li>
<li>https
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025151757.png" alt="image-20211025151757820"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>sslv2协议试探</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025152046.png" alt="image-20211025152046302"  />
</li>
</ul>
</li>
<li>
<p>UDP端口扫描</p>
<ul>
<li>向目标端口发送UDP 包。如果得到的应答为“ICMP port Unreachable”（ICMP 端口不可到达），那么目标端口是关闭的。 反之，如果没有收到这个应答消息，则目标端口极有可能是开放的。</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025153009.png" alt="image-20211025153009659"  />
</li>
</ul>
</li>
<li>
<p>结合报告，xscan主要对netbios-ssn(139/tcp)、https (443/tcp)、FTP-ssl (990/tcp)、ssh (22/tcp)、www (443/tcp)、ftp (990/tcp)、microsoft-ds (445/tcp)、ftp (21/tcp)、epmap (135/tcp)、www (80/tcp)、netbios-ns (137/udp)、ntp (123/udp)</p>
</li>
</ul>
<h3 id="nmap-1">nmap<a hidden class="anchor" aria-hidden="true" href="#nmap-1">#</a></h3>
<ul>
<li>
<p>参数设置</p>
</li>
<li>
<p>首先开启的为 TCP SYN扫描</p>
<ul>
<li>
<p>TCP - SYN扫描</p>
<ul>
<li>扫描器向目标主机端口发送FIN包。当一个FIN数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。</li>
</ul>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025153508.png" alt="image-20211025153508932"  />
</p>
</li>
<li>
<p>Wireshark抓包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025154215.png" alt="image-20211025154215529"  />
、</li>
<li>发现无效，因为TCP SYN扫描通常适用于UNIX目标主机，但在Windows95/NT环境下，该方法无效。因为不论目标端口是否打开，操作系统都返回RST包。我们这里的目标主机是xp系统，所以无论什么端口都会回显RST包</li>
</ul>
</li>
</ul>
</li>
<li>
<p>开启 TCP  ACK 扫描</p>
<ul>
<li>TCP-ACK扫描
<ul>
<li>TCP ACK扫描是利用标志位ACK，而ACK标志在TCP协议中表示确认序号有效，它表示确认一个正常的TCP连接。但是在TCP ACK扫描中没有进行正常的TCP连接过程，实际上是没有真正的TCP连接。那么当发送一个带有ACK标志的TCP报文到目标主机的端口时，目标主机会怎样反应呢？</li>
<li>使用TCP ACK扫描不能够确定端口的关闭或者开放，因为当发送给对方一个含有ACK表示的TCP报文的时候，都返回含有RST标志的报文，无论端口是开放或者关闭。所以，不能使用TCP ACK扫描来确定端口是否开放或者关闭。但是可以利用它来扫描防火墙的配置，用它来发现防火墙规则，确定它们是有状态的还是无状态的，哪些端口是被过滤的</li>
</ul>
</li>
<li>Wireshark抓包
<ul>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211025154830233.png" alt="image-20211025154830233"  />
</li>
<li>可以看到源主机发送的TCP请求包中，ACK直接被初始化了，没有了SYN过程</li>
</ul>
</li>
</ul>
</li>
<li>
<p>开启TCP - Xmas 扫描</p>
<ul>
<li>TCP - Xmas 扫描
<ul>
<li>TCP Xmas和Null扫描是FIN扫描的两个变种。Xmas扫描打开FIN，URG和PUSH标记，而Null扫描关闭所有标记。</li>
<li>这些组合的目的是为了通过对FIN标记数据包的过滤。</li>
<li>当此类数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。</li>
</ul>
</li>
<li>Wireshak 抓包
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025155548.png" alt="image-20211025155548393"  />
</li>
<li>可以看到发的源IP包里面带有Urgent、Fin、Push字段</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP - Connect 扫描</p>
<ul>
<li>
<p>通过调用socket函数connect()连接到目标计算机上，完成一次完整的三次握手过程。如果端口处于侦听状态，那么connect()就能成功返回。否则，这个端口不可用，即没有提供服务</p>
</li>
<li>
<p>Wireshark 抓包</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025160020.png" alt="image-20211025160020586"  />
</p>
</li>
<li>
<p>可以看到我们开放的http端口经过TCP三次连接可以连接，而另一个端口无法连接，返回一个RST包</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>开启 TCP NULL 扫描</p>
<ul>
<li>TCP NULL 扫描
<ul>
<li>TCP Xmas和Null扫描是FIN扫描的两个变种。而Null扫描关闭所有标记。这些组合的目的是为了通过对FIN标记数据包的过滤。当此类数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025170136.png" alt="image-20211025170136544"  />
</li>
</ul>
</li>
<li>可以看到我们开放的端口都没有回显，关闭的端口都返回一个RST、ACK包</li>
</ul>
</li>
<li>
<p>开启 TCP 滑动窗口扫描</p>
<ul>
<li>
<p>其实就是大量的TCP ACK扫描</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025170715.png" alt="image-20211025170715652"  />
</p>
</li>
<li>
<p>根据抓包，发现其即为通过同时发送大量的ACK包，这里是TCP ACK扫描</p>
</li>
<li>
<p>同时大量返回对上述包的RST包来查看端口是否开放。</p>
</li>
</ul>
</li>
<li>
<p>TCP FIN 扫描</p>
<ul>
<li>TCP FIN 扫描
<ul>
<li>扫描器向目标主机端口发送FIN包。当一个FIN数据包到达一个关闭的端口，数据包会被丢掉，并且返回一个RST数据包。否则，若是打开的端口，数据包只是简单的丢掉（不返回RST）。</li>
</ul>
</li>
<li>Wireshark分析
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025171048.png" alt="image-20211025171048532"  />
</li>
<li>通过将请求包置为FIN查看端口是否开放。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>nmap报告</p>
<ul>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211025165714522.png" alt="image-20211025165714522"  />
</li>
</ul>
</li>
</ul>
<h3 id="nessus-1">nessus<a hidden class="anchor" aria-hidden="true" href="#nessus-1">#</a></h3>
<ul>
<li>
<p>因为Window xp里面的 nessus版本用不了</p>
</li>
<li>
<p>所以在虚拟机Windows 7 里面搭建新版的 Nessus 8</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025163238.png" alt="image-20211025163211143"  />
</li>
</ul>
</li>
<li>
<p>并且对靶机<code>192.168.195.135</code>进行攻击</p>
</li>
<li>
<p>利用Wireshark进行抓包分析数据流。</p>
<ul>
<li>
<p>TCP-SYN扫描</p>
<ul>
<li>
<p>这里仅以HTTP为例子。(其他的协议就不赘述了)</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025163738.png" alt="image-20211025163654076"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025164034.png" alt="image-20211025164034229"  />
</p>
</li>
<li>
<p>80端口开放，所以SYN请求之后，可以正常回显，反之，如果请求的端口81.82没有开放，则回显一个RST包</p>
</li>
</ul>
</li>
<li>
<p>TCP - Connect 扫描</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025164246.png" alt="image-20211025164245952"  />
</li>
<li>可以看到 交互过程先 实现三次握手。查看了HTTPS、HTTP、TLSV1、ssh、FTP协议</li>
</ul>
</li>
<li>
<p>SSLV2 协议是否支持</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025165058.png" alt="image-20211025165058905"  />
</li>
</ul>
</li>
<li>
<p>SSLv3 协议是否支持</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025165233.png" alt="image-20211025165233057"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>nessus 扫描<code>192.168.195.135</code> 得到的漏洞报告</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025165556.png" alt="image-20211025165556671"  />
</li>
</ul>
</li>
</ul>
<h2 id="0x05-找到漏洞">0x05 找到漏洞<a hidden class="anchor" aria-hidden="true" href="#0x05-找到漏洞">#</a></h2>
<ul>
<li>FTP弱口令漏洞扫描：</li>
<li>扫描原理：
<ul>
<li>在上述实验过程中，发现靶机开启了21(默认端口)，那么我们可以用字典里的账户和密码去试着登录，如果能够登陆上去，则存在漏洞</li>
</ul>
</li>
<li>利用S-scan进行扫描模块
<ul>
<li>选择扫描模块，扫描端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025182436.png" alt="image-20211025182345274"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025182438.png" alt="image-20211025182400921"  />
</li>
</ul>
</li>
<li>扫描结束
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025182433.png" alt="image-20211025182433201"  />
</li>
</ul>
</li>
<li>生成的报告
<ul>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211025182510118.png" alt="image-20211025182510118"  />
</li>
</ul>
</li>
</ul>
</li>
<li>用Wireshark 对过程进行分析
<ul>
<li>首先，攻击机利用随机端口向靶机的FTP端口发出TCP SYN连接请求
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025182849.png" alt="image-20211025182849191"  />
</li>
</ul>
</li>
<li>然后，靶机端给其回复一个ACK,此时可以监听到21端口
<ul>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211025183034632.png" alt="image-20211025183034632"  />
</li>
</ul>
</li>
<li>最后，攻击机收到靶机的ack，再回复一个ack,至此三次握手完成
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025183126.png" alt="image-20211025183126093"  />
</li>
</ul>
</li>
</ul>
</li>
<li>之后，攻击机就开始用字典里面的数据来 不断发送数据包来暴力破解 靶机的FTP服务器密码账户
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025183332.png" alt="image-20211025183332478"  />
</li>
</ul>
</li>
<li>之后的过程，攻击机一直再重复以上过程，但可能因为FTP账户和密码设置的较为复杂，以及攻击机的字典过于弱小，所以不能够暴力登入ftp服务器中</li>
</ul>
<h2 id="0x06-编程实现">0x06 编程实现<a hidden class="anchor" aria-hidden="true" href="#0x06-编程实现">#</a></h2>
<ul>
<li>
<p>这里实现的是TCP SYN 扫描(即半连接扫描)</p>
</li>
<li>
<p>这里用套接字socket的方法来实现tcp  SYN 扫描</p>
<ul>
<li>来实现查看靶机端口的开放情况，便于方便，这里端口即从1~1024为止。</li>
</ul>
</li>
<li>
<p>只需要构造好一个TCP包，指定好包中IP.flags=0x02(为SYN包)。</p>
</li>
<li>
<p>我们这里在ubuntu 16 的环境中编译我们写好的程序</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025183857.png" alt="image-20211025183857539"  />
</li>
</ul>
</li>
<li>
<p>执行程序</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025192532.png" alt="image-20211025192504340"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025192629.png" alt="image-20211025192629475"  />
</p>
</li>
</ul>
</li>
<li>
<p>与此同时，利用Wireshark在靶机进行抓包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025192934.png" alt="image-20211025192820476"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025193029.png" alt="image-20211025193029052"  />
</li>
<li>可以很明显的看到攻击机的随机端口向靶机的端口从1-1024发送SYN请求，端口存在返回ACK包，端口不存在返回RST包。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211025193133.png" alt="image-20211025193133827"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>源码</p>
<ul>
<li>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;ctype.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;unistd.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;fcntl.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;signal.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/types.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/socket.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;netdb.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;errno.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdlib.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;arpa/inet.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> iphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ver_and_hdrlen;<span style="color:#007f7f">// 版本号与IP头部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       tos;           <span style="color:#007f7f">// 服务类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      total_len;     <span style="color:#007f7f">// 总长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      id;            <span style="color:#007f7f">// IP包ID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      flags;         <span style="color:#007f7f">// 标志位(包括分片偏移量)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ttl;           <span style="color:#007f7f">// 生命周期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       protocol;      <span style="color:#007f7f">// 上层协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum;      <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        srcaddr;       <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        dstaddr;       <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> tcphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      sport;    <span style="color:#007f7f">// 源端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      dport;    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        seq;      <span style="color:#007f7f">// 序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        ack_seq;  <span style="color:#007f7f">// 确认号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       len;      <span style="color:#007f7f">// 首部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       flag;     <span style="color:#007f7f">// 标志位
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      win;      <span style="color:#007f7f">// 窗口大小
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum; <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      urg;      <span style="color:#007f7f">// 紧急指针
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> pseudohdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        saddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        daddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span>                zeros;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span>                protocol;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      length;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> <span style="color:#fff;font-weight:bold">inline</span>
</span></span><span style="display:flex;"><span>checksum(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> *buffer, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">long</span> cksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (size &gt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        cksum += *buffer++;
</span></span><span style="display:flex;"><span>        size  -= <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (size) {
</span></span><span style="display:flex;"><span>        cksum += *(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> *)buffer;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cksum = (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>) + (cksum &amp; <span style="color:#ff0;font-weight:bold">0xffff</span>);
</span></span><span style="display:flex;"><span>    cksum += (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> )(~cksum);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_ip_header(<span style="color:#fff;font-weight:bold">struct</span> iphdr *ip, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len = <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr) + <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ip-&gt;ver_and_hdrlen = (<span style="color:#ff0;font-weight:bold">4</span>&lt;&lt;<span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr)/<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>));
</span></span><span style="display:flex;"><span>    ip-&gt;tos = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;total_len = htons(len);
</span></span><span style="display:flex;"><span>    ip-&gt;id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;flags = <span style="color:#ff0;font-weight:bold">0x40</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;ttl = <span style="color:#ff0;font-weight:bold">255</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    ip-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;srcaddr = srcaddr; <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip-&gt;dstaddr = dstaddr; <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_tcp_header(<span style="color:#fff;font-weight:bold">struct</span> tcphdr *tcp, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    tcp-&gt;sport = htons(rand() % <span style="color:#ff0;font-weight:bold">16383</span> + <span style="color:#ff0;font-weight:bold">49152</span>);   <span style="color:#007f7f">// 随机生成一个端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;dport = htons(dport);                    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;seq = htonl(rand() % <span style="color:#ff0;font-weight:bold">90000000</span> + <span style="color:#ff0;font-weight:bold">2345</span> );  <span style="color:#007f7f">// 随机生成一个初始化序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;ack_seq = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;len = (<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr) / <span style="color:#ff0;font-weight:bold">4</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;flag = <span style="color:#ff0;font-weight:bold">0x02</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;win = htons(<span style="color:#ff0;font-weight:bold">1024</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;urg = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_pseudo_header(<span style="color:#fff;font-weight:bold">struct</span> pseudohdr *pseudo, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    pseudo-&gt;zeros = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    pseudo-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    pseudo-&gt;length = htons(<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr));
</span></span><span style="display:flex;"><span>    pseudo-&gt;saddr = srcaddr;
</span></span><span style="display:flex;"><span>    pseudo-&gt;daddr = dstaddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_syn_packet(<span style="color:#fff;font-weight:bold">char</span> *packet, <span style="color:#fff;font-weight:bold">int</span> pkt_len, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> daddr,<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> saddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> buf[<span style="color:#ff0;font-weight:bold">100</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> iphdr ip;          <span style="color:#007f7f">//IP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> tcphdr tcp;        <span style="color:#007f7f">//TCP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> pseudohdr pseudo;  <span style="color:#007f7f">//TCP 伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//saddr = inet_addr(&#34;192.168.195.145&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    len = <span style="color:#fff;font-weight:bold">sizeof</span>(ip) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 初始化头部信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    init_ip_header(&amp;ip, saddr, daddr);
</span></span><span style="display:flex;"><span>    init_tcp_header(&amp;tcp, dport);
</span></span><span style="display:flex;"><span>    init_pseudo_header(&amp;pseudo, saddr, daddr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//计算IP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip.checksum = checksum((u_short *)&amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算TCP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bzero(buf, <span style="color:#fff;font-weight:bold">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>    memcpy(buf , &amp;pseudo, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo));           <span style="color:#007f7f">// 复制TCP伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    memcpy(buf + <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp)); <span style="color:#007f7f">// 复制TCP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp.checksum = checksum((u_short *)buf, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(packet, pkt_len);
</span></span><span style="display:flex;"><span>    memcpy(packet, &amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>    memcpy(packet + <span style="color:#fff;font-weight:bold">sizeof</span>(ip), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> len;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_raw_socket()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> on = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建一个原始套接字, 指定其关注TCP协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (fd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置需要手动构建IP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (<span style="color:#fff;font-weight:bold">char</span> *)&amp;on, <span style="color:#fff;font-weight:bold">sizeof</span>(on)) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> fd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> send_syn_packet(<span style="color:#fff;font-weight:bold">int</span> i ,<span style="color:#fff;font-weight:bold">int</span> sockfd, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> sddr,<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> sockaddr_in skaddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> packet[<span style="color:#ff0;font-weight:bold">256</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> pkt_len;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(&amp;skaddr, <span style="color:#fff;font-weight:bold">sizeof</span>(skaddr));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    skaddr.sin_family = AF_INET;
</span></span><span style="display:flex;"><span>    skaddr.sin_port = htons(port);
</span></span><span style="display:flex;"><span>    skaddr.sin_addr.s_addr = addr;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#0ff;font-weight:bold">&#34;%d 端口已经探测</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>,i);
</span></span><span style="display:flex;"><span>    pkt_len = make_syn_packet(packet, <span style="color:#ff0;font-weight:bold">256</span>, addr,sddr, port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> sendto(sockfd, packet, pkt_len, <span style="color:#ff0;font-weight:bold">0</span>, (<span style="color:#fff;font-weight:bold">struct</span> sockaddr *)&amp;skaddr,
</span></span><span style="display:flex;"><span>                  <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> sockaddr));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main(<span style="color:#fff;font-weight:bold">int</span> argc, <span style="color:#fff;font-weight:bold">char</span> *argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> sddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> sockfd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (argc &lt; <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Usage: synflood &lt;address&gt; &lt;port&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    addr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">1</span>]);
</span></span><span style="display:flex;"><span>    sddr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sockfd = make_raw_socket();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (sockfd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to make raw socket</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span> ; i &lt;= <span style="color:#ff0;font-weight:bold">1024</span>; i++) {
</span></span><span style="display:flex;"><span>        port = i;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (send_syn_packet(i,sockfd, addr,sddr, port) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to send syn packet</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        i +=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    close(sockfd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h2 id="0x07-总结">0x07 总结<a hidden class="anchor" aria-hidden="true" href="#0x07-总结">#</a></h2>
<ul>
<li>明晓网络扫描器xscan、nmap、nessus网络扫描过程中用到的扫描方法。</li>
<li>网络扫描三个过程
<ul>
<li>主机扫描</li>
<li>端口扫描</li>
<li>漏洞分析</li>
</ul>
</li>
<li>明白了TCP SYN、ACK、FIN、NULL、Xmac、Connect 等扫描方法的原理。</li>
<li>通过Xscan扫描靶机的FTP,通过Wireshark抓包分析扫描器利用FTP弱口令漏洞的过程。</li>
<li>通过编程socket 实现 TCP SYN 扫描，进一步加深了对socket编程的理解。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/">网络扫描</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/">
    <span class="title">« Prev</span>
    <br>
    <span>Vpn配置</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/">
    <span class="title">Next »</span>
    <br>
    <span>防火墙实验</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
