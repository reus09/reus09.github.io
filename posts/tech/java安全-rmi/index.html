<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>JAVAå®‰å…¨ RMI | Reus09&#39;s Blog</title>
<meta name="keywords" content="RMI">
<meta name="description" content="å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚ RMIä»‹ç» RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚ è¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€">
<meta name="author" content="Reus09">
<link rel="canonical" href="https://reus09.github.io/posts/tech/java%E5%AE%89%E5%85%A8-rmi/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.678b5c47efa744d2e0dd0d61101075e6aecdc9a0631e7ad8538f4ec0cca79273.css" integrity="sha256-Z4tcR&#43;&#43;nRNLg3Q1hEBB15q7NyaBjHnrYU49OwMynknM=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="JAVAå®‰å…¨ RMI" />
<meta property="og:description" content="å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚ RMIä»‹ç» RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚ è¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://reus09.github.io/posts/tech/java%E5%AE%89%E5%85%A8-rmi/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-10T19:17:17+08:00" />
<meta property="article:modified_time" content="2023-03-10T19:17:17+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JAVAå®‰å…¨ RMI"/>
<meta name="twitter:description" content="å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚ RMIä»‹ç» RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚ è¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://reus09.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯",
      "item": "https://reus09.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "JAVAå®‰å…¨ RMI",
      "item": "https://reus09.github.io/posts/tech/java%E5%AE%89%E5%85%A8-rmi/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JAVAå®‰å…¨ RMI",
  "name": "JAVAå®‰å…¨ RMI",
  "description": "å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚ RMIä»‹ç» RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚ è¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€",
  "keywords": [
    "RMI"
  ],
  "articleBody": "å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚\nRMIä»‹ç» RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚\nè¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€æ•°æ®ç»“æ„ï¼Œè€Œåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼ é€’ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ—¢åŒ…å«æ•°æ®ï¼Œä¹ŸåŒ…å«æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ŒJava ä¸­å¦‚æœæƒ³å®Œæ•´çš„åœ¨ç½‘ç»œä¸­å‘è¿œç¨‹ä½ç½®ä¼ è¾“ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„æ–¹æ³•æ˜¯ Java åŸç”Ÿååºåˆ—åŒ–ï¼Œå¹¶ä¸”å¯ä»¥ç»“åˆåŠ¨æ€ç±»åŠ è½½å’Œå®‰å…¨ç®¡ç†å™¨æ¥å®‰å…¨çš„ä¼ è¾“ä¸€ä¸ª Java ç±»ã€‚\nè€Œå…·ä½“çš„å®ç°æ€æƒ³å°±æ˜¯è®©æˆ‘ä»¬è·å–è¿œç¨‹ä¸»æœºä¸Šå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œä½†å®é™…æ–¹æ³•çš„æ‰§è¡Œåœ¨è¿œç¨‹ä½ç½®ä¸Šã€‚\nRMIå¼•å…¥äº†ä¸¤ä¸ªæ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ Stubï¼ˆå®¢æˆ·ç«¯å­˜æ ¹ï¼‰ ä»¥åŠ Skeletonï¼ˆæœåŠ¡ç«¯éª¨æ¶ï¼‰ã€‚å½“ä¸€ä¸ªå®¢æˆ·ç«¯(Client)å»è®¿é—®è¿œç¨‹ä¸€ä¸ªObjectçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å…ˆè®¿é—®æœ¬åœ°çš„ä¸€ä¸ªä»£ç†ç±»(Stub),ç„¶åè®¿é—®è¿œç«¯çš„Objectçš„ä»£ç†(Skeleton),å®ƒä» Stub ä¸­æ¥æ”¶è¿œç¨‹æ–¹æ³•è°ƒç”¨å¹¶ä¼ é€’ç»™çœŸå®çš„ç›®æ ‡ç±»,è¿™é‡Œå…ˆç®€å•åˆ—ä¸€ä¸‹æ•´ä½“è°ƒç”¨æ—¶åºå›¾ï¼Œåé¢ä¼šè¯¦ç»†è¿›è¡Œå±•å¼€è¯´ï¼š\nRMIä¹Ÿæä¾›äº†åŠ¨æ€åŠ è½½ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è°ƒç”¨æ—¶ï¼Œä¼ é€’äº†ä¸€ä¸ªå¯åºåˆ—åŒ–å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨æœåŠ¡ç«¯ä¸å­˜åœ¨ï¼Œåˆ™åœ¨æœåŠ¡ç«¯ä¼šæŠ›å‡º ClassNotFound çš„å¼‚å¸¸ï¼Œä½†æ˜¯ RMI æ”¯æŒåŠ¨æ€ç±»åŠ è½½ï¼Œå¦‚æœè®¾ç½®äº† java.rmi.server.codebaseï¼Œåˆ™ä¼šå°è¯•ä»å…¶ä¸­çš„åœ°å€è·å– .class å¹¶åŠ è½½åŠååºåˆ—åŒ–ã€‚å¯ä½¿ç”¨ System.setProperty(\"java.rmi.server.codebase\", \"http://127.0.0.1:9999/\"); è¿›è¡Œè®¾ç½®ï¼Œæˆ–ä½¿ç”¨å¯åŠ¨å‚æ•° -Djava.rmi.server.codebase=\"http://127.0.0.1:9999/\" è¿›è¡ŒæŒ‡å®šã€‚\næ¥ä¸‹æ¥å°±æ˜¯å®‰å…¨ç­–ç•¥çš„è®¾ç½®ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ç½‘ç»œåŠ è½½å¤–éƒ¨ç±»å¹¶æ‰§è¡Œæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå®‰å…¨ç®¡ç†å™¨æ¥è¿›è¡Œç®¡ç†ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å®‰å…¨ç®¡ç†ï¼Œåˆ™ RMI ä¸ä¼šåŠ¨æ€åŠ è½½ä»»ä½•ç±»ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ï¼š\n1 2 3 if (System.getSecurityManager() == null) { System.setSecurityManager(new RMISecurityManager()); } ç®¡ç†å™¨åº”ä¸ç®¡ç†ç­–ç•¥ç›¸è¾…ç›¸æˆï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªç­–ç•¥æ–‡ä»¶ï¼Œé‡Œé¢é…ç½®å…è®¸é‚£äº›ä¸»æœºè¿›è¡Œå“ªäº›æ“ä½œï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œç›´æ¥è®¾ç½®å…¨éƒ¨æƒé™ï¼š\n1 2 3 grant { permission java.security.AllPermission; }; åŒæ ·å¯ä»¥ä½¿ç”¨ -Djava.security.policy=rmi.policy æˆ– System.setProperty(\"java.security.policy\", RemoteServer.class.getClassLoader().getResource(\"rmi.policy\").toString()); æ¥è¿›è¡Œè®¾ç½®ã€‚\nRMIç¤ºä¾‹ Serverç«¯ é¦–å…ˆè¦å®šä¹‰ä¸€ä¸ªæœŸæœ›èƒ½å¤Ÿè¿œç¨‹è°ƒç”¨çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å¿…é¡»æ‰©å±•java.rmi.Remoteæ¥å£ã€‚è¿™ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»å£°æ˜æŠ›å‡ºjava.rmi.RemoteExceptionã€‚\n1 2 3 4 5 6 public interface RemoteInterface extends Remote { public String sayHello() throws RemoteException; public String sayHello(Object obj) throws RemoteException; public String sayGoodBye() throws RemoteException; } å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè¿™ä¸ªè¿œç¨‹æ¥å£çš„å®ç°ç±»ï¼Œè¿™ä¸ªç±»ä¸­æ˜¯çœŸæ­£çš„é€»è¾‘ä»£ç ï¼Œé€šå¸¸ä¼šæ‰©å±•java.rmi.server.UnicastRemoteObjectç±»ï¼Œæ‰©å±•æ­¤ç±»åï¼ŒRMI ä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±» export ç»™è¿œç¨‹æƒ³è¦è°ƒç”¨å®ƒçš„ Client ç«¯ï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›åŸºç¡€çš„ equals/hashcode/toString æ–¹æ³•ã€‚è¿™é‡Œå¿…é¡»ä¸ºè¿™ä¸ªå®ç°ç±»æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°å¹¶ä¸”æŠ›å‡º RemoteExceptionã€‚\nåœ¨ export æ—¶ï¼Œä¼šéšæœºç»‘å®šä¸€ä¸ªç«¯å£ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰€ä»¥å³ä½¿ä¸æ³¨å†Œï¼Œç›´æ¥è¯·æ±‚è¿™ä¸ªç«¯å£ä¹Ÿå¯ä»¥é€šä¿¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class RemoteObject extends UnicastRemoteObject implements RemoteInterface { protected RemoteObject() throws RemoteException { } @Override public String sayHello() throws RemoteException { return \"Hello My Friend\"; } @Override public String sayHello(Object obj) throws RemoteException { return obj.getClass().getName(); } @Override public String sayGoodBye() throws RemoteException { return \"Bye My Friend\"; } } å¦‚æœä¸æƒ³è®©è¿œç¨‹å¯¹è±¡æˆä¸º UnicastRemoteObject çš„å­ç±»ï¼Œåé¢å°±éœ€è¦ä¸»åŠ¨çš„ä½¿ç”¨å…¶é™æ€æ–¹æ³• exportObject æ¥æ‰‹åŠ¨ export å¯¹è±¡ã€‚\nRegistryç«¯ ä¸Šè¿°ï¼Œå¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„å¯¹è±¡åˆ›å»ºå®Œæ¯•ã€‚ä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼ŒJava RMIè®¾è®¡äº†ä¸€ä¸ªRegistryçš„æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨æ¥æŸ¥æ‰¾ä¸€ä¸ªè¿œç«¯å¯¹è±¡çš„è°ƒç”¨ã€‚æˆ‘ä»¬æƒ³ä»æŸä¸ªäººè·å–ä¿¡æ¯(Remote Method Invocation)ï¼Œæˆ‘ä»¬åœ¨ç”µè¯æœ¬(Registry)æŸ¥æ‰¾è¿™ä¸ªäººçš„å§“å(Name)ä»è€Œæ‰¾åˆ°è¿™ä¸ªäººçš„ç”µè¯å·ç (Reference)ï¼Œæœ€åé€šè¿‡è¿™ä¸ªå·ç æ‰¾åˆ°è¯¥äºº(Remote Object)ã€‚\nè¿™ç§æ€æƒ³ç”±java.rmi.Registryå’Œjava.rmi.Namingå®ç°ã€‚\njava.rmi.Naming å…ˆæ¥è¯´è¯´ java.rmi.Namingï¼Œè¿™æ˜¯ä¸€ä¸ª final ç±»ï¼Œæä¾›äº†åœ¨è¿œç¨‹å¯¹è±¡æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰ä¸­å­˜å‚¨å’Œè·å–è¿œç¨‹å¯¹è±¡å¼•ç”¨çš„æ–¹æ³•ï¼Œè¿™ä¸ªç±»æä¾›çš„æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª URL æ ¼å¼çš„å‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š //host:port/nameï¼š\nhost è¡¨ç¤ºæ³¨å†Œè¡¨æ‰€åœ¨çš„ä¸»æœº port è¡¨ç¤ºæ³¨å†Œè¡¨æ¥å—è°ƒç”¨çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 1099 name è¡¨ç¤ºä¸€ä¸ªæ³¨å†Œ Remote Object çš„å¼•ç”¨çš„åç§°ï¼Œä¸èƒ½æ˜¯æ³¨å†Œè¡¨ä¸­çš„ä¸€äº›å…³é”®å­— Naming æä¾›äº†æŸ¥è¯¢ï¼ˆlookupï¼‰ã€ç»‘å®šï¼ˆbindï¼‰ã€é‡æ–°ç»‘å®šï¼ˆrebindï¼‰ã€æ¥è§¦ç»‘å®šï¼ˆunbindï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ç”¨æ¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒNaming æ˜¯ä¸€ä¸ªç”¨æ¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œçš„ç±»ã€‚\njava.rmi.Registry ä¸Šè¿°Namingæä¾›çš„æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œå…¶å®æ˜¯è°ƒç”¨ LocateRegistry.getRegistry æ–¹æ³•è·å–äº† Registry æ¥å£çš„å®ç°ç±»ï¼Œå¹¶è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•è¿›è¡Œå®ç°çš„ã€‚\né‚£å°±è¯´åˆ°äº† java.rmi.registry.Registry æ¥å£ï¼Œè¿™ä¸ªæ¥å£åœ¨ RMI ä¸‹æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ RegistryImpl ä»¥åŠ RegistryImpl_Stubï¼Œå…·ä½“ä¹Ÿæ”¾é¢åé¢æ¥è¯´ã€‚\næˆ‘ä»¬é€šå¸¸ä½¿ç”¨ LocateRegistry#createRegistry() æ–¹æ³•æ¥åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 public class Registry { public static void main(String args[]) { try { LocateRegistry.createRegistry(1099); System.out.println(\"Server Start\"); } catch (Exception e) { e.printStackTrace(); } } } ç„¶åå°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®šï¼š\n1 2 3 4 5 6 7 8 9 public class RemoteServer { public static void main(String[] args) throws RemoteException, MalformedURLException, AlreadyBoundException, InterruptedException { // åˆ›å»ºè¿œç¨‹å¯¹è±¡ RemoteInterface remoteObject = new RemoteObject(); // ç»‘å®š Naming.bind(\"rmi://localhost:1099/Hello\", remoteObject); } } Clientç«¯ å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨ï¼Œé€šè¿‡RegistryæŸ¥æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 public class RMIClient { public static void main(String[] args) throws RemoteException, NotBoundException { Registry registry = LocateRegistry.getRegistry(1099); System.out.println(Arrays.toString(registry.list())); // lookup and call RemoteInterface stub = (RemoteInterface) registry.lookup(\"Hello\"); System.out.println(stub.sayHello()); System.out.println(stub.sayHello(new String())); System.out.println(stub.sayGoodBye()); } } è¿™é‡Œ RemoteInterface æ¥å£åœ¨ Client/Server/Registry å‡åº”è¯¥å­˜åœ¨ï¼Œåªä¸è¿‡é€šå¸¸ Registry ä¸ Server é€šå¸¸åœ¨åŒä¸€ç«¯ä¸Šã€‚\næºç åˆ†æ æœåŠ¡æ³¨å†Œ â‘ è¿œç¨‹å¯¹è±¡åˆ›å»º æ ¹æ®æˆ‘ä»¬ç›´æ¥åˆ›å»ºçš„demo,æˆ‘ä»¬åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡:RemoteInterface remoteObject = new RemoteObject();ï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿äº†UnicastRemoteObjectï¼Œè¿™ä¸ªç±»ä½¿ç”¨JRMPåè®®exportè¿œç¨‹å¯¹è±¡ï¼Œåœ¨æœåŠ¡å™¨ç«¯è·å–ä¸æ³¨å†Œç«¯è¿›è¡Œé€šä¿¡çš„Stubã€‚\nåœ¨UnicastRemoteObjectåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªUnicastServerRef ï¼Œç„¶ååˆ¤æ–­æˆ‘ä»¬ä¼ å…¥çš„remoteObjectæ˜¯å¦ç»§æ‰¿äº†UnicastRemoteObjectï¼Œæœ€åè°ƒç”¨UnicastServerRefçš„exportObjectæ–¹æ³•æ¥exportæˆ‘ä»¬åˆ›å»ºçš„remoteObjectè¿™ä¸ªè¿œç¨‹å¯¹è±¡ã€‚\nåœ¨sref.exportObjectæ–¹æ³•ä¸­ï¼Œå®ç°äº†Exportæˆ‘ä»¬çš„è¿œç¨‹å¯¹è±¡ï¼Œç„¶ååˆ›å»ºstubã€‚\nä½¿ç”¨ sun.rmi.server.Util#createProxy() å¦‚ä¸‹ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯è°ƒç”¨stubClassExistsæ–¹æ³•æ—¶ï¼Œæ­¤æ—¶ç±»ä¸­æ²¡æœ‰remoteClass.getName()+\"_Stub\"çš„ç±»ï¼Œæ‰€ä»¥è¿”å›ä¸ºfalseã€‚é€€å‡ºåˆ¤æ–­è¯­å¥ï¼Œç„¶åä½¿ç”¨RemoteObjectInvocationHandler æ¥ä¸ºæˆ‘ä»¬æµ‹è¯•å†™çš„ RemoteObject å®ç°çš„ RemoteInterface æ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚\nåˆ›å»ºstubå®Œæ¯•å,æˆ‘ä»¬çš„stubæ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å‹ï¼Œå¹¶æ²¡æœ‰ç»§æ‰¿RemoteStubç±»ï¼Œå› æ­¤å¯ä»¥è·³è¿‡ã€‚æ¥ç€åˆ›å»º sun.rmi.transport.Target å¯¹è±¡ï¼Œä½¿ç”¨è¿™ä¸ª Target å¯¹è±¡å°è£…äº†æˆ‘ä»¬è¿œç¨‹æ‰§è¡Œæ–¹æ³•å’Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ï¼ˆStubï¼‰ã€‚\nå¹¶è°ƒç”¨LiveRef#exportObjectï¼Œç»è¿‡å±‚å±‚è°ƒç”¨ï¼Œæœ€åè°ƒç”¨sun.rmi.transport.tcp.TCPTransport#exportObjectæ¥ç›‘å¬æœ¬åœ°ç«¯å£ã€‚\nç„¶åè°ƒç”¨sun.rmi.transport.Transport#exportObjectæ–¹æ³•å°† Target å®ä¾‹æ³¨å†Œåˆ° ObjectTable ä¸­ã€‚ObjectTable ç”¨æ¥ç®¡ç†æ‰€æœ‰å‘å¸ƒçš„æœåŠ¡å®ä¾‹ Targetï¼ŒObjectTable æä¾›äº†æ ¹æ®ObjectEndpointå’Œ Remote å®ä¾‹ä¸¤ç§æ–¹å¼æŸ¥æ‰¾ Target çš„æ–¹æ³•ï¼ˆä¸åŒå‚æ•°çš„ getTarget æ–¹æ³•ï¼‰ã€‚\nè¿™é‡Œå€Ÿç”¨su18å¸ˆå‚…ï¼Œæ€»ç»“ä¸ºä¸€å¼ å›¾ï¼š\nStubæ˜¯é€šè¿‡RemoteObjectInvocationHandler æ¥å®ç°ä¼ è¾“çš„ä¿¡æ¯æ¥å—å’Œååºåˆ—åŒ–æ‰§è¡Œã€‚è¿™ä¸ªåŠ¨æ€ä»£ç†ç»§æ‰¿ RemoteObject å®ç° InvocationHandlerï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ã€å¯ä½¿ç”¨ RMI è¿œç¨‹ä¼ è¾“çš„åŠ¨æ€ä»£ç†ç±»ã€‚æ—¢ç„¶æ˜¯åŠ¨æ€ä»£ç†ç±»ï¼Œè‡ªç„¶é‡ç‚¹å…³æ³¨ invoke æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæ˜¯å£°æ˜ç±»ä¸º Object çš„æ–¹æ³•ä¼šè°ƒç”¨ invokeObjectMethod æ–¹æ³•ï¼Œå…¶ä»–çš„åˆ™è°ƒç”¨ invokeRemoteMethod æ–¹æ³•ã€‚\ninvokeRemoteMethod ä¸­å®é™…æ˜¯å§”æ‰˜ RemoteRef çš„å­ç±» UnicastRef çš„ invoke æ–¹æ³•æ‰§è¡Œä»£ç†è°ƒç”¨ã€‚\nUnicastRef çš„ invoke æ–¹æ³•æ˜¯ä¸€ä¸ªå»ºç«‹è¿æ¥ï¼Œæ‰§è¡Œè°ƒç”¨ï¼Œå¹¶è¯»å–ç»“æœå¹¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚è¿™é‡Œï¼ŒUnicastRef åŒ…å«å±æ€§ LiveRef ï¼ŒLiveRef ç±»ä¸­çš„ Endpointã€Channel å°è£…äº†ä¸ç½‘ç»œé€šä¿¡ç›¸å…³çš„æ–¹æ³•ã€‚\nååºåˆ—åŒ–æ–¹æ³•åœ¨ unmarshalValue ä¸­ï¼Œåˆ¤æ–­typeä¹‹åï¼Œå°±å°†ç±»ååºåˆ—åŒ–ã€‚\nâ‘¡æ³¨å†Œä¸­å¿ƒåˆ›å»º æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ LocateRegistry.createRegistry(1099); æ¥åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼Œ\né¦–å…ˆæ˜¯å¯ä»¥çœ‹åˆ° createRegistry æ–¹æ³•å®é™… new äº†ä¸€ä¸ªRegistryImplå¯¹è±¡ã€‚\nRegistryImpl çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»º LiveRef å¯¹è±¡ï¼Œç„¶ååˆ›å»º UnicastServerRef å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ setup è¿›è¡Œé…ç½®ã€‚\nåœ¨ setup æ–¹æ³•ä¸­ï¼Œä¾æ—§æ˜¯ä½¿ç”¨ UnicastServerRef çš„ exportObject æ–¹æ³• export å¯¹è±¡ï¼Œåªä¸è¿‡è¿™æ¬¡ export çš„æ˜¯ RegistryImpl è¿™ä¸ªå¯¹è±¡ã€‚\nåœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼Œåœ¨createProxyæ–¹æ³•é‡Œå¯¹è¿œç¨‹å¯¹è±¡ä½¿ç”¨ RemoteObjectInvocationHandler åˆ›å»ºåŠ¨æ€ä»£ç†å‰ï¼Œæœ‰ä¸€ä¸ªstubClassExistsçš„åˆ¤æ–­ï¼Œå¦‚æœéœ€è¦åˆ›å»ºä»£ç†çš„ç±»åœ¨æœ¬åœ°æœ‰ _Stub çš„ç±»ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ createStub æ–¹æ³•åå°„è°ƒç”¨ stub ç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºç±»å®ä¾‹ã€‚RMIæ°å¥½å®ç°äº†RegistryImpl_Stubè¿™ä¸ªç±»çš„å®ç°ã€‚\nå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„stubå·²ç»è¢«å®ä¾‹åŒ–ä¸ºRegistryImpl_Stub,ç„¶åè¯¥ç±»ç»§æ‰¿äº†RemoteStubç±»\nå› æ­¤æ¥ä¸‹æ¥ä¼šè°ƒç”¨ setSkeleton æ–¹æ³•ï¼Œé‡Œé¢å°±æ˜¯è·Ÿåˆ¤æ–­RegistryImpl_Stubæ˜¯å¦å­˜åœ¨çš„æµç¨‹ï¼Œç»§ç»­åˆ¤æ–­RegistryImpl_Skelã€‚\nè°ƒç”¨ Util.createSkeleton() æ–¹æ³•åˆ›å»º skeletonã€‚\nRegistryImpl_Skel ç±»æä¾›äº† dispatch æ–¹æ³•æ¥åˆ†å‘å…·ä½“çš„æ“ä½œã€‚\nåç»­çš„ export æµç¨‹ç›¸åŒã€‚\næ³¨å†Œä¸­å¿ƒä¸è¿œç¨‹æœåŠ¡å¯¹è±¡æ³¨å†Œçš„å¤§éƒ¨åˆ†æµç¨‹ç›¸åŒï¼Œå·®å¼‚åœ¨ï¼š\nè¿œç¨‹æœåŠ¡å¯¹è±¡ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œinvoke æ–¹æ³•æœ€ç»ˆè°ƒç”¨ UnicastRef çš„ invoke æ–¹æ³•ï¼Œæ³¨å†Œä¸­å¿ƒä½¿ç”¨ RegistryImpl_Stubï¼ŒåŒæ—¶è¿˜åˆ›å»ºäº† RegistryImpl_Skel è¿œç¨‹å¯¹è±¡é»˜è®¤éšæœºç«¯å£ï¼Œæ³¨å†Œä¸­å¿ƒé»˜è®¤æ˜¯ 1099ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šï¼‰ â‘¢æœåŠ¡æ³¨å†Œ æ³¨å†Œå…¶å®å°±æ˜¯ bind çš„è¿‡ç¨‹ã€‚\nå¦‚æœ Server ç«¯å’Œ Registry åœ¨åŒä¸€ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨Registry çš„ bind æ–¹æ³•è¿›è¡Œç»‘å®šï¼Œå…·ä½“å®ç°åœ¨ RegistryImpl çš„ bind æ–¹æ³•ï¼Œå°±æ˜¯å°† Remote å¯¹è±¡å’Œåç§° String æ”¾åœ¨æˆå‘˜å˜é‡ bindings ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªHashtableå¯¹è±¡ã€‚\nå¦‚æœ Server ç«¯å’Œ Registry ç«¯ä¸åœ¨ä¸€èµ·ï¼Œé‚£æˆ‘ä»¬éœ€è¦å…ˆè·å– Registry å¯¹è±¡ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Naming æˆ–è€… LocateRegistry éƒ½æ˜¯è°ƒç”¨ LocateRegistry.getRegistry() æ–¹æ³•æ¥åˆ›å»º RegistryImpl_Stubï¼Œè¿™éƒ¨åˆ†çš„åˆ›å»ºè¿‡ç¨‹ä¸æ³¨å†Œä¸­å¿ƒæ³¨å†Œæ—¶çš„è¿‡ç¨‹æ˜¯ä¸€è‡´çš„ã€‚\næœåŠ¡å‘ç° è·å–æ³¨å†Œä¸­å¿ƒå¹¶å¯¹å…¶è¿›è¡Œæ“ä½œçš„è¿‡ç¨‹ï¼Œè¿™é‡Œé¢åŒ…å« Server ç«¯å’Œ Client ç«¯ä¸¤ç§ã€‚\nå¦‚æœ Server ç«¯å’Œ Registry åœ¨åŒä¸€ç«¯ï¼Œé‚£å¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨åˆ›å»º Registry æ—¶ä½¿ç”¨çš„ RegistryImplï¼Œ ç›´æ¥è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•ï¼Œè¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚\nå¦‚æœ Server ç«¯å’Œ Registry ä¸åŒç«¯ï¼Œåˆ™åœ¨ Server ç«¯æˆ– Client ç«¯ä½¿ç”¨ LocateRegistry.getRegistry() æ–¹æ³•è·å–æ³¨å†Œä¸­å¿ƒæ—¶éƒ½æ˜¯ä¸€æ ·çš„æµç¨‹ï¼š\né¦–å…ˆåœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«äº†å…·ä½“é€šä¿¡åœ°å€ã€ç«¯å£çš„ RegistryImpl_Stub å¯¹è±¡ é€šè¿‡è°ƒç”¨è¿™ä¸ªæœ¬åœ°çš„ RegistryImpl_Stub å¯¹è±¡çš„ bind/listâ€¦ ç­‰æ–¹æ³•ï¼Œæ¥ä¸ Registry ç«¯è¿›è¡Œé€šä¿¡ è€Œ RegistryImpl_Stub çš„æ¯ä¸ªæ–¹æ³•ï¼Œéƒ½å®é™…ä¸Šè°ƒç”¨äº†RemoteRefçš„ invoke æ–¹æ³•ï¼Œè¿›è¡Œäº†ä¸€æ¬¡è¿œç¨‹è°ƒç”¨é“¾æ¥ è¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨ java åŸç”Ÿåºåˆ—åŒ–åŠååºåˆ—åŒ–æ¥å®ç° è·å–äº†æ³¨å†Œä¸­å¿ƒåï¼Œå¦‚æœæ˜¯ Server ç«¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ³¨å†Œä¸­å¿ƒä¸Šç»‘å®šï¼ˆbindï¼‰æˆ‘ä»¬çš„æœåŠ¡ï¼Œå¦‚æœæ˜¯ Client ç«¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ³¨å†Œä¸­å¿ƒéå†ï¼ˆlistï¼‰ã€æŸ¥æ‰¾ï¼ˆlookupï¼‰å’Œè°ƒç”¨æœåŠ¡ï¼ŒæŸ¥æ‰¾çš„é€»è¾‘æˆ‘ä»¬æ”¾åœ¨ä¸‹ä¸€éƒ¨åˆ†æœåŠ¡è°ƒç”¨æ¥è¯´ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ç»‘å®šçš„è¿‡ç¨‹ã€‚\nå¯¹äº Server ç«¯å‘æ³¨å†Œä¸­å¿ƒä¸Šç»‘å®šï¼ˆbindï¼‰æ¥è¯´ï¼Œæ— è®ºæ˜¯ Registry è¿˜æ˜¯ Naming çš„ bind æ–¹æ³•ï¼Œå®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨ Server ç«¯ç”Ÿæˆçš„æœ¬åœ° RegistryImpl_Stub çš„ bind æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ç²—æš´ï¼Œå»ºç«‹è¿æ¥ç„¶åå‘æµé‡Œ writeObject ã€‚\nç„¶åè°ƒç”¨newCallæ–¹æ³•å»ºç«‹ä¸€ä¸ªè¿æ¥åˆ°å¯¹åº”çš„RMIæœåŠ¡ç«¯ï¼Œç„¶ååºåˆ—åŒ–è‡ªå·±çš„ä¸€äº›æ•°æ®ã€‚\nç„¶åå°†éœ€è¦bindçš„Nameå’Œå¯¹åº”çš„RemoteObjectå†™å…¥åˆ°out,ç„¶åæ‰§è¡Œref.invoke(call)æ–¹æ³•ã€‚\nåœ¨invokeæ–¹æ³•ä¸­è·Ÿè¿›executeCallæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºå½“å‰å®¢æˆ·ç«¯æ­£åœ¨å¤„ç†æœåŠ¡ç«¯è¿”å›å›æ¥çš„æ•°æ®\nè¯»å–çš„ç¬¬äºŒä¸ªå­—èŠ‚ä¼šç”¨äºä¸‹é¢çš„æµç¨‹åˆ¤æ–­ï¼Œå¦‚æœæ˜¯1çš„è¯é‚£ä¹ˆç›´æ¥returnï¼Œè€Œå¦‚æœæ˜¯2çš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¹è¿”å›å›æ¥çš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ”»å‡»ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæœåŠ¡ç«¯è¿”å›å›æ¥çš„åºåˆ—åŒ–æ•°æ®ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå®¢æˆ·ç«¯æ˜¯å¯ä»¥è¿›è¡Œååºåˆ—åŒ–çš„ï¼‰ã€‚\nè¿™é‡Œæ³¨æ„çš„æ˜¯ï¼šæ­£å¸¸æƒ…å†µreturnType = 1 ï¼Œç¨‹åºç›´æ¥è¿”å›ã€‚ é”™è¯¯çŠ¶æ€ä¸‹ï¼ŒretrunType = 2,è§¦å‘readObjectä»è€Œäº§ç”Ÿååºåˆ—åŒ–ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤è¿›è¡Œæ”»å‡»ï¼Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡å™¨è¿œç«¯æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¼ªè£…æœåŠ¡ç«¯è¿”å›æ¶æ„çš„æŠ¥é”™ä¿¡æ¯å°±å¯ä»¥è§¦å‘ååºåˆ—æ¼æ´ã€‚ ä»¥ä¸Šå°± Server ç«¯æ‰§è¡Œ bind æ–¹æ³•åè¿›è¡Œçš„æ“ä½œï¼Œä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œæ ¹æ® Registry çš„ host/port ç­‰ä¿¡æ¯åˆ›å»ºæœ¬åœ° RegistryImpl_Stubï¼Œç„¶åè°ƒç”¨å…¶ bind æ–¹æ³•å‘ Registry ç«¯ä½¿ç”¨ writeObject å†™å…¥ name å’Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚\nåœ¨ Registry ç«¯ï¼Œç”± sun.rmi.transport.tcp.TCPTransport#handleMessages æ¥å¤„ç†è¯·æ±‚ï¼Œè°ƒç”¨ serviceCall æ–¹æ³•å¤„ç†ã€‚\nserviceCall æ–¹æ³•ä¸­ä» ObjectTable ä¸­è·å–å°è£…çš„ Target å¯¹è±¡ï¼Œå¹¶è·å–å…¶ä¸­çš„å°è£…çš„ UnicastServerRef ä»¥åŠ RegistryImpl å¯¹è±¡ã€‚ç„¶åè°ƒç”¨ UnicastServerRef çš„ dispatch æ–¹æ³•\nUnicastServerRef çš„ dispatch æ–¹æ³•è°ƒç”¨ oldDispatch æ–¹æ³•ï¼Œè¿™é‡Œåˆ¤æ–­äº† skel æ˜¯å¦ä¸ºç©ºï¼Œç”¨æ¥åŒºåˆ«è‡ªå·±æ˜¯ Registry è¿˜æ˜¯ Serverã€‚\noldDispatch æ–¹æ³•è°ƒç”¨ this.skel ä¹Ÿå°±æ˜¯ RegistryImpl_Skel ç±»çš„ dispatch æ–¹æ³•ã€‚\nRegistryImpl_Skel çš„ dispatch æ–¹æ³•æ ¹æ®æµä¸­å†™å…¥çš„ä¸åŒçš„æ“ä½œç±»å‹åˆ†å‘ç»™ä¸åŒçš„æ–¹æ³•å¤„ç†ï¼Œä¾‹å¦‚ 0 ä»£è¡¨ç€ bind æ–¹æ³•ï¼Œåˆ™ä»æµä¸­è¯»å–å¯¹åº”çš„å†…å®¹ï¼Œååºåˆ—åŒ–ï¼Œç„¶åè°ƒç”¨ RegistryImpl çš„ bind æ–¹æ³•è¿›è¡Œç»‘å®šã€‚\nåœ¨Registryç«¯ï¼Œè°ƒç”¨RegistryImpl.bindæ–¹æ³•ï¼Œè¿™é‡Œè·å–æˆ‘ä»¬ä»Serveç«¯æ¥å—åˆ°çš„Nameå’ŒRemoteObjectã€‚\nRegistryImplä¼šå…ˆæ£€æŸ¥è‡ªå·±çš„bingdingsä¸­æ˜¯å¦æœ‰å½“å‰è¦ç»‘å®šçš„è¿œç¨‹å¯¹è±¡çš„åç§°ï¼Œå¦‚æœæœ‰çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯åˆ™å°†å½“å‰è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°RegistryImplçš„bindingså±æ€§ä¸­å»ã€‚\nä»¥ä¸Šå°±æ˜¯bindè¿‡ç¨‹æœåŠ¡å™¨ç«¯å’Œæ³¨å†Œç«¯çš„æ¥å—ä¿¡æ¯æµç¨‹ã€‚\næœåŠ¡è°ƒç”¨ Client ç«¯å‘ Registry ç«¯æŸ¥è¯¢å’Œè¯·æ±‚çš„è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯è·å– Registry çš„æµç¨‹ä¸ä¸Šé¢åˆ†æçš„æœåŠ¡ç«¯ä¸€è‡´ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚è¿˜æ˜¯é€šè¿‡è°ƒç”¨æœ¬åœ°åˆ›å»ºçš„ RegistryImpl_Stub å¯¹è±¡ã€‚\nåœ¨è°ƒç”¨å…¶ lookup æ–¹æ³•æ—¶ï¼Œä¼šå‘ Registry ç«¯ä¼ é€’åºåˆ—åŒ–çš„ name ï¼Œç„¶åå°† Registry ç«¯å›ä¼ çš„ç»“æœååºåˆ—åŒ–ã€‚\nè¿™é‡Œå…³æ³¨Registryç«¯çš„åšæ³•ï¼Œä¾æ—§æ˜¯ RegistryImpl_Skel çš„ dispatch æ–¹æ³•ï¼Œlookup æ–¹æ³•å¯¹åº”çš„å€¼opnumæ˜¯ 2 ï¼Œè°ƒç”¨ RegistryImpl çš„ lookup æ–¹æ³•ï¼Œç„¶åå°†æŸ¥è¯¢åˆ°çš„ç»“æœ writeObject åˆ°æµä¸­ã€‚\nlient æ‹¿åˆ° Registry ç«¯è¿”å›çš„åŠ¨æ€ä»£ç†å¯¹è±¡å¹¶ä¸”ååºåˆ—åŒ–åï¼Œå¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œè¿™çœ‹èµ·æ¥æ˜¯æœ¬åœ°è¿›è¡Œè°ƒç”¨ï¼Œä½†å®é™…ä¸Šæ˜¯åŠ¨æ€ä»£ç†çš„ RemoteObjectInvocationHandler å§”æ‰˜ RemoteRef çš„ invoke æ–¹æ³•è¿›è¡Œè¿œç¨‹é€šä¿¡ã€‚\nServer ç«¯ç”± UnicastServerRef çš„ dispatch æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¼šåœ¨ this.hashToMethod_Map ä¸­å¯»æ‰¾ Client ç«¯å¯¹åº”æ‰§è¡Œ Method çš„ hash å€¼ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™ä¼šååºåˆ—åŒ– Client ç«¯ä¼ æ¥çš„å‚æ•°ï¼Œå¹¶ä¸”é€šè¿‡åå°„è°ƒç”¨ã€‚\nè°ƒç”¨åå°†ç»“æœåºåˆ—åŒ–ä¼ è¾“ç»™ Client ç«¯ã€‚\nClient ç«¯æ¥å—ç»“æœè¿›è¡Œååºåˆ—åŒ–å¾—åˆ°Remote Methodæ‰§è¡Œåçš„ç»“æœï¼Œå®Œæˆæ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹ã€‚\næ€»ç»“ RMI åº•å±‚é€šè®¯é‡‡ç”¨äº†Stub (è¿è¡Œåœ¨å®¢æˆ·ç«¯) å’Œ Skeleton (è¿è¡Œåœ¨æœåŠ¡ç«¯) æœºåˆ¶ï¼ŒRMI è°ƒç”¨è¿œç¨‹æ–¹æ³•çš„å¤§è‡´å¦‚ä¸‹ï¼š\nRMI å®¢æˆ·ç«¯åœ¨è°ƒç”¨è¿œç¨‹æ–¹æ³•æ—¶ä¼šå…ˆåˆ›å»º Stub ( sun.rmi.registry.RegistryImpl_Stub )ã€‚ Stub ä¼šå°† Remote å¯¹è±¡ä¼ é€’ç»™è¿œç¨‹å¼•ç”¨å±‚ ( java.rmi.server.RemoteRef ) å¹¶åˆ›å»º java.rmi.server.RemoteCall( è¿œç¨‹è°ƒç”¨ )å¯¹è±¡ã€‚ RemoteCall åºåˆ—åŒ– RMI æœåŠ¡åç§°ã€Remote å¯¹è±¡ã€‚ RMI å®¢æˆ·ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ä¼ è¾“ RemoteCall åºåˆ—åŒ–åçš„è¯·æ±‚ä¿¡æ¯é€šè¿‡ Socket è¿æ¥çš„æ–¹å¼ä¼ è¾“åˆ° RMI æœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ã€‚ RMIæœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚( sun.rmi.server.UnicastServerRef )æ”¶åˆ°è¯·æ±‚ä¼šè¯·æ±‚ä¼ é€’ç»™ Skeleton ( sun.rmi.registry.RegistryImpl_Skel#dispatch )ã€‚ Skeleton è°ƒç”¨ RemoteCall ååºåˆ—åŒ– RMI å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„åºåˆ—åŒ–ã€‚ Skeleton å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼šbindã€listã€lookupã€rebindã€unbindï¼Œå¦‚æœæ˜¯ lookup åˆ™æŸ¥æ‰¾ RMI æœåŠ¡åç»‘å®šçš„æ¥å£å¯¹è±¡ï¼Œåºåˆ—åŒ–è¯¥å¯¹è±¡å¹¶é€šè¿‡ RemoteCall ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚ RMI å®¢æˆ·ç«¯ååºåˆ—åŒ–æœåŠ¡ç«¯ç»“æœï¼Œè·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ RMI å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼ŒRMIæœåŠ¡ç«¯åå°„è°ƒç”¨RMIæœåŠ¡å®ç°ç±»çš„å¯¹åº”æ–¹æ³•å¹¶åºåˆ—åŒ–æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ RMI å®¢æˆ·ç«¯ååºåˆ—åŒ– RMI è¿œç¨‹æ–¹æ³•è°ƒç”¨ç»“æœã€‚ ",
  "wordCount" : "5954",
  "inLanguage": "zh",
  "datePublished": "2023-03-10T19:17:17+08:00",
  "dateModified": "2023-03-10T19:17:17+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://reus09.github.io/posts/tech/java%E5%AE%89%E5%85%A8-rmi/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://reus09.github.io" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://reus09.github.io/search" title="æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://reus09.github.io/" title="ä¸»é¡µ">
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://reus09.github.io/posts" title="æ–‡ç« ">
                    <span>æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://reus09.github.io/tags" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://reus09.github.io/archives/" title="æ—¶é—´è½´">
                    <span>æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://reus09.github.io/about" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://reus09.github.io">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://reus09.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://reus09.github.io/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯</a></div>
    <h1 class="post-title">
      JAVAå®‰å…¨ RMI
    </h1>
    <div class="post-meta">&lt;span title=&#39;2023-03-10 19:17:17 &#43;0800 &#43;0800&#39;&gt;2023-03-10&lt;/span&gt;&amp;nbsp;Â·&amp;nbsp;12 åˆ†é’Ÿ&amp;nbsp;Â·&amp;nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#rmi%e4%bb%8b%e7%bb%8d" aria-label="RMIä»‹ç»">RMIä»‹ç»</a></li>
                    <li>
                        <a href="#rmi%e7%a4%ba%e4%be%8b" aria-label="RMIç¤ºä¾‹">RMIç¤ºä¾‹</a><ul>
                            
                    <li>
                        <a href="#server%e7%ab%af" aria-label="Serverç«¯">Serverç«¯</a></li>
                    <li>
                        <a href="#registry%e7%ab%af" aria-label="Registryç«¯">Registryç«¯</a><ul>
                            
                    <li>
                        <a href="#javarminaming" aria-label="java.rmi.Naming">java.rmi.Naming</a></li>
                    <li>
                        <a href="#javarmiregistry" aria-label="java.rmi.Registry">java.rmi.Registry</a></li></ul>
                    </li>
                    <li>
                        <a href="#client%e7%ab%af" aria-label="Clientç«¯">Clientç«¯</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="æºç åˆ†æ">æºç åˆ†æ</a><ul>
                            
                    <li>
                        <a href="#%e6%9c%8d%e5%8a%a1%e6%b3%a8%e5%86%8c" aria-label="æœåŠ¡æ³¨å†Œ">æœåŠ¡æ³¨å†Œ</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%9c%e7%a8%8b%e5%af%b9%e8%b1%a1%e5%88%9b%e5%bb%ba" aria-label="â‘ è¿œç¨‹å¯¹è±¡åˆ›å»º">â‘ è¿œç¨‹å¯¹è±¡åˆ›å»º</a></li>
                    <li>
                        <a href="#%e6%b3%a8%e5%86%8c%e4%b8%ad%e5%bf%83%e5%88%9b%e5%bb%ba" aria-label="â‘¡æ³¨å†Œä¸­å¿ƒåˆ›å»º">â‘¡æ³¨å†Œä¸­å¿ƒåˆ›å»º</a></li>
                    <li>
                        <a href="#%e6%9c%8d%e5%8a%a1%e6%b3%a8%e5%86%8c-1" aria-label="â‘¢æœåŠ¡æ³¨å†Œ">â‘¢æœåŠ¡æ³¨å†Œ</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0" aria-label="æœåŠ¡å‘ç°">æœåŠ¡å‘ç°</a></li>
                    <li>
                        <a href="#%e6%9c%8d%e5%8a%a1%e8%b0%83%e7%94%a8" aria-label="æœåŠ¡è°ƒç”¨">æœåŠ¡è°ƒç”¨</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><p>å®é™…ä¸Šï¼Œæ‡’ç‹—(xæœ¬äºº)å¥½ä¹…æ²¡å­¦ä¹ äº†ï¼Œä½†æ˜¯å€æ„Ÿå°±ä¸šå‹åŠ›å¦‚æ­¤ä¹‹å¤§ï¼Œæ­¤ç¯‡ç®€å•åˆ†æä¸€ä¸‹RMIçš„æµç¨‹ã€‚</p>
<h2 id="rmiä»‹ç»">RMIä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#rmiä»‹ç»">#</a></h2>
<p>RMI (Remote Method Invocation) è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä»–çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨æœ¬åœ°é€æ˜çš„è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚</p>
<p>è¿™ç§æ€æƒ³åœ¨ C è¯­è¨€ä¸­çš„ RPCï¼ˆRemote Procedure Callsï¼‰ä¸­æ—©å°±æœ‰äº†ä½“ç°ï¼Œä½†æ˜¯ RPC æ˜¯æ‰“åŒ…å’Œä¼ é€æ•°æ®ç»“æ„ï¼Œè€Œåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼ é€’ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ—¢åŒ…å«æ•°æ®ï¼Œä¹ŸåŒ…å«æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ŒJava ä¸­å¦‚æœæƒ³å®Œæ•´çš„åœ¨ç½‘ç»œä¸­å‘è¿œç¨‹ä½ç½®ä¼ è¾“ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„æ–¹æ³•æ˜¯ Java åŸç”Ÿååºåˆ—åŒ–ï¼Œå¹¶ä¸”å¯ä»¥ç»“åˆåŠ¨æ€ç±»åŠ è½½å’Œå®‰å…¨ç®¡ç†å™¨æ¥å®‰å…¨çš„ä¼ è¾“ä¸€ä¸ª Java ç±»ã€‚</p>
<p>è€Œå…·ä½“çš„å®ç°æ€æƒ³å°±æ˜¯è®©æˆ‘ä»¬è·å–è¿œç¨‹ä¸»æœºä¸Šå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œä½†å®é™…æ–¹æ³•çš„æ‰§è¡Œåœ¨è¿œç¨‹ä½ç½®ä¸Šã€‚</p>
<p>RMIå¼•å…¥äº†ä¸¤ä¸ªæ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ Stubï¼ˆå®¢æˆ·ç«¯å­˜æ ¹ï¼‰ ä»¥åŠ Skeletonï¼ˆæœåŠ¡ç«¯éª¨æ¶ï¼‰ã€‚å½“ä¸€ä¸ªå®¢æˆ·ç«¯(Client)å»è®¿é—®è¿œç¨‹ä¸€ä¸ªObjectçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å…ˆè®¿é—®æœ¬åœ°çš„ä¸€ä¸ªä»£ç†ç±»(Stub),ç„¶åè®¿é—®è¿œç«¯çš„Objectçš„ä»£ç†(Skeleton),å®ƒä» Stub ä¸­æ¥æ”¶è¿œç¨‹æ–¹æ³•è°ƒç”¨å¹¶ä¼ é€’ç»™çœŸå®çš„ç›®æ ‡ç±»,è¿™é‡Œå…ˆç®€å•åˆ—ä¸€ä¸‹æ•´ä½“è°ƒç”¨æ—¶åºå›¾ï¼Œåé¢ä¼šè¯¦ç»†è¿›è¡Œå±•å¼€è¯´ï¼š</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image1633059061409.png" alt="img"  />
</p>
<p>RMIä¹Ÿæä¾›äº†åŠ¨æ€åŠ è½½ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è°ƒç”¨æ—¶ï¼Œä¼ é€’äº†ä¸€ä¸ªå¯åºåˆ—åŒ–å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨æœåŠ¡ç«¯ä¸å­˜åœ¨ï¼Œåˆ™åœ¨æœåŠ¡ç«¯ä¼šæŠ›å‡º ClassNotFound çš„å¼‚å¸¸ï¼Œä½†æ˜¯ RMI æ”¯æŒåŠ¨æ€ç±»åŠ è½½ï¼Œå¦‚æœè®¾ç½®äº† <code>java.rmi.server.codebase</code>ï¼Œåˆ™ä¼šå°è¯•ä»å…¶ä¸­çš„åœ°å€è·å– <code>.class</code> å¹¶åŠ è½½åŠååºåˆ—åŒ–ã€‚å¯ä½¿ç”¨ <code>System.setProperty(&quot;java.rmi.server.codebase&quot;, &quot;http://127.0.0.1:9999/&quot;);</code> è¿›è¡Œè®¾ç½®ï¼Œæˆ–ä½¿ç”¨å¯åŠ¨å‚æ•° <code>-Djava.rmi.server.codebase=&quot;http://127.0.0.1:9999/&quot;</code> è¿›è¡ŒæŒ‡å®šã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å®‰å…¨ç­–ç•¥çš„è®¾ç½®ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ç½‘ç»œåŠ è½½å¤–éƒ¨ç±»å¹¶æ‰§è¡Œæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå®‰å…¨ç®¡ç†å™¨æ¥è¿›è¡Œç®¡ç†ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å®‰å…¨ç®¡ç†ï¼Œåˆ™ RMI ä¸ä¼šåŠ¨æ€åŠ è½½ä»»ä½•ç±»ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (System.<span style="color:#a6e22e">getSecurityManager</span>() <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#a6e22e">setSecurityManager</span>(<span style="color:#66d9ef">new</span> RMISecurityManager());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®¡ç†å™¨åº”ä¸ç®¡ç†ç­–ç•¥ç›¸è¾…ç›¸æˆï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªç­–ç•¥æ–‡ä»¶ï¼Œé‡Œé¢é…ç½®å…è®¸é‚£äº›ä¸»æœºè¿›è¡Œå“ªäº›æ“ä½œï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œç›´æ¥è®¾ç½®å…¨éƒ¨æƒé™ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zed" data-lang="zed"><span style="display:flex;"><span>grant {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">permission</span> java.security.AllPermission;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·å¯ä»¥ä½¿ç”¨ <code>-Djava.security.policy=rmi.policy</code> æˆ– <code>System.setProperty(&quot;java.security.policy&quot;, RemoteServer.class.getClassLoader().getResource(&quot;rmi.policy&quot;).toString());</code> æ¥è¿›è¡Œè®¾ç½®ã€‚</p>
<h2 id="rmiç¤ºä¾‹">RMIç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#rmiç¤ºä¾‹">#</a></h2>
<h3 id="serverç«¯">Serverç«¯<a hidden class="anchor" aria-hidden="true" href="#serverç«¯">#</a></h3>
<p>é¦–å…ˆè¦å®šä¹‰ä¸€ä¸ªæœŸæœ›èƒ½å¤Ÿè¿œç¨‹è°ƒç”¨çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å¿…é¡»æ‰©å±•<code>java.rmi.Remote</code>æ¥å£ã€‚è¿™ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»å£°æ˜æŠ›å‡º<code>java.rmi.RemoteException</code>ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">RemoteInterface</span> <span style="color:#66d9ef">extends</span> Remote {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span>() <span style="color:#66d9ef">throws</span> RemoteException;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span>(Object obj) <span style="color:#66d9ef">throws</span>  RemoteException;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayGoodBye</span>() <span style="color:#66d9ef">throws</span> RemoteException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè¿™ä¸ªè¿œç¨‹æ¥å£çš„å®ç°ç±»ï¼Œè¿™ä¸ªç±»ä¸­æ˜¯çœŸæ­£çš„é€»è¾‘ä»£ç ï¼Œé€šå¸¸ä¼šæ‰©å±•<code>java.rmi.server.UnicastRemoteObject</code>ç±»ï¼Œæ‰©å±•æ­¤ç±»åï¼ŒRMI ä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±» export ç»™è¿œç¨‹æƒ³è¦è°ƒç”¨å®ƒçš„ Client ç«¯ï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›åŸºç¡€çš„ <code>equals/hashcode/toString</code> æ–¹æ³•ã€‚è¿™é‡Œå¿…é¡»ä¸ºè¿™ä¸ªå®ç°ç±»æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°å¹¶ä¸”æŠ›å‡º RemoteExceptionã€‚</p>
<p>åœ¨ export æ—¶ï¼Œä¼šéšæœºç»‘å®šä¸€ä¸ªç«¯å£ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰€ä»¥å³ä½¿ä¸æ³¨å†Œï¼Œç›´æ¥è¯·æ±‚è¿™ä¸ªç«¯å£ä¹Ÿå¯ä»¥é€šä¿¡ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RemoteObject</span> <span style="color:#66d9ef">extends</span> UnicastRemoteObject <span style="color:#66d9ef">implements</span>  RemoteInterface {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#a6e22e">RemoteObject</span>() <span style="color:#66d9ef">throws</span> RemoteException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span>() <span style="color:#66d9ef">throws</span> RemoteException {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello My Friend&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span>(Object obj) <span style="color:#66d9ef">throws</span> RemoteException {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> obj.<span style="color:#a6e22e">getClass</span>().<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayGoodBye</span>() <span style="color:#66d9ef">throws</span> RemoteException {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Bye My Friend&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¸æƒ³è®©è¿œç¨‹å¯¹è±¡æˆä¸º UnicastRemoteObject çš„å­ç±»ï¼Œåé¢å°±éœ€è¦ä¸»åŠ¨çš„ä½¿ç”¨å…¶é™æ€æ–¹æ³• <code>exportObject</code> æ¥æ‰‹åŠ¨ export å¯¹è±¡ã€‚</p>
<h3 id="registryç«¯">Registryç«¯<a hidden class="anchor" aria-hidden="true" href="#registryç«¯">#</a></h3>
<p>ä¸Šè¿°ï¼Œå¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„å¯¹è±¡åˆ›å»ºå®Œæ¯•ã€‚ä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼ŒJava RMIè®¾è®¡äº†ä¸€ä¸ªRegistryçš„æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨æ¥æŸ¥æ‰¾ä¸€ä¸ªè¿œç«¯å¯¹è±¡çš„è°ƒç”¨ã€‚æˆ‘ä»¬æƒ³ä»æŸä¸ªäººè·å–ä¿¡æ¯(Remote Method Invocation)ï¼Œæˆ‘ä»¬åœ¨ç”µè¯æœ¬(Registry)æŸ¥æ‰¾è¿™ä¸ªäººçš„å§“å(Name)ä»è€Œæ‰¾åˆ°è¿™ä¸ªäººçš„ç”µè¯å·ç (Reference)ï¼Œæœ€åé€šè¿‡è¿™ä¸ªå·ç æ‰¾åˆ°è¯¥äºº(Remote Object)ã€‚</p>
<p>è¿™ç§æ€æƒ³ç”±<code>java.rmi.Registry</code>å’Œ<code>java.rmi.Naming</code>å®ç°ã€‚</p>
<h4 id="javarminaming">java.rmi.Naming<a hidden class="anchor" aria-hidden="true" href="#javarminaming">#</a></h4>
<p>å…ˆæ¥è¯´è¯´ <code>java.rmi.Naming</code>ï¼Œè¿™æ˜¯ä¸€ä¸ª final ç±»ï¼Œæä¾›äº†åœ¨è¿œç¨‹å¯¹è±¡æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰ä¸­å­˜å‚¨å’Œè·å–è¿œç¨‹å¯¹è±¡å¼•ç”¨çš„æ–¹æ³•ï¼Œè¿™ä¸ªç±»æä¾›çš„æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª URL æ ¼å¼çš„å‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<code> //host:port/name</code>ï¼š</p>
<ul>
<li>host è¡¨ç¤ºæ³¨å†Œè¡¨æ‰€åœ¨çš„ä¸»æœº</li>
<li>port è¡¨ç¤ºæ³¨å†Œè¡¨æ¥å—è°ƒç”¨çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 1099</li>
<li>name è¡¨ç¤ºä¸€ä¸ªæ³¨å†Œ Remote Object çš„å¼•ç”¨çš„åç§°ï¼Œä¸èƒ½æ˜¯æ³¨å†Œè¡¨ä¸­çš„ä¸€äº›å…³é”®å­—</li>
</ul>
<p>Naming æä¾›äº†æŸ¥è¯¢ï¼ˆlookupï¼‰ã€ç»‘å®šï¼ˆbindï¼‰ã€é‡æ–°ç»‘å®šï¼ˆrebindï¼‰ã€æ¥è§¦ç»‘å®šï¼ˆunbindï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ç”¨æ¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒNaming æ˜¯ä¸€ä¸ªç”¨æ¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œçš„ç±»ã€‚</p>
<h4 id="javarmiregistry">java.rmi.Registry<a hidden class="anchor" aria-hidden="true" href="#javarmiregistry">#</a></h4>
<p>ä¸Šè¿°<code>Naming</code>æä¾›çš„æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œå…¶å®æ˜¯è°ƒç”¨ <code>LocateRegistry.getRegistry</code> æ–¹æ³•è·å–äº† Registry æ¥å£çš„å®ç°ç±»ï¼Œå¹¶è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•è¿›è¡Œå®ç°çš„ã€‚</p>
<p>é‚£å°±è¯´åˆ°äº† <code>java.rmi.registry.Registry</code> æ¥å£ï¼Œè¿™ä¸ªæ¥å£åœ¨ RMI ä¸‹æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ RegistryImpl ä»¥åŠ RegistryImpl_Stubï¼Œå…·ä½“ä¹Ÿæ”¾é¢åé¢æ¥è¯´ã€‚</p>
<p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>LocateRegistry#createRegistry()</code> æ–¹æ³•æ¥åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Registry</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String args<span style="color:#f92672">[]</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			LocateRegistry.<span style="color:#a6e22e">createRegistry</span>(1099);
</span></span><span style="display:flex;"><span>			System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server Start&#34;</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®šï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RemoteServer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> RemoteException, MalformedURLException, AlreadyBoundException, InterruptedException {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// åˆ›å»ºè¿œç¨‹å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>		RemoteInterface remoteObject <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RemoteObject();
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// ç»‘å®š</span>
</span></span><span style="display:flex;"><span>		Naming.<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#34;rmi://localhost:1099/Hello&#34;</span>, remoteObject);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="clientç«¯">Clientç«¯<a hidden class="anchor" aria-hidden="true" href="#clientç«¯">#</a></h3>
<p>å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨ï¼Œé€šè¿‡<code>Registry</code>æŸ¥æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å³å¯ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RMIClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> RemoteException, NotBoundException {
</span></span><span style="display:flex;"><span>        Registry registry <span style="color:#f92672">=</span> LocateRegistry.<span style="color:#a6e22e">getRegistry</span>(1099);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(Arrays.<span style="color:#a6e22e">toString</span>(registry.<span style="color:#a6e22e">list</span>()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// lookup and call</span>
</span></span><span style="display:flex;"><span>        RemoteInterface stub <span style="color:#f92672">=</span> (RemoteInterface) registry.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#34;Hello&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(stub.<span style="color:#a6e22e">sayHello</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(stub.<span style="color:#a6e22e">sayHello</span>(<span style="color:#66d9ef">new</span> String()));
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(stub.<span style="color:#a6e22e">sayGoodBye</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ RemoteInterface æ¥å£åœ¨ Client/Server/Registry å‡åº”è¯¥å­˜åœ¨ï¼Œåªä¸è¿‡é€šå¸¸ Registry ä¸ Server é€šå¸¸åœ¨åŒä¸€ç«¯ä¸Šã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310195425570.png" alt="image-20230310195425570"  />
</p>
<h2 id="æºç åˆ†æ">æºç åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#æºç åˆ†æ">#</a></h2>
<h3 id="æœåŠ¡æ³¨å†Œ">æœåŠ¡æ³¨å†Œ<a hidden class="anchor" aria-hidden="true" href="#æœåŠ¡æ³¨å†Œ">#</a></h3>
<h4 id="è¿œç¨‹å¯¹è±¡åˆ›å»º">â‘ è¿œç¨‹å¯¹è±¡åˆ›å»º<a hidden class="anchor" aria-hidden="true" href="#è¿œç¨‹å¯¹è±¡åˆ›å»º">#</a></h4>
<p>æ ¹æ®æˆ‘ä»¬ç›´æ¥åˆ›å»ºçš„demo,æˆ‘ä»¬åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡:<code>RemoteInterface remoteObject = new RemoteObject();</code>ï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿äº†<code>UnicastRemoteObject</code>ï¼Œè¿™ä¸ªç±»ä½¿ç”¨JRMPåè®®exportè¿œç¨‹å¯¹è±¡ï¼Œåœ¨æœåŠ¡å™¨ç«¯è·å–ä¸æ³¨å†Œç«¯è¿›è¡Œé€šä¿¡çš„<code>Stub</code>ã€‚</p>
<p>åœ¨<code>UnicastRemoteObject</code>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<code>UnicastServerRef </code>ï¼Œç„¶ååˆ¤æ–­æˆ‘ä»¬ä¼ å…¥çš„<code>remoteObject</code>æ˜¯å¦ç»§æ‰¿äº†<code>UnicastRemoteObject</code>ï¼Œæœ€åè°ƒç”¨<code>UnicastServerRef</code>çš„<code>exportObject</code>æ–¹æ³•æ¥exportæˆ‘ä»¬åˆ›å»ºçš„<code>remoteObject</code>è¿™ä¸ªè¿œç¨‹å¯¹è±¡ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310202734566.png" alt="image-20230310202734566"  />
</p>
<p>åœ¨<code>sref.exportObject</code>æ–¹æ³•ä¸­ï¼Œå®ç°äº†Exportæˆ‘ä»¬çš„è¿œç¨‹å¯¹è±¡ï¼Œç„¶ååˆ›å»º<code>stub</code>ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310203027144.png" alt="image-20230310203027144"  />
</p>
<p>ä½¿ç”¨ <code>sun.rmi.server.Util#createProxy()</code> å¦‚ä¸‹ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310204040761.png" alt="image-20230310204040761"  />
</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯è°ƒç”¨<code>stubClassExists</code>æ–¹æ³•æ—¶ï¼Œæ­¤æ—¶ç±»ä¸­æ²¡æœ‰<code>remoteClass.getName()+&quot;_Stub&quot;</code>çš„ç±»ï¼Œæ‰€ä»¥è¿”å›ä¸º<code>false</code>ã€‚é€€å‡ºåˆ¤æ–­è¯­å¥ï¼Œç„¶åä½¿ç”¨RemoteObjectInvocationHandler æ¥ä¸ºæˆ‘ä»¬æµ‹è¯•å†™çš„ RemoteObject å®ç°çš„ <code>RemoteInterface </code>æ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310204425126.png" alt="image-20230310204425126"  />
</p>
<p>åˆ›å»º<code>stub</code>å®Œæ¯•å,æˆ‘ä»¬çš„<code>stub</code>æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å‹ï¼Œå¹¶æ²¡æœ‰ç»§æ‰¿<code>RemoteStub</code>ç±»ï¼Œå› æ­¤å¯ä»¥è·³è¿‡ã€‚æ¥ç€åˆ›å»º <code>sun.rmi.transport.Target</code> å¯¹è±¡ï¼Œä½¿ç”¨è¿™ä¸ª Target å¯¹è±¡å°è£…äº†æˆ‘ä»¬è¿œç¨‹æ‰§è¡Œæ–¹æ³•å’Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ï¼ˆStubï¼‰ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310204937299.png" alt="image-20230310204937299"  />
</p>
<p>å¹¶è°ƒç”¨<code>LiveRef#exportObject</code>ï¼Œç»è¿‡å±‚å±‚è°ƒç”¨ï¼Œæœ€åè°ƒç”¨<code>sun.rmi.transport.tcp.TCPTransport#exportObject</code>æ¥ç›‘å¬æœ¬åœ°ç«¯å£ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310205157040.png" alt="image-20230310205157040"  />
</p>
<p>ç„¶åè°ƒç”¨<code>sun.rmi.transport.Transport#exportObject</code>æ–¹æ³•å°† Target å®ä¾‹æ³¨å†Œåˆ° ObjectTable ä¸­ã€‚<code>ObjectTable</code> ç”¨æ¥ç®¡ç†æ‰€æœ‰å‘å¸ƒçš„æœåŠ¡å®ä¾‹ Targetï¼ŒObjectTable æä¾›äº†æ ¹æ®<code>ObjectEndpoint</code>å’Œ <code>Remote </code>å®ä¾‹ä¸¤ç§æ–¹å¼æŸ¥æ‰¾ Target çš„æ–¹æ³•ï¼ˆä¸åŒå‚æ•°çš„ getTarget æ–¹æ³•ï¼‰ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310205421052.png" alt="image-20230310205421052"  />
</p>
<p>è¿™é‡Œå€Ÿç”¨su18å¸ˆå‚…ï¼Œæ€»ç»“ä¸ºä¸€å¼ å›¾ï¼š</p>
<p><img loading="lazy" src="https://su18.org/post-images/1633142606521.png" alt="img"  />
</p>
<p>Stubæ˜¯é€šè¿‡<code>RemoteObjectInvocationHandler</code> æ¥å®ç°ä¼ è¾“çš„ä¿¡æ¯æ¥å—å’Œååºåˆ—åŒ–æ‰§è¡Œã€‚è¿™ä¸ªåŠ¨æ€ä»£ç†ç»§æ‰¿ RemoteObject å®ç° InvocationHandlerï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ã€å¯ä½¿ç”¨ RMI è¿œç¨‹ä¼ è¾“çš„åŠ¨æ€ä»£ç†ç±»ã€‚æ—¢ç„¶æ˜¯åŠ¨æ€ä»£ç†ç±»ï¼Œè‡ªç„¶é‡ç‚¹å…³æ³¨ invoke æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæ˜¯å£°æ˜ç±»ä¸º Object çš„æ–¹æ³•ä¼šè°ƒç”¨ <code>invokeObjectMethod</code> æ–¹æ³•ï¼Œå…¶ä»–çš„åˆ™è°ƒç”¨ <code>invokeRemoteMethod</code> æ–¹æ³•ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310210117106.png" alt="image-20230310210117106"  />
</p>
<p><code>invokeRemoteMethod</code> ä¸­å®é™…æ˜¯å§”æ‰˜ RemoteRef çš„å­ç±» UnicastRef çš„ invoke æ–¹æ³•æ‰§è¡Œä»£ç†è°ƒç”¨ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310210243718.png" alt="image-20230310210243718"  />
</p>
<p>UnicastRef çš„ invoke æ–¹æ³•æ˜¯ä¸€ä¸ªå»ºç«‹è¿æ¥ï¼Œæ‰§è¡Œè°ƒç”¨ï¼Œå¹¶è¯»å–ç»“æœå¹¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚è¿™é‡Œï¼ŒUnicastRef åŒ…å«å±æ€§ LiveRef ï¼ŒLiveRef ç±»ä¸­çš„ Endpointã€Channel å°è£…äº†ä¸ç½‘ç»œé€šä¿¡ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310210544058.png" alt="image-20230310210544058"  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310210609040.png" alt="image-20230310210609040"  />
</p>
<p>ååºåˆ—åŒ–æ–¹æ³•åœ¨ <code>unmarshalValue</code> ä¸­ï¼Œåˆ¤æ–­<code>type</code>ä¹‹åï¼Œå°±å°†ç±»ååºåˆ—åŒ–ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310210737644.png" alt="image-20230310210737644"  />
</p>
<h4 id="æ³¨å†Œä¸­å¿ƒåˆ›å»º">â‘¡æ³¨å†Œä¸­å¿ƒåˆ›å»º<a hidden class="anchor" aria-hidden="true" href="#æ³¨å†Œä¸­å¿ƒåˆ›å»º">#</a></h4>
<p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>LocateRegistry.createRegistry(1099);</code> æ¥åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼Œ</p>
<p>é¦–å…ˆæ˜¯å¯ä»¥çœ‹åˆ° createRegistry æ–¹æ³•å®é™… new äº†ä¸€ä¸ª<code>RegistryImpl</code>å¯¹è±¡ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310211102448.png" alt="image-20230310211102448"  />
</p>
<p>RegistryImpl çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»º LiveRef å¯¹è±¡ï¼Œç„¶ååˆ›å»º UnicastServerRef å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ <code>setup</code> è¿›è¡Œé…ç½®ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310211225992.png" alt="image-20230310211225992"  />
</p>
<p>åœ¨ <code>setup</code> æ–¹æ³•ä¸­ï¼Œä¾æ—§æ˜¯ä½¿ç”¨ <code>UnicastServerRef </code>çš„ exportObject æ–¹æ³• export å¯¹è±¡ï¼Œåªä¸è¿‡è¿™æ¬¡ export çš„æ˜¯ RegistryImpl è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310211310947.png" alt="image-20230310211310947"  />
</p>
<p>åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼Œåœ¨<code>createProxy</code>æ–¹æ³•é‡Œå¯¹è¿œç¨‹å¯¹è±¡ä½¿ç”¨ RemoteObjectInvocationHandler åˆ›å»ºåŠ¨æ€ä»£ç†å‰ï¼Œæœ‰ä¸€ä¸ª<code>stubClassExists</code>çš„åˆ¤æ–­ï¼Œå¦‚æœéœ€è¦åˆ›å»ºä»£ç†çš„ç±»åœ¨æœ¬åœ°æœ‰ <code>_Stub</code> çš„ç±»ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ createStub æ–¹æ³•åå°„è°ƒç”¨ stub ç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºç±»å®ä¾‹ã€‚RMIæ°å¥½å®ç°äº†<code>RegistryImpl_Stub</code>è¿™ä¸ªç±»çš„å®ç°ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310211649307.png" alt="image-20230310211649307"  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310211858029.png" alt="image-20230310211858029"  />
</p>
<p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„stubå·²ç»è¢«å®ä¾‹åŒ–ä¸º<code>RegistryImpl_Stub</code>,ç„¶åè¯¥ç±»ç»§æ‰¿äº†<code>RemoteStub</code>ç±»</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310212022106.png" alt="image-20230310212022106"  />
</p>
<p>å› æ­¤æ¥ä¸‹æ¥ä¼šè°ƒç”¨ <code>setSkeleton </code>æ–¹æ³•ï¼Œé‡Œé¢å°±æ˜¯è·Ÿåˆ¤æ–­<code>RegistryImpl_Stub</code>æ˜¯å¦å­˜åœ¨çš„æµç¨‹ï¼Œç»§ç»­åˆ¤æ–­<code>RegistryImpl_Skel</code>ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310212135344.png" alt="image-20230310212135344"  />
</p>
<p>è°ƒç”¨ <code>Util.createSkeleton()</code> æ–¹æ³•åˆ›å»º skeletonã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310212414149.png" alt="image-20230310212414149"  />
</p>
<p>RegistryImpl_Skel ç±»æä¾›äº† dispatch æ–¹æ³•æ¥åˆ†å‘å…·ä½“çš„æ“ä½œã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310212604511.png" alt="image-20230310212604511"  />
</p>
<p>åç»­çš„ export æµç¨‹ç›¸åŒã€‚</p>
<p>æ³¨å†Œä¸­å¿ƒä¸è¿œç¨‹æœåŠ¡å¯¹è±¡æ³¨å†Œçš„å¤§éƒ¨åˆ†æµç¨‹ç›¸åŒï¼Œå·®å¼‚åœ¨ï¼š</p>
<ul>
<li>è¿œç¨‹æœåŠ¡å¯¹è±¡ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œinvoke æ–¹æ³•æœ€ç»ˆè°ƒç”¨ UnicastRef çš„ invoke æ–¹æ³•ï¼Œæ³¨å†Œä¸­å¿ƒä½¿ç”¨<code> RegistryImpl_Stub</code>ï¼ŒåŒæ—¶è¿˜åˆ›å»ºäº†<code> RegistryImpl_Skel</code></li>
<li>è¿œç¨‹å¯¹è±¡é»˜è®¤éšæœºç«¯å£ï¼Œæ³¨å†Œä¸­å¿ƒé»˜è®¤æ˜¯ 1099ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šï¼‰</li>
</ul>
<h4 id="æœåŠ¡æ³¨å†Œ-1">â‘¢æœåŠ¡æ³¨å†Œ<a hidden class="anchor" aria-hidden="true" href="#æœåŠ¡æ³¨å†Œ-1">#</a></h4>
<p>æ³¨å†Œå…¶å®å°±æ˜¯ bind çš„è¿‡ç¨‹ã€‚</p>
<p>å¦‚æœ Server ç«¯å’Œ Registry åœ¨åŒä¸€ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨Registry çš„ bind æ–¹æ³•è¿›è¡Œç»‘å®šï¼Œå…·ä½“å®ç°åœ¨ <code>RegistryImpl </code>çš„ bind æ–¹æ³•ï¼Œå°±æ˜¯å°† Remote å¯¹è±¡å’Œåç§° String æ”¾åœ¨æˆå‘˜å˜é‡<code> bindings ä¸­</code>ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>Hashtable</code>å¯¹è±¡ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310212932851.png" alt="image-20230310212932851"  />
</p>
<p>å¦‚æœ Server ç«¯å’Œ Registry ç«¯ä¸åœ¨ä¸€èµ·ï¼Œé‚£æˆ‘ä»¬éœ€è¦å…ˆè·å– Registry å¯¹è±¡ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Naming æˆ–è€… LocateRegistry éƒ½æ˜¯è°ƒç”¨ <code>LocateRegistry.getRegistry()</code> æ–¹æ³•æ¥åˆ›å»º <code>RegistryImpl_Stub</code>ï¼Œè¿™éƒ¨åˆ†çš„åˆ›å»ºè¿‡ç¨‹ä¸æ³¨å†Œä¸­å¿ƒæ³¨å†Œæ—¶çš„è¿‡ç¨‹æ˜¯ä¸€è‡´çš„ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230310213255500.png" alt="image-20230310213255500"  />
</p>
<h3 id="æœåŠ¡å‘ç°">æœåŠ¡å‘ç°<a hidden class="anchor" aria-hidden="true" href="#æœåŠ¡å‘ç°">#</a></h3>
<p>è·å–æ³¨å†Œä¸­å¿ƒå¹¶å¯¹å…¶è¿›è¡Œæ“ä½œçš„è¿‡ç¨‹ï¼Œè¿™é‡Œé¢åŒ…å« Server ç«¯å’Œ Client ç«¯ä¸¤ç§ã€‚</p>
<p>å¦‚æœ Server ç«¯å’Œ Registry åœ¨åŒä¸€ç«¯ï¼Œé‚£å¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨åˆ›å»º Registry æ—¶ä½¿ç”¨çš„ RegistryImplï¼Œ ç›´æ¥è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•ï¼Œè¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p>
<p>å¦‚æœ Server ç«¯å’Œ Registry ä¸åŒç«¯ï¼Œåˆ™åœ¨ Server ç«¯æˆ– Client ç«¯ä½¿ç”¨ <code>LocateRegistry.getRegistry()</code> æ–¹æ³•è·å–æ³¨å†Œä¸­å¿ƒæ—¶éƒ½æ˜¯ä¸€æ ·çš„æµç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆåœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«äº†å…·ä½“é€šä¿¡åœ°å€ã€ç«¯å£çš„ RegistryImpl_Stub å¯¹è±¡</li>
<li>é€šè¿‡è°ƒç”¨è¿™ä¸ªæœ¬åœ°çš„ RegistryImpl_Stub å¯¹è±¡çš„ bind/list&hellip; ç­‰æ–¹æ³•ï¼Œæ¥ä¸ Registry ç«¯è¿›è¡Œé€šä¿¡</li>
<li>è€Œ <code>RegistryImpl_Stub</code> çš„æ¯ä¸ªæ–¹æ³•ï¼Œéƒ½å®é™…ä¸Šè°ƒç”¨äº†<code>RemoteRef</code>çš„ invoke æ–¹æ³•ï¼Œè¿›è¡Œäº†ä¸€æ¬¡è¿œç¨‹è°ƒç”¨é“¾æ¥</li>
<li>è¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨ java åŸç”Ÿåºåˆ—åŒ–åŠååºåˆ—åŒ–æ¥å®ç°</li>
</ul>
<p>è·å–äº†æ³¨å†Œä¸­å¿ƒåï¼Œå¦‚æœæ˜¯ Server ç«¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ³¨å†Œä¸­å¿ƒä¸Šç»‘å®šï¼ˆbindï¼‰æˆ‘ä»¬çš„æœåŠ¡ï¼Œå¦‚æœæ˜¯ Client ç«¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ³¨å†Œä¸­å¿ƒéå†ï¼ˆlistï¼‰ã€æŸ¥æ‰¾ï¼ˆlookupï¼‰å’Œè°ƒç”¨æœåŠ¡ï¼ŒæŸ¥æ‰¾çš„é€»è¾‘æˆ‘ä»¬æ”¾åœ¨ä¸‹ä¸€éƒ¨åˆ†æœåŠ¡è°ƒç”¨æ¥è¯´ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ç»‘å®šçš„è¿‡ç¨‹ã€‚</p>
<p>å¯¹äº Server ç«¯å‘æ³¨å†Œä¸­å¿ƒä¸Šç»‘å®šï¼ˆbindï¼‰æ¥è¯´ï¼Œæ— è®ºæ˜¯ Registry è¿˜æ˜¯ Naming çš„ <code>bind</code> æ–¹æ³•ï¼Œå®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨ Server ç«¯ç”Ÿæˆçš„æœ¬åœ° RegistryImpl_Stub çš„ <code>bind</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ç²—æš´ï¼Œå»ºç«‹è¿æ¥ç„¶åå‘æµé‡Œ writeObject ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311143125558.png" alt="image-20230311143125558"  />
</p>
<p>ç„¶åè°ƒç”¨newCallæ–¹æ³•å»ºç«‹ä¸€ä¸ªè¿æ¥åˆ°å¯¹åº”çš„RMIæœåŠ¡ç«¯ï¼Œç„¶ååºåˆ—åŒ–è‡ªå·±çš„ä¸€äº›æ•°æ®ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311143643607.png" alt="image-20230311143643607"  />
</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311143707192.png" alt="image-20230311143707192"  />
</p>
<p>ç„¶åå°†éœ€è¦bindçš„Nameå’Œå¯¹åº”çš„RemoteObjectå†™å…¥åˆ°out,ç„¶åæ‰§è¡Œ<code>ref.invoke(call)æ–¹æ³•</code>ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311143847714.png" alt="image-20230311143847714"  />
</p>
<p>åœ¨<code>invoke</code>æ–¹æ³•ä¸­è·Ÿè¿›<code>executeCall</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºå½“å‰å®¢æˆ·ç«¯æ­£åœ¨å¤„ç†æœåŠ¡ç«¯è¿”å›å›æ¥çš„æ•°æ®</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311144409366.png" alt="image-20230311144409366"  />
</p>
<p>è¯»å–çš„ç¬¬äºŒä¸ªå­—èŠ‚ä¼šç”¨äºä¸‹é¢çš„æµç¨‹åˆ¤æ–­ï¼Œå¦‚æœæ˜¯1çš„è¯é‚£ä¹ˆç›´æ¥returnï¼Œè€Œå¦‚æœæ˜¯2çš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¹è¿”å›å›æ¥çš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ”»å‡»ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæœåŠ¡ç«¯è¿”å›å›æ¥çš„åºåˆ—åŒ–æ•°æ®ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå®¢æˆ·ç«¯æ˜¯å¯ä»¥è¿›è¡Œååºåˆ—åŒ–çš„ï¼‰ã€‚</p>
<ul>
<li>è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼šæ­£å¸¸æƒ…å†µ<code>returnType = 1 </code> ï¼Œç¨‹åºç›´æ¥è¿”å›ã€‚</li>
<li>é”™è¯¯çŠ¶æ€ä¸‹ï¼Œ<code>retrunType = 2</code>,è§¦å‘<code>readObject</code>ä»è€Œäº§ç”Ÿååºåˆ—åŒ–ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤è¿›è¡Œæ”»å‡»ï¼Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡å™¨è¿œç«¯æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¼ªè£…æœåŠ¡ç«¯è¿”å›æ¶æ„çš„æŠ¥é”™ä¿¡æ¯å°±å¯ä»¥è§¦å‘ååºåˆ—æ¼æ´ã€‚</li>
</ul>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311144621982.png" alt="image-20230311144621982"  />
</p>
<p>ä»¥ä¸Šå°± Server ç«¯æ‰§è¡Œ bind æ–¹æ³•åè¿›è¡Œçš„æ“ä½œï¼Œä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œæ ¹æ® Registry çš„ host/port ç­‰ä¿¡æ¯åˆ›å»ºæœ¬åœ° RegistryImpl_Stubï¼Œç„¶åè°ƒç”¨å…¶ bind æ–¹æ³•å‘ Registry ç«¯ä½¿ç”¨ writeObject å†™å…¥ name å’Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚</p>
<p>åœ¨ Registry ç«¯ï¼Œç”± <code>sun.rmi.transport.tcp.TCPTransport#handleMessages</code> æ¥å¤„ç†è¯·æ±‚ï¼Œè°ƒç”¨ <code>serviceCall</code> æ–¹æ³•å¤„ç†ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311145555186.png" alt="image-20230311145555186"  />
</p>
<p><code>serviceCall</code> æ–¹æ³•ä¸­ä» ObjectTable ä¸­è·å–å°è£…çš„ Target å¯¹è±¡ï¼Œå¹¶è·å–å…¶ä¸­çš„å°è£…çš„ UnicastServerRef ä»¥åŠ RegistryImpl å¯¹è±¡ã€‚ç„¶åè°ƒç”¨ UnicastServerRef çš„ <code>dispatch</code> æ–¹æ³•</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311145739581.png" alt="image-20230311145739581"  />
</p>
<p>UnicastServerRef çš„ <code>dispatch</code> æ–¹æ³•è°ƒç”¨ <code>oldDispatch</code> æ–¹æ³•ï¼Œè¿™é‡Œåˆ¤æ–­äº† <code>skel</code> æ˜¯å¦ä¸ºç©ºï¼Œç”¨æ¥åŒºåˆ«è‡ªå·±æ˜¯ Registry è¿˜æ˜¯ Serverã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311150143071.png" alt="image-20230311150143071"  />
</p>
<p><code>oldDispatch</code> æ–¹æ³•è°ƒç”¨ <code>this.skel</code> ä¹Ÿå°±æ˜¯ RegistryImpl_Skel ç±»çš„ <code>dispatch</code> æ–¹æ³•ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311150422228.png" alt="image-20230311150422228"  />
</p>
<p>RegistryImpl_Skel çš„ <code>dispatch</code> æ–¹æ³•æ ¹æ®æµä¸­å†™å…¥çš„ä¸åŒçš„æ“ä½œç±»å‹åˆ†å‘ç»™ä¸åŒçš„æ–¹æ³•å¤„ç†ï¼Œä¾‹å¦‚ 0 ä»£è¡¨ç€ bind æ–¹æ³•ï¼Œåˆ™ä»æµä¸­è¯»å–å¯¹åº”çš„å†…å®¹ï¼Œååºåˆ—åŒ–ï¼Œç„¶åè°ƒç”¨ RegistryImpl çš„ bind æ–¹æ³•è¿›è¡Œç»‘å®šã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311150532110.png" alt="image-20230311150532110"  />
</p>
<p>åœ¨Registryç«¯ï¼Œè°ƒç”¨<code>RegistryImpl.bind</code>æ–¹æ³•ï¼Œè¿™é‡Œè·å–æˆ‘ä»¬ä»Serveç«¯æ¥å—åˆ°çš„Nameå’ŒRemoteObjectã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311150705589.png" alt="image-20230311150705589"  />
</p>
<p><code>RegistryImpl</code>ä¼šå…ˆæ£€æŸ¥è‡ªå·±çš„bingdingsä¸­æ˜¯å¦æœ‰å½“å‰è¦ç»‘å®šçš„è¿œç¨‹å¯¹è±¡çš„åç§°ï¼Œå¦‚æœæœ‰çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯åˆ™å°†å½“å‰è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°<code>RegistryImpl</code>çš„<code>bindings</code>å±æ€§ä¸­å»ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311150734681.png" alt="image-20230311150734681"  />
</p>
<p>ä»¥ä¸Šå°±æ˜¯bindè¿‡ç¨‹æœåŠ¡å™¨ç«¯å’Œæ³¨å†Œç«¯çš„æ¥å—ä¿¡æ¯æµç¨‹ã€‚</p>
<h3 id="æœåŠ¡è°ƒç”¨">æœåŠ¡è°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#æœåŠ¡è°ƒç”¨">#</a></h3>
<p>Client ç«¯å‘ Registry ç«¯æŸ¥è¯¢å’Œè¯·æ±‚çš„è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯è·å– Registry çš„æµç¨‹ä¸ä¸Šé¢åˆ†æçš„æœåŠ¡ç«¯ä¸€è‡´ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚è¿˜æ˜¯é€šè¿‡è°ƒç”¨æœ¬åœ°åˆ›å»ºçš„ RegistryImpl_Stub å¯¹è±¡ã€‚</p>
<p>åœ¨è°ƒç”¨å…¶ lookup æ–¹æ³•æ—¶ï¼Œä¼šå‘ Registry ç«¯ä¼ é€’åºåˆ—åŒ–çš„ name ï¼Œç„¶åå°† Registry ç«¯å›ä¼ çš„ç»“æœååºåˆ—åŒ–ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311152130650.png" alt="image-20230311152130650"  />
</p>
<p>è¿™é‡Œå…³æ³¨Registryç«¯çš„åšæ³•ï¼Œä¾æ—§æ˜¯ RegistryImpl_Skel çš„ <code>dispatch</code> æ–¹æ³•ï¼Œlookup æ–¹æ³•å¯¹åº”çš„å€¼<code>opnum</code>æ˜¯ 2 ï¼Œè°ƒç”¨ <code>RegistryImpl </code>çš„ lookup æ–¹æ³•ï¼Œç„¶åå°†æŸ¥è¯¢åˆ°çš„ç»“æœ writeObject åˆ°æµä¸­ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311152357323.png" alt="image-20230311152357323"  />
</p>
<p>lient æ‹¿åˆ° Registry ç«¯è¿”å›çš„åŠ¨æ€ä»£ç†å¯¹è±¡å¹¶ä¸”ååºåˆ—åŒ–åï¼Œå¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œè¿™çœ‹èµ·æ¥æ˜¯æœ¬åœ°è¿›è¡Œè°ƒç”¨ï¼Œä½†å®é™…ä¸Šæ˜¯åŠ¨æ€ä»£ç†çš„ <code>RemoteObjectInvocationHandler </code>å§”æ‰˜ RemoteRef çš„ invoke æ–¹æ³•è¿›è¡Œè¿œç¨‹é€šä¿¡ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311152822275.png" alt="image-20230311152822275"  />
</p>
<p>Server ç«¯ç”± UnicastServerRef çš„ dispatch æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¼šåœ¨ <code>this.hashToMethod_Map</code> ä¸­å¯»æ‰¾ Client ç«¯å¯¹åº”æ‰§è¡Œ Method çš„ hash å€¼ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™ä¼šååºåˆ—åŒ– Client ç«¯ä¼ æ¥çš„å‚æ•°ï¼Œå¹¶ä¸”é€šè¿‡åå°„è°ƒç”¨ã€‚</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageimage-20230311154836538.png" alt="image-20230311154836538"  />
</p>
<p>è°ƒç”¨åå°†ç»“æœåºåˆ—åŒ–ä¼ è¾“ç»™ Client ç«¯ã€‚</p>
<p>Client ç«¯æ¥å—ç»“æœè¿›è¡Œååºåˆ—åŒ–å¾—åˆ°<code>Remote Method</code>æ‰§è¡Œåçš„ç»“æœï¼Œå®Œæˆæ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>RMI åº•å±‚é€šè®¯é‡‡ç”¨äº†Stub (è¿è¡Œåœ¨å®¢æˆ·ç«¯) å’Œ Skeleton (è¿è¡Œåœ¨æœåŠ¡ç«¯) æœºåˆ¶ï¼ŒRMI è°ƒç”¨è¿œç¨‹æ–¹æ³•çš„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>RMI å®¢æˆ·ç«¯åœ¨è°ƒç”¨è¿œç¨‹æ–¹æ³•æ—¶ä¼šå…ˆåˆ›å»º Stub ( <code>sun.rmi.registry.RegistryImpl_Stub</code> )ã€‚</li>
<li>Stub ä¼šå°† Remote å¯¹è±¡ä¼ é€’ç»™è¿œç¨‹å¼•ç”¨å±‚ ( <code>java.rmi.server.RemoteRef</code> ) å¹¶åˆ›å»º <code>java.rmi.server.RemoteCall</code>( è¿œç¨‹è°ƒç”¨ )å¯¹è±¡ã€‚</li>
<li>RemoteCall åºåˆ—åŒ– RMI æœåŠ¡åç§°ã€Remote å¯¹è±¡ã€‚</li>
<li>RMI å®¢æˆ·ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ä¼ è¾“ RemoteCall åºåˆ—åŒ–åçš„è¯·æ±‚ä¿¡æ¯é€šè¿‡ Socket è¿æ¥çš„æ–¹å¼ä¼ è¾“åˆ° RMI æœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚ã€‚</li>
<li>RMIæœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨å±‚( <code>sun.rmi.server.UnicastServerRef</code> )æ”¶åˆ°è¯·æ±‚ä¼šè¯·æ±‚ä¼ é€’ç»™ Skeleton ( <code>sun.rmi.registry.RegistryImpl_Skel#dispatch</code> )ã€‚</li>
<li>Skeleton è°ƒç”¨ RemoteCall ååºåˆ—åŒ– RMI å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„åºåˆ—åŒ–ã€‚</li>
<li>Skeleton å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼šbindã€listã€lookupã€rebindã€unbindï¼Œå¦‚æœæ˜¯ lookup åˆ™æŸ¥æ‰¾ RMI æœåŠ¡åç»‘å®šçš„æ¥å£å¯¹è±¡ï¼Œåºåˆ—åŒ–è¯¥å¯¹è±¡å¹¶é€šè¿‡ RemoteCall ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚</li>
<li>RMI å®¢æˆ·ç«¯ååºåˆ—åŒ–æœåŠ¡ç«¯ç»“æœï¼Œè·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>RMI å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼ŒRMIæœåŠ¡ç«¯åå°„è°ƒç”¨RMIæœåŠ¡å®ç°ç±»çš„å¯¹åº”æ–¹æ³•å¹¶åºåˆ—åŒ–æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>RMI å®¢æˆ·ç«¯ååºåˆ—åŒ– RMI è¿œç¨‹æ–¹æ³•è°ƒç”¨ç»“æœã€‚</li>
</ol>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/imageupload_f6dcd30875579430ba6b4980c1957f97.png" alt="img"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://reus09.github.io/tags/rmi/">RMI</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://reus09.github.io/posts/tech/shiro-550%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Shiro-550æ¼æ´åˆ†æ</span>
  </a>
  <a class="next" href="https://reus09.github.io/posts/life/%E9%95%BF%E6%B2%99%E4%B9%8B%E8%A1%8C/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>é•¿æ²™ä¹‹è¡Œ</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://reus09.github.io">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
