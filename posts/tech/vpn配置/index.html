<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Vpn配置 | Reus09&#39;s Blog</title>
<meta name="keywords" content="vpn配置">
<meta name="description" content="VPN配置实验 0x01 实验内容 在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考：">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Vpn配置" />
<meta property="og:description" content="VPN配置实验 0x01 实验内容 在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-01T21:22:48+00:00" />
<meta property="article:modified_time" content="2022-09-11T16:13:59+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vpn配置"/>
<meta name="twitter:description" content="VPN配置实验 0x01 实验内容 在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考："/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻技术",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Vpn配置",
      "item": "http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Vpn配置",
  "name": "Vpn配置",
  "description": "VPN配置实验 0x01 实验内容 在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考：",
  "keywords": [
    "vpn配置"
  ],
  "articleBody": "VPN配置实验 0x01 实验内容 在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考：IKE密钥协商过程是否存在安全威胁。 采用IPSec隧道模式在两台用作网关的计算机之间配置VPN，抓取两台计算机之间的数据包，查看数据的机密性，提交实验步骤和分析结果。(提示：可以使用ping\\net send \\telnet等命令进行对比验证) 配置OPENVPN，利用2至3台主机独立完成虚拟专网的搭建，并验证虚拟专网的安全性（用抓包工具分析，提示：可以使用ping\\net send \\telnet等命令进行对比验证）。 PacketTracer里VPN配置实验。（选做） 0x02 Windows IPSEC配置 配置环境：windows xp \u0026 windows 7 查看win xp和win 7的IP地址 windows xp : 192.168.195.131 windows 7 : 192.168.195.176 2.1 windows xp IPSEC配置 打开windows xp虚拟机，通过secpol.msc打开本地安全设置\n在IP安全策略下右键，创建安全策略\n设置配置名称为reus09\n激活默认响应规则 身份认证方法采用此字符串用来保护密钥交换，输入123456 回到原来窗口，鼠标右键，指派\n鼠标右键，属性，添加规则并进行相应的配置\n选择此规则不指定隧道\n选择所有网络连接\n身份验证方法采用此字符串用来保护密钥交换，输入字符串：123456\nIP筛选列表选择所有IP通讯量\n筛选器操作选择需要安全\n点击下一步完成\n至此，Windows xp下的IPSEC配置完成，操作过程中没有报错。\n2.2 windows 7 IPSEC配置 以同样的方式配置windows 7下的IPSEC，这里与windows xp配置大致相同，截图只用于说明不同点。通过secpol.msc打开windows 7本地安全设置 在IP安全策略下右键，创建安全策略 设置配置名称为reus09（个人随意），由于激活默认响应规则仅限于windows早期版本，故不选择激活默认响应规则，过程中，没有身份认证选择 点击默认设置，一直到属性窗口，添加规则：选择此规则不指定隧道、选择所有网络连接、在IP筛选列表中点击添加，名称为新IP筛选列表，并点击添加，之后选择默认操作 选择刚刚建立的IP筛选列表，点击下一步 选择添加IP筛选器操作, 选择协商安全,继续默认操作 选择刚刚建立的新筛选器操作，点击下一步 身份验证方法采用此字符串用来保护密钥交换，输入字符串：123456(与上面的相同) 单击下一步，选择默认操作直至筛选器配置完成 回到原来窗口，鼠标右键，分配，至此，Windows 7下的IPSEC配置完成，操作过程中没有报错 2.3 开始通信 关闭win 7的IPSEC服务 使用win 7 ping win xp，请求超时，ping不通 对通信过程进行抓包，可以看到win 7一直请求IPsec SA但总不成功 重新开启win 7的IPSEC服务 2.3.1 默认安全策略 使用win 7重新ping win xp，发现成功ping通 对通信过程进行抓包，由于此时win xp和win7都采用的是默认的esp加密，所以抓包显示的是esp包 2.3.2 仅AH通信,不经过ESP加密 Win 7和win xp都设置仅AH通信，不经过ESP加密 window 7 windows xp 继续使用win 7 ping win xp 对通信过程进行抓包，发现没有ESP加密后数据包格式为ICMP，数据为abcdef 2.3.3 Win 7和win xp仅esp认证 windows 7 windows xp 可以看到没有esp加密后的数据是abcdefg 同时也可以注意到开启esp加密之后的esp加密的数据被加密隐藏了 2.3.4 分析IKE SA和IPSEC SA建立过程 要建立IPSec连接，首先要协商一个IKE SA，然后在IKE SA的基础上协商IPSec SA IKE SA建立分为三个阶段 SA交换，协商确认有关安全策略。该过程进行安全协商 密钥交换阶段，主要交换密钥Diffie-Hellman公共值。数据包中的Key Exchange用于交换各自加密生成的主密钥；Nonce使用了随机数，防止重放攻击；加密所用的密钥为ipsec中设定的预共享密钥； NAT-D为双方的ip+端口的Hash值。 ID信息和认证数据交换，进行身份认证，对第一阶段交换内容的认证。 IPSec SA建立分为两个阶段，都是加密数据，无法查看。用到了Quick-Mode，目的是在两个对等体间协商一组一致的参数来创建IPSec SA，用于真实数据的加解密，并且在此进行PFS，PFS及在Quick-Mode重新做DH的交换，产生新的密钥用于IPSec数据的加密。 2.3.5 思考 Q：IKE密钥协商过程是否存在安全威胁？ A：IPSec密钥交换过程分为两个独立阶段。第一阶段通信双方彼此建立一个通过身份认证和安全保护的隧道，称为ISAKMP SA。只要ISAKMP SA建立起来，所有发起方和应答方之间的IKE通信信息都通过加密、完整性检查和认证的方法受到保护。第二阶段的建立是为特定的Internet安全协议(如IPSec等)创建安全关联(IPSec SA)。IKE第一阶段的目的是建立一个安全隧道，使得第二阶段的协商可以秘密地进行。两台主机之间可以同时建立多个ISAKMP SA，一个ISAKMP SA也可以创建多个IPSec SA，ISAKMP SA的结束不会影响它创建的IPSec SA发生作用。这种密钥协商过程是存在着漏洞的，可以通过中间人攻击和拒绝服务攻击实现漏洞利用。 0x03 配置OPENVPN 4.1 网络环境 服务器端 Windows xp: 192.168.195.131 client IP :192.168.195.131 4.2 环境修改 把 easy-rsa 目录下的 vars.bat.sample 改名为 vars.bat，并且修改其内容\n把 easy-rsa 下的 openssl.cnf.sample 改成 openssl.cnf。\n然后进入 cmd.exe\n生成 Root CA\n格式: build-ca.bat\n输出: keys/ca.crt keys/ca.key\n生成 dh1024.pem 文件，Server 使用 TLS 必须使用的一个文件。\n格式: build-dh.bat\n输出: keys/dh1024.pem\n下面生成服务端证书、客户端证书和 TA 证书：\n下面开始生成 Server 使用的证书了：\n格式: build-key-server.bat 输出: keys/.crt .csr .key\n下面开始为 client 办法证书：\n格式: build-key.bat 输出: keys/.crt keys/.csr keys/.key\n下面生成 ta.key 文件\n格式: openvpn –genkey –secret keys/ta.key\n输出: keys/ta.key\n服务端与客户端的配置:\nserver.opvn配置 把 easy-rsa\\keys\\下的 ca.crt server.crt server.key ta.key dh1024.pem复制到 server.ovpn 所在目录。 可以看到server端连接：VPN的IP为10.8.0.0 Client\nclient.opvn配置 服务端主机 easy-rsa/keys 下的 ca.crt client.crt client.key ta.key 一起放到客户机的\\config 目录下。 连接效果图 4.3 连接测试 0x04 PacketTrace VPN配置 5.1 实验环境 系统：Windows xp 软件工具：思科官方模拟器Packet Tracer 5.3 模拟实体：2台cisco2800系列路由器、2台24端口以太网交换机和若干PC电脑 5.2 初始化路由器 安装Packet Tracer 5.3\n配置安全策略\n新建一条安全策略PacketTracer，添加IP安全规则，隧道方式为不指定隧道，网络类型选择所有网络连接，身份验证方法选择用字符串保护密钥交换，输入：123456；进入IP筛选器列表的配置项，设置一个新的IP筛选器列表，新建一个IP筛选器，将我的IP地址作为源地址，将任何IP地址作为目标地址，在选择协议类型中选中任意，新建一个筛选操作，设置为协商安全，选中不和不支持IPSec的计算机通讯，以要求必须在IPSec基础上进行连接，IP通讯安全设施中选择选择自定义，然后点击设置选择如下图，选择默认直至配置完成 初始化配置路由器\n打开cisco模拟器，在模拟器窗口工具栏下选择file--new。在左下角设备栏选取路由器。 将cisco2811路由器拖到工作区域，单击工作区域的路由器图标，选择CLI项，弹出如图所示界面 进入路由器特权模式配置路由器网卡IP，输入命令如下\n1 2 3 4 5 6 7 8 9 10 11 Router\u003eenable\t//进入特权模式，只有在特权模式下才可以对路由器进行配置 Router#configure terminal\t//进入配置状态，通过端口进行配置 Router(config)# interface fastEthernet 0/0\t//进入端口f0/0 Router(config-if)#ip address 10.0.0.1 255.255.255.0\t#配置网卡f0/0的ip地址和子网掩码 Router(config-if)#no shutdown\t//开启端口f0/0 Router(config-if)#end\t//返回特权模式 Router#configure terminal\t//进入配置状态，通过端口进行配置 Router(config)# interface fastEthernet 0/1 //进入端口f0/1 Router(config-if)#ip address 192.168.1.1 255.255.255.0 //配置网卡f0/1的ip地址和子网掩码 Router(config-if)#no shutdown\t//开启端口f0/1 Router(config-if)#end\t//返回特权模式 初始配置router 0完成，根据router 0的配置过程完成router 1的配置，其中router 1的f0/0端口IP为10.0.0.2/24, router 1的f0/1端口的IP地址为192.168.2.1/24\n配置完成后，点击选择将router 0和router 1的f0/0端口连接\n5.3 搭建网络环境 在模拟器左下角选择PC\n拖到绘图工作区，双击PC图标，选择Desktop，如图所示 选择IP Configuration，配置PC的IP地址和子网掩码，如图所示\n重复上述操作，配置六台PC，它们的IP地址分别为\n192.168.1.10 192.168.1.20 192.168.1.30 192.168.2.10 192.168.2.20 192.168.2.30 子网掩码全为255.255.255.0，前三台网关为192.168.1.1，后三台网关为192.168.2.1\n选取交换机\n将路由器于交换机相连，将交换机于PC相连；最终完成如图所示的网络图 5.4 配置路由 在路由器中配置路由，使路由器两端的网络互通\n配置router 0，双击router 0图标，选择CLI项，进入路由器配置窗口，输入命令如下\n1 2 3 4 5 Router\u003een Router#configure terminal Router(config)# ip route 0.0.0.0 0.0.0.0 fastEthernet 0/0 //配置内网访问外部网络的出口路由 Router(config)#ip route 192.168.1.0 255.255.255.0 fastEthernet 0/1 //配置外部访问内部网络入口路由 Router(config)#end 配置router 1，双击router 1图标，选择CLI项，进入路由器配置窗口，输入命令如下\n1 2 3 4 5 Router\u003een Router#configure terminal Router(config)# ip route 0.0.0.0 0.0.0.0 fastEthernet 0/0 //配置内网访问外部网络的出口路由 Router(config)#ip route 192.168.2.0 255.255.255.0 fastEthernet 0/1 //配置外部访问内部网络入口路由 Router(config)#end 5.5 测试网络互通性 双击PC0图标，在弹出的对话框中，选择Desktop，选择Command Prompt\n使用ping命令，ping 192.168.1.1、10.0.0.1、192.168.2.10、10.0.0.2、192.168.3.10结果除了最后一个地址(该地址不存在)其它全能ping通，表明搭建的网络满足实验环境\n0x05 IPSEC隧道模式VPN 5.1 配置IPSec VPN 配置router 0，双击router 0图标，选择CLI项，进入路由器配置窗口\n定义IKE的策略(router 0和router1之间的密钥交换策略)，IKE只是密钥的交换策略,在使用加密对称和非对称加密算法的时候,需要密钥来对数据加密,下面的IKE策略只是建立一条管理连接，负责加密生成的各种密钥，输入命令如下\n1 2 3 4 5 6 7 8 9 Router#configure terminal\t//进入配置状态，通过端口进行配置 Router (config)#crypto isakmp policy 10\t//一个IKE的策略，号码是10，数字越低，策略优先级越高 Router (config-isakmp)# authentication pre-share\t//使用预定义共享密钥进行设备认证 Router (config-isakmp)#hash md5\t//认证方式使用MD5进行认证 Router (config-isakmp)#encryption des\t//加密方式使用DES，可选AES/DES Router (config-isakmp)#group 2\t//指定DH组 Router (config-isakmp)# lifetime 86400\t//对生成新SA的周期进行调整，两端的路由器都要设置相同的SA周期 Router (config-isakmp)# exit Router (config)#crypto isakmp key reus09 address 10.0.0.2 //定义一个密码,密码是reus09，和地址为10.0.0.2的设备去交换密钥 定义数据的加密方式和认证方式，配置IPSec，输入命令如下\n1 2 3 4 5 6 7 8 Router (config)#access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255\t//定义访问控制列表,这里的访问控制列表不是对数据进行过滤，是定义那些数据应该被加密，也可以理解哪些数据触发IPSec 流 Router (config)#crypto ipsec transform-set mine esp-des esp-md5-hmac\t//设置数据的加密方式，策略名字为mine，使用ESP-DES对数据加密，ESP-MD5-HMAC对数据认证 Router(config)# crypto map mymap 101 ipsec-isakmp //定义一个map,调用刚才做的策略 Router(config-crypto-map)# match address 110\t//匹配出访问控制列表110的数据 Router(config-crypto-map)# set peer 10.0.0.2 //标识对端路由器的合法IP地址 Router(config-crypto-map)# set pfs group2 Router(config-crypto-map)# set transform-set mine //使用刚才定义好的策略对数据加密 Router(config-crypto-map)# set security-association lifetime seconds 86400\t//指定IPSec SA的存活期 将map映射到公网端口，一个端口只能映射一个map，输入命令如下\n1 2 3 4 Router（config）interface fastEthernet 0/0 Router(config-if)#crypto map mymap *Jan 3 07:16:26.785: %CRYPTO-6-ISAKMP_ON_OFF: ISAKMP is ON Router（config-if）end 查看策略\n查看IKE策略\n1 Router# show crypto isakmp policy 查看IPSec变换集\n1 Router# show crypto ipsec transform-set 查看 crypto maps\n1 Router# show crypto map 配置router 1，双击router 1图标，选择CLI项，进入路由器配置窗口\n定义IKE的策略，与配置route 0相同 定义数据的加密方式和认证方式，配置IPSec，与配置route 0相同 将map映射到公网端口，与配置route 0相同 5.2 测试IPSec VPN 测试VPN连通性\n双击PC0图标，在弹出的对话框中，选择Desktop，选择Command Prompt，ping 192.168.2.10，如下图所示\n验证数据经过IPSec VPN 加密传输，点击进入simulation mode，弹出如图所示对话框\n重复上一步操作，simulation Panel中选取Auto Capture，观察工作区动画，展示了数据包在网络中的传送过程\n双击路由器router 0处数据包，弹出如图所示弹框，可以分析出数据包的信息\n进入路由器的数据包（左侧）的信息源IP是192.168.1.10，目的IP是192.168.2.10 路由器出去的数据包(右侧)的源IP改变为10.0.0.1，目的IP变为10.0.0.2 从上图的第六条信息中发现ESP encrypts the received packet的信息 综上，从PC0（192.168.1.10）发往对端PC3（192.168.2.10）的数据经过了路由器的IPSec VPN模块加密处理，隐藏了内网的IP地址信息，从而保护了内网的数据 断开VPN\n断开router 0\n1 2 3 Router（config）#interface fastEthernet 0/0 Router(config-if)#no crypto map mymap Router（config-if）end 双击PC0图标，在弹出的对话框中，选择Desktop，选择Command Prompt，ping 192.168.2.10，ping不通，表明只断开一端路由器的端口map映射，两边无法连通\n以同样的方式断开route 1\n1 2 3 Router（config）#interface fastEthernet 0/0 Router(config-if)#no crypto map mymap Router（config-if）end 双击PC0图标，在弹出的对话框中，选择Desktop，选择Command Prompt，ping 192.168.2.10，ping成功，表明两端都断开后，两边网络可以再次保持连接\n抓取经过route 0的数据包，发现数据不再加密传输。\n0x06 总结 通过配置IPSEC，明白AH和ESP的区别。 配置OPEN VPN,PacketTrace 对局域网的架构有了一定的了解。 配置多个VPN，明白了VPN的工作原理。 ",
  "wordCount" : "5663",
  "inLanguage": "en",
  "datePublished": "2022-01-01T21:22:48Z",
  "dateModified": "2022-09-11T16:13:59+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="主页">
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/categories" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/links" title="友链">
                    <span>友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/tech/">👨🏻‍💻技术</a></div>
    <h1 class="post-title">
      Vpn配置
    </h1>
    <div class="post-meta"><span title='2022-01-01 21:22:48 +0000 UTC'>2022-01-01</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#vpn%e9%85%8d%e7%bd%ae%e5%ae%9e%e9%aa%8c" aria-label="VPN配置实验">VPN配置实验</a><ul>
                            
                    <li>
                        <a href="#0x01-%e5%ae%9e%e9%aa%8c%e5%86%85%e5%ae%b9" aria-label="0x01 实验内容">0x01 实验内容</a></li>
                    <li>
                        <a href="#0x02-windows-ipsec%e9%85%8d%e7%bd%ae" aria-label="0x02 Windows IPSEC配置">0x02 Windows IPSEC配置</a><ul>
                            
                    <li>
                        <a href="#21-windows-xp-ipsec%e9%85%8d%e7%bd%ae" aria-label="2.1 windows xp IPSEC配置">2.1 windows xp IPSEC配置</a></li>
                    <li>
                        <a href="#22-windows-7-ipsec%e9%85%8d%e7%bd%ae" aria-label="2.2 windows 7 IPSEC配置">2.2 windows 7 IPSEC配置</a></li>
                    <li>
                        <a href="#23-%e5%bc%80%e5%a7%8b%e9%80%9a%e4%bf%a1" aria-label="2.3 开始通信">2.3 开始通信</a><ul>
                            
                    <li>
                        <a href="#231-%e9%bb%98%e8%ae%a4%e5%ae%89%e5%85%a8%e7%ad%96%e7%95%a5" aria-label="2.3.1 默认安全策略">2.3.1 默认安全策略</a></li>
                    <li>
                        <a href="#232-%e4%bb%85ah%e9%80%9a%e4%bf%a1%e4%b8%8d%e7%bb%8f%e8%bf%87esp%e5%8a%a0%e5%af%86" aria-label="2.3.2 仅AH通信,不经过ESP加密">2.3.2 仅<code>AH通信</code>,不经过<code>ESP加密</code></a></li>
                    <li>
                        <a href="#233--win-7%e5%92%8cwin-xp%e4%bb%85esp%e8%ae%a4%e8%af%81" aria-label="2.3.3 Win 7和win xp仅esp认证">2.3.3  Win 7<code>和</code>win xp<code>仅</code>esp认证</a></li>
                    <li>
                        <a href="#234-%e5%88%86%e6%9e%90ike-sa%e5%92%8cipsec-sa%e5%bb%ba%e7%ab%8b%e8%bf%87%e7%a8%8b" aria-label="2.3.4 分析IKE SA和IPSEC SA建立过程">2.3.4 分析<code>IKE SA</code>和<code>IPSEC SA</code>建立过程</a></li>
                    <li>
                        <a href="#235-%e6%80%9d%e8%80%83" aria-label="2.3.5 思考">2.3.5 思考</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#0x03-%e9%85%8d%e7%bd%aeopenvpn" aria-label="0x03 配置OPENVPN">0x03 配置OPENVPN</a><ul>
                            
                    <li>
                        <a href="#41-%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83" aria-label="4.1 网络环境">4.1 网络环境</a></li>
                    <li>
                        <a href="#42-%e7%8e%af%e5%a2%83%e4%bf%ae%e6%94%b9" aria-label="4.2 环境修改">4.2 环境修改</a></li>
                    <li>
                        <a href="#43-%e8%bf%9e%e6%8e%a5%e6%b5%8b%e8%af%95" aria-label="4.3 连接测试">4.3 连接测试</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x04-packettrace-vpn%e9%85%8d%e7%bd%ae" aria-label="0x04 PacketTrace VPN配置">0x04 PacketTrace VPN配置</a><ul>
                            
                    <li>
                        <a href="#51-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83" aria-label="5.1 实验环境">5.1 实验环境</a></li>
                    <li>
                        <a href="#52-%e5%88%9d%e5%a7%8b%e5%8c%96%e8%b7%af%e7%94%b1%e5%99%a8" aria-label="5.2 初始化路由器">5.2 初始化路由器</a></li>
                    <li>
                        <a href="#53-%e6%90%ad%e5%bb%ba%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83" aria-label="5.3 搭建网络环境">5.3 搭建网络环境</a></li>
                    <li>
                        <a href="#54-%e9%85%8d%e7%bd%ae%e8%b7%af%e7%94%b1" aria-label="5.4 配置路由">5.4 配置路由</a></li>
                    <li>
                        <a href="#55-%e6%b5%8b%e8%af%95%e7%bd%91%e7%bb%9c%e4%ba%92%e9%80%9a%e6%80%a7" aria-label="5.5 测试网络互通性">5.5 测试网络互通性</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x05--ipsec%e9%9a%a7%e9%81%93%e6%a8%a1%e5%bc%8fvpn" aria-label="0x05  IPSEC隧道模式VPN">0x05  IPSEC隧道模式VPN</a><ul>
                            
                    <li>
                        <a href="#51-%e9%85%8d%e7%bd%aeipsec-vpn" aria-label="5.1 配置IPSec VPN">5.1 配置IPSec VPN</a></li>
                    <li>
                        <a href="#52-%e6%b5%8b%e8%af%95ipsec-vpn" aria-label="5.2 测试IPSec VPN">5.2 测试IPSec VPN</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x06-%e6%80%bb%e7%bb%93" aria-label="0x06 总结">0x06 总结</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="vpn配置实验">VPN配置实验<a hidden class="anchor" aria-hidden="true" href="#vpn配置实验">#</a></h1>
<h2 id="0x01-实验内容">0x01 实验内容<a hidden class="anchor" aria-hidden="true" href="#0x01-实验内容">#</a></h2>
<ul>
<li>在Windows IPSEC配置实验中，通过抓包工具抓取IKE SA和IPSEC SA建立过程的数据包，并进行分析；思考：IKE密钥协商过程是否存在安全威胁。</li>
<li>采用IPSec隧道模式在两台用作网关的计算机之间配置VPN，抓取两台计算机之间的数据包，查看数据的机密性，提交实验步骤和分析结果。(提示：可以使用ping\net send \telnet等命令进行对比验证)</li>
<li>配置OPENVPN，利用2至3台主机独立完成虚拟专网的搭建，并验证虚拟专网的安全性（用抓包工具分析，提示：可以使用ping\net send \telnet等命令进行对比验证）。</li>
<li>PacketTracer里VPN配置实验。（选做）</li>
</ul>
<h2 id="0x02-windows-ipsec配置">0x02 Windows IPSEC配置<a hidden class="anchor" aria-hidden="true" href="#0x02-windows-ipsec配置">#</a></h2>
<ul>
<li>配置环境：<code>windows xp</code> &amp; <code>windows 7</code></li>
<li>查看<code>win xp</code>和<code>win 7</code>的IP地址
<ul>
<li><code>windows xp</code> : <code>192.168.195.131</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128233556.png" alt="image-20211128233556458"  />
</li>
</ul>
</li>
<li><code>windows 7</code> : <code>192.168.195.176</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128233635.png" alt="image-20211128233635296"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="21-windows-xp-ipsec配置">2.1 windows xp IPSEC配置<a hidden class="anchor" aria-hidden="true" href="#21-windows-xp-ipsec配置">#</a></h3>
<ul>
<li>
<p>打开<code>windows xp</code>虚拟机，通过<code>secpol.msc</code>打开本地安全设置</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231055.png" alt="image-20211128231055325"  />
</li>
</ul>
</li>
<li>
<p>在IP安全策略下右键，创建安全策略</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231125.png" alt="image-20211128231125637"  />
</li>
</ul>
</li>
<li>
<p>设置配置名称为<code>reus09</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231159.png" alt="image-20211128231159635"  />
</li>
<li>激活默认响应规则
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231229.png" alt="image-20211128231229636"  />
</li>
</ul>
</li>
<li>身份认证方法采用<code>此字符串用来保护密钥交换</code>，输入<code>123456</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231312.png" alt="image-20211128231312522"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>回到原来窗口，鼠标右键，指派</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231410.png" alt="image-20211128231410547"  />
</li>
</ul>
</li>
<li>
<p>鼠标右键，属性，添加规则并进行相应的配置</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231441.png" alt="image-20211128231441417"  />
</p>
</li>
<li>
<p>选择此规则不指定隧道</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231513.png" alt="image-20211128231513737"  />
</li>
</ul>
</li>
<li>
<p>选择所有网络连接</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231533.png" alt="image-20211128231532956"  />
</li>
</ul>
</li>
<li>
<p>身份验证方法采用<code>此字符串用来保护密钥交换</code>，输入字符串：<code>123456</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231623.png" alt="image-20211128231623393"  />
</li>
</ul>
</li>
<li>
<p>IP筛选列表选择<code>所有IP通讯量</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231647.png" alt="image-20211128231647505"  />
</li>
</ul>
</li>
<li>
<p>筛选器操作选择<code>需要安全</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231708.png" alt="image-20211128231708556"  />
</li>
</ul>
</li>
<li>
<p>点击下一步完成</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128231743.png" alt="image-20211128231743191"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>至此，<code>Windows xp</code>下的<code>IPSEC</code>配置完成，操作过程中没有报错。</p>
</li>
</ul>
<h3 id="22-windows-7-ipsec配置">2.2 windows 7 IPSEC配置<a hidden class="anchor" aria-hidden="true" href="#22-windows-7-ipsec配置">#</a></h3>
<ul>
<li>以同样的方式配置<code>windows 7</code>下的<code>IPSEC</code>，这里与<code>windows xp</code>配置大致相同，截图只用于说明不同点。通过<code>secpol.msc</code>打开<code>windows 7</code>本地安全设置
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232047.png" alt="image-20211128232047010"  />
</li>
</ul>
</li>
<li>在IP安全策略下右键，创建安全策略</li>
<li>设置配置名称为<code>reus09</code>（个人随意），由于激活默认响应规则仅限于windows早期版本，故不选择激活默认响应规则，过程中，没有身份认证选择
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232145.png" alt="image-20211128232145840"  />
</li>
<li>点击默认设置，一直到属性窗口，添加规则：选择此规则不指定隧道、选择所有网络连接、在IP筛选列表中点击添加，名称为<code>新IP筛选列表</code>，并点击添加，之后选择默认操作
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232338.png" alt="image-20211128232338854"  />
</li>
</ul>
</li>
<li>选择刚刚建立的IP筛选列表，点击下一步
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232453.png" alt="image-20211128232417902"  />
</li>
</ul>
</li>
<li>选择<code>添加IP筛选器</code>操作, 选择<code>协商安全</code>,继续默认操作
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232530.png" alt="image-20211128232530857"  />
</li>
</ul>
</li>
</ul>
</li>
<li>选择刚刚建立的新筛选器操作，点击下一步
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232655.png" alt="image-20211128232654966"  />
</li>
<li>身份验证方法采用<code>此字符串用来保护密钥交换</code>，输入字符串：<code>123456</code>(与上面的相同)
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232733.png" alt="image-20211128232733497"  />
</li>
</ul>
</li>
<li>单击下一步，选择默认操作直至筛选器配置完成
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232803.png" alt="image-20211128232803642"  />
</li>
</ul>
</li>
</ul>
</li>
<li>回到原来窗口，鼠标右键，分配，至此，<code>Windows 7</code>下的<code>IPSEC</code>配置完成，操作过程中没有报错
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128232825.png" alt="image-20211128232825585"  />
</li>
</ul>
</li>
</ul>
<h3 id="23-开始通信">2.3 开始通信<a hidden class="anchor" aria-hidden="true" href="#23-开始通信">#</a></h3>
<ul>
<li>关闭<code>win 7</code>的<code>IPSEC服务</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128234514.png" alt="image-20211128234514472"  />
</li>
</ul>
</li>
<li>使用<code>win 7</code> <code>ping</code> <code>win xp</code>，请求超时，<code>ping</code>不通
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128234625.png" alt="image-20211128234625877"  />
</li>
</ul>
</li>
<li>对通信过程进行抓包，可以看到<code>win 7</code>一直请求<code>IPsec SA</code>但总不成功
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235205.png" alt="image-20211128235205748"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235245.png" alt="image-20211128235245855"  />
</li>
</ul>
</li>
<li>重新开启<code>win 7</code>的<code>IPSEC服务</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235309.png" alt="image-20211128235309178"  />
</li>
</ul>
</li>
</ul>
<h4 id="231-默认安全策略">2.3.1 默认安全策略<a hidden class="anchor" aria-hidden="true" href="#231-默认安全策略">#</a></h4>
<ul>
<li>使用<code>win 7</code>重新<code>ping</code> <code>win xp</code>，发现成功<code>ping</code>通
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235353.png" alt="image-20211128235353746"  />
</li>
</ul>
</li>
<li>对通信过程进行抓包，由于此时<code>win xp</code>和<code>win7</code>都采用的是默认的<code>esp加密</code>，所以抓包显示的是<code>esp包</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235444.png" alt="image-20211128235444673"  />
</li>
</ul>
</li>
</ul>
<h4 id="232-仅ah通信不经过esp加密">2.3.2 仅<code>AH通信</code>,不经过<code>ESP加密</code><a hidden class="anchor" aria-hidden="true" href="#232-仅ah通信不经过esp加密">#</a></h4>
<ul>
<li><code>Win 7</code>和<code>win xp</code>都设置仅<code>AH通信</code>，不经过<code>ESP</code>加密
<ul>
<li><code>window 7</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211128235942.png" alt="image-20211128235942864"  />
</li>
</ul>
</li>
<li><code>windows xp</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129000000.png" alt="image-20211129000000261"  />
</li>
</ul>
</li>
</ul>
</li>
<li>继续使用<code>win 7</code> <code>ping</code> <code>win xp</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129000200.png" alt="image-20211129000200223"  />
</li>
</ul>
</li>
<li>对通信过程进行抓包，发现没有<code>ESP加密</code>后数据包格式为<code>ICMP</code>，数据为<code>abcdef</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129000322.png" alt="image-20211129000322754"  />
</li>
</ul>
</li>
</ul>
<h4 id="233--win-7和win-xp仅esp认证">2.3.3  Win 7<code>和</code>win xp<code>仅</code>esp认证<a hidden class="anchor" aria-hidden="true" href="#233--win-7和win-xp仅esp认证">#</a></h4>
<ul>
<li><code>windows 7</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129000619.png" alt="image-20211129000619011"  />
</li>
</ul>
</li>
<li><code>windows xp</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129001629.png" alt="image-20211129000631541"  />
</li>
</ul>
</li>
<li>可以看到没有<code>esp</code>加密后的数据是<code>abcdefg</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129001724.png" alt="image-20211129001724022"  />
</li>
</ul>
</li>
<li>同时也可以注意到开启<code>esp加密之后</code>的<code>esp</code>加密的数据被加密隐藏了
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129001921.png" alt="image-20211129001921658"  />
</li>
</ul>
</li>
</ul>
<h4 id="234-分析ike-sa和ipsec-sa建立过程">2.3.4 分析<code>IKE SA</code>和<code>IPSEC SA</code>建立过程<a hidden class="anchor" aria-hidden="true" href="#234-分析ike-sa和ipsec-sa建立过程">#</a></h4>
<ul>
<li>要建立<code>IPSec连接</code>，首先要协商一个<code>IKE SA</code>，然后在<code>IKE SA</code>的基础上协商<code>IPSec SA</code></li>
<li>IKE SA建立分为三个阶段
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129002908.png" alt="image-20211129002908001"  />

<ul>
<li><code>SA交换</code>，协商确认有关安全策略。该过程进行安全协商
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003346.png" alt="image-20211129003346698"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003322.png" alt="image-20211129003322371"  />
</li>
</ul>
</li>
<li>密钥交换阶段，主要交换密钥<code>Diffie-Hellman公共值</code>。数据包中的<code>Key Exchange</code>用于交换各自加密生成的<code>主密钥</code>；<code>Nonce</code>使用了随机数，防止重放攻击；加密所用的密钥为<code>ipsec</code>中设定的<code>预共享密钥</code>； <code>NAT-D</code>为双方的ip+端口的Hash值。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003410.png" alt="image-20211129003410748"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003213.png" alt="image-20211129003136281"  />
</li>
</ul>
</li>
<li>ID信息和认证数据交换，进行身份认证，对第一阶段交换内容的认证。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003438.png" alt="image-20211129003438177"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003449.png" alt="image-20211129003449503"  />
</li>
</ul>
</li>
</ul>
</li>
<li><code>IPSec SA</code>建立分为两个阶段，都是加密数据，无法查看。用到了<code>Quick-Mode</code>，目的是在两个对等体间协商一组一致的参数来创建<code>IPSec SA</code>，用于真实数据的加解密，并且在此进行<code>PFS</code>，<code>PFS</code>及在<code>Quick-Mode</code>重新做<code>DH</code>的交换，产生新的密钥用于<code>IPSec</code>数据的加密。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129003512.png" alt="image-20211129003512913"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="235-思考">2.3.5 思考<a hidden class="anchor" aria-hidden="true" href="#235-思考">#</a></h4>
<ul>
<li>Q：IKE密钥协商过程是否存在安全威胁？</li>
<li>A：<code>IPSec密钥交换过程</code>分为两个独立阶段。第一阶段通信双方彼此建立一个通过身份认证和安全保护的隧道，称为<code>ISAKMP SA</code>。只要<code>ISAKMP SA</code>建立起来，所有发起方和应答方之间的<code>IKE</code>通信信息都通过加密、完整性检查和认证的方法受到保护。第二阶段的建立是为特定的<code>Internet</code>安全协议(如<code>IPSec</code>等)创建安全关联(<code>IPSec SA</code>)。IKE第一阶段的目的是建立一个<code>安全隧道</code>，使得第二阶段的协商可以秘密地进行。两台主机之间可以同时建立多个<code>ISAKMP SA</code>，一个<code>ISAKMP SA</code>也可以创建多个<code>IPSec SA</code>，<code>ISAKMP SA</code>的结束不会影响它创建的<code>IPSec SA</code>发生作用。这种密钥协商过程是存在着漏洞的，可以通过中间人攻击和拒绝服务攻击实现漏洞利用。</li>
</ul>
<h2 id="0x03-配置openvpn">0x03 配置OPENVPN<a hidden class="anchor" aria-hidden="true" href="#0x03-配置openvpn">#</a></h2>
<h3 id="41-网络环境">4.1 网络环境<a hidden class="anchor" aria-hidden="true" href="#41-网络环境">#</a></h3>
<ul>
<li>服务器端
<ul>
<li><code>Windows xp</code>: <code>192.168.195.131</code></li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130013117.png" alt="image-20211130013117863"  />
</li>
</ul>
</li>
<li>client
<ul>
<li><code>IP</code> :<code>192.168.195.131</code></li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130013825.png" alt="image-20211130013825694"  />
</li>
</ul>
</li>
</ul>
<h3 id="42-环境修改">4.2 环境修改<a hidden class="anchor" aria-hidden="true" href="#42-环境修改">#</a></h3>
<ul>
<li>
<p>把 easy-rsa 目录下的 vars.bat.sample 改名为 vars.bat，并且修改其内容</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130002436.png" alt="image-20211130002435971"  />
</li>
</ul>
</li>
<li>
<p>把 easy-rsa 下的 openssl.cnf.sample 改成 openssl.cnf。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130002541.png" alt="image-20211130002541798"  />
</li>
</ul>
</li>
<li>
<p>然后进入 cmd.exe</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130002645.png" alt="image-20211130002645764"  />
</li>
</ul>
</li>
<li>
<p>生成 Root CA</p>
<p>格式: build-ca.bat</p>
<p>输出: keys/ca.crt keys/ca.key</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130002917.png" alt="image-20211130002917147"  />
</li>
</ul>
</li>
<li>
<p>生成 dh1024.pem 文件，Server 使用 TLS 必须使用的一个文件。</p>
<p>格式: build-dh.bat</p>
<p>输出: keys/dh1024.pem</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130003000.png" alt="image-20211130003000109"  />
</li>
</ul>
</li>
<li>
<p><strong>下面生成服务端证书、客户端证书和 TA 证书：</strong></p>
<ul>
<li>
<p>下面开始生成 Server 使用的证书了：</p>
<p>格式: build-key-server.bat <filename></p>
<p>输出: keys/<filename>.crt <filename>.csr <filename>.key</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130003144.png" alt="image-20211130003144877"  />
</li>
</ul>
</li>
<li>
<p>下面开始为 client 办法证书：</p>
<p>格式: build-key.bat <filename></p>
<p>输出: keys/<filename>.crt keys/<filename>.csr keys/<filename>.key</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130004557.png" alt="image-20211130004515698"  />
</li>
</ul>
</li>
<li>
<p>下面生成 ta.key 文件</p>
<p>格式: openvpn &ndash;genkey &ndash;secret keys/ta.key</p>
<p>输出: keys/ta.key</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130004557.png" alt="image-20211130004555618"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>服务端与客户端的配置:</strong></p>
<ul>
<li>server.opvn配置</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130014311.png" alt="image-20211130014311592"  />
</li>
<li>把 easy-rsa\keys\下的 ca.crt server.crt server.key ta.key dh1024.pem复制到 server.ovpn 所在目录。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130010603.png" alt="image-20211130010603644"  />
</li>
</ul>
</li>
<li>可以看到<code>server端连接</code>：VPN的IP为<code>10.8.0.0</code>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130014424.png" alt="image-20211130014424315"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Client</p>
<ul>
<li>client.opvn配置
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130014326.png" alt="image-20211130014326627"  />
</li>
</ul>
</li>
<li>服务端主机 easy-rsa/keys 下的 ca.crt client.crt client.key ta.key 一起放到客户机的&lt;OPENVPN_HOME&gt;\config 目录下。
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130011418.png" alt="image-20211130011418555"  />
</li>
</ul>
</li>
<li>连接效果图
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130013744.png" alt=""  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="43-连接测试">4.3 连接测试<a hidden class="anchor" aria-hidden="true" href="#43-连接测试">#</a></h3>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130014242.png" alt="image-20211130014242007"  />
</li>
</ul>
<h2 id="0x04-packettrace-vpn配置">0x04 PacketTrace VPN配置<a hidden class="anchor" aria-hidden="true" href="#0x04-packettrace-vpn配置">#</a></h2>
<h3 id="51-实验环境">5.1 实验环境<a hidden class="anchor" aria-hidden="true" href="#51-实验环境">#</a></h3>
<ul>
<li>系统：<code>Windows xp</code></li>
<li>软件工具：思科官方模拟器<code>Packet Tracer 5.3</code></li>
<li>模拟实体：2台<code>cisco2800</code>系列路由器、2台24端口以太网交换机和若干PC电脑</li>
</ul>
<h3 id="52-初始化路由器">5.2 初始化路由器<a hidden class="anchor" aria-hidden="true" href="#52-初始化路由器">#</a></h3>
<ul>
<li>
<p>安装<code>Packet Tracer 5.3</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129004245.png" alt="image-20211129004245806"  />
</li>
</ul>
</li>
<li>
<p>配置安全策略</p>
<ul>
<li>新建一条安全策略<code>PacketTracer</code>，添加IP安全规则，隧道方式为<code>不指定隧道</code>，网络类型选择<code>所有网络连接</code>，身份验证方法选择<code>用字符串保护密钥交换</code>，输入：<code>123456</code>；进入IP筛选器列表的配置项，设置一个新的IP筛选器列表，新建一个IP筛选器，将<code>我的IP地址</code>作为源地址，将<code>任何IP地址</code>作为目标地址，在<code>选择协议类型</code>中选中<code>任意</code>，新建一个筛选操作，设置为<code>协商安全</code>，选中<code>不和不支持IPSec的计算机通讯</code>，以要求必须在<code>IPSec</code>基础上进行连接，<code>IP通讯安全设施</code>中选择选择<code>自定义</code>，然后点击<code>设置</code>选择如下图，选择默认直至配置完成</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129004914.png" alt="image-20211129004914430"  />
</li>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211129004953171.png" alt="image-20211129004953171"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129005023.png" alt="image-20211129005022954"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129005054.png" alt="image-20211129005054453"  />
</li>
</ul>
</li>
<li>
<p>初始化配置路由器</p>
<ul>
<li>打开<code>cisco模拟器</code>，在模拟器窗口工具栏下选择<code>file--new</code>。在左下角设备栏选取路由器。</li>
<li>将<code>cisco2811路由器</code>拖到工作区域，单击工作区域的路由器图标，选择<code>CLI项</code>，弹出如图所示界面
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129005434.png" alt="image-20211129005433997"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>进入路由器特权模式配置路由器网卡IP，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router&gt;enable	//进入特权模式，只有在特权模式下才可以对路由器进行配置
</span></span><span style="display:flex;"><span>Router#configure terminal		//进入配置状态，通过端口进行配置
</span></span><span style="display:flex;"><span>Router(config)# interface fastEthernet 0/0	//进入端口f0/0 
</span></span><span style="display:flex;"><span>Router(config-if)#ip address 10.0.0.1 255.255.255.0	#配置网卡f0/0的ip地址和子网掩码
</span></span><span style="display:flex;"><span>Router(config-if)#no shutdown		//开启端口f0/0
</span></span><span style="display:flex;"><span>Router(config-if)#end		//返回特权模式
</span></span><span style="display:flex;"><span>Router#configure terminal		//进入配置状态，通过端口进行配置
</span></span><span style="display:flex;"><span>Router(config)# interface fastEthernet 0/1  //进入端口f0/1
</span></span><span style="display:flex;"><span>Router(config-if)#ip address 192.168.1.1 255.255.255.0  //配置网卡f0/1的ip地址和子网掩码 
</span></span><span style="display:flex;"><span>Router(config-if)#no shutdown		//开启端口f0/1
</span></span><span style="display:flex;"><span>Router(config-if)#end		//返回特权模式
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129212207.png" alt="image-20211129212200414"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129212253.png" alt="image-20211129212253475"  />
</li>
</ul>
</li>
<li>
<p>初始配置<code>router 0</code>完成，根据<code>router 0</code>的配置过程完成<code>router 1</code>的配置，其中<code>router 1</code>的<code>f0/0</code>端口IP为<code>10.0.0.2/24</code>, <code>router 1</code>的<code>f0/1</code>端口的IP地址为<code>192.168.2.1/24</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129213100.png" alt="image-20211129212951455"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129213100.png" alt="image-20211129213058622"  />
</li>
</ul>
</li>
<li>
<p>配置完成后，点击选择将<code>router 0</code>和<code>router 1</code>的<code>f0/0</code>端口连接</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129213237.png" alt="image-20211129213237143"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129213247.png" alt="image-20211129213247785"  />
</li>
</ul>
</li>
</ul>
<h3 id="53-搭建网络环境">5.3 搭建网络环境<a hidden class="anchor" aria-hidden="true" href="#53-搭建网络环境">#</a></h3>
<ul>
<li>
<p>在模拟器左下角选择PC</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129234811.png" alt="image-20211129234811235"  />
</li>
<li>拖到绘图工作区，双击<code>PC图标</code>，选择<code>Desktop</code>，如图所示
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129234852.png" alt="image-20211129234852274"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>选择<code>IP Configuration</code>，配置PC的IP地址和子网掩码，如图所示</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129235026.png" alt="image-20211129235026855"  />
</li>
</ul>
</li>
<li>
<p>重复上述操作，配置六台PC，它们的IP地址分别为</p>
<ul>
<li><code>192.168.1.10</code></li>
<li><code>192.168.1.20</code></li>
<li><code>192.168.1.30</code></li>
<li><code>192.168.2.10</code></li>
<li><code>192.168.2.20</code></li>
<li><code>192.168.2.30</code></li>
</ul>
<p>子网掩码全为<code>255.255.255.0</code>，前三台网关为<code>192.168.1.1</code>，后三台网关为<code>192.168.2.1</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129235214.png" alt="image-20211129235214339"  />
</li>
</ul>
</li>
<li>
<p>选取交换机</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211129235344.png" alt="image-20211129235344813"  />
</li>
<li>将路由器于交换机相连，将交换机于PC相连；最终完成如图所示的网络图
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001024.png" alt="image-20211130001024110"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="54-配置路由">5.4 配置路由<a hidden class="anchor" aria-hidden="true" href="#54-配置路由">#</a></h3>
<ul>
<li>
<p>在路由器中配置路由，使路由器两端的网络互通</p>
</li>
<li>
<p>配置<code>router 0</code>，双击<code>router 0</code>图标，选择<code>CLI项</code>，进入路由器配置窗口，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router&gt;en
</span></span><span style="display:flex;"><span>Router#configure  terminal
</span></span><span style="display:flex;"><span>Router(config)# ip route 0.0.0.0  0.0.0.0 fastEthernet 0/0  //配置内网访问外部网络的出口路由
</span></span><span style="display:flex;"><span>Router(config)#ip route 192.168.1.0  255.255.255.0  fastEthernet  0/1  //配置外部访问内部网络入口路由
</span></span><span style="display:flex;"><span>Router(config)#end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001038.png" alt="image-20211130001038099"  />
</li>
</ul>
</li>
<li>
<p>配置<code>router 1</code>，双击<code>router 1</code>图标，选择<code>CLI项</code>，进入路由器配置窗口，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router&gt;en
</span></span><span style="display:flex;"><span>Router#configure  terminal
</span></span><span style="display:flex;"><span>Router(config)# ip route 0.0.0.0  0.0.0.0 fastEthernet 0/0  //配置内网访问外部网络的出口路由
</span></span><span style="display:flex;"><span>Router(config)#ip route 192.168.2.0  255.255.255.0  fastEthernet  0/1  //配置外部访问内部网络入口路由
</span></span><span style="display:flex;"><span>Router(config)#end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001055.png" alt="image-20211130001055645"  />
</li>
</ul>
</li>
</ul>
<h3 id="55-测试网络互通性">5.5 测试网络互通性<a hidden class="anchor" aria-hidden="true" href="#55-测试网络互通性">#</a></h3>
<ul>
<li>
<p>双击<code>PC0图标</code>，在弹出的对话框中，选择<code>Desktop</code>，选择<code>Command Prompt</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001215.png" alt="image-20211130001215742"  />
</li>
</ul>
</li>
<li>
<p>使用<code>ping</code>命令，<code>ping</code> <code>192.168.1.1</code>、<code>10.0.0.1</code>、<code>192.168.2.10</code>、<code>10.0.0.2</code>、<code>192.168.3.10</code>结果除了最后一个地址(该地址不存在)其它全能<code>ping</code>通，表明搭建的网络满足实验环境</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001251.png" alt="image-20211130001251587"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001314.png" alt="image-20211130001314453"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001400.png" alt="image-20211130001400515"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001421.png" alt="image-20211130001420945"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211130001508.png" alt="image-20211130001508132"  />
</li>
</ul>
<p><a href="https://leeyuxun-1258157351.cos.ap-beijing.myqcloud.com/img/1565753295977.png">
</a></p>
</li>
</ul>
<h2 id="0x05--ipsec隧道模式vpn">0x05  IPSEC隧道模式VPN<a hidden class="anchor" aria-hidden="true" href="#0x05--ipsec隧道模式vpn">#</a></h2>
<h3 id="51-配置ipsec-vpn">5.1 配置IPSec VPN<a hidden class="anchor" aria-hidden="true" href="#51-配置ipsec-vpn">#</a></h3>
<ul>
<li>
<p>配置<code>router 0</code>，双击<code>router 0</code>图标，选择<code>CLI项</code>，进入路由器配置窗口</p>
<ul>
<li>
<p>定义<code>IKE</code>的策略(<code>router 0</code>和<code>router1</code>之间的密钥交换策略)，<code>IKE</code>只是密钥的交换策略,在使用加密对称和非对称加密算法的时候,需要密钥来对数据加密,下面的IKE策略只是建立一条管理连接，负责加密生成的各种密钥，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router#configure terminal		//进入配置状态，通过端口进行配置
</span></span><span style="display:flex;"><span>Router (config)#crypto isakmp policy 10		//一个IKE的策略，号码是10，数字越低，策略优先级越高
</span></span><span style="display:flex;"><span>Router (config-isakmp)# authentication pre-share	//使用预定义共享密钥进行设备认证
</span></span><span style="display:flex;"><span>Router (config-isakmp)#hash md5	   //认证方式使用MD5进行认证
</span></span><span style="display:flex;"><span>Router (config-isakmp)#encryption des		//加密方式使用DES，可选AES/DES
</span></span><span style="display:flex;"><span>Router (config-isakmp)#group 2		//指定DH组
</span></span><span style="display:flex;"><span>Router (config-isakmp)# lifetime 86400		//对生成新SA的周期进行调整，两端的路由器都要设置相同的SA周期
</span></span><span style="display:flex;"><span>Router (config-isakmp)# exit
</span></span><span style="display:flex;"><span>Router (config)#crypto isakmp key reus09 address 10.0.0.2   //定义一个密码,密码是reus09，和地址为10.0.0.2的设备去交换密钥
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201003548.png" alt="image-20211201003541244"  />
</p>
</li>
<li>
<p>定义数据的<code>加密方式</code>和<code>认证方式</code>，配置<code>IPSec</code>，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router (config)#access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.2.0  0.0.0.255	//定义访问控制列表,这里的访问控制列表不是对数据进行过滤，是定义那些数据应该被加密，也可以理解哪些数据触发IPSec 流
</span></span><span style="display:flex;"><span>Router (config)#crypto ipsec transform-set mine esp-des esp-md5-hmac	//设置数据的加密方式，策略名字为mine，使用ESP-DES对数据加密，ESP-MD5-HMAC对数据认证
</span></span><span style="display:flex;"><span>Router(config)# crypto map mymap 101 ipsec-isakmp  //定义一个map,调用刚才做的策略
</span></span><span style="display:flex;"><span>Router(config-crypto-map)# match address 110		//匹配出访问控制列表110的数据
</span></span><span style="display:flex;"><span>Router(config-crypto-map)# set peer 10.0.0.2      //标识对端路由器的合法IP地址
</span></span><span style="display:flex;"><span>Router(config-crypto-map)# set pfs group2
</span></span><span style="display:flex;"><span>Router(config-crypto-map)# set transform-set mine  //使用刚才定义好的策略对数据加密
</span></span><span style="display:flex;"><span>Router(config-crypto-map)# set security-association lifetime seconds 86400	//指定IPSec SA的存活期
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201003727.png" alt="image-20211201003727600"  />
</p>
</li>
<li>
<p>将<code>map</code>映射到<code>公网端口</code>，一个端口只能映射一个<code>map</code>，输入命令如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router（config）interface fastEthernet 0/0
</span></span><span style="display:flex;"><span>Router(config-if)#crypto map mymap
</span></span><span style="display:flex;"><span>*Jan  3 07:16:26.785: %CRYPTO-6-ISAKMP_ON_OFF: ISAKMP is ON
</span></span><span style="display:flex;"><span>Router（config-if）end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201003814.png" alt="image-20211201003814132"  />
</li>
</ul>
</li>
<li>
<p>查看策略</p>
<ol>
<li>
<p>查看<code>IKE策略</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router# show crypto isakmp policy
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004108.png" alt="image-20211201004108595"  />
</li>
</ul>
</li>
<li>
<p>查看<code>IPSec变换集</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router# show crypto ipsec transform-set
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004133.png" alt="image-20211201004133511"  />
</li>
</ul>
</li>
<li>
<p>查看 <code>crypto maps</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router# show crypto map
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004200.png" alt="image-20211201004200300"  />
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>配置<code>router 1</code>，双击<code>router 1</code>图标，选择<code>CLI项</code>，进入路由器配置窗口</p>
<ul>
<li>定义<code>IKE</code>的策略，与配置<code>route 0</code>相同
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004433.png" alt="image-20211201004433062"  />
</li>
</ul>
</li>
<li>定义数据的加密方式和认证方式，配置<code>IPSec</code>，与配置<code>route 0</code>相同
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004721.png" alt="image-20211201004721537"  />
</li>
</ul>
</li>
<li>将<code>map</code>映射到<code>公网端口</code>，与配置<code>route 0</code>相同
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201004820.png" alt="image-20211201004820247"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="52-测试ipsec-vpn">5.2 测试IPSec VPN<a hidden class="anchor" aria-hidden="true" href="#52-测试ipsec-vpn">#</a></h3>
<ul>
<li>
<p>测试<code>VPN连通性</code></p>
<p>双击<code>PC0</code>图标，在弹出的对话框中，选择<code>Desktop</code>，选择<code>Command Prompt</code>，<code>ping 192.168.2.10</code>，如下图所示</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005024.png" alt="image-20211201005024135"  />
</li>
</ul>
</li>
<li>
<p>验证数据经过<code>IPSec VPN</code> <code>加密传输</code>，点击进入<code>simulation mode</code>，弹出如图所示对话框</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005218.png" alt="image-20211201005218194"  />
</li>
</ul>
</li>
<li>
<p>重复上一步操作，<code>simulation Panel</code>中选取<code>Auto Capture</code>，观察工作区动画，展示了数据包在网络中的传送过程</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005424.png" alt="image-20211201005423929"  />
</li>
</ul>
</li>
<li>
<p>双击路由器<code>router 0</code>处数据包，弹出如图所示弹框，可以分析出数据包的信息</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005603.png" alt="image-20211201005603722"  />
</li>
<li>进入路由器的数据包（左侧）的信息源IP是<code>192.168.1.10</code>，目的IP是<code>192.168.2.10</code></li>
<li>路由器出去的数据包(右侧)的源IP改变为<code>10.0.0.1</code>，目的IP变为<code>10.0.0.2</code></li>
<li>从上图的第六条信息中发现<code>ESP encrypts the received packet</code>的信息</li>
<li>综上，从<code>PC0</code>（<code>192.168.1.10</code>）发往对端<code>PC3</code>（<code>192.168.2.10</code>）的数据经过了路由器的<code>IPSec VPN</code>模块加密处理，隐藏了内网的IP地址信息，从而保护了内网的数据</li>
</ul>
</li>
<li>
<p>断开<code>VPN</code></p>
<ul>
<li>
<p>断开<code>router 0</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router（config）#interface fastEthernet 0/0
</span></span><span style="display:flex;"><span>Router(config-if)#no crypto map mymap
</span></span><span style="display:flex;"><span>Router（config-if）end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005811.png" alt="image-20211201005811344"  />
</li>
</ul>
</li>
<li>
<p>双击<code>PC0</code>图标，在弹出的对话框中，选择<code>Desktop</code>，选择<code>Command Prompt</code>，<code>ping 192.168.2.10</code>，<code>ping</code>不通，表明只断开一端路由器的端口<code>map映射</code>，两边无法连通</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201005945.png" alt="image-20211201005945175"  />
</li>
</ul>
</li>
<li>
<p>以同样的方式断开route 1</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Router（config）#interface fastEthernet 0/0
</span></span><span style="display:flex;"><span>Router(config-if)#no crypto map mymap
</span></span><span style="display:flex;"><span>Router（config-if）end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201010052.png" alt="image-20211201010052171"  />
</li>
</ul>
</li>
<li>
<p>双击<code>PC0</code>图标，在弹出的对话框中，选择<code>Desktop</code>，选择<code>Command Prompt</code>，<code>ping 192.168.2.10</code>，<code>ping</code>成功，表明两端都断开后，两边网络可以再次保持连接</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201010306.png" alt="image-20211201010306640"  />
</li>
</ul>
</li>
<li>
<p>抓取经过<code>route 0</code>的数据包，发现数据不再加密传输。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211201010334.png" alt="image-20211201010333971"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x06-总结">0x06 总结<a hidden class="anchor" aria-hidden="true" href="#0x06-总结">#</a></h2>
<ul>
<li>通过配置IPSEC，明白AH和ESP的区别。</li>
<li>配置OPEN VPN,PacketTrace 对局域网的架构有了一定的了解。</li>
<li>配置多个VPN，明白了VPN的工作原理。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/vpn%E9%85%8D%E7%BD%AE/">vpn配置</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/tech/jdbc/">
    <span class="title">« Prev</span>
    <br>
    <span>Jdbc</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/">
    <span class="title">Next »</span>
    <br>
    <span>网络扫描</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
